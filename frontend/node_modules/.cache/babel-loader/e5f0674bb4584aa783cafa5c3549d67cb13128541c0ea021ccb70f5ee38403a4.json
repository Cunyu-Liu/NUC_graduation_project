{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { defineComponent, getCurrentInstance, ref, computed, onBeforeMount, onMounted, onBeforeUnmount, Fragment, h } from 'vue';\nimport { ElCheckbox } from '../../../checkbox/index.mjs';\nimport { cellStarts } from '../config.mjs';\nimport { mergeOptions, compose } from '../util.mjs';\nimport useWatcher from './watcher-helper.mjs';\nimport useRender from './render-helper.mjs';\nimport defaultProps from './defaults.mjs';\nimport { isUndefined } from '../../../../utils/types.mjs';\nimport { isArray, isString } from '@vue/shared';\nlet columnIdSeed = 1;\nvar ElTableColumn = defineComponent({\n  name: \"ElTableColumn\",\n  components: {\n    ElCheckbox\n  },\n  props: defaultProps,\n  setup(props, {\n    slots\n  }) {\n    const instance = getCurrentInstance();\n    const columnConfig = ref({});\n    const owner = computed(() => {\n      let parent2 = instance.parent;\n      while (parent2 && !parent2.tableId) {\n        parent2 = parent2.parent;\n      }\n      return parent2;\n    });\n    const {\n      registerNormalWatchers,\n      registerComplexWatchers\n    } = useWatcher(owner, props);\n    const {\n      columnId,\n      isSubColumn,\n      realHeaderAlign,\n      columnOrTableParent,\n      setColumnWidth,\n      setColumnForcedProps,\n      setColumnRenders,\n      getPropsData,\n      getColumnElIndex,\n      realAlign,\n      updateColumnOrder\n    } = useRender(props, slots, owner);\n    const parent = columnOrTableParent.value;\n    columnId.value = `${\"tableId\" in parent && parent.tableId || \"columnId\" in parent && parent.columnId}_column_${columnIdSeed++}`;\n    onBeforeMount(() => {\n      isSubColumn.value = owner.value !== parent;\n      const type = props.type || \"default\";\n      const sortable = props.sortable === \"\" ? true : props.sortable;\n      const showOverflowTooltip = type === \"selection\" ? false : isUndefined(props.showOverflowTooltip) ? parent.props.showOverflowTooltip : props.showOverflowTooltip;\n      const tooltipFormatter = isUndefined(props.tooltipFormatter) ? parent.props.tooltipFormatter : props.tooltipFormatter;\n      const defaults = {\n        ...cellStarts[type],\n        id: columnId.value,\n        type,\n        property: props.prop || props.property,\n        align: realAlign,\n        headerAlign: realHeaderAlign,\n        showOverflowTooltip,\n        tooltipFormatter,\n        filterable: props.filters || props.filterMethod,\n        filteredValue: [],\n        filterPlacement: \"\",\n        filterClassName: \"\",\n        isColumnGroup: false,\n        isSubColumn: false,\n        filterOpened: false,\n        sortable,\n        index: props.index,\n        rawColumnKey: instance.vnode.key\n      };\n      const basicProps = [\"columnKey\", \"label\", \"className\", \"labelClassName\", \"type\", \"renderHeader\", \"formatter\", \"fixed\", \"resizable\"];\n      const sortProps = [\"sortMethod\", \"sortBy\", \"sortOrders\"];\n      const selectProps = [\"selectable\", \"reserveSelection\"];\n      const filterProps = [\"filterMethod\", \"filters\", \"filterMultiple\", \"filterOpened\", \"filteredValue\", \"filterPlacement\", \"filterClassName\"];\n      let column = getPropsData(basicProps, sortProps, selectProps, filterProps);\n      column = mergeOptions(defaults, column);\n      const chains = compose(setColumnRenders, setColumnWidth, setColumnForcedProps);\n      column = chains(column);\n      columnConfig.value = column;\n      registerNormalWatchers();\n      registerComplexWatchers();\n    });\n    onMounted(() => {\n      var _a, _b;\n      const parent2 = columnOrTableParent.value;\n      const children = isSubColumn.value ? (_a = parent2.vnode.el) == null ? void 0 : _a.children : (_b = parent2.refs.hiddenColumns) == null ? void 0 : _b.children;\n      const getColumnIndex = () => getColumnElIndex(children || [], instance.vnode.el);\n      columnConfig.value.getColumnIndex = getColumnIndex;\n      const columnIndex = getColumnIndex();\n      columnIndex > -1 && owner.value.store.commit(\"insertColumn\", columnConfig.value, isSubColumn.value ? \"columnConfig\" in parent2 && parent2.columnConfig.value : null, updateColumnOrder);\n    });\n    onBeforeUnmount(() => {\n      const getColumnIndex = columnConfig.value.getColumnIndex;\n      const columnIndex = getColumnIndex ? getColumnIndex() : -1;\n      columnIndex > -1 && owner.value.store.commit(\"removeColumn\", columnConfig.value, isSubColumn.value ? \"columnConfig\" in parent && parent.columnConfig.value : null, updateColumnOrder);\n    });\n    instance.columnId = columnId.value;\n    instance.columnConfig = columnConfig;\n    return;\n  },\n  render() {\n    var _a, _b, _c;\n    try {\n      const renderDefault = (_b = (_a = this.$slots).default) == null ? void 0 : _b.call(_a, {\n        row: {},\n        column: {},\n        $index: -1\n      });\n      const children = [];\n      if (isArray(renderDefault)) {\n        for (const childNode of renderDefault) {\n          if (((_c = childNode.type) == null ? void 0 : _c.name) === \"ElTableColumn\" || childNode.shapeFlag & 2) {\n            children.push(childNode);\n          } else if (childNode.type === Fragment && isArray(childNode.children)) {\n            childNode.children.forEach(vnode2 => {\n              if ((vnode2 == null ? void 0 : vnode2.patchFlag) !== 1024 && !isString(vnode2 == null ? void 0 : vnode2.children)) {\n                children.push(vnode2);\n              }\n            });\n          }\n        }\n      }\n      const vnode = h(\"div\", children);\n      return vnode;\n    } catch (e) {\n      return h(\"div\", []);\n    }\n  }\n});\nexport { ElTableColumn as default };","map":{"version":3,"names":["columnIdSeed","ElTableColumn","defineComponent","name","components","ElCheckbox","props","defaultProps","setup","slots","instance","getCurrentInstance","columnConfig","ref","owner","computed","parent2","parent","tableId","registerNormalWatchers","registerComplexWatchers","useWatcher","columnId","isSubColumn","realHeaderAlign","columnOrTableParent","setColumnWidth","setColumnForcedProps","setColumnRenders","getPropsData","getColumnElIndex","realAlign","updateColumnOrder","useRender","value","onBeforeMount","type","sortable","showOverflowTooltip","isUndefined","tooltipFormatter","defaults","cellStarts","id","property","prop","align","headerAlign","filterable","filters","filterMethod","filteredValue","filterPlacement","filterClassName","isColumnGroup","filterOpened","index","rawColumnKey","vnode","key","basicProps","sortProps","selectProps","filterProps","column","mergeOptions","chains","compose","onMounted","_a","_b","children","el","refs","hiddenColumns","getColumnIndex","columnIndex","store","commit","onBeforeUnmount","render","_c","renderDefault","$slots","default","call","row","$index","isArray","childNode","shapeFlag","push","Fragment","forEach","vnode2","patchFlag","isString","h","e"],"sources":["../../../../../../../packages/components/table/src/table-column/index.ts"],"sourcesContent":["import {\n  Fragment,\n  computed,\n  defineComponent,\n  getCurrentInstance,\n  h,\n  onBeforeMount,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n} from 'vue'\nimport ElCheckbox from '@element-plus/components/checkbox'\nimport { isArray, isString, isUndefined } from '@element-plus/utils'\nimport { cellStarts } from '../config'\nimport { compose, mergeOptions } from '../util'\nimport useWatcher from './watcher-helper'\nimport useRender from './render-helper'\nimport defaultProps from './defaults'\n\nimport type { VNode } from 'vue'\nimport type { TableColumn, TableColumnCtx } from './defaults'\nimport type { DefaultRow } from '../table/defaults'\n\nlet columnIdSeed = 1\n\n//TODO: when vue 3.3 we can set this component a generic: https://github.com/vuejs/core/pull/7963\nexport default defineComponent({\n  name: 'ElTableColumn',\n  components: {\n    ElCheckbox,\n  },\n  props: defaultProps,\n  setup(props, { slots }) {\n    const instance = getCurrentInstance() as TableColumn<DefaultRow>\n    const columnConfig = ref<Partial<TableColumnCtx<DefaultRow>>>({})\n    const owner = computed(() => {\n      let parent = instance.parent as any\n      while (parent && !parent.tableId) {\n        parent = parent.parent\n      }\n      return parent\n    })\n\n    const { registerNormalWatchers, registerComplexWatchers } = useWatcher(\n      owner,\n      props\n    )\n    const {\n      columnId,\n      isSubColumn,\n      realHeaderAlign,\n      columnOrTableParent,\n      setColumnWidth,\n      setColumnForcedProps,\n      setColumnRenders,\n      getPropsData,\n      getColumnElIndex,\n      realAlign,\n      updateColumnOrder,\n    } = useRender(props as unknown as TableColumnCtx<DefaultRow>, slots, owner)\n\n    const parent = columnOrTableParent.value\n    columnId.value = `${\n      ('tableId' in parent && parent.tableId) ||\n      ('columnId' in parent && parent.columnId)\n    }_column_${columnIdSeed++}`\n    onBeforeMount(() => {\n      isSubColumn.value = owner.value !== parent\n\n      const type = (props.type as keyof typeof cellStarts) || 'default'\n      const sortable = props.sortable === '' ? true : props.sortable\n      //The selection column should not be affected by `showOverflowTooltip`.\n      const showOverflowTooltip =\n        type === 'selection'\n          ? false\n          : isUndefined(props.showOverflowTooltip)\n            ? parent.props.showOverflowTooltip\n            : props.showOverflowTooltip\n      const tooltipFormatter = isUndefined(props.tooltipFormatter)\n        ? parent.props.tooltipFormatter\n        : props.tooltipFormatter\n      const defaults = {\n        ...cellStarts[type],\n        id: columnId.value,\n        type,\n        property: props.prop || props.property,\n        align: realAlign,\n        headerAlign: realHeaderAlign,\n        showOverflowTooltip,\n        tooltipFormatter,\n        // filter 相关属性\n        filterable: props.filters || props.filterMethod,\n        filteredValue: [],\n        filterPlacement: '',\n        filterClassName: '',\n        isColumnGroup: false,\n        isSubColumn: false,\n        filterOpened: false,\n        // sort 相关属性\n        sortable,\n        // index 列\n        index: props.index,\n        // <el-table-column key=\"xxx\" />\n        rawColumnKey: instance.vnode.key,\n      }\n\n      const basicProps = [\n        'columnKey',\n        'label',\n        'className',\n        'labelClassName',\n        'type',\n        'renderHeader',\n        'formatter',\n        'fixed',\n        'resizable',\n      ]\n      const sortProps = ['sortMethod', 'sortBy', 'sortOrders']\n      const selectProps = ['selectable', 'reserveSelection']\n      const filterProps = [\n        'filterMethod',\n        'filters',\n        'filterMultiple',\n        'filterOpened',\n        'filteredValue',\n        'filterPlacement',\n        'filterClassName',\n      ]\n\n      let column = getPropsData(basicProps, sortProps, selectProps, filterProps)\n\n      column = mergeOptions(defaults, column)\n      // 注意 compose 中函数执行的顺序是从右到左\n      const chains = compose(\n        setColumnRenders,\n        setColumnWidth,\n        setColumnForcedProps\n      )\n      column = chains(column) as unknown as TableColumnCtx<DefaultRow>\n      columnConfig.value = column\n\n      // 注册 watcher\n      registerNormalWatchers()\n      registerComplexWatchers()\n    })\n    onMounted(() => {\n      const parent = columnOrTableParent.value\n      const children = isSubColumn.value\n        ? parent.vnode.el?.children\n        : parent.refs.hiddenColumns?.children\n      const getColumnIndex = () =>\n        getColumnElIndex(children || [], instance.vnode.el)\n      columnConfig.value.getColumnIndex = getColumnIndex\n      const columnIndex = getColumnIndex()\n      columnIndex > -1 &&\n        owner.value.store.commit(\n          'insertColumn',\n          columnConfig.value,\n          isSubColumn.value\n            ? 'columnConfig' in parent && parent.columnConfig.value\n            : null,\n          updateColumnOrder\n        )\n    })\n    onBeforeUnmount(() => {\n      const getColumnIndex = columnConfig.value.getColumnIndex\n      const columnIndex = getColumnIndex ? getColumnIndex() : -1\n      columnIndex > -1 &&\n        owner.value.store.commit(\n          'removeColumn',\n          columnConfig.value,\n          isSubColumn.value\n            ? 'columnConfig' in parent && parent.columnConfig.value\n            : null,\n          updateColumnOrder\n        )\n    })\n    instance.columnId = columnId.value\n\n    instance.columnConfig = columnConfig as any\n    return\n  },\n  render() {\n    try {\n      const renderDefault = this.$slots.default?.({\n        row: {},\n        column: {},\n        $index: -1,\n      })\n      const children = []\n      if (isArray(renderDefault)) {\n        for (const childNode of renderDefault) {\n          if (\n            (childNode.type as any)?.name === 'ElTableColumn' ||\n            childNode.shapeFlag & 2\n          ) {\n            children.push(childNode)\n          } else if (\n            childNode.type === Fragment &&\n            isArray(childNode.children)\n          ) {\n            childNode.children.forEach((vnode) => {\n              // No rendering when vnode is dynamic slot or text\n              if (\n                (vnode as VNode)?.patchFlag !== 1024 &&\n                !isString((vnode as VNode)?.children)\n              ) {\n                children.push(vnode)\n              }\n            })\n          }\n        }\n      }\n      const vnode = h('div', children)\n      return vnode\n    } catch {\n      return h('div', [])\n    }\n  },\n})\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}