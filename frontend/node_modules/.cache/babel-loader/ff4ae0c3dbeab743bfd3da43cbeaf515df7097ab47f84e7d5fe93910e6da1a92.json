{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { ref, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport { useLocale } from '../../../hooks/use-locale/index.mjs';\nimport { INPUT_EVENT, UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nimport { isArray, isDate } from '@vue/shared';\nimport { debugWarn } from '../../../utils/error.mjs';\nconst adjacentMonth = (start, end) => {\n  const firstMonthLastDay = start.endOf(\"month\");\n  const lastMonthFirstDay = end.startOf(\"month\");\n  const isSameWeek = firstMonthLastDay.isSame(lastMonthFirstDay, \"week\");\n  const lastMonthStartDay = isSameWeek ? lastMonthFirstDay.add(1, \"week\") : lastMonthFirstDay;\n  return [[start, firstMonthLastDay], [lastMonthStartDay.startOf(\"week\"), end]];\n};\nconst threeConsecutiveMonth = (start, end) => {\n  const firstMonthLastDay = start.endOf(\"month\");\n  const secondMonthFirstDay = start.add(1, \"month\").startOf(\"month\");\n  const secondMonthStartDay = firstMonthLastDay.isSame(secondMonthFirstDay, \"week\") ? secondMonthFirstDay.add(1, \"week\") : secondMonthFirstDay;\n  const secondMonthLastDay = secondMonthStartDay.endOf(\"month\");\n  const lastMonthFirstDay = end.startOf(\"month\");\n  const lastMonthStartDay = secondMonthLastDay.isSame(lastMonthFirstDay, \"week\") ? lastMonthFirstDay.add(1, \"week\") : lastMonthFirstDay;\n  return [[start, firstMonthLastDay], [secondMonthStartDay.startOf(\"week\"), secondMonthLastDay], [lastMonthStartDay.startOf(\"week\"), end]];\n};\nconst useCalendar = (props, emit, componentName) => {\n  const {\n    lang\n  } = useLocale();\n  const selectedDay = ref();\n  const now = dayjs().locale(lang.value);\n  const realSelectedDay = computed({\n    get() {\n      if (!props.modelValue) return selectedDay.value;\n      return date.value;\n    },\n    set(val) {\n      if (!val) return;\n      selectedDay.value = val;\n      const result = val.toDate();\n      emit(INPUT_EVENT, result);\n      emit(UPDATE_MODEL_EVENT, result);\n    }\n  });\n  const validatedRange = computed(() => {\n    if (!props.range || !isArray(props.range) || props.range.length !== 2 || props.range.some(item => !isDate(item))) return [];\n    const rangeArrDayjs = props.range.map(_ => dayjs(_).locale(lang.value));\n    const [startDayjs, endDayjs] = rangeArrDayjs;\n    if (startDayjs.isAfter(endDayjs)) {\n      debugWarn(componentName, \"end time should be greater than start time\");\n      return [];\n    }\n    if (startDayjs.isSame(endDayjs, \"month\")) {\n      return calculateValidatedDateRange(startDayjs, endDayjs);\n    } else {\n      if (startDayjs.add(1, \"month\").month() !== endDayjs.month()) {\n        debugWarn(componentName, \"start time and end time interval must not exceed two months\");\n        return [];\n      }\n      return calculateValidatedDateRange(startDayjs, endDayjs);\n    }\n  });\n  const date = computed(() => {\n    if (!props.modelValue) {\n      return realSelectedDay.value || (validatedRange.value.length ? validatedRange.value[0][0] : now);\n    } else {\n      return dayjs(props.modelValue).locale(lang.value);\n    }\n  });\n  const prevMonthDayjs = computed(() => date.value.subtract(1, \"month\").date(1));\n  const nextMonthDayjs = computed(() => date.value.add(1, \"month\").date(1));\n  const prevYearDayjs = computed(() => date.value.subtract(1, \"year\").date(1));\n  const nextYearDayjs = computed(() => date.value.add(1, \"year\").date(1));\n  const calculateValidatedDateRange = (startDayjs, endDayjs) => {\n    const firstDay = startDayjs.startOf(\"week\");\n    const lastDay = endDayjs.endOf(\"week\");\n    const firstMonth = firstDay.get(\"month\");\n    const lastMonth = lastDay.get(\"month\");\n    if (firstMonth === lastMonth) {\n      return [[firstDay, lastDay]];\n    } else if ((firstMonth + 1) % 12 === lastMonth) {\n      return adjacentMonth(firstDay, lastDay);\n    } else if (firstMonth + 2 === lastMonth || (firstMonth + 1) % 11 === lastMonth) {\n      return threeConsecutiveMonth(firstDay, lastDay);\n    } else {\n      debugWarn(componentName, \"start time and end time interval must not exceed two months\");\n      return [];\n    }\n  };\n  const pickDay = day => {\n    realSelectedDay.value = day;\n  };\n  const selectDate = type => {\n    const dateMap = {\n      \"prev-month\": prevMonthDayjs.value,\n      \"next-month\": nextMonthDayjs.value,\n      \"prev-year\": prevYearDayjs.value,\n      \"next-year\": nextYearDayjs.value,\n      today: now\n    };\n    const day = dateMap[type];\n    if (!day.isSame(date.value, \"day\")) {\n      pickDay(day);\n    }\n  };\n  return {\n    calculateValidatedDateRange,\n    date,\n    realSelectedDay,\n    pickDay,\n    selectDate,\n    validatedRange\n  };\n};\nexport { useCalendar };","map":{"version":3,"names":["adjacentMonth","start","end","firstMonthLastDay","endOf","lastMonthFirstDay","startOf","isSameWeek","isSame","lastMonthStartDay","add","threeConsecutiveMonth","secondMonthFirstDay","secondMonthStartDay","secondMonthLastDay","useCalendar","props","emit","componentName","lang","useLocale","selectedDay","ref","now","dayjs","locale","value","realSelectedDay","computed","get","modelValue","date","set","val","result","toDate","INPUT_EVENT","UPDATE_MODEL_EVENT","validatedRange","range","isArray","length","some","item","isDate","rangeArrDayjs","map","_","startDayjs","endDayjs","isAfter","debugWarn","calculateValidatedDateRange","month","prevMonthDayjs","subtract","nextMonthDayjs","prevYearDayjs","nextYearDayjs","firstDay","lastDay","firstMonth","lastMonth","pickDay","day","selectDate","type","dateMap","today"],"sources":["../../../../../../packages/components/calendar/src/use-calendar.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport dayjs from 'dayjs'\nimport { useLocale } from '@element-plus/hooks'\nimport { debugWarn, isArray, isDate } from '@element-plus/utils'\nimport { INPUT_EVENT, UPDATE_MODEL_EVENT } from '@element-plus/constants'\n\nimport type { ComputedRef, SetupContext } from 'vue'\nimport type { Dayjs } from 'dayjs'\nimport type { CalendarDateType, CalendarEmits, CalendarProps } from './calendar'\n\nconst adjacentMonth = (start: Dayjs, end: Dayjs): [Dayjs, Dayjs][] => {\n  const firstMonthLastDay = start.endOf('month')\n  const lastMonthFirstDay = end.startOf('month')\n\n  // Whether the last day of the first month and the first day of the last month is in the same week\n  const isSameWeek = firstMonthLastDay.isSame(lastMonthFirstDay, 'week')\n  const lastMonthStartDay = isSameWeek\n    ? lastMonthFirstDay.add(1, 'week')\n    : lastMonthFirstDay\n\n  return [\n    [start, firstMonthLastDay],\n    [lastMonthStartDay.startOf('week'), end],\n  ]\n}\n\nconst threeConsecutiveMonth = (start: Dayjs, end: Dayjs): [Dayjs, Dayjs][] => {\n  const firstMonthLastDay = start.endOf('month')\n  const secondMonthFirstDay = start.add(1, 'month').startOf('month')\n\n  // Whether the last day of the first month and the second month is in the same week\n  const secondMonthStartDay = firstMonthLastDay.isSame(\n    secondMonthFirstDay,\n    'week'\n  )\n    ? secondMonthFirstDay.add(1, 'week')\n    : secondMonthFirstDay\n\n  const secondMonthLastDay = secondMonthStartDay.endOf('month')\n  const lastMonthFirstDay = end.startOf('month')\n\n  // Whether the last day of the second month and the last day of the last month is in the same week\n  const lastMonthStartDay = secondMonthLastDay.isSame(lastMonthFirstDay, 'week')\n    ? lastMonthFirstDay.add(1, 'week')\n    : lastMonthFirstDay\n\n  return [\n    [start, firstMonthLastDay],\n    [secondMonthStartDay.startOf('week'), secondMonthLastDay],\n    [lastMonthStartDay.startOf('week'), end],\n  ]\n}\n\nexport const useCalendar = (\n  props: CalendarProps,\n  emit: SetupContext<CalendarEmits>['emit'],\n  componentName: string\n) => {\n  const { lang } = useLocale()\n\n  const selectedDay = ref<Dayjs>()\n  const now = dayjs().locale(lang.value)\n\n  const realSelectedDay = computed<Dayjs | undefined>({\n    get() {\n      if (!props.modelValue) return selectedDay.value\n      return date.value\n    },\n    set(val) {\n      if (!val) return\n      selectedDay.value = val\n      const result = val.toDate()\n\n      emit(INPUT_EVENT, result)\n      emit(UPDATE_MODEL_EVENT, result)\n    },\n  })\n\n  // if range is valid, we get a two-digit array\n  const validatedRange = computed(() => {\n    if (\n      !props.range ||\n      !isArray(props.range) ||\n      props.range.length !== 2 ||\n      props.range.some((item) => !isDate(item))\n    )\n      return []\n    const rangeArrDayjs = props.range.map((_) => dayjs(_).locale(lang.value))\n    const [startDayjs, endDayjs] = rangeArrDayjs\n    if (startDayjs.isAfter(endDayjs)) {\n      debugWarn(componentName, 'end time should be greater than start time')\n      return []\n    }\n    if (startDayjs.isSame(endDayjs, 'month')) {\n      // same month\n      return calculateValidatedDateRange(startDayjs, endDayjs)\n    } else {\n      // two months\n      if (startDayjs.add(1, 'month').month() !== endDayjs.month()) {\n        debugWarn(\n          componentName,\n          'start time and end time interval must not exceed two months'\n        )\n        return []\n      }\n      return calculateValidatedDateRange(startDayjs, endDayjs)\n    }\n  })\n\n  const date: ComputedRef<Dayjs> = computed(() => {\n    if (!props.modelValue) {\n      return (\n        realSelectedDay.value ||\n        (validatedRange.value.length ? validatedRange.value[0][0] : now)\n      )\n    } else {\n      return dayjs(props.modelValue).locale(lang.value)\n    }\n  })\n  const prevMonthDayjs = computed(() => date.value.subtract(1, 'month').date(1))\n  const nextMonthDayjs = computed(() => date.value.add(1, 'month').date(1))\n  const prevYearDayjs = computed(() => date.value.subtract(1, 'year').date(1))\n  const nextYearDayjs = computed(() => date.value.add(1, 'year').date(1))\n\n  // https://github.com/element-plus/element-plus/issues/3155\n  // Calculate the validate date range according to the start and end dates\n  const calculateValidatedDateRange = (\n    startDayjs: Dayjs,\n    endDayjs: Dayjs\n  ): [Dayjs, Dayjs][] => {\n    const firstDay = startDayjs.startOf('week')\n    const lastDay = endDayjs.endOf('week')\n    const firstMonth = firstDay.get('month')\n    const lastMonth = lastDay.get('month')\n\n    // Current mouth\n    if (firstMonth === lastMonth) {\n      return [[firstDay, lastDay]]\n    }\n    // Two adjacent months\n    else if ((firstMonth + 1) % 12 === lastMonth) {\n      return adjacentMonth(firstDay, lastDay)\n    }\n    // Three consecutive months (compatible: 2021-01-30 to 2021-02-28)\n    else if (\n      firstMonth + 2 === lastMonth ||\n      (firstMonth + 1) % 11 === lastMonth\n    ) {\n      return threeConsecutiveMonth(firstDay, lastDay)\n    }\n    // Other cases\n    else {\n      debugWarn(\n        componentName,\n        'start time and end time interval must not exceed two months'\n      )\n      return []\n    }\n  }\n\n  const pickDay = (day: Dayjs) => {\n    realSelectedDay.value = day\n  }\n\n  const selectDate = (type: CalendarDateType) => {\n    const dateMap: Record<CalendarDateType, Dayjs> = {\n      'prev-month': prevMonthDayjs.value,\n      'next-month': nextMonthDayjs.value,\n      'prev-year': prevYearDayjs.value,\n      'next-year': nextYearDayjs.value,\n      today: now,\n    }\n\n    const day = dateMap[type]\n\n    if (!day.isSame(date.value, 'day')) {\n      pickDay(day)\n    }\n  }\n\n  return {\n    calculateValidatedDateRange,\n    date,\n    realSelectedDay,\n    pickDay,\n    selectDate,\n    validatedRange,\n  }\n}\n"],"mappings":";;;;;;;;;AAUA,MAAMA,aAAA,GAAgBA,CAACC,KAAA,EAAcC,GAAiC;EAC9D,MAAAC,iBAAA,GAAoBF,KAAM,CAAAG,KAAA,CAAM,OAAO;EACvC,MAAAC,iBAAA,GAAoBH,GAAI,CAAAI,OAAA,CAAQ,OAAO;EAG7C,MAAMC,UAAa,GAAAJ,iBAAA,CAAkBK,MAAO,CAAAH,iBAAA,EAAmB,MAAM;EACrE,MAAMI,iBAAA,GAAoBF,UACtB,GAAAF,iBAAA,CAAkBK,GAAI,IAAG,MAAM,CAC/B,GAAAL,iBAAA;EAEG,QACL,CAACJ,KAAA,EAAOE,iBAAiB,GACzB,CAACM,iBAAA,CAAkBH,OAAQ,OAAM,GAAGJ,GAAG,EACzC;AACF;AAEA,MAAMS,qBAAA,GAAwBA,CAACV,KAAA,EAAcC,GAAiC;EACtE,MAAAC,iBAAA,GAAoBF,KAAM,CAAAG,KAAA,CAAM,OAAO;EAC7C,MAAMQ,mBAAA,GAAsBX,KAAM,CAAAS,GAAA,CAAI,GAAG,OAAO,EAAEJ,OAAA,CAAQ,OAAO;EAGjE,MAAMO,mBAAA,GAAsBV,iBAAkB,CAAAK,MAAA,CAC5CI,mBAAA,EACA,OAEE,GAAAA,mBAAA,CAAoBF,GAAI,IAAG,MAAM,CACjC,GAAAE,mBAAA;EAEE,MAAAE,kBAAA,GAAqBD,mBAAoB,CAAAT,KAAA,CAAM,OAAO;EACtD,MAAAC,iBAAA,GAAoBH,GAAI,CAAAI,OAAA,CAAQ,OAAO;EAGvC,MAAAG,iBAAA,GAAoBK,kBAAmB,CAAAN,MAAA,CAAOH,iBAAmB,QAAM,IACzEA,iBAAkB,CAAAK,GAAA,CAAI,CAAG,QAAM,CAC/B,GAAAL,iBAAA;EAEG,QACL,CAACJ,KAAA,EAAOE,iBAAiB,GACzB,CAACU,mBAAA,CAAoBP,OAAQ,OAAM,GAAGQ,kBAAkB,GACxD,CAACL,iBAAA,CAAkBH,OAAQ,OAAM,GAAGJ,GAAG,EACzC;AACF;AAEO,MAAMa,WAAc,GAAAA,CACzBC,KACA,EAAAC,IAAA,EACAC,aACG;EACG;IAAEC;EAAK,IAAIC,SAAU;EAE3B,MAAMC,WAAA,GAAcC,GAAW;EAC/B,MAAMC,GAAM,GAAAC,KAAA,EAAQ,CAAAC,MAAA,CAAON,IAAA,CAAKO,KAAK;EAErC,MAAMC,eAAA,GAAkBC,QAA4B;IAClDC,GAAMA,CAAA;MACJ,IAAI,CAACb,KAAM,CAAAc,UAAA,EAAY,OAAOT,WAAY,CAAAK,KAAA;MAC1C,OAAOK,IAAK,CAAAL,KAAA;IAAA,CACd;IACAM,IAAIC,GAAK;MACP,IAAI,CAACA,GAAA,EAAK;MACVZ,WAAA,CAAYK,KAAQ,GAAAO,GAAA;MACd,MAAAC,MAAA,GAASD,GAAA,CAAIE,MAAO;MAE1BlB,IAAA,CAAKmB,WAAA,EAAaF,MAAM;MACxBjB,IAAA,CAAKoB,kBAAA,EAAoBH,MAAM;IAAA;EACjC,CACD;EAGK,MAAAI,cAAA,GAAiBV,QAAA,CAAS,MAAM;IAElC,KAACZ,KAAA,CAAMuB,KACP,KAACC,OAAA,CAAQxB,KAAM,CAAAuB,KAAK,KACpBvB,KAAM,CAAAuB,KAAA,CAAME,MAAA,KAAW,CACvB,IAAAzB,KAAA,CAAMuB,KAAA,CAAMG,IAAK,CAACC,IAAA,IAAS,CAACC,MAAA,CAAOD,IAAI,CAAC,GAExC,OAAO,EAAC;IACV,MAAME,aAAgB,GAAA7B,KAAA,CAAMuB,KAAM,CAAAO,GAAA,CAAKC,CAAA,IAAMvB,KAAM,CAAAuB,CAAC,CAAE,CAAAtB,MAAA,CAAON,IAAK,CAAAO,KAAK,CAAC;IAClE,OAACsB,UAAY,EAAAC,QAAQ,CAAI,GAAAJ,aAAA;IAC3B,IAAAG,UAAA,CAAWE,OAAQ,CAAAD,QAAQ,CAAG;MAChCE,SAAA,CAAUjC,aAAA,EAAe,4CAA4C;MACrE,OAAO,EAAC;IAAA;IAEV,IAAI8B,UAAW,CAAAxC,MAAA,CAAOyC,QAAU,SAAO,CAAG;MAEjC,OAAAG,2BAAA,CAA4BJ,UAAA,EAAYC,QAAQ;IAAA,CAClD;MAED,IAAAD,UAAA,CAAWtC,GAAA,CAAI,CAAG,SAAO,EAAE2C,KAAM,OAAMJ,QAAS,CAAAI,KAAA,EAAS;QAC3DF,SAAA,CACEjC,aAAA,EACA,8DACF;QACA,OAAO,EAAC;MAAA;MAEH,OAAAkC,2BAAA,CAA4BJ,UAAA,EAAYC,QAAQ;IAAA;EACzD,CACD;EAEK,MAAAlB,IAAA,GAA2BH,QAAA,CAAS,MAAM;IAC1C,KAACZ,KAAA,CAAMc,UAAY;MAEnB,OAAAH,eAAA,CAAgBD,KAAA,KACfY,cAAe,CAAAZ,KAAA,CAAMe,MAAA,GAASH,cAAe,CAAAZ,KAAA,CAAM,GAAG,CAAK,IAAAH,GAAA;IAAA,CAEzD;MACL,OAAOC,KAAA,CAAMR,KAAM,CAAAc,UAAU,CAAE,CAAAL,MAAA,CAAON,IAAA,CAAKO,KAAK;IAAA;EAClD,CACD;EACK,MAAA4B,cAAA,GAAiB1B,QAAS,OAAMG,IAAK,CAAAL,KAAA,CAAM6B,QAAS,IAAG,OAAO,EAAExB,IAAK,EAAC,CAAC;EACvE,MAAAyB,cAAA,GAAiB5B,QAAS,OAAMG,IAAK,CAAAL,KAAA,CAAMhB,GAAI,IAAG,OAAO,EAAEqB,IAAK,EAAC,CAAC;EAClE,MAAA0B,aAAA,GAAgB7B,QAAS,OAAMG,IAAK,CAAAL,KAAA,CAAM6B,QAAS,IAAG,MAAM,EAAExB,IAAK,EAAC,CAAC;EACrE,MAAA2B,aAAA,GAAgB9B,QAAS,OAAMG,IAAK,CAAAL,KAAA,CAAMhB,GAAI,IAAG,MAAM,EAAEqB,IAAK,EAAC,CAAC;EAIhE,MAAAqB,2BAAA,GAA8BA,CAClCJ,UAAA,EACAC,QACqB;IACf,MAAAU,QAAA,GAAWX,UAAW,CAAA1C,OAAA,CAAQ,MAAM;IACpC,MAAAsD,OAAA,GAAUX,QAAS,CAAA7C,KAAA,CAAM,MAAM;IAC/B,MAAAyD,UAAA,GAAaF,QAAS,CAAA9B,GAAA,CAAI,OAAO;IACjC,MAAAiC,SAAA,GAAYF,OAAQ,CAAA/B,GAAA,CAAI,OAAO;IAGrC,IAAIgC,UAAA,KAAeC,SAAW;MAC5B,OAAO,CAAC,CAACH,QAAU,EAAAC,OAAO,CAAC;IAAA,CAGnB,WAAAC,UAAA,GAAa,CAAK,WAAOC,SAAW;MACrC,OAAA9D,aAAA,CAAc2D,QAAA,EAAUC,OAAO;IAAA,WAItCC,UAAa,SAAMC,SAAA,KAClBD,UAAa,QAAK,OAAOC,SAC1B;MACO,OAAAnD,qBAAA,CAAsBgD,QAAA,EAAUC,OAAO;IAAA,CAG3C;MACHT,SAAA,CACEjC,aAAA,EACA,8DACF;MACA,OAAO,EAAC;IAAA;EACV,CACF;EAEM,MAAA6C,OAAA,GAAWC,GAAe;IAC9BrC,eAAA,CAAgBD,KAAQ,GAAAsC,GAAA;EAAA,CAC1B;EAEM,MAAAC,UAAA,GAAcC,IAA2B;IAC7C,MAAMC,OAA2C;MAC/C,cAAcb,cAAe,CAAA5B,KAAA;MAC7B,cAAc8B,cAAe,CAAA9B,KAAA;MAC7B,aAAa+B,aAAc,CAAA/B,KAAA;MAC3B,aAAagC,aAAc,CAAAhC,KAAA;MAC3B0C,KAAO,EAAA7C;IAAA,CACT;IAEA,MAAMyC,GAAA,GAAMG,OAAQ,CAAAD,IAAA;IAEpB,IAAI,CAACF,GAAI,CAAAxD,MAAA,CAAOuB,IAAK,CAAAL,KAAA,EAAO,KAAK,CAAG;MAClCqC,OAAA,CAAQC,GAAG;IAAA;EACb,CACF;EAEO;IACLZ,2BAAA;IACArB,IAAA;IACAJ,eAAA;IACAoC,OAAA;IACAE,UAAA;IACA3B;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}