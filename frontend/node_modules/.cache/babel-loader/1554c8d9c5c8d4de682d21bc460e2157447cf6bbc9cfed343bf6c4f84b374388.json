{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport { watch } from 'vue';\nimport { isArray } from '@vue/shared';\nimport { throwError, debugWarn } from '../../../../utils/error.mjs';\nimport { isNumber } from '../../../../utils/types.mjs';\nimport { UPDATE_MODEL_EVENT, INPUT_EVENT } from '../../../../constants/event.mjs';\nconst useWatch = (props, initData, minValue, maxValue, emit, elFormItem) => {\n  const _emit = val => {\n    emit(UPDATE_MODEL_EVENT, val);\n    emit(INPUT_EVENT, val);\n  };\n  const valueChanged = () => {\n    if (props.range) {\n      return ![minValue.value, maxValue.value].every((item, index) => item === initData.oldValue[index]);\n    } else {\n      return props.modelValue !== initData.oldValue;\n    }\n  };\n  const setValues = () => {\n    var _a, _b;\n    if (props.min > props.max) {\n      throwError(\"Slider\", \"min should not be greater than max.\");\n    }\n    const val = props.modelValue;\n    if (props.range && isArray(val)) {\n      if (val[1] < props.min) {\n        _emit([props.min, props.min]);\n      } else if (val[0] > props.max) {\n        _emit([props.max, props.max]);\n      } else if (val[0] < props.min) {\n        _emit([props.min, val[1]]);\n      } else if (val[1] > props.max) {\n        _emit([val[0], props.max]);\n      } else {\n        initData.firstValue = val[0];\n        initData.secondValue = val[1];\n        if (valueChanged()) {\n          if (props.validateEvent) {\n            (_a = elFormItem == null ? void 0 : elFormItem.validate) == null ? void 0 : _a.call(elFormItem, \"change\").catch(err => debugWarn(err));\n          }\n          initData.oldValue = val.slice();\n        }\n      }\n    } else if (!props.range && isNumber(val) && !Number.isNaN(val)) {\n      if (val < props.min) {\n        _emit(props.min);\n      } else if (val > props.max) {\n        _emit(props.max);\n      } else {\n        initData.firstValue = val;\n        if (valueChanged()) {\n          if (props.validateEvent) {\n            (_b = elFormItem == null ? void 0 : elFormItem.validate) == null ? void 0 : _b.call(elFormItem, \"change\").catch(err => debugWarn(err));\n          }\n          initData.oldValue = val;\n        }\n      }\n    }\n  };\n  setValues();\n  watch(() => initData.dragging, val => {\n    if (!val) {\n      setValues();\n    }\n  });\n  watch(() => props.modelValue, (val, oldVal) => {\n    if (initData.dragging || isArray(val) && isArray(oldVal) && val.every((item, index) => item === oldVal[index]) && initData.firstValue === val[0] && initData.secondValue === val[1]) {\n      return;\n    }\n    setValues();\n  }, {\n    deep: true\n  });\n  watch(() => [props.min, props.max], () => {\n    setValues();\n  });\n};\nexport { useWatch };","map":{"version":3,"names":["useWatch","props","initData","minValue","maxValue","emit","elFormItem","_emit","val","UPDATE_MODEL_EVENT","INPUT_EVENT","valueChanged","range","value","every","item","index","oldValue","modelValue","setValues","_a","_b","min","max","throwError","isArray","firstValue","secondValue","validateEvent","validate","call","catch","err","debugWarn","slice","isNumber","Number","isNaN","watch","dragging","oldVal","deep"],"sources":["../../../../../../../packages/components/slider/src/composables/use-watch.ts"],"sourcesContent":["import { watch } from 'vue'\nimport { INPUT_EVENT, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { debugWarn, isArray, isNumber, throwError } from '@element-plus/utils'\n\nimport type { ComputedRef, SetupContext } from 'vue'\nimport type { Arrayable } from '@element-plus/utils'\nimport type { FormItemContext } from '@element-plus/components/form'\nimport type { SliderEmits, SliderInitData, SliderProps } from '../slider'\n\nexport const useWatch = (\n  props: SliderProps,\n  initData: SliderInitData,\n  minValue: ComputedRef<number>,\n  maxValue: ComputedRef<number>,\n  emit: SetupContext<SliderEmits>['emit'],\n  elFormItem: FormItemContext\n) => {\n  const _emit = (val: Arrayable<number>) => {\n    emit(UPDATE_MODEL_EVENT, val)\n    emit(INPUT_EVENT, val)\n  }\n\n  const valueChanged = () => {\n    if (props.range) {\n      return ![minValue.value, maxValue.value].every(\n        (item, index) => item === (initData.oldValue as number[])[index]\n      )\n    } else {\n      return props.modelValue !== initData.oldValue\n    }\n  }\n\n  const setValues = () => {\n    if (props.min > props.max) {\n      throwError('Slider', 'min should not be greater than max.')\n    }\n    const val = props.modelValue\n    if (props.range && isArray(val)) {\n      if (val[1] < props.min) {\n        _emit([props.min, props.min])\n      } else if (val[0] > props.max) {\n        _emit([props.max, props.max])\n      } else if (val[0] < props.min) {\n        _emit([props.min, val[1]])\n      } else if (val[1] > props.max) {\n        _emit([val[0], props.max])\n      } else {\n        initData.firstValue = val[0]\n        initData.secondValue = val[1]\n        if (valueChanged()) {\n          if (props.validateEvent) {\n            elFormItem?.validate?.('change').catch((err) => debugWarn(err))\n          }\n          initData.oldValue = val.slice()\n        }\n      }\n    } else if (!props.range && isNumber(val) && !Number.isNaN(val)) {\n      if (val < props.min) {\n        _emit(props.min)\n      } else if (val > props.max) {\n        _emit(props.max)\n      } else {\n        initData.firstValue = val\n        if (valueChanged()) {\n          if (props.validateEvent) {\n            elFormItem?.validate?.('change').catch((err) => debugWarn(err))\n          }\n          initData.oldValue = val\n        }\n      }\n    }\n  }\n\n  setValues()\n\n  watch(\n    () => initData.dragging,\n    (val) => {\n      if (!val) {\n        setValues()\n      }\n    }\n  )\n\n  watch(\n    () => props.modelValue,\n    (val, oldVal) => {\n      if (\n        initData.dragging ||\n        (isArray(val) &&\n          isArray(oldVal) &&\n          val.every((item, index) => item === oldVal[index]) &&\n          initData.firstValue === val[0] &&\n          initData.secondValue === val[1])\n      ) {\n        return\n      }\n      setValues()\n    },\n    {\n      deep: true,\n    }\n  )\n\n  watch(\n    () => [props.min, props.max],\n    () => {\n      setValues()\n    }\n  )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}