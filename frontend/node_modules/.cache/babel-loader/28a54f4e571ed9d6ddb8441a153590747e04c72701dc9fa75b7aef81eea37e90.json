{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { getCurrentInstance, onBeforeMount, onMounted, onUpdated, onUnmounted, computed } from 'vue';\nfunction useLayoutObserver(root) {\n  const instance = getCurrentInstance();\n  onBeforeMount(() => {\n    tableLayout.value.addObserver(instance);\n  });\n  onMounted(() => {\n    onColumnsChange(tableLayout.value);\n    onScrollableChange(tableLayout.value);\n  });\n  onUpdated(() => {\n    onColumnsChange(tableLayout.value);\n    onScrollableChange(tableLayout.value);\n  });\n  onUnmounted(() => {\n    tableLayout.value.removeObserver(instance);\n  });\n  const tableLayout = computed(() => {\n    const layout = root.layout;\n    if (!layout) {\n      throw new Error(\"Can not find table layout.\");\n    }\n    return layout;\n  });\n  const onColumnsChange = layout => {\n    var _a;\n    const cols = ((_a = root.vnode.el) == null ? void 0 : _a.querySelectorAll(\"colgroup > col\")) || [];\n    if (!cols.length) return;\n    const flattenColumns = layout.getFlattenColumns();\n    const columnsMap = {};\n    flattenColumns.forEach(column => {\n      columnsMap[column.id] = column;\n    });\n    for (let i = 0, j = cols.length; i < j; i++) {\n      const col = cols[i];\n      const name = col.getAttribute(\"name\");\n      const column = columnsMap[name];\n      if (column) {\n        col.setAttribute(\"width\", column.realWidth || column.width);\n      }\n    }\n  };\n  const onScrollableChange = layout => {\n    var _a, _b;\n    const cols = ((_a = root.vnode.el) == null ? void 0 : _a.querySelectorAll(\"colgroup > col[name=gutter]\")) || [];\n    for (let i = 0, j = cols.length; i < j; i++) {\n      const col = cols[i];\n      col.setAttribute(\"width\", layout.scrollY.value ? layout.gutterWidth : \"0\");\n    }\n    const ths = ((_b = root.vnode.el) == null ? void 0 : _b.querySelectorAll(\"th.gutter\")) || [];\n    for (let i = 0, j = ths.length; i < j; i++) {\n      const th = ths[i];\n      th.style.width = layout.scrollY.value ? `${layout.gutterWidth}px` : \"0\";\n      th.style.display = layout.scrollY.value ? \"\" : \"none\";\n    }\n  };\n  return {\n    tableLayout: tableLayout.value,\n    onColumnsChange,\n    onScrollableChange\n  };\n}\nexport { useLayoutObserver as default };","map":{"version":3,"names":["useLayoutObserver","root","instance","getCurrentInstance","onBeforeMount","tableLayout","value","addObserver","onMounted","onColumnsChange","onScrollableChange","onUpdated","onUnmounted","removeObserver","computed","layout","Error","_a","cols","vnode","el","querySelectorAll","length","flattenColumns","getFlattenColumns","columnsMap","forEach","column","id","i","j","col","name","getAttribute","setAttribute","realWidth","width","_b","scrollY","gutterWidth","ths","th","style","display"],"sources":["../../../../../../packages/components/table/src/layout-observer.ts"],"sourcesContent":["import {\n  computed,\n  getCurrentInstance,\n  onBeforeMount,\n  onMounted,\n  onUnmounted,\n  onUpdated,\n} from 'vue'\n\nimport type { TableHeader } from './table-header'\nimport type TableLayout from './table-layout'\nimport type { DefaultRow, Table, TableColumnCtx } from './table/defaults'\n\nfunction useLayoutObserver<T extends DefaultRow>(root: Table<T>) {\n  const instance = getCurrentInstance() as TableHeader\n  onBeforeMount(() => {\n    tableLayout.value.addObserver(instance)\n  })\n  onMounted(() => {\n    onColumnsChange(tableLayout.value)\n    onScrollableChange(tableLayout.value)\n  })\n  onUpdated(() => {\n    onColumnsChange(tableLayout.value)\n    onScrollableChange(tableLayout.value)\n  })\n  onUnmounted(() => {\n    tableLayout.value.removeObserver(instance)\n  })\n  const tableLayout = computed(() => {\n    const layout = root.layout as TableLayout<T>\n    if (!layout) {\n      throw new Error('Can not find table layout.')\n    }\n    return layout\n  })\n  const onColumnsChange = (layout: TableLayout<T>) => {\n    const cols = root.vnode.el?.querySelectorAll('colgroup > col') || []\n    if (!cols.length) return\n    const flattenColumns = layout.getFlattenColumns()\n    const columnsMap: Record<string, TableColumnCtx<T>> = {}\n    flattenColumns.forEach((column) => {\n      columnsMap[column.id] = column\n    })\n    for (let i = 0, j = cols.length; i < j; i++) {\n      const col = cols[i]\n      const name = col.getAttribute('name')\n      const column = columnsMap[name]\n      if (column) {\n        col.setAttribute('width', column.realWidth || column.width)\n      }\n    }\n  }\n\n  const onScrollableChange = (layout: TableLayout<T>) => {\n    const cols =\n      root.vnode.el?.querySelectorAll('colgroup > col[name=gutter]') || []\n    for (let i = 0, j = cols.length; i < j; i++) {\n      const col = cols[i]\n      col.setAttribute('width', layout.scrollY.value ? layout.gutterWidth : '0')\n    }\n    const ths = root.vnode.el?.querySelectorAll('th.gutter') || []\n    for (let i = 0, j = ths.length; i < j; i++) {\n      const th = ths[i]\n      th.style.width = layout.scrollY.value ? `${layout.gutterWidth}px` : '0'\n      th.style.display = layout.scrollY.value ? '' : 'none'\n    }\n  }\n\n  return {\n    tableLayout: tableLayout.value,\n    onColumnsChange,\n    onScrollableChange,\n  }\n}\n\nexport default useLayoutObserver\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}