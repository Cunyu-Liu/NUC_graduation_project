{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { computed } from 'vue';\nimport dayjs from 'dayjs';\nimport localeData from 'dayjs/plugin/localeData.js';\nimport { getPrevMonthLastDays, getMonthDays, toNestedArr } from './date-table.mjs';\nimport { WEEK_DAYS } from '../../../constants/date.mjs';\nimport { useLocale } from '../../../hooks/use-locale/index.mjs';\nimport { rangeArr } from '../../time-picker/src/utils.mjs';\nconst useDateTable = (props, emit) => {\n  dayjs.extend(localeData);\n  const firstDayOfWeek = dayjs.localeData().firstDayOfWeek();\n  const {\n    t,\n    lang\n  } = useLocale();\n  const now = dayjs().locale(lang.value);\n  const isInRange = computed(() => !!props.range && !!props.range.length);\n  const rows = computed(() => {\n    let days = [];\n    if (isInRange.value) {\n      const [start, end] = props.range;\n      const currentMonthRange = rangeArr(end.date() - start.date() + 1).map(index => ({\n        text: start.date() + index,\n        type: \"current\"\n      }));\n      let remaining = currentMonthRange.length % 7;\n      remaining = remaining === 0 ? 0 : 7 - remaining;\n      const nextMonthRange = rangeArr(remaining).map((_, index) => ({\n        text: index + 1,\n        type: \"next\"\n      }));\n      days = currentMonthRange.concat(nextMonthRange);\n    } else {\n      const firstDay = props.date.startOf(\"month\").day();\n      const prevMonthDays = getPrevMonthLastDays(props.date, (firstDay - firstDayOfWeek + 7) % 7).map(day => ({\n        text: day,\n        type: \"prev\"\n      }));\n      const currentMonthDays = getMonthDays(props.date).map(day => ({\n        text: day,\n        type: \"current\"\n      }));\n      days = [...prevMonthDays, ...currentMonthDays];\n      const remaining = 7 - (days.length % 7 || 7);\n      const nextMonthDays = rangeArr(remaining).map((_, index) => ({\n        text: index + 1,\n        type: \"next\"\n      }));\n      days = days.concat(nextMonthDays);\n    }\n    return toNestedArr(days);\n  });\n  const weekDays = computed(() => {\n    const start = firstDayOfWeek;\n    if (start === 0) {\n      return WEEK_DAYS.map(_ => t(`el.datepicker.weeks.${_}`));\n    } else {\n      return WEEK_DAYS.slice(start).concat(WEEK_DAYS.slice(0, start)).map(_ => t(`el.datepicker.weeks.${_}`));\n    }\n  });\n  const getFormattedDate = (day, type) => {\n    switch (type) {\n      case \"prev\":\n        return props.date.startOf(\"month\").subtract(1, \"month\").date(day);\n      case \"next\":\n        return props.date.startOf(\"month\").add(1, \"month\").date(day);\n      case \"current\":\n        return props.date.date(day);\n    }\n  };\n  const handlePickDay = ({\n    text,\n    type\n  }) => {\n    const date = getFormattedDate(text, type);\n    emit(\"pick\", date);\n  };\n  const getSlotData = ({\n    text,\n    type\n  }) => {\n    const day = getFormattedDate(text, type);\n    return {\n      isSelected: day.isSame(props.selectedDay),\n      type: `${type}-month`,\n      day: day.format(\"YYYY-MM-DD\"),\n      date: day.toDate()\n    };\n  };\n  return {\n    now,\n    isInRange,\n    rows,\n    weekDays,\n    getFormattedDate,\n    handlePickDay,\n    getSlotData\n  };\n};\nexport { useDateTable };","map":{"version":3,"names":["useDateTable","props","emit","dayjs","extend","localeData","firstDayOfWeek","t","lang","useLocale","now","locale","value","isInRange","computed","range","length","rows","days","start","end","currentMonthRange","rangeArr","date","map","index","text","type","remaining","nextMonthRange","_","concat","firstDay","startOf","day","prevMonthDays","getPrevMonthLastDays","currentMonthDays","getMonthDays","nextMonthDays","toNestedArr","weekDays","WEEK_DAYS","slice","getFormattedDate","subtract","add","handlePickDay","getSlotData","isSelected","isSame","selectedDay","format","toDate"],"sources":["../../../../../../packages/components/calendar/src/use-date-table.ts"],"sourcesContent":["import { computed } from 'vue'\nimport dayjs from 'dayjs'\nimport localeData from 'dayjs/plugin/localeData.js'\nimport { useLocale } from '@element-plus/hooks'\nimport { rangeArr } from '@element-plus/components/time-picker'\nimport { WEEK_DAYS } from '@element-plus/constants'\nimport { getMonthDays, getPrevMonthLastDays, toNestedArr } from './date-table'\n\nimport type { SetupContext } from 'vue'\nimport type { Dayjs } from 'dayjs'\nimport type {\n  CalendarDateCell,\n  CalendarDateCellType,\n  DateTableEmits,\n  DateTableProps,\n} from './date-table'\n\nexport const useDateTable = (\n  props: DateTableProps,\n  emit: SetupContext<DateTableEmits>['emit']\n) => {\n  dayjs.extend(localeData)\n  // https://day.js.org/docs/en/i18n/locale-data\n  const firstDayOfWeek: number = dayjs.localeData().firstDayOfWeek()\n\n  const { t, lang } = useLocale()\n  const now = dayjs().locale(lang.value)\n\n  const isInRange = computed(() => !!props.range && !!props.range.length)\n\n  const rows = computed(() => {\n    let days: CalendarDateCell[] = []\n    if (isInRange.value) {\n      const [start, end] = props.range!\n      const currentMonthRange: CalendarDateCell[] = rangeArr(\n        end.date() - start.date() + 1\n      ).map((index) => ({\n        text: start.date() + index,\n        type: 'current',\n      }))\n\n      let remaining = currentMonthRange.length % 7\n      remaining = remaining === 0 ? 0 : 7 - remaining\n      const nextMonthRange: CalendarDateCell[] = rangeArr(remaining).map(\n        (_, index) => ({\n          text: index + 1,\n          type: 'next',\n        })\n      )\n      days = currentMonthRange.concat(nextMonthRange)\n    } else {\n      const firstDay = props.date.startOf('month').day()\n      const prevMonthDays: CalendarDateCell[] = getPrevMonthLastDays(\n        props.date,\n        (firstDay - firstDayOfWeek + 7) % 7\n      ).map((day) => ({\n        text: day,\n        type: 'prev',\n      }))\n      const currentMonthDays: CalendarDateCell[] = getMonthDays(props.date).map(\n        (day) => ({\n          text: day,\n          type: 'current',\n        })\n      )\n      days = [...prevMonthDays, ...currentMonthDays]\n      const remaining = 7 - (days.length % 7 || 7)\n      const nextMonthDays: CalendarDateCell[] = rangeArr(remaining).map(\n        (_, index) => ({\n          text: index + 1,\n          type: 'next',\n        })\n      )\n      days = days.concat(nextMonthDays)\n    }\n    return toNestedArr(days)\n  })\n\n  const weekDays = computed(() => {\n    const start = firstDayOfWeek\n    if (start === 0) {\n      return WEEK_DAYS.map((_) => t(`el.datepicker.weeks.${_}`))\n    } else {\n      return WEEK_DAYS.slice(start)\n        .concat(WEEK_DAYS.slice(0, start))\n        .map((_) => t(`el.datepicker.weeks.${_}`))\n    }\n  })\n\n  const getFormattedDate = (day: number, type: CalendarDateCellType): Dayjs => {\n    switch (type) {\n      case 'prev':\n        return props.date.startOf('month').subtract(1, 'month').date(day)\n      case 'next':\n        return props.date.startOf('month').add(1, 'month').date(day)\n      case 'current':\n        return props.date.date(day)\n    }\n  }\n\n  const handlePickDay = ({ text, type }: CalendarDateCell) => {\n    const date = getFormattedDate(text, type)\n    emit('pick', date)\n  }\n\n  const getSlotData = ({ text, type }: CalendarDateCell) => {\n    const day = getFormattedDate(text, type)\n    return {\n      isSelected: day.isSame(props.selectedDay),\n      type: `${type}-month`,\n      day: day.format('YYYY-MM-DD'),\n      date: day.toDate(),\n    }\n  }\n\n  return {\n    now,\n    isInRange,\n    rows,\n    weekDays,\n    getFormattedDate,\n    handlePickDay,\n    getSlotData,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}