{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { ref, onMounted, watchEffect, unref, isRef } from 'vue';\nimport { isClient, unrefElement } from '@vueuse/core';\nimport { isNil } from 'lodash-unified';\nimport { arrow, computePosition } from '@floating-ui/dom';\nimport { keysOf } from '../../utils/objects.mjs';\nimport { buildProps } from '../../utils/vue/props/runtime.mjs';\nconst useFloatingProps = buildProps({});\nconst unrefReference = elRef => {\n  if (!isClient) return;\n  if (!elRef) return elRef;\n  const unrefEl = unrefElement(elRef);\n  if (unrefEl) return unrefEl;\n  return isRef(elRef) ? unrefEl : elRef;\n};\nconst getPositionDataWithUnit = (record, key) => {\n  const value = record == null ? void 0 : record[key];\n  return isNil(value) ? \"\" : `${value}px`;\n};\nconst useFloating = ({\n  middleware,\n  placement,\n  strategy\n}) => {\n  const referenceRef = ref();\n  const contentRef = ref();\n  const x = ref();\n  const y = ref();\n  const middlewareData = ref({});\n  const states = {\n    x,\n    y,\n    placement,\n    strategy,\n    middlewareData\n  };\n  const update = async () => {\n    if (!isClient) return;\n    const referenceEl = unrefReference(referenceRef);\n    const contentEl = unrefElement(contentRef);\n    if (!referenceEl || !contentEl) return;\n    const data = await computePosition(referenceEl, contentEl, {\n      placement: unref(placement),\n      strategy: unref(strategy),\n      middleware: unref(middleware)\n    });\n    keysOf(states).forEach(key => {\n      states[key].value = data[key];\n    });\n  };\n  onMounted(() => {\n    watchEffect(() => {\n      update();\n    });\n  });\n  return {\n    ...states,\n    update,\n    referenceRef,\n    contentRef\n  };\n};\nconst arrowMiddleware = ({\n  arrowRef,\n  padding\n}) => {\n  return {\n    name: \"arrow\",\n    options: {\n      element: arrowRef,\n      padding\n    },\n    fn(args) {\n      const arrowEl = unref(arrowRef);\n      if (!arrowEl) return {};\n      return arrow({\n        element: arrowEl,\n        padding\n      }).fn(args);\n    }\n  };\n};\nexport { arrowMiddleware, getPositionDataWithUnit, useFloating, useFloatingProps };","map":{"version":3,"names":["useFloatingProps","buildProps","unrefReference","elRef","isClient","unrefEl","unrefElement","isRef","getPositionDataWithUnit","record","key","value","isNil","useFloating","middleware","placement","strategy","referenceRef","ref","contentRef","x","y","middlewareData","states","update","referenceEl","contentEl","data","computePosition","unref","keysOf","forEach","onMounted","watchEffect","arrowMiddleware","arrowRef","padding","name","options","element","fn","args","arrowEl","arrow"],"sources":["../../../../../packages/hooks/use-floating/index.ts"],"sourcesContent":["import { isRef, onMounted, ref, unref, watchEffect } from 'vue'\nimport { unrefElement } from '@vueuse/core'\nimport { isNil } from 'lodash-unified'\nimport { arrow as arrowCore, computePosition } from '@floating-ui/dom'\nimport { buildProps, isClient, keysOf } from '@element-plus/utils'\n\nimport type { Ref, ToRefs } from 'vue'\nimport type {\n  ComputePositionReturn,\n  Middleware,\n  Placement,\n  SideObject,\n  Strategy,\n  VirtualElement,\n} from '@floating-ui/dom'\n\nexport const useFloatingProps = buildProps({} as const)\n\nexport type UseFloatingProps = ToRefs<{\n  middleware: Array<Middleware>\n  placement: Placement\n  strategy: Strategy\n}>\n\ntype ElementRef = Parameters<typeof unrefElement>['0']\n\nconst unrefReference = (\n  elRef: ElementRef | Ref<VirtualElement | undefined>\n) => {\n  if (!isClient) return\n  if (!elRef) return elRef\n  const unrefEl = unrefElement(elRef as ElementRef)\n  if (unrefEl) return unrefEl\n  return isRef(elRef) ? unrefEl : (elRef as VirtualElement)\n}\n\nexport const getPositionDataWithUnit = <T extends Record<string, number>>(\n  record: T | undefined,\n  key: keyof T\n) => {\n  const value = record?.[key]\n  return isNil(value) ? '' : `${value}px`\n}\n\nexport const useFloating = ({\n  middleware,\n  placement,\n  strategy,\n}: UseFloatingProps) => {\n  const referenceRef = ref<HTMLElement | VirtualElement>()\n  const contentRef = ref<HTMLElement>()\n  const x = ref<number>()\n  const y = ref<number>()\n  const middlewareData = ref<ComputePositionReturn['middlewareData']>({})\n\n  const states = {\n    x,\n    y,\n    placement,\n    strategy,\n    middlewareData,\n  } as const\n\n  const update = async () => {\n    if (!isClient) return\n\n    const referenceEl = unrefReference(referenceRef)\n    const contentEl = unrefElement(contentRef)\n    if (!referenceEl || !contentEl) return\n\n    const data = await computePosition(referenceEl, contentEl, {\n      placement: unref(placement),\n      strategy: unref(strategy),\n      middleware: unref(middleware),\n    })\n\n    keysOf(states).forEach((key) => {\n      states[key].value = data[key]\n    })\n  }\n\n  onMounted(() => {\n    watchEffect(() => {\n      update()\n    })\n  })\n\n  return {\n    ...states,\n    update,\n    referenceRef,\n    contentRef,\n  }\n}\n\nexport type ArrowMiddlewareProps = {\n  arrowRef: Ref<HTMLElement | null | undefined>\n  padding?: number | SideObject\n}\n\nexport const arrowMiddleware = ({\n  arrowRef,\n  padding,\n}: ArrowMiddlewareProps): Middleware => {\n  return {\n    name: 'arrow',\n    options: {\n      element: arrowRef,\n      padding,\n    },\n\n    fn(args) {\n      const arrowEl = unref(arrowRef)\n      if (!arrowEl) return {}\n\n      return arrowCore({\n        element: arrowEl,\n        padding,\n      }).fn(args)\n    },\n  }\n}\n"],"mappings":";;;;;;;;AAgBa,MAAAA,gBAAA,GAAmBC,UAAW,GAAW;AAUtD,MAAMC,cAAA,GACJC,KACG;EACH,IAAI,CAACC,QAAA,EAAU;EACf,IAAI,CAACD,KAAA,EAAc,OAAAA,KAAA;EACb,MAAAE,OAAA,GAAUC,YAAA,CAAaH,KAAmB;EAC5C,IAAAE,OAAA,EAAgB,OAAAA,OAAA;EACb,OAAAE,KAAA,CAAMJ,KAAK,IAAIE,OAAW,GAAAF,KAAA;AACnC;AAEa,MAAAK,uBAAA,GAA0BA,CACrCC,MAAA,EACAC,GACG;EACH,MAAMC,KAAA,GAAQF,MAAS,oBAAAA,MAAA,CAAAC,GAAA;EACvB,OAAOE,KAAM,CAAAD,KAAK,CAAI,QAAK,GAAGA,KAAA;AAChC;AAEO,MAAME,WAAA,GAAcA,CAAC;EAC1BC,UAAA;EACAC,SAAA;EACAC;AACF,CAAwB;EACtB,MAAMC,YAAA,GAAeC,GAAkC;EACvD,MAAMC,UAAA,GAAaD,GAAiB;EACpC,MAAME,CAAA,GAAIF,GAAY;EACtB,MAAMG,CAAA,GAAIH,GAAY;EAChB,MAAAI,cAAA,GAAiBJ,GAA6C,GAAE;EAEtE,MAAMK,MAAS;IACbH,CAAA;IACAC,CAAA;IACAN,SAAA;IACAC,QAAA;IACAM;EAAA,CACF;EAEA,MAAME,MAAA,GAAS,MAAAA,CAAA,KAAY;IACzB,IAAI,CAACpB,QAAA,EAAU;IAET,MAAAqB,WAAA,GAAcvB,cAAA,CAAee,YAAY;IACzC,MAAAS,SAAA,GAAYpB,YAAA,CAAaa,UAAU;IACrC,KAACM,WAAA,IAAe,CAACC,SAAA,EAAW;IAEhC,MAAMC,IAAO,SAAMC,eAAgB,CAAAH,WAAA,EAAaC,SAAW;MACzDX,SAAA,EAAWc,KAAA,CAAMd,SAAS;MAC1BC,QAAA,EAAUa,KAAA,CAAMb,QAAQ;MACxBF,UAAA,EAAYe,KAAA,CAAMf,UAAU;IAAA,CAC7B;IAEDgB,MAAA,CAAOP,MAAM,EAAEQ,OAAQ,CAACrB,GAAQ;MACvBa,MAAA,CAAAb,GAAA,EAAKC,KAAA,GAAQgB,IAAK,CAAAjB,GAAA;IAAA,CAC1B;EAAA,CACH;EAEAsB,SAAA,CAAU,MAAM;IACdC,WAAA,CAAY,MAAM;MACTT,MAAA;IAAA,CACR;EAAA,CACF;EAEM;IACL,GAAGD,MAAA;IACHC,MAAA;IACAP,YAAA;IACAE;EAAA,CACF;AACF;AAOO,MAAMe,eAAA,GAAkBA,CAAC;EAC9BC,QAAA;EACAC;AACF,CAAwC;EAC/B;IACLC,IAAM;IACNC,OAAS;MACPC,OAAS,EAAAJ,QAAA;MACTC;IAAA,CACF;IAEAI,GAAGC,IAAM;MACD,MAAAC,OAAA,GAAUb,KAAA,CAAMM,QAAQ;MAC9B,IAAI,CAACO,OAAA,EAAS,OAAO,EAAC;MAEtB,OAAOC,KAAU;QACfJ,OAAS,EAAAG,OAAA;QACTN;MAAA,CACD,CAAE,CAAAI,EAAA,CAAGC,IAAI;IAAA;EACZ,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}