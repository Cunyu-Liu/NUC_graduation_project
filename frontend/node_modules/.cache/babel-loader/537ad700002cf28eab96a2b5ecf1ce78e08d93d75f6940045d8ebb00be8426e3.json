{"ast":null,"code":"import { isRef, computed, watch, onScopeDispose } from 'vue';\nimport { useNamespace } from '../use-namespace/index.mjs';\nimport { throwError } from '../../utils/error.mjs';\nimport { hasClass, addClass, getStyle, removeClass } from '../../utils/dom/style.mjs';\nimport { getScrollBarWidth } from '../../utils/dom/scroll.mjs';\nconst useLockscreen = (trigger, options = {}) => {\n  if (!isRef(trigger)) {\n    throwError(\"[useLockscreen]\", \"You need to pass a ref param to this function\");\n  }\n  const ns = options.ns || useNamespace(\"popup\");\n  const hiddenCls = computed(() => ns.bm(\"parent\", \"hidden\"));\n  let scrollBarWidth = 0;\n  let withoutHiddenClass = false;\n  let bodyWidth = \"0\";\n  const cleanup = () => {\n    setTimeout(() => {\n      if (typeof document === \"undefined\") return;\n      if (withoutHiddenClass && document) {\n        document.body.style.width = bodyWidth;\n        removeClass(document.body, hiddenCls.value);\n      }\n    }, 200);\n  };\n  watch(trigger, val => {\n    if (!val) {\n      cleanup();\n      return;\n    }\n    withoutHiddenClass = !hasClass(document.body, hiddenCls.value);\n    if (withoutHiddenClass) {\n      bodyWidth = document.body.style.width;\n      addClass(document.body, hiddenCls.value);\n    }\n    scrollBarWidth = getScrollBarWidth(ns.namespace.value);\n    const bodyHasOverflow = document.documentElement.clientHeight < document.body.scrollHeight;\n    const bodyOverflowY = getStyle(document.body, \"overflowY\");\n    if (scrollBarWidth > 0 && (bodyHasOverflow || bodyOverflowY === \"scroll\") && withoutHiddenClass) {\n      document.body.style.width = `calc(100% - ${scrollBarWidth}px)`;\n    }\n  });\n  onScopeDispose(() => cleanup());\n};\nexport { useLockscreen };","map":{"version":3,"names":["useLockscreen","trigger","options","isRef","throwError","ns","useNamespace","hiddenCls","computed","bm","scrollBarWidth","withoutHiddenClass","bodyWidth","cleanup","setTimeout","document","body","style","width","removeClass","value","watch","val","hasClass","addClass","getScrollBarWidth","namespace","bodyHasOverflow","documentElement","clientHeight","scrollHeight","bodyOverflowY","getStyle","onScopeDispose"],"sources":["../../../../../packages/hooks/use-lockscreen/index.ts"],"sourcesContent":["import { computed, isRef, onScopeDispose, watch } from 'vue'\nimport {\n  addClass,\n  getScrollBarWidth,\n  getStyle,\n  hasClass,\n  removeClass,\n  throwError,\n} from '@element-plus/utils'\nimport { useNamespace } from '../use-namespace'\n\nimport type { Ref } from 'vue'\nimport type { UseNamespaceReturn } from '../use-namespace'\n\nexport type UseLockScreenOptions = {\n  ns?: UseNamespaceReturn\n  // shouldLock?: MaybeRef<boolean>\n}\n\n/**\n * Hook that monitoring the ref value to lock or unlock the screen.\n * When the trigger became true, it assumes modal is now opened and vice versa.\n * @param trigger {Ref<boolean>}\n */\nexport const useLockscreen = (\n  trigger: Ref<boolean>,\n  options: UseLockScreenOptions = {}\n) => {\n  if (!isRef(trigger)) {\n    throwError(\n      '[useLockscreen]',\n      'You need to pass a ref param to this function'\n    )\n  }\n\n  const ns = options.ns || useNamespace('popup')\n\n  const hiddenCls = computed(() => ns.bm('parent', 'hidden'))\n\n  let scrollBarWidth = 0\n  let withoutHiddenClass = false\n  let bodyWidth = '0'\n\n  const cleanup = () => {\n    setTimeout(() => {\n      // When the test case is running, the context environment simulated by jsdom may have been destroyed,\n      // and the document does not exist at this time.\n      if (typeof document === 'undefined') return\n      if (withoutHiddenClass && document) {\n        document.body.style.width = bodyWidth\n        removeClass(document.body, hiddenCls.value)\n      }\n    }, 200)\n  }\n  watch(trigger, (val) => {\n    if (!val) {\n      cleanup()\n      return\n    }\n\n    withoutHiddenClass = !hasClass(document.body, hiddenCls.value)\n    if (withoutHiddenClass) {\n      bodyWidth = document.body.style.width\n      addClass(document.body, hiddenCls.value)\n    }\n    scrollBarWidth = getScrollBarWidth(ns.namespace.value)\n    const bodyHasOverflow =\n      document.documentElement.clientHeight < document.body.scrollHeight\n    const bodyOverflowY = getStyle(document.body, 'overflowY')\n    if (\n      scrollBarWidth > 0 &&\n      (bodyHasOverflow || bodyOverflowY === 'scroll') &&\n      withoutHiddenClass\n    ) {\n      document.body.style.width = `calc(100% - ${scrollBarWidth}px)`\n    }\n  })\n  onScopeDispose(() => cleanup())\n}\n"],"mappings":";;;;;AAwBO,MAAMA,aAAgB,GAAAA,CAC3BC,OACA,EAAAC,OAAA,GAAgC,EAC7B;EACC,KAACC,KAAM,CAAAF,OAAO,CAAG;IACnBG,UAAA,CACE,mBACA,gDACF;EAAA;EAGF,MAAMC,EAAK,GAAAH,OAAA,CAAQG,EAAM,IAAAC,YAAA,CAAa,OAAO;EAE7C,MAAMC,SAAA,GAAYC,QAAS,OAAMH,EAAA,CAAGI,EAAG,WAAU,QAAQ,CAAC;EAE1D,IAAIC,cAAiB;EACrB,IAAIC,kBAAqB;EACzB,IAAIC,SAAY;EAEhB,MAAMC,OAAA,GAAUA,CAAA,KAAM;IACpBC,UAAA,CAAW,MAAM;MAGf,IAAI,OAAOC,QAAa,kBAAa;MACrC,IAAIJ,kBAAA,IAAsBI,QAAU;QACzBA,QAAA,CAAAC,IAAA,CAAKC,KAAA,CAAMC,KAAQ,GAAAN,SAAA;QAChBO,WAAA,CAAAJ,QAAA,CAASC,IAAM,EAAAT,SAAA,CAAUa,KAAK;MAAA;IAC5C,GACC,GAAG;EAAA,CACR;EACMC,KAAA,CAAApB,OAAA,EAAUqB,GAAQ;IACtB,IAAI,CAACA,GAAK;MACAT,OAAA;MACR;IAAA;IAGFF,kBAAA,GAAqB,CAACY,QAAA,CAASR,QAAS,CAAAC,IAAA,EAAMT,SAAA,CAAUa,KAAK;IAC7D,IAAIT,kBAAoB;MACVC,SAAA,GAAAG,QAAA,CAASC,IAAA,CAAKC,KAAM,CAAAC,KAAA;MACvBM,QAAA,CAAAT,QAAA,CAASC,IAAM,EAAAT,SAAA,CAAUa,KAAK;IAAA;IAExBV,cAAA,GAAAe,iBAAA,CAAkBpB,EAAG,CAAAqB,SAAA,CAAUN,KAAK;IACrD,MAAMO,eACJ,GAAAZ,QAAA,CAASa,eAAgB,CAAAC,YAAA,GAAed,QAAA,CAASC,IAAK,CAAAc,YAAA;IACxD,MAAMC,aAAgB,GAAAC,QAAA,CAASjB,QAAS,CAAAC,IAAA,EAAM,WAAW;IACzD,IACEN,cAAiB,SAChBiB,eAAmB,IAAAI,aAAA,KAAkB,aACtCpB,kBACA;MACSI,QAAA,CAAAC,IAAA,CAAKC,KAAM,CAAAC,KAAA,GAAQ,eAAeR,cAAA;IAAA;EAC7C,CACD;EACcuB,cAAA,OAAMpB,OAAA,EAAS;AAChC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}