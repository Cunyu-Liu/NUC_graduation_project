{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { ref, computed } from 'vue';\nimport { isFunction } from '@vue/shared';\nfunction useFilter(props, tree) {\n  const hiddenNodeKeySet = ref(/* @__PURE__ */new Set([]));\n  const hiddenExpandIconKeySet = ref(/* @__PURE__ */new Set([]));\n  const filterable = computed(() => {\n    return isFunction(props.filterMethod);\n  });\n  function doFilter(query) {\n    var _a;\n    if (!filterable.value) {\n      return;\n    }\n    const expandKeySet = /* @__PURE__ */new Set();\n    const hiddenExpandIconKeys = hiddenExpandIconKeySet.value;\n    const hiddenKeys = hiddenNodeKeySet.value;\n    const family = [];\n    const nodes = ((_a = tree.value) == null ? void 0 : _a.treeNodes) || [];\n    const filter = props.filterMethod;\n    hiddenKeys.clear();\n    function traverse(nodes2) {\n      nodes2.forEach(node => {\n        family.push(node);\n        if (filter == null ? void 0 : filter(query, node.data, node)) {\n          family.forEach(member => {\n            expandKeySet.add(member.key);\n            member.expanded = true;\n          });\n        } else {\n          node.expanded = false;\n          if (node.isLeaf) {\n            hiddenKeys.add(node.key);\n          }\n        }\n        const children = node.children;\n        if (children) {\n          traverse(children);\n        }\n        if (!node.isLeaf) {\n          if (!expandKeySet.has(node.key)) {\n            hiddenKeys.add(node.key);\n          } else if (children) {\n            let allHidden = true;\n            for (const childNode of children) {\n              if (!hiddenKeys.has(childNode.key)) {\n                allHidden = false;\n                break;\n              }\n            }\n            if (allHidden) {\n              hiddenExpandIconKeys.add(node.key);\n            } else {\n              hiddenExpandIconKeys.delete(node.key);\n            }\n          }\n        }\n        family.pop();\n      });\n    }\n    traverse(nodes);\n    return expandKeySet;\n  }\n  function isForceHiddenExpandIcon(node) {\n    return hiddenExpandIconKeySet.value.has(node.key);\n  }\n  return {\n    hiddenExpandIconKeySet,\n    hiddenNodeKeySet,\n    doFilter,\n    isForceHiddenExpandIcon\n  };\n}\nexport { useFilter };","map":{"version":3,"names":["useFilter","props","tree","hiddenNodeKeySet","ref","Set","hiddenExpandIconKeySet","filterable","computed","isFunction","filterMethod","doFilter","query","_a","value","expandKeySet","hiddenExpandIconKeys","hiddenKeys","family","nodes","treeNodes","filter","clear","traverse","nodes2","forEach","node","push","data","member","add","key","expanded","isLeaf","children","has","allHidden","childNode","delete","pop","isForceHiddenExpandIcon"],"sources":["../../../../../../../packages/components/tree-v2/src/composables/useFilter.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport { isFunction } from '@element-plus/utils'\n\nimport type { Ref } from 'vue'\nimport type { Tree, TreeKey, TreeNode, TreeProps } from '../types'\n\n// When the data volume is very large using filter will cause lag\n// I haven't found a better way to optimize it for now\n// Maybe this problem should be left to the server side\nexport function useFilter(props: TreeProps, tree: Ref<Tree | undefined>) {\n  const hiddenNodeKeySet = ref<Set<TreeKey>>(new Set([]))\n  const hiddenExpandIconKeySet = ref<Set<TreeKey>>(new Set([]))\n\n  const filterable = computed(() => {\n    return isFunction(props.filterMethod)\n  })\n\n  function doFilter(query: string) {\n    if (!filterable.value) {\n      return\n    }\n    const expandKeySet = new Set<TreeKey>()\n    const hiddenExpandIconKeys = hiddenExpandIconKeySet.value\n    const hiddenKeys = hiddenNodeKeySet.value\n    const family: TreeNode[] = []\n    const nodes = tree.value?.treeNodes || []\n    const filter = props.filterMethod\n    hiddenKeys.clear()\n    function traverse(nodes: TreeNode[]) {\n      nodes.forEach((node) => {\n        family.push(node)\n        if (filter?.(query, node.data, node)) {\n          family.forEach((member) => {\n            expandKeySet.add(member.key)\n            member.expanded = true\n          })\n        } else {\n          node.expanded = false\n          if (node.isLeaf) {\n            hiddenKeys.add(node.key)\n          }\n        }\n        const children = node.children\n        if (children) {\n          traverse(children)\n        }\n        if (!node.isLeaf) {\n          if (!expandKeySet.has(node.key)) {\n            hiddenKeys.add(node.key)\n          } else if (children) {\n            // If all child nodes are hidden, then the expand icon will be hidden\n            let allHidden = true\n            for (const childNode of children) {\n              if (!hiddenKeys.has(childNode.key)) {\n                allHidden = false\n                break\n              }\n            }\n            if (allHidden) {\n              hiddenExpandIconKeys.add(node.key)\n            } else {\n              hiddenExpandIconKeys.delete(node.key)\n            }\n          }\n        }\n        family.pop()\n      })\n    }\n    traverse(nodes)\n    return expandKeySet\n  }\n\n  function isForceHiddenExpandIcon(node: TreeNode): boolean {\n    return hiddenExpandIconKeySet.value.has(node.key)\n  }\n\n  return {\n    hiddenExpandIconKeySet,\n    hiddenNodeKeySet,\n    doFilter,\n    isForceHiddenExpandIcon,\n  }\n}\n"],"mappings":";;;;;;;;;;;;AASgB,SAAAA,UAAUC,KAAA,EAAkBC,IAA6B;EACvE,MAAMC,gBAAA,GAAmBC,GAAkB,oBAAIC,GAAI,GAAE,CAAC;EACtD,MAAMC,sBAAA,GAAyBF,GAAkB,oBAAIC,GAAI,GAAE,CAAC;EAEtD,MAAAE,UAAA,GAAaC,QAAA,CAAS,MAAM;IACzB,OAAAC,UAAA,CAAWR,KAAA,CAAMS,YAAY;EAAA,CACrC;EAED,SAASC,SAASC,KAAe;IAjBnC,IAAAC,EAAA;IAkBQ,KAACN,UAAA,CAAWO,KAAO;MACrB;IAAA;IAEI,MAAAC,YAAA,sBAAmBV,GAAa;IACtC,MAAMW,oBAAA,GAAuBV,sBAAuB,CAAAQ,KAAA;IACpD,MAAMG,UAAA,GAAad,gBAAiB,CAAAW,KAAA;IACpC,MAAMI,MAAA,GAAqB,EAAC;IAC5B,MAAMC,KAAQ,KAAAN,EAAA,GAAAX,IAAA,CAAKY,KAAL,qBAAAD,EAAA,CAAYO,SAAA,KAAa,EAAC;IACxC,MAAMC,MAAA,GAASpB,KAAM,CAAAS,YAAA;IACrBO,UAAA,CAAWK,KAAM;IACjB,SAASC,SAASC,MAAmB;MACnCA,MAAA,CAAMC,OAAQ,CAACC,IAAS;QACtBR,MAAA,CAAOS,IAAA,CAAKD,IAAI;QAChB,IAAIL,MAAS,oBAAAA,MAAA,CAAAT,KAAA,EAAOc,IAAK,CAAAE,IAAA,EAAMF,IAAO;UAC7BR,MAAA,CAAAO,OAAA,CAASI,MAAW;YACZd,YAAA,CAAAe,GAAA,CAAID,MAAA,CAAOE,GAAG;YAC3BF,MAAA,CAAOG,QAAW;UAAA,CACnB;QAAA,CACI;UACLN,IAAA,CAAKM,QAAW;UAChB,IAAIN,IAAA,CAAKO,MAAQ;YACJhB,UAAA,CAAAa,GAAA,CAAIJ,IAAA,CAAKK,GAAG;UAAA;QACzB;QAEF,MAAMG,QAAA,GAAWR,IAAK,CAAAQ,QAAA;QACtB,IAAIA,QAAU;UACZX,QAAA,CAASW,QAAQ;QAAA;QAEf,KAACR,IAAA,CAAKO,MAAQ;UAChB,IAAI,CAAClB,YAAA,CAAaoB,GAAI,CAAAT,IAAA,CAAKK,GAAG,CAAG;YACpBd,UAAA,CAAAa,GAAA,CAAIJ,IAAA,CAAKK,GAAG;UAAA,WACdG,QAAU;YAEnB,IAAIE,SAAY;YAChB,WAAWC,SAAA,IAAaH,QAAU;cAChC,IAAI,CAACjB,UAAA,CAAWkB,GAAI,CAAAE,SAAA,CAAUN,GAAG,CAAG;gBACtBK,SAAA;gBACZ;cAAA;YACF;YAEF,IAAIA,SAAW;cACQpB,oBAAA,CAAAc,GAAA,CAAIJ,IAAA,CAAKK,GAAG;YAAA,CAC5B;cACgBf,oBAAA,CAAAsB,MAAA,CAAOZ,IAAA,CAAKK,GAAG;YAAA;UACtC;QACF;QAEFb,MAAA,CAAOqB,GAAI;MAAA,CACZ;IAAA;IAEHhB,QAAA,CAASJ,KAAK;IACP,OAAAJ,YAAA;EAAA;EAGT,SAASyB,wBAAwBd,IAAyB;IACxD,OAAOpB,sBAAuB,CAAAQ,KAAA,CAAMqB,GAAI,CAAAT,IAAA,CAAKK,GAAG;EAAA;EAG3C;IACLzB,sBAAA;IACAH,gBAAA;IACAQ,QAAA;IACA6B;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}