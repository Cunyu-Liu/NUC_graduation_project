{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { getCurrentInstance, watch } from 'vue';\nimport { parseWidth, parseMinWidth } from '../util.mjs';\nimport { hasOwn } from '@vue/shared';\nimport { isUndefined } from '../../../../utils/types.mjs';\nfunction getAllAliases(props, aliases) {\n  return props.reduce((prev, cur) => {\n    prev[cur] = cur;\n    return prev;\n  }, aliases);\n}\nfunction useWatcher(owner, props_) {\n  const instance = getCurrentInstance();\n  const registerComplexWatchers = () => {\n    const props = [\"fixed\"];\n    const aliases = {\n      realWidth: \"width\",\n      realMinWidth: \"minWidth\"\n    };\n    const allAliases = getAllAliases(props, aliases);\n    Object.keys(allAliases).forEach(key => {\n      const columnKey = aliases[key];\n      if (hasOwn(props_, columnKey)) {\n        watch(() => props_[columnKey], newVal => {\n          let value = newVal;\n          if (columnKey === \"width\" && key === \"realWidth\") {\n            value = parseWidth(newVal);\n          }\n          if (columnKey === \"minWidth\" && key === \"realMinWidth\") {\n            value = parseMinWidth(newVal);\n          }\n          instance.columnConfig.value[columnKey] = value;\n          instance.columnConfig.value[key] = value;\n          const updateColumns = columnKey === \"fixed\";\n          owner.value.store.scheduleLayout(updateColumns);\n        });\n      }\n    });\n  };\n  const registerNormalWatchers = () => {\n    const props = [\"label\", \"filters\", \"filterMultiple\", \"filteredValue\", \"sortable\", \"index\", \"formatter\", \"className\", \"labelClassName\", \"filterClassName\", \"showOverflowTooltip\", \"tooltipFormatter\", \"resizable\"];\n    const parentProps = [\"showOverflowTooltip\"];\n    const aliases = {\n      property: \"prop\",\n      align: \"realAlign\",\n      headerAlign: \"realHeaderAlign\"\n    };\n    const allAliases = getAllAliases(props, aliases);\n    Object.keys(allAliases).forEach(key => {\n      const columnKey = aliases[key];\n      if (hasOwn(props_, columnKey)) {\n        watch(() => props_[columnKey], newVal => {\n          instance.columnConfig.value[key] = newVal;\n          if (key === \"filters\" || key === \"filterMethod\") {\n            instance.columnConfig.value[\"filterable\"] = !!(instance.columnConfig.value[\"filters\"] || instance.columnConfig.value[\"filterMethod\"]);\n          }\n        });\n      }\n    });\n    parentProps.forEach(key => {\n      if (hasOwn(owner.value.props, key)) {\n        watch(() => owner.value.props[key], newVal => {\n          if (instance.columnConfig.value.type === \"selection\") return;\n          if (!isUndefined(props_[key])) return;\n          instance.columnConfig.value[key] = newVal;\n        });\n      }\n    });\n  };\n  return {\n    registerComplexWatchers,\n    registerNormalWatchers\n  };\n}\nexport { useWatcher as default };","map":{"version":3,"names":["getAllAliases","props","aliases","reduce","prev","cur","useWatcher","owner","props_","instance","getCurrentInstance","registerComplexWatchers","realWidth","realMinWidth","allAliases","Object","keys","forEach","key","columnKey","hasOwn","watch","newVal","value","parseWidth","parseMinWidth","columnConfig","updateColumns","store","scheduleLayout","registerNormalWatchers","parentProps","property","align","headerAlign","type","isUndefined"],"sources":["../../../../../../../packages/components/table/src/table-column/watcher-helper.ts"],"sourcesContent":["import { getCurrentInstance, watch } from 'vue'\nimport { hasOwn, isUndefined } from '@element-plus/utils'\nimport { parseMinWidth, parseWidth } from '../util'\n\nimport type { ComputedRef } from 'vue'\nimport type { DefaultRow } from '../table/defaults'\nimport type { TableColumn, TableColumnCtx, ValueOf } from './defaults'\n\nfunction getAllAliases(props: string[], aliases: Record<string, string>) {\n  return props.reduce((prev, cur) => {\n    prev[cur as keyof typeof prev] = cur\n    return prev\n  }, aliases)\n}\nfunction useWatcher<T extends DefaultRow>(\n  owner: ComputedRef<any>,\n  props_: Partial<TableColumnCtx<T>>\n) {\n  const instance = getCurrentInstance() as TableColumn<T>\n  const registerComplexWatchers = () => {\n    const props = ['fixed']\n    const aliases: Record<string, string> = {\n      realWidth: 'width',\n      realMinWidth: 'minWidth',\n    }\n    const allAliases = getAllAliases(props, aliases)\n    Object.keys(allAliases).forEach((key) => {\n      const columnKey = aliases[key]\n      if (hasOwn(props_, columnKey)) {\n        watch(\n          () => props_[columnKey],\n          (newVal) => {\n            let value: ValueOf<TableColumnCtx<T>> = newVal\n            if (columnKey === 'width' && key === 'realWidth') {\n              value = parseWidth(newVal)\n            }\n            if (columnKey === 'minWidth' && key === 'realMinWidth') {\n              value = parseMinWidth(newVal)\n            }\n            instance.columnConfig.value[columnKey as never] = value as never\n            instance.columnConfig.value[key as never] = value as never\n            const updateColumns = columnKey === 'fixed'\n            owner.value.store.scheduleLayout(updateColumns)\n          }\n        )\n      }\n    })\n  }\n  const registerNormalWatchers = () => {\n    const props = [\n      'label',\n      'filters',\n      'filterMultiple',\n      'filteredValue',\n      'sortable',\n      'index',\n      'formatter',\n      'className',\n      'labelClassName',\n      'filterClassName',\n      'showOverflowTooltip',\n      'tooltipFormatter',\n      'resizable',\n    ]\n    const parentProps = ['showOverflowTooltip']\n    const aliases: Record<string, string> = {\n      property: 'prop',\n      align: 'realAlign',\n      headerAlign: 'realHeaderAlign',\n    }\n    const allAliases = getAllAliases(props, aliases)\n    Object.keys(allAliases).forEach((key) => {\n      const columnKey = aliases[key]\n      if (hasOwn(props_, columnKey)) {\n        watch(\n          () => props_[columnKey],\n          (newVal) => {\n            instance.columnConfig.value[key as never] = newVal\n            if (key === 'filters' || key === 'filterMethod') {\n              instance.columnConfig.value['filterable'] = !!(\n                instance.columnConfig.value['filters'] ||\n                instance.columnConfig.value['filterMethod']\n              )\n            }\n          }\n        )\n      }\n    })\n    parentProps.forEach((key) => {\n      if (hasOwn(owner.value.props, key)) {\n        watch(\n          () => owner.value.props[key],\n          (newVal) => {\n            if (instance.columnConfig.value.type === 'selection') return\n            if (!isUndefined(props_[key])) return\n            instance.columnConfig.value[key] = newVal as never\n          }\n        )\n      }\n    })\n  }\n\n  return {\n    registerComplexWatchers,\n    registerNormalWatchers,\n  }\n}\n\nexport default useWatcher\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}