{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { computed, unref } from 'vue';\nimport { SortOrder, oppositeOrderMap } from '../constants.mjs';\nimport { placeholderSign } from '../private.mjs';\nimport { calcColumnStyle } from './utils.mjs';\nimport { isObject } from '@vue/shared';\nfunction useColumns(props, columns, fixed) {\n  const _columns = computed(() => unref(columns).map((column, index) => {\n    var _a, _b;\n    return {\n      ...column,\n      key: (_b = (_a = column.key) != null ? _a : column.dataKey) != null ? _b : index\n    };\n  }));\n  const visibleColumns = computed(() => {\n    return unref(_columns).filter(column => !column.hidden);\n  });\n  const fixedColumnsOnLeft = computed(() => unref(visibleColumns).filter(column => column.fixed === \"left\" || column.fixed === true));\n  const fixedColumnsOnRight = computed(() => unref(visibleColumns).filter(column => column.fixed === \"right\"));\n  const normalColumns = computed(() => unref(visibleColumns).filter(column => !column.fixed));\n  const mainColumns = computed(() => {\n    const ret = [];\n    unref(fixedColumnsOnLeft).forEach(column => {\n      ret.push({\n        ...column,\n        placeholderSign\n      });\n    });\n    unref(normalColumns).forEach(column => {\n      ret.push(column);\n    });\n    unref(fixedColumnsOnRight).forEach(column => {\n      ret.push({\n        ...column,\n        placeholderSign\n      });\n    });\n    return ret;\n  });\n  const hasFixedColumns = computed(() => {\n    return unref(fixedColumnsOnLeft).length || unref(fixedColumnsOnRight).length;\n  });\n  const columnsStyles = computed(() => {\n    return unref(_columns).reduce((style, column) => {\n      style[column.key] = calcColumnStyle(column, unref(fixed), props.fixed);\n      return style;\n    }, {});\n  });\n  const columnsTotalWidth = computed(() => {\n    return unref(visibleColumns).reduce((width, column) => width + column.width, 0);\n  });\n  const getColumn = key => {\n    return unref(_columns).find(column => column.key === key);\n  };\n  const getColumnStyle = key => {\n    return unref(columnsStyles)[key];\n  };\n  const updateColumnWidth = (column, width) => {\n    column.width = width;\n  };\n  function onColumnSorted(e) {\n    var _a;\n    const {\n      key\n    } = e.currentTarget.dataset;\n    if (!key) return;\n    const {\n      sortState,\n      sortBy\n    } = props;\n    let order = SortOrder.ASC;\n    if (isObject(sortState)) {\n      order = oppositeOrderMap[sortState[key]];\n    } else {\n      order = oppositeOrderMap[sortBy.order];\n    }\n    (_a = props.onColumnSort) == null ? void 0 : _a.call(props, {\n      column: getColumn(key),\n      key,\n      order\n    });\n  }\n  return {\n    columns: _columns,\n    columnsStyles,\n    columnsTotalWidth,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    hasFixedColumns,\n    mainColumns,\n    normalColumns,\n    visibleColumns,\n    getColumn,\n    getColumnStyle,\n    updateColumnWidth,\n    onColumnSorted\n  };\n}\nexport { useColumns };","map":{"version":3,"names":["useColumns","props","columns","fixed","_columns","computed","unref","map","column","index","_a","_b","key","dataKey","visibleColumns","filter","hidden","fixedColumnsOnLeft","fixedColumnsOnRight","normalColumns","mainColumns","ret","forEach","push","placeholderSign","hasFixedColumns","length","columnsStyles","reduce","style","calcColumnStyle","columnsTotalWidth","width","getColumn","find","getColumnStyle","updateColumnWidth","onColumnSorted","e","currentTarget","dataset","sortState","sortBy","order","SortOrder","ASC","isObject","oppositeOrderMap","onColumnSort","call"],"sources":["../../../../../../../packages/components/table-v2/src/composables/use-columns.ts"],"sourcesContent":["import { computed, unref } from 'vue'\nimport { isObject } from '@element-plus/utils'\nimport { SortOrder, oppositeOrderMap } from '../constants'\nimport { placeholderSign } from '../private'\nimport { calcColumnStyle } from './utils'\n\nimport type { CSSProperties, Ref } from 'vue'\nimport type { TableV2Props } from '../table'\nimport type { AnyColumns, Column, KeyType } from '../types'\n\nfunction useColumns(\n  props: TableV2Props,\n  columns: Ref<AnyColumns>,\n  fixed: Ref<boolean>\n) {\n  const _columns = computed(() =>\n    unref(columns).map((column, index) => ({\n      ...column,\n      key: column.key ?? column.dataKey ?? index,\n    }))\n  )\n\n  const visibleColumns = computed(() => {\n    return unref(_columns).filter((column) => !column.hidden)\n  })\n\n  const fixedColumnsOnLeft = computed(() =>\n    unref(visibleColumns).filter(\n      (column) => column.fixed === 'left' || column.fixed === true\n    )\n  )\n\n  const fixedColumnsOnRight = computed(() =>\n    unref(visibleColumns).filter((column) => column.fixed === 'right')\n  )\n\n  const normalColumns = computed(() =>\n    unref(visibleColumns).filter((column) => !column.fixed)\n  )\n\n  const mainColumns = computed(() => {\n    const ret: AnyColumns = []\n\n    unref(fixedColumnsOnLeft).forEach((column) => {\n      ret.push({\n        ...column,\n        placeholderSign,\n      })\n    })\n\n    unref(normalColumns).forEach((column) => {\n      ret.push(column)\n    })\n\n    unref(fixedColumnsOnRight).forEach((column) => {\n      ret.push({\n        ...column,\n        placeholderSign,\n      })\n    })\n\n    return ret\n  })\n\n  const hasFixedColumns = computed(() => {\n    return unref(fixedColumnsOnLeft).length || unref(fixedColumnsOnRight).length\n  })\n\n  const columnsStyles = computed(() => {\n    return unref(_columns).reduce<Record<KeyType, CSSProperties>>(\n      (style, column) => {\n        style[column.key] = calcColumnStyle(column, unref(fixed), props.fixed)\n        return style\n      },\n      {}\n    )\n  })\n\n  const columnsTotalWidth = computed(() => {\n    return unref(visibleColumns).reduce(\n      (width, column) => width + column.width,\n      0\n    )\n  })\n\n  const getColumn = (key: KeyType) => {\n    return unref(_columns).find((column) => column.key === key)\n  }\n\n  const getColumnStyle = (key: KeyType) => {\n    return unref(columnsStyles)[key]\n  }\n\n  const updateColumnWidth = (column: Column<any>, width: number) => {\n    column.width = width\n  }\n\n  function onColumnSorted(e: MouseEvent) {\n    const { key } = (e.currentTarget as HTMLElement).dataset\n    if (!key) return\n    const { sortState, sortBy } = props\n\n    let order = SortOrder.ASC\n\n    if (isObject(sortState)) {\n      order = oppositeOrderMap[sortState[key]]\n    } else {\n      order = oppositeOrderMap[sortBy.order]\n    }\n\n    props.onColumnSort?.({ column: getColumn(key)!, key, order })\n  }\n\n  return {\n    columns: _columns,\n    columnsStyles,\n    columnsTotalWidth,\n    fixedColumnsOnLeft,\n    fixedColumnsOnRight,\n    hasFixedColumns,\n    mainColumns,\n    normalColumns,\n    visibleColumns,\n\n    getColumn,\n    getColumnStyle,\n    updateColumnWidth,\n    onColumnSorted,\n  }\n}\n\nexport { useColumns }\nexport type UseColumnsReturn = ReturnType<typeof useColumns>\n"],"mappings":";;;;;;;;;;;;AAUA,SAASA,WACPC,KACA,EAAAC,OAAA,EACAC,KACA;EACA,MAAMC,QAAW,GAAAC,QAAA,CAAS,MACxBC,KAAM,CAAAJ,OAAO,EAAEK,GAAI,EAACC,MAAA,EAAQC,KAAO;IAhBvC,IAAAC,EAAA,EAAAC,EAAA;IAgB2C;MACrC,GAAGH,MAAA;MACHI,GAAA,GAAKD,EAAO,IAAAD,EAAA,GAAAF,MAAA,CAAAI,GAAA,KAAP,IAAc,GAAAF,EAAA,GAAAF,MAAA,CAAOK,OAAA,KAArB,IAAgC,GAAAF,EAAA,GAAAF;IAAA,CACvC;EAAA,CAAE,EACJ;EAEM,MAAAK,cAAA,GAAiBT,QAAA,CAAS,MAAM;IAC7B,OAAAC,KAAA,CAAMF,QAAQ,CAAE,CAAAW,MAAA,CAAQP,MAAW,KAACA,MAAA,CAAOQ,MAAM;EAAA,CACzD;EAED,MAAMC,kBAAqB,GAAAZ,QAAA,CAAS,MAClCC,KAAM,CAAAQ,cAAc,CAAE,CAAAC,MAAA,CACnBP,MAAW,IAAAA,MAAA,CAAOL,KAAU,eAAUK,MAAA,CAAOL,KAAU,UAC1D,CACF;EAEA,MAAMe,mBAAsB,GAAAb,QAAA,CAAS,MACnCC,KAAA,CAAMQ,cAAc,EAAEC,MAAA,CAAQP,MAAA,IAAWA,MAAO,CAAAL,KAAA,KAAU,OAAO,EACnE;EAEA,MAAMgB,aAAgB,GAAAd,QAAA,CAAS,MAC7BC,KAAA,CAAMQ,cAAc,EAAEC,MAAA,CAAQP,MAAA,IAAW,CAACA,MAAA,CAAOL,KAAK,EACxD;EAEM,MAAAiB,WAAA,GAAcf,QAAA,CAAS,MAAM;IACjC,MAAMgB,GAAA,GAAkB,EAAC;IAEzBf,KAAA,CAAMW,kBAAkB,EAAEK,OAAQ,CAACd,MAAW;MAC5Ca,GAAA,CAAIE,IAAK;QACP,GAAGf,MAAA;QACHgB;MAAA,CACD;IAAA,CACF;IAEDlB,KAAA,CAAMa,aAAa,EAAEG,OAAQ,CAACd,MAAW;MACvCa,GAAA,CAAIE,IAAA,CAAKf,MAAM;IAAA,CAChB;IAEDF,KAAA,CAAMY,mBAAmB,EAAEI,OAAQ,CAACd,MAAW;MAC7Ca,GAAA,CAAIE,IAAK;QACP,GAAGf,MAAA;QACHgB;MAAA,CACD;IAAA,CACF;IAEM,OAAAH,GAAA;EAAA,CACR;EAEK,MAAAI,eAAA,GAAkBpB,QAAA,CAAS,MAAM;IACrC,OAAOC,KAAA,CAAMW,kBAAkB,EAAES,MAAU,IAAApB,KAAA,CAAMY,mBAAmB,CAAE,CAAAQ,MAAA;EAAA,CACvE;EAEK,MAAAC,aAAA,GAAgBtB,QAAA,CAAS,MAAM;IAC5B,OAAAC,KAAA,CAAMF,QAAQ,CAAE,CAAAwB,MAAA,CACrB,CAACC,KAAA,EAAOrB,MAAW;MACXqB,KAAA,CAAArB,MAAA,CAAOI,GAAA,IAAOkB,eAAgB,CAAAtB,MAAA,EAAQF,KAAA,CAAMH,KAAK,GAAGF,KAAA,CAAME,KAAK;MAC9D,OAAA0B,KAAA;IAAA,CACT,EACA,EAAC,CACH;EAAA,CACD;EAEK,MAAAE,iBAAA,GAAoB1B,QAAA,CAAS,MAAM;IAChC,OAAAC,KAAA,CAAMQ,cAAc,CAAE,CAAAc,MAAA,CAC3B,CAACI,KAAA,EAAOxB,MAAW,KAAAwB,KAAA,GAAQxB,MAAO,CAAAwB,KAAA,EAClC,EACF;EAAA,CACD;EAEK,MAAAC,SAAA,GAAarB,GAAiB;IAC3B,OAAAN,KAAA,CAAMF,QAAQ,CAAE,CAAA8B,IAAA,CAAM1B,MAAW,IAAAA,MAAA,CAAOI,GAAA,KAAQA,GAAG;EAAA,CAC5D;EAEM,MAAAuB,cAAA,GAAkBvB,GAAiB;IAChC,OAAAN,KAAA,CAAMqB,aAAa,CAAE,CAAAf,GAAA;EAAA,CAC9B;EAEM,MAAAwB,iBAAA,GAAoBA,CAAC5B,MAAA,EAAqBwB,KAAkB;IAChExB,MAAA,CAAOwB,KAAQ,GAAAA,KAAA;EAAA,CACjB;EAEA,SAASK,eAAeC,CAAe;IAjGzC,IAAA5B,EAAA;IAkGI,MAAM;MAAEE;IAAA,CAAS,GAAA0B,CAAA,CAAEC,aAA8B,CAAAC,OAAA;IACjD,IAAI,CAAC5B,GAAA,EAAK;IACJ;MAAE6B,SAAW;MAAAC;IAAA,CAAW,GAAAzC,KAAA;IAE9B,IAAI0C,KAAA,GAAQC,SAAU,CAAAC,GAAA;IAElB,IAAAC,QAAA,CAASL,SAAS,CAAG;MACvBE,KAAA,GAAQI,gBAAA,CAAiBN,SAAU,CAAA7B,GAAA;IAAA,CAC9B;MACL+B,KAAA,GAAQI,gBAAA,CAAiBL,MAAO,CAAAC,KAAA;IAAA;IAG5B,CAAAjC,EAAA,GAAAT,KAAA,CAAA+C,YAAA,KAAN,gBAAAtC,EAAA,CAAAuC,IAAA,CAAAhD,KAAA,EAAqB;MAAEO,MAAA,EAAQyB,SAAA,CAAUrB,GAAG;MAAIA,GAAA;MAAK+B;IAAM;EAAA;EAGtD;IACLzC,OAAS,EAAAE,QAAA;IACTuB,aAAA;IACAI,iBAAA;IACAd,kBAAA;IACAC,mBAAA;IACAO,eAAA;IACAL,WAAA;IACAD,aAAA;IACAL,cAAA;IAEAmB,SAAA;IACAE,cAAA;IACAC,iBAAA;IACAC;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}