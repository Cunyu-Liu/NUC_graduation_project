{"ast":null,"code":"import { shallowRef, ref, computed, nextTick } from 'vue';\nimport { useFormItem } from '../../../form/src/hooks/use-form-item.mjs';\nimport { useFormDisabled } from '../../../form/src/hooks/use-form-common-props.mjs';\nimport { UPDATE_MODEL_EVENT, INPUT_EVENT, CHANGE_EVENT } from '../../../../constants/event.mjs';\nconst useSlide = (props, initData, emit) => {\n  const {\n    formItem: elFormItem\n  } = useFormItem();\n  const slider = shallowRef();\n  const firstButton = ref();\n  const secondButton = ref();\n  const buttonRefs = {\n    firstButton,\n    secondButton\n  };\n  const sliderDisabled = useFormDisabled();\n  const minValue = computed(() => {\n    return Math.min(initData.firstValue, initData.secondValue);\n  });\n  const maxValue = computed(() => {\n    return Math.max(initData.firstValue, initData.secondValue);\n  });\n  const barSize = computed(() => {\n    return props.range ? `${100 * (maxValue.value - minValue.value) / (props.max - props.min)}%` : `${100 * (initData.firstValue - props.min) / (props.max - props.min)}%`;\n  });\n  const barStart = computed(() => {\n    return props.range ? `${100 * (minValue.value - props.min) / (props.max - props.min)}%` : \"0%\";\n  });\n  const runwayStyle = computed(() => {\n    return props.vertical ? {\n      height: props.height\n    } : {};\n  });\n  const barStyle = computed(() => {\n    return props.vertical ? {\n      height: barSize.value,\n      bottom: barStart.value\n    } : {\n      width: barSize.value,\n      left: barStart.value\n    };\n  });\n  const resetSize = () => {\n    if (slider.value) {\n      const rect = slider.value.getBoundingClientRect();\n      initData.sliderSize = rect[props.vertical ? \"height\" : \"width\"];\n    }\n  };\n  const getButtonRefByPercent = percent => {\n    const targetValue = props.min + percent * (props.max - props.min) / 100;\n    if (!props.range) {\n      return firstButton;\n    }\n    let buttonRefName;\n    if (Math.abs(minValue.value - targetValue) < Math.abs(maxValue.value - targetValue)) {\n      buttonRefName = initData.firstValue < initData.secondValue ? \"firstButton\" : \"secondButton\";\n    } else {\n      buttonRefName = initData.firstValue > initData.secondValue ? \"firstButton\" : \"secondButton\";\n    }\n    return buttonRefs[buttonRefName];\n  };\n  const setPosition = percent => {\n    const buttonRef = getButtonRefByPercent(percent);\n    buttonRef.value.setPosition(percent);\n    return buttonRef;\n  };\n  const setFirstValue = firstValue => {\n    initData.firstValue = firstValue != null ? firstValue : props.min;\n    _emit(props.range ? [minValue.value, maxValue.value] : firstValue != null ? firstValue : props.min);\n  };\n  const setSecondValue = secondValue => {\n    initData.secondValue = secondValue;\n    if (props.range) {\n      _emit([minValue.value, maxValue.value]);\n    }\n  };\n  const _emit = val => {\n    emit(UPDATE_MODEL_EVENT, val);\n    emit(INPUT_EVENT, val);\n  };\n  const emitChange = async () => {\n    await nextTick();\n    emit(CHANGE_EVENT, props.range ? [minValue.value, maxValue.value] : props.modelValue);\n  };\n  const handleSliderPointerEvent = event => {\n    var _a, _b, _c, _d, _e, _f;\n    if (sliderDisabled.value || initData.dragging) return;\n    resetSize();\n    let newPercent = 0;\n    if (props.vertical) {\n      const clientY = (_c = (_b = (_a = event.touches) == null ? void 0 : _a.item(0)) == null ? void 0 : _b.clientY) != null ? _c : event.clientY;\n      const sliderOffsetBottom = slider.value.getBoundingClientRect().bottom;\n      newPercent = (sliderOffsetBottom - clientY) / initData.sliderSize * 100;\n    } else {\n      const clientX = (_f = (_e = (_d = event.touches) == null ? void 0 : _d.item(0)) == null ? void 0 : _e.clientX) != null ? _f : event.clientX;\n      const sliderOffsetLeft = slider.value.getBoundingClientRect().left;\n      newPercent = (clientX - sliderOffsetLeft) / initData.sliderSize * 100;\n    }\n    if (newPercent < 0 || newPercent > 100) return;\n    return setPosition(newPercent);\n  };\n  const onSliderWrapperPrevent = event => {\n    var _a, _b;\n    if (((_a = buttonRefs[\"firstButton\"].value) == null ? void 0 : _a.dragging) || ((_b = buttonRefs[\"secondButton\"].value) == null ? void 0 : _b.dragging)) {\n      event.preventDefault();\n    }\n  };\n  const onSliderDown = async event => {\n    const buttonRef = handleSliderPointerEvent(event);\n    if (buttonRef) {\n      await nextTick();\n      buttonRef.value.onButtonDown(event);\n    }\n  };\n  const onSliderClick = event => {\n    const buttonRef = handleSliderPointerEvent(event);\n    if (buttonRef) {\n      emitChange();\n    }\n  };\n  const onSliderMarkerDown = position => {\n    if (sliderDisabled.value || initData.dragging) return;\n    const buttonRef = setPosition(position);\n    if (buttonRef) {\n      emitChange();\n    }\n  };\n  return {\n    elFormItem,\n    slider,\n    firstButton,\n    secondButton,\n    sliderDisabled,\n    minValue,\n    maxValue,\n    runwayStyle,\n    barStyle,\n    resetSize,\n    setPosition,\n    emitChange,\n    onSliderWrapperPrevent,\n    onSliderClick,\n    onSliderDown,\n    onSliderMarkerDown,\n    setFirstValue,\n    setSecondValue\n  };\n};\nexport { useSlide };","map":{"version":3,"names":["useSlide","props","initData","emit","formItem","elFormItem","useFormItem","slider","shallowRef","firstButton","ref","secondButton","buttonRefs","sliderDisabled","useFormDisabled","minValue","computed","Math","min","firstValue","secondValue","maxValue","max","barSize","range","value","barStart","runwayStyle","vertical","height","barStyle","bottom","width","left","resetSize","rect","getBoundingClientRect","sliderSize","getButtonRefByPercent","percent","targetValue","buttonRefName","abs","setPosition","buttonRef","setFirstValue","_emit","setSecondValue","val","UPDATE_MODEL_EVENT","INPUT_EVENT","emitChange","nextTick","CHANGE_EVENT","modelValue","handleSliderPointerEvent","event","_a","_b","_c","_d","_e","_f","dragging","newPercent","clientY","touches","item","sliderOffsetBottom","clientX","sliderOffsetLeft","onSliderWrapperPrevent","preventDefault","onSliderDown","onButtonDown","onSliderClick","onSliderMarkerDown","position"],"sources":["../../../../../../../packages/components/slider/src/composables/use-slide.ts"],"sourcesContent":["import { computed, nextTick, ref, shallowRef } from 'vue'\nimport {\n  CHANGE_EVENT,\n  INPUT_EVENT,\n  UPDATE_MODEL_EVENT,\n} from '@element-plus/constants'\nimport { useFormDisabled, useFormItem } from '@element-plus/components/form'\n\nimport type { CSSProperties, Ref, SetupContext } from 'vue'\nimport type { Arrayable } from '@element-plus/utils'\nimport type { SliderEmits, SliderInitData, SliderProps } from '../slider'\nimport type { ButtonRefs, SliderButtonInstance } from '../button'\n\nexport const useSlide = (\n  props: SliderProps,\n  initData: SliderInitData,\n  emit: SetupContext<SliderEmits>['emit']\n) => {\n  const { formItem: elFormItem } = useFormItem()\n\n  const slider = shallowRef<HTMLElement>()\n\n  const firstButton = ref<SliderButtonInstance>()\n\n  const secondButton = ref<SliderButtonInstance>()\n\n  const buttonRefs: ButtonRefs = {\n    firstButton,\n    secondButton,\n  }\n\n  const sliderDisabled = useFormDisabled()\n\n  const minValue = computed(() => {\n    return Math.min(initData.firstValue, initData.secondValue)\n  })\n\n  const maxValue = computed(() => {\n    return Math.max(initData.firstValue, initData.secondValue)\n  })\n\n  const barSize = computed(() => {\n    return props.range\n      ? `${\n          (100 * (maxValue.value - minValue.value)) / (props.max - props.min)\n        }%`\n      : `${\n          (100 * (initData.firstValue - props.min)) / (props.max - props.min)\n        }%`\n  })\n\n  const barStart = computed(() => {\n    return props.range\n      ? `${(100 * (minValue.value - props.min)) / (props.max - props.min)}%`\n      : '0%'\n  })\n\n  const runwayStyle = computed<CSSProperties>(() => {\n    return props.vertical ? { height: props.height } : {}\n  })\n\n  const barStyle = computed<CSSProperties>(() => {\n    return props.vertical\n      ? {\n          height: barSize.value,\n          bottom: barStart.value,\n        }\n      : {\n          width: barSize.value,\n          left: barStart.value,\n        }\n  })\n\n  const resetSize = () => {\n    if (slider.value) {\n      const rect = slider.value.getBoundingClientRect()\n      initData.sliderSize = rect[props.vertical ? 'height' : 'width']\n    }\n  }\n\n  const getButtonRefByPercent = (\n    percent: number\n  ): Ref<SliderButtonInstance | undefined> => {\n    const targetValue = props.min + (percent * (props.max - props.min)) / 100\n    if (!props.range) {\n      return firstButton\n    }\n    let buttonRefName: 'firstButton' | 'secondButton'\n    if (\n      Math.abs(minValue.value - targetValue) <\n      Math.abs(maxValue.value - targetValue)\n    ) {\n      buttonRefName =\n        initData.firstValue < initData.secondValue\n          ? 'firstButton'\n          : 'secondButton'\n    } else {\n      buttonRefName =\n        initData.firstValue > initData.secondValue\n          ? 'firstButton'\n          : 'secondButton'\n    }\n    return buttonRefs[buttonRefName]\n  }\n\n  const setPosition = (\n    percent: number\n  ): Ref<SliderButtonInstance | undefined> => {\n    const buttonRef = getButtonRefByPercent(percent)\n    buttonRef.value!.setPosition(percent)\n    return buttonRef\n  }\n\n  const setFirstValue = (firstValue: number | undefined) => {\n    initData.firstValue = firstValue ?? props.min\n    _emit(\n      props.range ? [minValue.value, maxValue.value] : (firstValue ?? props.min)\n    )\n  }\n\n  const setSecondValue = (secondValue: number) => {\n    initData.secondValue = secondValue\n\n    if (props.range) {\n      _emit([minValue.value, maxValue.value])\n    }\n  }\n\n  const _emit = (val: Arrayable<number>) => {\n    emit(UPDATE_MODEL_EVENT, val)\n    emit(INPUT_EVENT, val)\n  }\n\n  const emitChange = async () => {\n    await nextTick()\n    emit(\n      CHANGE_EVENT,\n      props.range ? [minValue.value, maxValue.value] : props.modelValue\n    )\n  }\n\n  const handleSliderPointerEvent = (\n    event: MouseEvent | TouchEvent\n  ): Ref<SliderButtonInstance | undefined> | undefined => {\n    if (sliderDisabled.value || initData.dragging) return\n    resetSize()\n    let newPercent = 0\n    if (props.vertical) {\n      const clientY =\n        (event as TouchEvent).touches?.item(0)?.clientY ??\n        (event as MouseEvent).clientY\n      const sliderOffsetBottom = slider.value!.getBoundingClientRect().bottom\n      newPercent = ((sliderOffsetBottom - clientY) / initData.sliderSize) * 100\n    } else {\n      const clientX =\n        (event as TouchEvent).touches?.item(0)?.clientX ??\n        (event as MouseEvent).clientX\n      const sliderOffsetLeft = slider.value!.getBoundingClientRect().left\n      newPercent = ((clientX - sliderOffsetLeft) / initData.sliderSize) * 100\n    }\n    if (newPercent < 0 || newPercent > 100) return\n    return setPosition(newPercent)\n  }\n\n  const onSliderWrapperPrevent = (event: TouchEvent) => {\n    if (\n      buttonRefs['firstButton'].value?.dragging ||\n      buttonRefs['secondButton'].value?.dragging\n    ) {\n      event.preventDefault()\n    }\n  }\n\n  const onSliderDown = async (event: MouseEvent | TouchEvent) => {\n    const buttonRef = handleSliderPointerEvent(event)\n    if (buttonRef) {\n      await nextTick()\n      buttonRef.value!.onButtonDown(event)\n    }\n  }\n\n  const onSliderClick = (event: MouseEvent | TouchEvent) => {\n    const buttonRef = handleSliderPointerEvent(event)\n    if (buttonRef) {\n      emitChange()\n    }\n  }\n\n  const onSliderMarkerDown = (position: number) => {\n    if (sliderDisabled.value || initData.dragging) return\n    const buttonRef = setPosition(position)\n    if (buttonRef) {\n      emitChange()\n    }\n  }\n\n  return {\n    elFormItem,\n    slider,\n    firstButton,\n    secondButton,\n    sliderDisabled,\n    minValue,\n    maxValue,\n    runwayStyle,\n    barStyle,\n    resetSize,\n    setPosition,\n    emitChange,\n    onSliderWrapperPrevent,\n    onSliderClick,\n    onSliderDown,\n    onSliderMarkerDown,\n    setFirstValue,\n    setSecondValue,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}