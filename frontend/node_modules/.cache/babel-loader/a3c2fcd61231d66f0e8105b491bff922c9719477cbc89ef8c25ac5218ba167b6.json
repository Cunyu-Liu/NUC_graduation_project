{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport { ref, computed, onMounted, nextTick, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { Plus, Fold, Expand, ChatLineRound, MoreFilled, Setting, Document, Delete, ChatDotRound, Cpu, Paperclip, Search, Globe, Promotion, Loading, Edit } from '@element-plus/icons-vue';\nimport api from '@/api';\nimport { marked } from 'marked';\nimport DOMPurify from 'dompurify';\nimport hljs from 'highlight.js';\n\n// 配置 marked\n\nexport default {\n  __name: 'KimiChat',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    marked.setOptions({\n      highlight: function (code, lang) {\n        if (lang && hljs.getLanguage(lang)) {\n          return hljs.highlight(code, {\n            language: lang\n          }).value;\n        }\n        return hljs.highlightAuto(code).value;\n      },\n      breaks: true,\n      gfm: true\n    });\n    const store = useStore();\n\n    // ==================== 状态 ====================\n    const sidebarCollapsed = ref(false);\n    const currentChatId = ref(null);\n    const chatHistory = ref([]);\n    const messages = ref([]);\n    const inputMessage = ref('');\n    const isTyping = ref(false);\n    const currentModel = ref('glm-4-plus');\n    const messagesContainer = ref(null);\n    const useRag = ref(true);\n    const useWebSearch = ref(false);\n    const selectedPapers = ref([]);\n\n    // 论文选择\n    const showPaperSelector = ref(false);\n    const paperSearch = ref('');\n    const papers = ref([]);\n    const tempSelectedPapers = ref([]);\n    const paperTable = ref(null);\n\n    // 设置\n    const showSettings = ref(false);\n    const settings = ref({\n      model: 'glm-4-plus',\n      temperature: 0.7,\n      maxTokens: 4000,\n      useRag: true,\n      autoReference: true\n    });\n\n    // 重命名\n    const showRenameDialog = ref(false);\n    const renameValue = ref('');\n    const renameChatId = ref(null);\n\n    // ==================== 计算属性 ====================\n    const userAvatar = computed(() => store.getters.currentUser?.avatar || '');\n    const userInitial = computed(() => {\n      const name = store.getters.currentUser?.full_name || store.getters.currentUser?.username || 'U';\n      return name.charAt(0).toUpperCase();\n    });\n    const currentChatTitle = computed(() => {\n      const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n      return chat?.preview || '新对话';\n    });\n    const canSend = computed(() => {\n      return inputMessage.value.trim().length > 0 && !isTyping.value;\n    });\n    const inputRows = computed(() => {\n      const lines = inputMessage.value.split('\\n').length;\n      return Math.min(Math.max(lines, 1), 5);\n    });\n    const filteredPapers = computed(() => {\n      if (!paperSearch.value) return papers.value;\n      const query = paperSearch.value.toLowerCase();\n      return papers.value.filter(p => (p.title || '').toLowerCase().includes(query) || (p.abstract || '').toLowerCase().includes(query));\n    });\n\n    // ==================== 快捷功能卡片 ====================\n    const quickCards = [{\n      key: 'summary',\n      label: '文献综述',\n      icon: 'Document',\n      prompt: '请基于我的论文库生成一份文献综述'\n    }, {\n      key: 'gaps',\n      label: '研究空白',\n      icon: 'Search',\n      prompt: '请分析当前研究领域的主要空白'\n    }, {\n      key: 'code',\n      label: '代码生成',\n      icon: 'Cpu',\n      prompt: '请帮我生成实现XX算法的代码'\n    }, {\n      key: 'trends',\n      label: '趋势分析',\n      icon: 'TrendCharts',\n      prompt: '请分析该领域的研究趋势'\n    }];\n    const exampleQuestions = ['帮我总结这几篇论文的核心贡献', '这些论文中使用了哪些主要方法？', '这个领域的研究现状如何？', '有哪些潜在的研究方向值得探索？', '帮我比较论文A和论文B的方法差异', '请解释论文中的XX算法原理'];\n\n    // ==================== 方法 ====================\n    const formatTime = timestamp => {\n      if (!timestamp) return '';\n      const date = new Date(timestamp);\n      return date.toLocaleTimeString('zh-CN', {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    };\n    const renderMessage = content => {\n      if (!content) return '';\n      const html = marked(content);\n      return DOMPurify.sanitize(html);\n    };\n    const scrollToBottom = () => {\n      nextTick(() => {\n        if (messagesContainer.value) {\n          messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;\n        }\n      });\n    };\n\n    // ==================== 聊天操作 ====================\n    const loadChatHistory = async () => {\n      try {\n        // 这里可以调用后端 API 获取会话列表\n        // 目前使用本地存储\n        const saved = localStorage.getItem('kimi_chat_history');\n        if (saved) {\n          chatHistory.value = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.error('加载聊天历史失败:', e);\n      }\n    };\n    const saveChatHistory = () => {\n      try {\n        localStorage.setItem('kimi_chat_history', JSON.stringify(chatHistory.value));\n      } catch (e) {\n        console.error('保存聊天历史失败:', e);\n      }\n    };\n    const createNewChat = () => {\n      const newChatId = `chat_${Date.now()}`;\n      currentChatId.value = newChatId;\n      messages.value = [];\n      selectedPapers.value = [];\n\n      // 添加到历史\n      chatHistory.value.unshift({\n        chat_id: newChatId,\n        preview: '新对话',\n        created_at: new Date().toISOString(),\n        message_count: 0\n      });\n      saveChatHistory();\n    };\n    const switchChat = async chatId => {\n      if (currentChatId.value === chatId) return;\n      currentChatId.value = chatId;\n\n      // 加载该会话的消息历史\n      try {\n        const response = await api.getChatHistory(chatId);\n        if (response.success) {\n          messages.value = response.data || [];\n        }\n      } catch (e) {\n        console.error('加载消息历史失败:', e);\n        messages.value = [];\n      }\n      scrollToBottom();\n    };\n    const renameChat = chatId => {\n      renameChatId.value = chatId;\n      renameValue.value = '';\n      showRenameDialog.value = true;\n    };\n    const confirmRename = () => {\n      if (!renameValue.value.trim()) {\n        ElMessage.warning('请输入新名称');\n        return;\n      }\n      const chat = chatHistory.value.find(c => c.chat_id === renameChatId.value);\n      if (chat) {\n        chat.preview = renameValue.value;\n        saveChatHistory();\n        ElMessage.success('重命名成功');\n      }\n      showRenameDialog.value = false;\n    };\n    const deleteChat = async chatId => {\n      try {\n        await ElMessageBox.confirm('确定要删除这个对话吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n\n        // 调用后端 API 删除\n        await api.deleteChat({\n          chatId\n        });\n\n        // 从列表中移除\n        chatHistory.value = chatHistory.value.filter(c => c.chat_id !== chatId);\n\n        // 如果删除的是当前会话，切换到第一个或新建\n        if (currentChatId.value === chatId) {\n          if (chatHistory.value.length > 0) {\n            switchChat(chatHistory.value[0].chat_id);\n          } else {\n            createNewChat();\n          }\n        }\n        saveChatHistory();\n        ElMessage.success('删除成功');\n      } catch (e) {\n        if (e !== 'cancel') {\n          console.error('删除失败:', e);\n        }\n      }\n    };\n    const clearCurrentChat = async () => {\n      if (messages.value.length === 0) return;\n      try {\n        await ElMessageBox.confirm('确定要清空当前对话吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        await api.clearChat({\n          chatId: currentChatId.value\n        });\n        messages.value = [];\n\n        // 更新预览\n        const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n        if (chat) {\n          chat.preview = '新对话';\n          chat.message_count = 0;\n          saveChatHistory();\n        }\n        ElMessage.success('已清空');\n      } catch (e) {\n        if (e !== 'cancel') {\n          console.error('清空失败:', e);\n        }\n      }\n    };\n\n    // ==================== 消息发送 ====================\n    const handleEnter = e => {\n      if (e.shiftKey) {\n        // Shift+Enter 换行\n        return;\n      }\n      e.preventDefault();\n      sendMessage();\n    };\n    const handleInput = () => {\n      // 可以在这里实现输入提示等功能\n    };\n    const sendQuickMessage = prompt => {\n      inputMessage.value = prompt;\n      sendMessage();\n    };\n    const sendMessage = async (content = null) => {\n      const message = content || inputMessage.value.trim();\n      if (!message || isTyping.value) return;\n\n      // 清空输入框\n      if (!content) {\n        inputMessage.value = '';\n      }\n\n      // 添加用户消息\n      messages.value.push({\n        role: 'user',\n        content: message,\n        timestamp: new Date().toISOString(),\n        references: []\n      });\n      scrollToBottom();\n      isTyping.value = true;\n      try {\n        // 调用流式 API\n        const response = await fetch('/api/chat/stream', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\n          },\n          body: JSON.stringify({\n            message,\n            chatId: currentChatId.value,\n            papers: selectedPapers.value.map(p => p.id),\n            model: currentModel.value,\n            temperature: settings.value.temperature,\n            useRag: useRag.value,\n            useWebSearch: useWebSearch.value\n          })\n        });\n        const reader = response.body.getReader();\n        const decoder = new TextDecoder();\n        let fullContent = '';\n\n        // 添加 AI 消息占位\n        messages.value.push({\n          role: 'assistant',\n          content: '',\n          timestamp: new Date().toISOString(),\n          references: []\n        });\n\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const {\n            done,\n            value\n          } = await reader.read();\n          if (done) break;\n          const chunk = decoder.decode(value);\n          const lines = chunk.split('\\n\\n');\n          for (const line of lines) {\n            if (line.startsWith('data: ')) {\n              try {\n                const data = JSON.parse(line.slice(6));\n                if (data.done) {\n                  isTyping.value = false;\n                } else if (data.content) {\n                  fullContent += data.content;\n                  messages.value[messages.value.length - 1].content = fullContent;\n                  scrollToBottom();\n                }\n              } catch (e) {\n                console.error('解析 SSE 数据失败:', e);\n              }\n            }\n          }\n        }\n\n        // 更新会话预览\n        const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n        if (chat) {\n          chat.preview = message.slice(0, 30) + (message.length > 30 ? '...' : '');\n          chat.message_count = messages.value.length;\n          saveChatHistory();\n        }\n      } catch (error) {\n        console.error('发送消息失败:', error);\n        ElMessage.error('发送失败，请重试');\n        isTyping.value = false;\n      }\n    };\n\n    // ==================== 论文选择 ====================\n    const loadPapers = async () => {\n      try {\n        const response = await api.getPapersList({\n          limit: 100\n        });\n        if (response.success) {\n          papers.value = response.data.items || [];\n        }\n      } catch (error) {\n        console.error('加载论文失败:', error);\n      }\n    };\n    const handlePaperSelectionChange = selection => {\n      tempSelectedPapers.value = selection;\n    };\n    const confirmPaperSelection = () => {\n      selectedPapers.value = [...tempSelectedPapers.value];\n      showPaperSelector.value = false;\n      ElMessage.success(`已关联 ${selectedPapers.value.length} 篇论文`);\n    };\n    const viewPaper = paperId => {\n      window.open(`#/papers/${paperId}`, '_blank');\n    };\n\n    // ==================== 设置 ====================\n    const saveSettings = () => {\n      localStorage.setItem('kimi_chat_settings', JSON.stringify(settings.value));\n      showSettings.value = false;\n      ElMessage.success('设置已保存');\n    };\n    const loadSettings = () => {\n      try {\n        const saved = localStorage.getItem('kimi_chat_settings');\n        if (saved) {\n          settings.value = {\n            ...settings.value,\n            ...JSON.parse(saved)\n          };\n        }\n      } catch (e) {\n        console.error('加载设置失败:', e);\n      }\n    };\n\n    // ==================== 其他操作 ====================\n    const handleUpload = () => {\n      ElMessage.info('文件上传功能开发中');\n    };\n\n    // ==================== 生命周期 ====================\n    onMounted(() => {\n      loadChatHistory();\n      loadPapers();\n      loadSettings();\n\n      // 如果没有会话，创建一个新的\n      if (chatHistory.value.length === 0) {\n        createNewChat();\n      } else {\n        // 切换到第一个会话\n        switchChat(chatHistory.value[0].chat_id);\n      }\n    });\n    const __returned__ = {\n      store,\n      sidebarCollapsed,\n      currentChatId,\n      chatHistory,\n      messages,\n      inputMessage,\n      isTyping,\n      currentModel,\n      messagesContainer,\n      useRag,\n      useWebSearch,\n      selectedPapers,\n      showPaperSelector,\n      paperSearch,\n      papers,\n      tempSelectedPapers,\n      paperTable,\n      showSettings,\n      settings,\n      showRenameDialog,\n      renameValue,\n      renameChatId,\n      userAvatar,\n      userInitial,\n      currentChatTitle,\n      canSend,\n      inputRows,\n      filteredPapers,\n      quickCards,\n      exampleQuestions,\n      formatTime,\n      renderMessage,\n      scrollToBottom,\n      loadChatHistory,\n      saveChatHistory,\n      createNewChat,\n      switchChat,\n      renameChat,\n      confirmRename,\n      deleteChat,\n      clearCurrentChat,\n      handleEnter,\n      handleInput,\n      sendQuickMessage,\n      sendMessage,\n      loadPapers,\n      handlePaperSelectionChange,\n      confirmPaperSelection,\n      viewPaper,\n      saveSettings,\n      loadSettings,\n      handleUpload,\n      ref,\n      computed,\n      onMounted,\n      nextTick,\n      watch,\n      get useStore() {\n        return useStore;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get Plus() {\n        return Plus;\n      },\n      get Fold() {\n        return Fold;\n      },\n      get Expand() {\n        return Expand;\n      },\n      get ChatLineRound() {\n        return ChatLineRound;\n      },\n      get MoreFilled() {\n        return MoreFilled;\n      },\n      get Setting() {\n        return Setting;\n      },\n      get Document() {\n        return Document;\n      },\n      get Delete() {\n        return Delete;\n      },\n      get ChatDotRound() {\n        return ChatDotRound;\n      },\n      get Cpu() {\n        return Cpu;\n      },\n      get Paperclip() {\n        return Paperclip;\n      },\n      get Search() {\n        return Search;\n      },\n      get Globe() {\n        return Globe;\n      },\n      get Promotion() {\n        return Promotion;\n      },\n      get Loading() {\n        return Loading;\n      },\n      get Edit() {\n        return Edit;\n      },\n      get api() {\n        return api;\n      },\n      get marked() {\n        return marked;\n      },\n      get DOMPurify() {\n        return DOMPurify;\n      },\n      get hljs() {\n        return hljs;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","nextTick","watch","useStore","ElMessage","ElMessageBox","Plus","Fold","Expand","ChatLineRound","MoreFilled","Setting","Document","Delete","ChatDotRound","Cpu","Paperclip","Search","Globe","Promotion","Loading","Edit","api","marked","DOMPurify","hljs","setOptions","highlight","code","lang","getLanguage","language","value","highlightAuto","breaks","gfm","store","sidebarCollapsed","currentChatId","chatHistory","messages","inputMessage","isTyping","currentModel","messagesContainer","useRag","useWebSearch","selectedPapers","showPaperSelector","paperSearch","papers","tempSelectedPapers","paperTable","showSettings","settings","model","temperature","maxTokens","autoReference","showRenameDialog","renameValue","renameChatId","userAvatar","getters","currentUser","avatar","userInitial","name","full_name","username","charAt","toUpperCase","currentChatTitle","chat","find","c","chat_id","preview","canSend","trim","length","inputRows","lines","split","Math","min","max","filteredPapers","query","toLowerCase","filter","p","title","includes","abstract","quickCards","key","label","icon","prompt","exampleQuestions","formatTime","timestamp","date","Date","toLocaleTimeString","hour","minute","renderMessage","content","html","sanitize","scrollToBottom","scrollTop","scrollHeight","loadChatHistory","saved","localStorage","getItem","JSON","parse","e","console","error","saveChatHistory","setItem","stringify","createNewChat","newChatId","now","unshift","created_at","toISOString","message_count","switchChat","chatId","response","getChatHistory","success","data","renameChat","confirmRename","warning","deleteChat","confirm","confirmButtonText","cancelButtonText","type","clearCurrentChat","clearChat","handleEnter","shiftKey","preventDefault","sendMessage","handleInput","sendQuickMessage","message","push","role","references","fetch","method","headers","body","map","id","reader","getReader","decoder","TextDecoder","fullContent","done","read","chunk","decode","line","startsWith","slice","loadPapers","getPapersList","limit","items","handlePaperSelectionChange","selection","confirmPaperSelection","viewPaper","paperId","window","open","saveSettings","loadSettings","handleUpload","info"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/views/KimiChat.vue"],"sourcesContent":["<template>\n  <div class=\"kimi-chat-container\">\n    <!-- 左侧边栏 -->\n    <aside class=\"sidebar\" :class=\"{ 'collapsed': sidebarCollapsed }\">\n      <!-- 新建对话按钮 -->\n      <div class=\"sidebar-header\">\n        <button class=\"new-chat-btn\" @click=\"createNewChat\">\n          <el-icon><Plus /></el-icon>\n          <span>新建对话</span>\n        </button>\n        <button class=\"collapse-btn\" @click=\"sidebarCollapsed = !sidebarCollapsed\">\n          <el-icon><Fold v-if=\"!sidebarCollapsed\" /><Expand v-else /></el-icon>\n        </button>\n      </div>\n\n      <!-- 对话历史列表 -->\n      <div class=\"chat-history\">\n        <div\n          v-for=\"chat in chatHistory\"\n          :key=\"chat.chat_id\"\n          class=\"chat-item\"\n          :class=\"{ active: currentChatId === chat.chat_id }\"\n          @click=\"switchChat(chat.chat_id)\"\n        >\n          <el-icon class=\"chat-icon\"><ChatLineRound /></el-icon>\n          <span class=\"chat-title\">{{ chat.preview || '新对话' }}</span>\n          <div class=\"chat-actions\" @click.stop>\n            <el-dropdown trigger=\"click\" :teleported=\"false\">\n              <el-icon class=\"more-icon\"><MoreFilled /></el-icon>\n              <template #dropdown>\n                <el-dropdown-menu>\n                  <el-dropdown-item @click=\"renameChat(chat.chat_id)\">\n                    <el-icon><Edit /></el-icon> 重命名\n                  </el-dropdown-item>\n                  <el-dropdown-item divided @click=\"deleteChat(chat.chat_id)\" class=\"danger\">\n                    <el-icon><Delete /></el-icon> 删除\n                  </el-dropdown-item>\n                </el-dropdown-menu>\n              </template>\n            </el-dropdown>\n          </div>\n        </div>\n      </div>\n\n      <!-- 底部设置 -->\n      <div class=\"sidebar-footer\">\n        <button class=\"footer-btn\" @click=\"showSettings = true\">\n          <el-icon><Setting /></el-icon>\n          <span>设置</span>\n        </button>\n      </div>\n    </aside>\n\n    <!-- 主聊天区域 -->\n    <main class=\"chat-main\">\n      <!-- 顶部导航 -->\n      <header class=\"chat-header\">\n        <div class=\"header-left\">\n          <h2 class=\"chat-title\">{{ currentChatTitle }}</h2>\n          <el-tag v-if=\"selectedPapers.length > 0\" type=\"success\" size=\"small\">\n            已关联 {{ selectedPapers.length }} 篇论文\n          </el-tag>\n        </div>\n        <div class=\"header-right\">\n          <el-select v-model=\"currentModel\" size=\"small\" class=\"model-select\">\n            <el-option label=\"GLM-4-Plus\" value=\"glm-4-plus\" />\n            <el-option label=\"GLM-4-Flash\" value=\"glm-4-flash\" />\n          </el-select>\n          <el-tooltip content=\"关联论文\">\n            <el-button circle size=\"small\" @click=\"showPaperSelector = true\">\n              <el-icon><Document /></el-icon>\n            </el-button>\n          </el-tooltip>\n          <el-tooltip content=\"清空对话\">\n            <el-button circle size=\"small\" @click=\"clearCurrentChat\">\n              <el-icon><Delete /></el-icon>\n            </el-button>\n          </el-tooltip>\n        </div>\n      </header>\n\n      <!-- 消息列表区域 -->\n      <div ref=\"messagesContainer\" class=\"messages-area\">\n        <!-- 欢迎页面 -->\n        <div v-if=\"messages.length === 0\" class=\"welcome-section\">\n          <div class=\"welcome-logo\">\n            <el-icon :size=\"80\" color=\"#10b981\"><ChatDotRound /></el-icon>\n          </div>\n          <h1 class=\"welcome-title\">AI 科研助手</h1>\n          <p class=\"welcome-subtitle\">\n            基于您的论文库，提供深度文献分析、研究建议、代码生成等服务\n          </p>\n\n          <!-- 快捷功能卡片 -->\n          <div class=\"quick-cards\">\n            <div\n              v-for=\"card in quickCards\"\n              :key=\"card.key\"\n              class=\"quick-card\"\n              @click=\"sendQuickMessage(card.prompt)\"\n            >\n              <el-icon :size=\"24\"><component :is=\"card.icon\" /></el-icon>\n              <span>{{ card.label }}</span>\n            </div>\n          </div>\n\n          <!-- 示例问题 -->\n          <div class=\"example-questions\">\n            <div class=\"section-title\">你可以这样问我：</div>\n            <div class=\"question-tags\">\n              <el-tag\n                v-for=\"q in exampleQuestions\"\n                :key=\"q\"\n                class=\"question-tag\"\n                effect=\"plain\"\n                @click=\"sendMessage(q)\"\n              >\n                {{ q }}\n              </el-tag>\n            </div>\n          </div>\n        </div>\n\n        <!-- 消息列表 -->\n        <template v-else>\n          <div\n            v-for=\"(message, index) in messages\"\n            :key=\"index\"\n            class=\"message-wrapper\"\n            :class=\"{ 'user-message': message.role === 'user', 'ai-message': message.role === 'assistant' }\"\n          >\n            <div class=\"message-avatar\">\n              <el-avatar\n                v-if=\"message.role === 'user'\"\n                :size=\"36\"\n                :src=\"userAvatar\"\n              >\n                {{ userInitial }}\n              </el-avatar>\n              <div v-else class=\"ai-avatar\">\n                <el-icon :size=\"20\"><Cpu /></el-icon>\n              </div>\n            </div>\n\n            <div class=\"message-content\">\n              <!-- 消息头部 -->\n              <div class=\"message-header\">\n                <span class=\"message-role\">{{ message.role === 'user' ? '我' : 'AI 助手' }}</span>\n                <span class=\"message-time\">{{ formatTime(message.timestamp) }}</span>\n              </div>\n\n              <!-- 消息体 -->\n              <div class=\"message-body\" v-html=\"renderMessage(message.content)\"></div>\n\n              <!-- 引用论文 -->\n              <div v-if=\"message.references && message.references.length > 0\" class=\"message-references\">\n                <div class=\"ref-title\">引用文献：</div>\n                <div class=\"ref-list\">\n                  <el-tag\n                    v-for=\"ref in message.references\"\n                    :key=\"ref.paper_id\"\n                    size=\"small\"\n                    type=\"info\"\n                    class=\"ref-tag\"\n                    @click=\"viewPaper(ref.paper_id)\"\n                  >\n                    {{ ref.title }}\n                  </el-tag>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- AI 正在输入 -->\n          <div v-if=\"isTyping\" class=\"message-wrapper ai-message typing\">\n            <div class=\"message-avatar\">\n              <div class=\"ai-avatar\">\n                <el-icon :size=\"20\"><Cpu /></el-icon>\n              </div>\n            </div>\n            <div class=\"message-content\">\n              <div class=\"typing-indicator\">\n                <span></span>\n                <span></span>\n                <span></span>\n              </div>\n            </div>\n          </div>\n        </template>\n      </div>\n\n      <!-- 输入区域 -->\n      <footer class=\"input-area\">\n        <div class=\"input-toolbar\">\n          <el-tooltip content=\"上传文件\">\n            <button class=\"tool-btn\" @click=\"handleUpload\">\n              <el-icon><Paperclip /></el-icon>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"关联论文\">\n            <button class=\"tool-btn\" @click=\"showPaperSelector = true\">\n              <el-icon><Document /></el-icon>\n              <span v-if=\"selectedPapers.length > 0\" class=\"badge\">{{ selectedPapers.length }}</span>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"使用 RAG\">\n            <button\n              class=\"tool-btn\"\n              :class=\"{ active: useRag }\"\n              @click=\"useRag = !useRag\"\n            >\n              <el-icon><Search /></el-icon>\n              <span>RAG</span>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"网络搜索\">\n            <button\n              class=\"tool-btn\"\n              :class=\"{ active: useWebSearch }\"\n              @click=\"useWebSearch = !useWebSearch\"\n            >\n              <el-icon><Globe /></el-icon>\n              <span>联网</span>\n            </button>\n          </el-tooltip>\n        </div>\n\n        <div class=\"input-box\">\n          <el-input\n            v-model=\"inputMessage\"\n            type=\"textarea\"\n            :rows=\"inputRows\"\n            placeholder=\"输入您的问题，AI 将基于您的论文库进行回答...\"\n            resize=\"none\"\n            @keydown.enter.prevent=\"handleEnter\"\n            @input=\"handleInput\"\n          />\n          <button\n            class=\"send-btn\"\n            :disabled=\"!canSend\"\n            @click=\"sendMessage()\"\n          >\n            <el-icon v-if=\"!isTyping\"><Promotion /></el-icon>\n            <el-icon v-else class=\"loading\"><Loading /></el-icon>\n          </button>\n        </div>\n\n        <div class=\"input-hint\">\n          <span>Enter 发送，Shift + Enter 换行</span>\n          <span v-if=\"inputMessage.length > 0\">{{ inputMessage.length }} 字符</span>\n        </div>\n      </footer>\n    </main>\n\n    <!-- 论文选择对话框 -->\n    <el-dialog v-model=\"showPaperSelector\" title=\"选择关联论文\" width=\"700px\">\n      <div class=\"paper-selector\">\n        <el-input\n          v-model=\"paperSearch\"\n          placeholder=\"搜索论文...\"\n          clearable\n          class=\"paper-search\"\n        >\n          <template #prefix>\n            <el-icon><Search /></el-icon>\n          </template>\n        </el-input>\n\n        <el-table\n          :data=\"filteredPapers\"\n          style=\"width: 100%\"\n          max-height=\"400\"\n          @selection-change=\"handlePaperSelectionChange\"\n          ref=\"paperTable\"\n        >\n          <el-table-column type=\"selection\" width=\"55\" />\n          <el-table-column prop=\"title\" label=\"论文标题\" show-overflow-tooltip min-width=\"250\" />\n          <el-table-column prop=\"year\" label=\"年份\" width=\"80\" />\n          <el-table-column prop=\"venue\" label=\"期刊/会议\" show-overflow-tooltip />\n        </el-table>\n      </div>\n\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <span>已选择 {{ tempSelectedPapers.length }} 篇论文</span>\n          <div>\n            <el-button @click=\"showPaperSelector = false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"confirmPaperSelection\">确定</el-button>\n          </div>\n        </div>\n      </template>\n    </el-dialog>\n\n    <!-- 设置对话框 -->\n    <el-dialog v-model=\"showSettings\" title=\"聊天设置\" width=\"500px\">\n      <el-form label-width=\"100px\">\n        <el-form-item label=\"默认模型\">\n          <el-select v-model=\"settings.model\" style=\"width: 100%\">\n            <el-option label=\"GLM-4-Plus\" value=\"glm-4-plus\" />\n            <el-option label=\"GLM-4-Flash\" value=\"glm-4-flash\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"温度\">\n          <el-slider v-model=\"settings.temperature\" :min=\"0\" :max=\"1\" :step=\"0.1\" show-stops />\n          <div class=\"slider-hint\">较低的值使输出更确定，较高的值使输出更随机</div>\n        </el-form-item>\n        <el-form-item label=\"最大长度\">\n          <el-input-number v-model=\"settings.maxTokens\" :min=\"1000\" :max=\"8000\" :step=\"1000\" style=\"width: 100%\" />\n        </el-form-item>\n        <el-form-item label=\"启用 RAG\">\n          <el-switch v-model=\"settings.useRag\" />\n        </el-form-item>\n        <el-form-item label=\"自动引用\">\n          <el-switch v-model=\"settings.autoReference\" />\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"showSettings = false\">关闭</el-button>\n        <el-button type=\"primary\" @click=\"saveSettings\">保存设置</el-button>\n      </template>\n    </el-dialog>\n\n    <!-- 重命名对话框 -->\n    <el-dialog v-model=\"showRenameDialog\" title=\"重命名对话\" width=\"400px\">\n      <el-input v-model=\"renameValue\" placeholder=\"输入新名称\" />\n      <template #footer>\n        <el-button @click=\"showRenameDialog = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmRename\">确定</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, nextTick, watch } from 'vue'\nimport { useStore } from 'vuex'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport {\n  Plus, Fold, Expand, ChatLineRound, MoreFilled, Setting,\n  Document, Delete, ChatDotRound, Cpu, Paperclip, Search,\n  Globe, Promotion, Loading, Edit\n} from '@element-plus/icons-vue'\nimport api from '@/api'\nimport { marked } from 'marked'\nimport DOMPurify from 'dompurify'\nimport hljs from 'highlight.js'\n\n// 配置 marked\nmarked.setOptions({\n  highlight: function(code, lang) {\n    if (lang && hljs.getLanguage(lang)) {\n      return hljs.highlight(code, { language: lang }).value\n    }\n    return hljs.highlightAuto(code).value\n  },\n  breaks: true,\n  gfm: true\n})\n\nconst store = useStore()\n\n// ==================== 状态 ====================\nconst sidebarCollapsed = ref(false)\nconst currentChatId = ref(null)\nconst chatHistory = ref([])\nconst messages = ref([])\nconst inputMessage = ref('')\nconst isTyping = ref(false)\nconst currentModel = ref('glm-4-plus')\nconst messagesContainer = ref(null)\nconst useRag = ref(true)\nconst useWebSearch = ref(false)\nconst selectedPapers = ref([])\n\n// 论文选择\nconst showPaperSelector = ref(false)\nconst paperSearch = ref('')\nconst papers = ref([])\nconst tempSelectedPapers = ref([])\nconst paperTable = ref(null)\n\n// 设置\nconst showSettings = ref(false)\nconst settings = ref({\n  model: 'glm-4-plus',\n  temperature: 0.7,\n  maxTokens: 4000,\n  useRag: true,\n  autoReference: true\n})\n\n// 重命名\nconst showRenameDialog = ref(false)\nconst renameValue = ref('')\nconst renameChatId = ref(null)\n\n// ==================== 计算属性 ====================\nconst userAvatar = computed(() => store.getters.currentUser?.avatar || '')\nconst userInitial = computed(() => {\n  const name = store.getters.currentUser?.full_name || store.getters.currentUser?.username || 'U'\n  return name.charAt(0).toUpperCase()\n})\n\nconst currentChatTitle = computed(() => {\n  const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n  return chat?.preview || '新对话'\n})\n\nconst canSend = computed(() => {\n  return inputMessage.value.trim().length > 0 && !isTyping.value\n})\n\nconst inputRows = computed(() => {\n  const lines = inputMessage.value.split('\\n').length\n  return Math.min(Math.max(lines, 1), 5)\n})\n\nconst filteredPapers = computed(() => {\n  if (!paperSearch.value) return papers.value\n  const query = paperSearch.value.toLowerCase()\n  return papers.value.filter(p =>\n    (p.title || '').toLowerCase().includes(query) ||\n    (p.abstract || '').toLowerCase().includes(query)\n  )\n})\n\n// ==================== 快捷功能卡片 ====================\nconst quickCards = [\n  { key: 'summary', label: '文献综述', icon: 'Document', prompt: '请基于我的论文库生成一份文献综述' },\n  { key: 'gaps', label: '研究空白', icon: 'Search', prompt: '请分析当前研究领域的主要空白' },\n  { key: 'code', label: '代码生成', icon: 'Cpu', prompt: '请帮我生成实现XX算法的代码' },\n  { key: 'trends', label: '趋势分析', icon: 'TrendCharts', prompt: '请分析该领域的研究趋势' },\n]\n\nconst exampleQuestions = [\n  '帮我总结这几篇论文的核心贡献',\n  '这些论文中使用了哪些主要方法？',\n  '这个领域的研究现状如何？',\n  '有哪些潜在的研究方向值得探索？',\n  '帮我比较论文A和论文B的方法差异',\n  '请解释论文中的XX算法原理'\n]\n\n// ==================== 方法 ====================\nconst formatTime = (timestamp) => {\n  if (!timestamp) return ''\n  const date = new Date(timestamp)\n  return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })\n}\n\nconst renderMessage = (content) => {\n  if (!content) return ''\n  const html = marked(content)\n  return DOMPurify.sanitize(html)\n}\n\nconst scrollToBottom = () => {\n  nextTick(() => {\n    if (messagesContainer.value) {\n      messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight\n    }\n  })\n}\n\n// ==================== 聊天操作 ====================\nconst loadChatHistory = async () => {\n  try {\n    // 这里可以调用后端 API 获取会话列表\n    // 目前使用本地存储\n    const saved = localStorage.getItem('kimi_chat_history')\n    if (saved) {\n      chatHistory.value = JSON.parse(saved)\n    }\n  } catch (e) {\n    console.error('加载聊天历史失败:', e)\n  }\n}\n\nconst saveChatHistory = () => {\n  try {\n    localStorage.setItem('kimi_chat_history', JSON.stringify(chatHistory.value))\n  } catch (e) {\n    console.error('保存聊天历史失败:', e)\n  }\n}\n\nconst createNewChat = () => {\n  const newChatId = `chat_${Date.now()}`\n  currentChatId.value = newChatId\n  messages.value = []\n  selectedPapers.value = []\n\n  // 添加到历史\n  chatHistory.value.unshift({\n    chat_id: newChatId,\n    preview: '新对话',\n    created_at: new Date().toISOString(),\n    message_count: 0\n  })\n\n  saveChatHistory()\n}\n\nconst switchChat = async (chatId) => {\n  if (currentChatId.value === chatId) return\n\n  currentChatId.value = chatId\n\n  // 加载该会话的消息历史\n  try {\n    const response = await api.getChatHistory(chatId)\n    if (response.success) {\n      messages.value = response.data || []\n    }\n  } catch (e) {\n    console.error('加载消息历史失败:', e)\n    messages.value = []\n  }\n\n  scrollToBottom()\n}\n\nconst renameChat = (chatId) => {\n  renameChatId.value = chatId\n  renameValue.value = ''\n  showRenameDialog.value = true\n}\n\nconst confirmRename = () => {\n  if (!renameValue.value.trim()) {\n    ElMessage.warning('请输入新名称')\n    return\n  }\n\n  const chat = chatHistory.value.find(c => c.chat_id === renameChatId.value)\n  if (chat) {\n    chat.preview = renameValue.value\n    saveChatHistory()\n    ElMessage.success('重命名成功')\n  }\n\n  showRenameDialog.value = false\n}\n\nconst deleteChat = async (chatId) => {\n  try {\n    await ElMessageBox.confirm('确定要删除这个对话吗？', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    })\n\n    // 调用后端 API 删除\n    await api.deleteChat({ chatId })\n\n    // 从列表中移除\n    chatHistory.value = chatHistory.value.filter(c => c.chat_id !== chatId)\n\n    // 如果删除的是当前会话，切换到第一个或新建\n    if (currentChatId.value === chatId) {\n      if (chatHistory.value.length > 0) {\n        switchChat(chatHistory.value[0].chat_id)\n      } else {\n        createNewChat()\n      }\n    }\n\n    saveChatHistory()\n    ElMessage.success('删除成功')\n  } catch (e) {\n    if (e !== 'cancel') {\n      console.error('删除失败:', e)\n    }\n  }\n}\n\nconst clearCurrentChat = async () => {\n  if (messages.value.length === 0) return\n\n  try {\n    await ElMessageBox.confirm('确定要清空当前对话吗？', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    })\n\n    await api.clearChat({ chatId: currentChatId.value })\n    messages.value = []\n\n    // 更新预览\n    const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n    if (chat) {\n      chat.preview = '新对话'\n      chat.message_count = 0\n      saveChatHistory()\n    }\n\n    ElMessage.success('已清空')\n  } catch (e) {\n    if (e !== 'cancel') {\n      console.error('清空失败:', e)\n    }\n  }\n}\n\n// ==================== 消息发送 ====================\nconst handleEnter = (e) => {\n  if (e.shiftKey) {\n    // Shift+Enter 换行\n    return\n  }\n  e.preventDefault()\n  sendMessage()\n}\n\nconst handleInput = () => {\n  // 可以在这里实现输入提示等功能\n}\n\nconst sendQuickMessage = (prompt) => {\n  inputMessage.value = prompt\n  sendMessage()\n}\n\nconst sendMessage = async (content = null) => {\n  const message = content || inputMessage.value.trim()\n  if (!message || isTyping.value) return\n\n  // 清空输入框\n  if (!content) {\n    inputMessage.value = ''\n  }\n\n  // 添加用户消息\n  messages.value.push({\n    role: 'user',\n    content: message,\n    timestamp: new Date().toISOString(),\n    references: []\n  })\n\n  scrollToBottom()\n  isTyping.value = true\n\n  try {\n    // 调用流式 API\n    const response = await fetch('/api/chat/stream', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      },\n      body: JSON.stringify({\n        message,\n        chatId: currentChatId.value,\n        papers: selectedPapers.value.map(p => p.id),\n        model: currentModel.value,\n        temperature: settings.value.temperature,\n        useRag: useRag.value,\n        useWebSearch: useWebSearch.value\n      })\n    })\n\n    const reader = response.body.getReader()\n    const decoder = new TextDecoder()\n    let fullContent = ''\n\n    // 添加 AI 消息占位\n    messages.value.push({\n      role: 'assistant',\n      content: '',\n      timestamp: new Date().toISOString(),\n      references: []\n    })\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const { done, value } = await reader.read()\n      if (done) break\n\n      const chunk = decoder.decode(value)\n      const lines = chunk.split('\\n\\n')\n\n      for (const line of lines) {\n        if (line.startsWith('data: ')) {\n          try {\n            const data = JSON.parse(line.slice(6))\n\n            if (data.done) {\n              isTyping.value = false\n            } else if (data.content) {\n              fullContent += data.content\n              messages.value[messages.value.length - 1].content = fullContent\n              scrollToBottom()\n            }\n          } catch (e) {\n            console.error('解析 SSE 数据失败:', e)\n          }\n        }\n      }\n    }\n\n    // 更新会话预览\n    const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n    if (chat) {\n      chat.preview = message.slice(0, 30) + (message.length > 30 ? '...' : '')\n      chat.message_count = messages.value.length\n      saveChatHistory()\n    }\n\n  } catch (error) {\n    console.error('发送消息失败:', error)\n    ElMessage.error('发送失败，请重试')\n    isTyping.value = false\n  }\n}\n\n// ==================== 论文选择 ====================\nconst loadPapers = async () => {\n  try {\n    const response = await api.getPapersList({ limit: 100 })\n    if (response.success) {\n      papers.value = response.data.items || []\n    }\n  } catch (error) {\n    console.error('加载论文失败:', error)\n  }\n}\n\nconst handlePaperSelectionChange = (selection) => {\n  tempSelectedPapers.value = selection\n}\n\nconst confirmPaperSelection = () => {\n  selectedPapers.value = [...tempSelectedPapers.value]\n  showPaperSelector.value = false\n  ElMessage.success(`已关联 ${selectedPapers.value.length} 篇论文`)\n}\n\nconst viewPaper = (paperId) => {\n  window.open(`#/papers/${paperId}`, '_blank')\n}\n\n// ==================== 设置 ====================\nconst saveSettings = () => {\n  localStorage.setItem('kimi_chat_settings', JSON.stringify(settings.value))\n  showSettings.value = false\n  ElMessage.success('设置已保存')\n}\n\nconst loadSettings = () => {\n  try {\n    const saved = localStorage.getItem('kimi_chat_settings')\n    if (saved) {\n      settings.value = { ...settings.value, ...JSON.parse(saved) }\n    }\n  } catch (e) {\n    console.error('加载设置失败:', e)\n  }\n}\n\n// ==================== 其他操作 ====================\nconst handleUpload = () => {\n  ElMessage.info('文件上传功能开发中')\n}\n\n// ==================== 生命周期 ====================\nonMounted(() => {\n  loadChatHistory()\n  loadPapers()\n  loadSettings()\n\n  // 如果没有会话，创建一个新的\n  if (chatHistory.value.length === 0) {\n    createNewChat()\n  } else {\n    // 切换到第一个会话\n    switchChat(chatHistory.value[0].chat_id)\n  }\n})\n</script>\n\n<style scoped>\n.kimi-chat-container {\n  display: flex;\n  height: calc(100vh - 64px);\n  background: #f9fafb;\n}\n\n/* ==================== 侧边栏 ==================== */\n.sidebar {\n  width: 260px;\n  background: #ffffff;\n  border-right: 1px solid #e5e7eb;\n  display: flex;\n  flex-direction: column;\n  transition: width 0.3s ease;\n}\n\n.sidebar.collapsed {\n  width: 60px;\n}\n\n.sidebar-header {\n  padding: 16px;\n  display: flex;\n  gap: 8px;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.new-chat-btn {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 10px 16px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: white;\n  border: none;\n  border-radius: 10px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.new-chat-btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n}\n\n.collapse-btn {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #f3f4f6;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.collapse-btn:hover {\n  background: #e5e7eb;\n}\n\n.sidebar.collapsed .new-chat-btn span {\n  display: none;\n}\n\n/* 对话历史 */\n.chat-history {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px;\n}\n\n.chat-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  border-radius: 8px;\n  cursor: pointer;\n  margin-bottom: 4px;\n  transition: all 0.2s;\n  position: relative;\n}\n\n.chat-item:hover {\n  background: #f3f4f6;\n}\n\n.chat-item.active {\n  background: #d1fae5;\n}\n\n.chat-item.active .chat-title {\n  color: #059669;\n  font-weight: 500;\n}\n\n.chat-icon {\n  font-size: 16px;\n  color: #6b7280;\n  flex-shrink: 0;\n}\n\n.chat-item.active .chat-icon {\n  color: #059669;\n}\n\n.chat-title {\n  flex: 1;\n  font-size: 14px;\n  color: #374151;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.chat-actions {\n  opacity: 0;\n  transition: opacity 0.2s;\n}\n\n.chat-item:hover .chat-actions {\n  opacity: 1;\n}\n\n.more-icon {\n  padding: 4px;\n  border-radius: 4px;\n  color: #6b7280;\n  cursor: pointer;\n}\n\n.more-icon:hover {\n  background: #e5e7eb;\n  color: #374151;\n}\n\n.sidebar.collapsed .chat-title,\n.sidebar.collapsed .chat-actions {\n  display: none;\n}\n\n/* 侧边栏底部 */\n.sidebar-footer {\n  padding: 12px 16px;\n  border-top: 1px solid #e5e7eb;\n}\n\n.footer-btn {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  background: transparent;\n  border: none;\n  border-radius: 8px;\n  color: #6b7280;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.footer-btn:hover {\n  background: #f3f4f6;\n  color: #374151;\n}\n\n.sidebar.collapsed .footer-btn span {\n  display: none;\n}\n\n/* ==================== 主聊天区域 ==================== */\n.chat-main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n/* 顶部导航 */\n.chat-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 24px;\n  background: #ffffff;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.chat-title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #111827;\n  margin: 0;\n}\n\n.header-right {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.model-select {\n  width: 140px;\n}\n\n/* 消息区域 */\n.messages-area {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px;\n}\n\n/* 欢迎页面 */\n.welcome-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 100%;\n  text-align: center;\n  padding: 40px 20px;\n}\n\n.welcome-logo {\n  margin-bottom: 24px;\n  animation: float 3s ease-in-out infinite;\n}\n\n@keyframes float {\n  0%, 100% { transform: translateY(0); }\n  50% { transform: translateY(-10px); }\n}\n\n.welcome-title {\n  font-size: 32px;\n  font-weight: 700;\n  color: #111827;\n  margin-bottom: 12px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n.welcome-subtitle {\n  font-size: 16px;\n  color: #6b7280;\n  max-width: 500px;\n  margin-bottom: 40px;\n}\n\n/* 快捷卡片 */\n.quick-cards {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 16px;\n  max-width: 600px;\n  margin-bottom: 48px;\n}\n\n.quick-card {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 10px;\n  padding: 20px 16px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.quick-card:hover {\n  border-color: #10b981;\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);\n  transform: translateY(-2px);\n}\n\n.quick-card span {\n  font-size: 14px;\n  color: #374151;\n  font-weight: 500;\n}\n\n.quick-card:hover span {\n  color: #059669;\n}\n\n/* 示例问题 */\n.example-questions {\n  max-width: 600px;\n}\n\n.section-title {\n  font-size: 14px;\n  color: #9ca3af;\n  margin-bottom: 16px;\n}\n\n.question-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  justify-content: center;\n}\n\n.question-tag {\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.question-tag:hover {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n/* 消息样式 */\n.message-wrapper {\n  display: flex;\n  gap: 12px;\n  margin-bottom: 24px;\n  max-width: 90%;\n}\n\n.message-wrapper.user-message {\n  margin-left: auto;\n  flex-direction: row-reverse;\n}\n\n.message-wrapper.ai-message {\n  margin-right: auto;\n}\n\n.message-avatar {\n  flex-shrink: 0;\n}\n\n.ai-avatar {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  border-radius: 50%;\n  color: white;\n}\n\n.message-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.message-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 6px;\n}\n\n.user-message .message-header {\n  justify-content: flex-end;\n}\n\n.message-role {\n  font-size: 13px;\n  font-weight: 600;\n  color: #374151;\n}\n\n.message-time {\n  font-size: 12px;\n  color: #9ca3af;\n}\n\n.message-body {\n  padding: 14px 18px;\n  border-radius: 12px;\n  font-size: 15px;\n  line-height: 1.7;\n  color: #374151;\n}\n\n.user-message .message-body {\n  background: #10b981;\n  color: white;\n  border-bottom-right-radius: 4px;\n}\n\n.ai-message .message-body {\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-bottom-left-radius: 4px;\n}\n\n.ai-message .message-body :deep(p) {\n  margin: 0 0 12px 0;\n}\n\n.ai-message .message-body :deep(p:last-child) {\n  margin-bottom: 0;\n}\n\n.ai-message .message-body :deep(pre) {\n  background: #1f2937;\n  border-radius: 8px;\n  padding: 16px;\n  overflow-x: auto;\n  margin: 12px 0;\n}\n\n.ai-message .message-body :deep(code) {\n  font-family: 'Menlo', 'Monaco', 'Courier New', monospace;\n  font-size: 13px;\n}\n\n.ai-message .message-body :deep(:not(pre) > code) {\n  background: #f3f4f6;\n  padding: 2px 6px;\n  border-radius: 4px;\n  color: #ec4899;\n}\n\n.ai-message .message-body :deep(ul), .ai-message .message-body :deep(ol) {\n  padding-left: 20px;\n  margin: 12px 0;\n}\n\n.ai-message .message-body :deep(li) {\n  margin: 6px 0;\n}\n\n.ai-message .message-body :deep(h1), .ai-message .message-body :deep(h2), .ai-message .message-body :deep(h3) {\n  margin: 20px 0 12px 0;\n  color: #111827;\n}\n\n.ai-message .message-body :deep(blockquote) {\n  border-left: 4px solid #10b981;\n  margin: 12px 0;\n  padding: 8px 16px;\n  background: #f0fdf4;\n  border-radius: 0 8px 8px 0;\n}\n\n/* 引用文献 */\n.message-references {\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px dashed #e5e7eb;\n}\n\n.ref-title {\n  font-size: 12px;\n  color: #9ca3af;\n  margin-bottom: 8px;\n}\n\n.ref-list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.ref-tag {\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.ref-tag:hover {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n/* 正在输入动画 */\n.typing-indicator {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 16px 18px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  border-bottom-left-radius: 4px;\n}\n\n.typing-indicator span {\n  width: 8px;\n  height: 8px;\n  background: #10b981;\n  border-radius: 50%;\n  animation: typing 1.4s infinite ease-in-out both;\n}\n\n.typing-indicator span:nth-child(1) {\n  animation-delay: -0.32s;\n}\n\n.typing-indicator span:nth-child(2) {\n  animation-delay: -0.16s;\n}\n\n@keyframes typing {\n  0%, 80%, 100% {\n    transform: scale(0);\n    opacity: 0.5;\n  }\n  40% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n/* ==================== 输入区域 ==================== */\n.input-area {\n  background: #ffffff;\n  border-top: 1px solid #e5e7eb;\n  padding: 16px 24px;\n}\n\n.input-toolbar {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 10px;\n}\n\n.tool-btn {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  color: #6b7280;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n}\n\n.tool-btn:hover {\n  background: #f3f4f6;\n  color: #374151;\n}\n\n.tool-btn.active {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n.tool-btn .badge {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  width: 18px;\n  height: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #ef4444;\n  color: white;\n  font-size: 11px;\n  border-radius: 50%;\n}\n\n.input-box {\n  display: flex;\n  gap: 12px;\n  align-items: flex-end;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  padding: 12px 16px;\n  transition: all 0.2s;\n}\n\n.input-box:focus-within {\n  background: #ffffff;\n  border-color: #10b981;\n  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);\n}\n\n.input-box :deep(.el-textarea__inner) {\n  background: transparent;\n  border: none;\n  padding: 0;\n  font-size: 15px;\n  resize: none;\n  box-shadow: none;\n}\n\n.input-box :deep(.el-textarea__inner:focus) {\n  box-shadow: none;\n}\n\n.send-btn {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  border: none;\n  border-radius: 10px;\n  color: white;\n  cursor: pointer;\n  transition: all 0.2s;\n  flex-shrink: 0;\n}\n\n.send-btn:hover:not(:disabled) {\n  transform: scale(1.05);\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n}\n\n.send-btn:disabled {\n  background: #d1d5db;\n  cursor: not-allowed;\n}\n\n.send-btn .loading {\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n.input-hint {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 8px;\n  font-size: 12px;\n  color: #9ca3af;\n}\n\n/* ==================== 对话框样式 ==================== */\n.dialog-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.paper-selector {\n  max-height: 500px;\n}\n\n.paper-search {\n  margin-bottom: 16px;\n}\n\n.slider-hint {\n  font-size: 12px;\n  color: #9ca3af;\n  margin-top: 4px;\n}\n\n/* 下拉菜单危险项 */\n:deep(.el-dropdown-menu__item.danger) {\n  color: #ef4444;\n}\n\n:deep(.el-dropdown-menu__item.danger:hover) {\n  background: #fef2f2;\n  color: #dc2626;\n}\n\n/* 响应式 */\n@media (max-width: 768px) {\n  .sidebar {\n    position: absolute;\n    z-index: 100;\n    height: 100%;\n  }\n\n  .sidebar.collapsed {\n    transform: translateX(-100%);\n  }\n\n  .quick-cards {\n    grid-template-columns: repeat(2, 1fr);\n  }\n\n  .message-wrapper {\n    max-width: 100%;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}