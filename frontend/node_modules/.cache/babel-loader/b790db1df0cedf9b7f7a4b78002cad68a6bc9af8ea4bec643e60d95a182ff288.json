{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport api, { connectSocket } from '@/api';\nimport { ElMessage } from 'element-plus';\nexport default {\n  name: 'Cluster',\n  setup() {\n    const store = useStore();\n    const files = computed(() => store.state.files);\n    const selectedFiles = ref([]);\n    const options = ref({\n      nClusters: 5,\n      method: 'kmeans',\n      language: 'chinese'\n    });\n    const clustering = ref(false);\n    const result = ref(null);\n    const activeClusters = ref(['0', '1', '2']);\n    const formatSize = (row, column, size) => {\n      return (size / 1024 / 1024).toFixed(2) + ' MB';\n    };\n    const handleSelectionChange = selection => {\n      selectedFiles.value = selection;\n    };\n    const startCluster = async () => {\n      if (selectedFiles.value.length < 2) {\n        ElMessage.warning('请至少选择2篇论文');\n        return;\n      }\n\n      // 连接WebSocket\n      connectSocket();\n      store.commit('SHOW_PROGRESS_DIALOG', true);\n      store.commit('SET_PROGRESS', {\n        progress: 0,\n        message: '开始聚类分析...',\n        step: ''\n      });\n      clustering.value = true;\n      try {\n        const filepaths = selectedFiles.value.map(f => `/uploads/${f.filename}`);\n        const response = await api.clusterPapers(filepaths, options.value.nClusters, options.value.method, options.value.language);\n        if (response.success) {\n          result.value = response.data;\n          store.commit('SET_PROGRESS', {\n            progress: 100,\n            message: '聚类完成!'\n          });\n          ElMessage.success('聚类分析完成!');\n        } else {\n          ElMessage.error(response.error || '聚类失败');\n        }\n      } catch (error) {\n        ElMessage.error('聚类失败: ' + error.message);\n      } finally {\n        clustering.value = false;\n      }\n    };\n    const downloadVisualization = () => {\n      api.downloadResult('cluster', 'cluster_visualization.png');\n    };\n    const downloadReport = () => {\n      api.downloadResult('cluster', 'cluster_report.txt');\n    };\n    onMounted(() => {\n      store.dispatch('fetchFiles');\n    });\n    return {\n      files,\n      selectedFiles,\n      options,\n      clustering,\n      result,\n      activeClusters,\n      formatSize,\n      handleSelectionChange,\n      startCluster,\n      downloadVisualization,\n      downloadReport\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useStore","api","connectSocket","ElMessage","name","setup","store","files","state","selectedFiles","options","nClusters","method","language","clustering","result","activeClusters","formatSize","row","column","size","toFixed","handleSelectionChange","selection","value","startCluster","length","warning","commit","progress","message","step","filepaths","map","f","filename","response","clusterPapers","success","data","error","downloadVisualization","downloadResult","downloadReport","dispatch"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/views/Cluster.vue"],"sourcesContent":["<template>\n  <div class=\"cluster\">\n    <h2>多篇论文主题聚类分析</h2>\n\n    <el-card class=\"select-card\">\n      <h3>选择要分析的论文（至少2篇）</h3>\n      <el-table\n        :data=\"files\"\n        style=\"width: 100%; margin-top: 20px\"\n        @selection-change=\"handleSelectionChange\"\n      >\n        <el-table-column type=\"selection\" width=\"55\" />\n        <el-table-column prop=\"filename\" label=\"文件名\" />\n        <el-table-column prop=\"size\" label=\"大小\" :formatter=\"formatSize\" />\n      </el-table>\n    </el-card>\n\n    <el-card class=\"options-card\">\n      <h3>聚类选项</h3>\n      <el-form :model=\"options\" label-width=\"120px\">\n        <el-form-item label=\"聚类数量\">\n          <el-input-number v-model=\"options.nClusters\" :min=\"2\" :max=\"10\" />\n        </el-form-item>\n        <el-form-item label=\"聚类方法\">\n          <el-select v-model=\"options.method\">\n            <el-option label=\"K-Means\" value=\"kmeans\" />\n            <el-option label=\"DBSCAN\" value=\"dbscan\" />\n            <el-option label=\"层次聚类\" value=\"hierarchical\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"论文语言\">\n          <el-select v-model=\"options.language\">\n            <el-option label=\"中文\" value=\"chinese\" />\n            <el-option label=\"英文\" value=\"english\" />\n          </el-select>\n        </el-form-item>\n      </el-form>\n\n      <el-button\n        type=\"primary\"\n        size=\"large\"\n        @click=\"startCluster\"\n        :disabled=\"selectedFiles.length < 2\"\n        :loading=\"clustering\"\n      >\n        <i class=\"el-icon-data-analysis\"></i> 开始聚类分析\n      </el-button>\n    </el-card>\n\n    <el-card class=\"result-card\" v-if=\"result\">\n      <h3>聚类结果</h3>\n\n      <el-alert\n        :title=\"`共发现 ${result.clusterCount} 个主题类别`\"\n        type=\"success\"\n        :closable=\"false\"\n        style=\"margin-bottom: 20px\"\n      />\n\n      <el-collapse v-model=\"activeClusters\">\n        <el-collapse-item\n          v-for=\"(cluster, index) in Object.entries(result.clusterAnalysis)\"\n          :key=\"cluster[0]\"\n          :name=\"cluster[0]\"\n        >\n          <template #title>\n            <strong>聚类 {{ cluster[0] }}</strong>\n            <el-tag style=\"margin-left: 10px\">{{ cluster[1].paperCount }} 篇论文</el-tag>\n          </template>\n\n          <div class=\"cluster-content\">\n            <h4>核心关键词</h4>\n            <el-space wrap>\n              <el-tag\n                v-for=\"(keyword, kIndex) in cluster[1].topKeywords.slice(0, 10)\"\n                :key=\"kIndex\"\n                type=\"success\"\n              >\n                {{ keyword }}\n              </el-tag>\n            </el-space>\n\n            <h4 style=\"margin-top: 20px\">包含论文</h4>\n            <ul>\n              <li v-for=\"(paper, pIndex) in cluster[1].papers\" :key=\"pIndex\">\n                {{ paper }}\n              </li>\n            </ul>\n\n            <h4 style=\"margin-top: 20px\">代表性论文</h4>\n            <div\n              v-for=\"(rep, rIndex) in cluster[1].representativePapers\"\n              :key=\"rIndex\"\n              class=\"rep-paper\"\n            >\n              <p><strong>{{ rep.title }}</strong></p>\n              <p class=\"rep-abstract\">{{ rep.abstract }}</p>\n            </div>\n          </div>\n        </el-collapse-item>\n      </el-collapse>\n\n      <div class=\"result-actions\">\n        <el-button @click=\"downloadVisualization\">\n          <i class=\"el-icon-picture\"></i> 下载可视化图\n        </el-button>\n        <el-button @click=\"downloadReport\">\n          <i class=\"el-icon-document\"></i> 下载聚类报告\n        </el-button>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted } from 'vue'\nimport { useStore } from 'vuex'\nimport api, { connectSocket } from '@/api'\nimport { ElMessage } from 'element-plus'\n\nexport default {\n  name: 'Cluster',\n  setup() {\n    const store = useStore()\n\n    const files = computed(() => store.state.files)\n    const selectedFiles = ref([])\n    const options = ref({\n      nClusters: 5,\n      method: 'kmeans',\n      language: 'chinese'\n    })\n    const clustering = ref(false)\n    const result = ref(null)\n    const activeClusters = ref(['0', '1', '2'])\n\n    const formatSize = (row, column, size) => {\n      return (size / 1024 / 1024).toFixed(2) + ' MB'\n    }\n\n    const handleSelectionChange = (selection) => {\n      selectedFiles.value = selection\n    }\n\n    const startCluster = async () => {\n      if (selectedFiles.value.length < 2) {\n        ElMessage.warning('请至少选择2篇论文')\n        return\n      }\n\n      // 连接WebSocket\n      connectSocket()\n      store.commit('SHOW_PROGRESS_DIALOG', true)\n      store.commit('SET_PROGRESS', { progress: 0, message: '开始聚类分析...', step: '' })\n\n      clustering.value = true\n\n      try {\n        const filepaths = selectedFiles.value.map(f => `/uploads/${f.filename}`)\n        const response = await api.clusterPapers(\n          filepaths,\n          options.value.nClusters,\n          options.value.method,\n          options.value.language\n        )\n\n        if (response.success) {\n          result.value = response.data\n          store.commit('SET_PROGRESS', { progress: 100, message: '聚类完成!' })\n          ElMessage.success('聚类分析完成!')\n        } else {\n          ElMessage.error(response.error || '聚类失败')\n        }\n      } catch (error) {\n        ElMessage.error('聚类失败: ' + error.message)\n      } finally {\n        clustering.value = false\n      }\n    }\n\n    const downloadVisualization = () => {\n      api.downloadResult('cluster', 'cluster_visualization.png')\n    }\n\n    const downloadReport = () => {\n      api.downloadResult('cluster', 'cluster_report.txt')\n    }\n\n    onMounted(() => {\n      store.dispatch('fetchFiles')\n    })\n\n    return {\n      files,\n      selectedFiles,\n      options,\n      clustering,\n      result,\n      activeClusters,\n      formatSize,\n      handleSelectionChange,\n      startCluster,\n      downloadVisualization,\n      downloadReport\n    }\n  }\n}\n</script>\n\n<style scoped>\n.cluster {\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\nh2 {\n  margin-bottom: 20px;\n  color: #303133;\n}\n\n.select-card,\n.options-card,\n.result-card {\n  margin-bottom: 20px;\n}\n\n.cluster-content h4 {\n  color: #409eff;\n  margin: 20px 0 10px 0;\n}\n\n.cluster-content ul {\n  list-style: none;\n  padding: 0;\n}\n\n.cluster-content ul li {\n  padding: 8px 0;\n  padding-left: 20px;\n  position: relative;\n}\n\n.cluster-content ul li:before {\n  content: '•';\n  position: absolute;\n  left: 0;\n  color: #409eff;\n  font-weight: bold;\n}\n\n.rep-paper {\n  padding: 15px;\n  background: #f5f7fa;\n  border-radius: 4px;\n  margin-bottom: 10px;\n}\n\n.rep-paper p {\n  margin: 5px 0;\n}\n\n.rep-abstract {\n  color: #606266;\n  font-size: 14px;\n  line-height: 1.6;\n}\n\n.result-actions {\n  margin-top: 20px;\n  text-align: right;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}