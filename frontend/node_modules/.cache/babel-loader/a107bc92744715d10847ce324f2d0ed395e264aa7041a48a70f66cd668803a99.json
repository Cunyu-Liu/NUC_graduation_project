{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { ref, computed, watch } from 'vue';\nimport { useProps } from './useProps.mjs';\nfunction useAllowCreate(props, states) {\n  const {\n    aliasProps,\n    getLabel,\n    getValue\n  } = useProps(props);\n  const createOptionCount = ref(0);\n  const cachedSelectedOption = ref();\n  const enableAllowCreateMode = computed(() => {\n    return props.allowCreate && props.filterable;\n  });\n  watch(() => props.options, options => {\n    const optionLabelsSet = new Set(options.map(option => getLabel(option)));\n    states.createdOptions = states.createdOptions.filter(createdOption => !optionLabelsSet.has(getLabel(createdOption)));\n  });\n  function hasExistingOption(query) {\n    const hasOption = option => getLabel(option) === query;\n    return props.options && props.options.some(hasOption) || states.createdOptions.some(hasOption);\n  }\n  function selectNewOption(option) {\n    if (!enableAllowCreateMode.value) {\n      return;\n    }\n    if (props.multiple && option.created) {\n      createOptionCount.value++;\n    } else {\n      cachedSelectedOption.value = option;\n    }\n  }\n  function createNewOption(query) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0) {\n        if (hasExistingOption(query)) {\n          states.createdOptions = states.createdOptions.filter(createdOption => getLabel(createdOption) !== states.previousQuery);\n          return;\n        }\n        const newOption = {\n          [aliasProps.value.value]: query,\n          [aliasProps.value.label]: query,\n          created: true,\n          [aliasProps.value.disabled]: false\n        };\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption;\n        } else {\n          states.createdOptions.push(newOption);\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value;\n        } else {\n          const selectedOption = cachedSelectedOption.value;\n          states.createdOptions.length = 0;\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption);\n          }\n        }\n      }\n    }\n  }\n  function removeNewOption(option) {\n    if (!enableAllowCreateMode.value || !option || !option.created || option.created && props.reserveKeyword && states.inputValue === getLabel(option)) {\n      return;\n    }\n    const idx = states.createdOptions.findIndex(it => getValue(it) === getValue(option));\n    if (~idx) {\n      states.createdOptions.splice(idx, 1);\n      createOptionCount.value--;\n    }\n  }\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0;\n      createOptionCount.value = 0;\n    }\n  }\n  return {\n    createNewOption,\n    removeNewOption,\n    selectNewOption,\n    clearAllNewOption\n  };\n}\nexport { useAllowCreate };","map":{"version":3,"names":["useAllowCreate","props","states","aliasProps","getLabel","getValue","useProps","createOptionCount","ref","cachedSelectedOption","enableAllowCreateMode","computed","allowCreate","filterable","watch","options","optionLabelsSet","Set","map","option","createdOptions","filter","createdOption","has","hasExistingOption","query","hasOption","some","selectNewOption","value","multiple","created","createNewOption","length","previousQuery","newOption","label","disabled","push","selectedOption","removeNewOption","reserveKeyword","inputValue","idx","findIndex","it","splice","clearAllNewOption"],"sources":["../../../../../../packages/components/select-v2/src/useAllowCreate.ts"],"sourcesContent":["import { computed, ref, watch } from 'vue'\nimport { useProps } from './useProps'\n\nimport type { SelectV2Props } from './token'\nimport type { Option, SelectStates } from './select.types'\n\nexport function useAllowCreate(props: SelectV2Props, states: SelectStates) {\n  const { aliasProps, getLabel, getValue } = useProps(props)\n\n  const createOptionCount = ref(0)\n  const cachedSelectedOption = ref<Option>()\n\n  const enableAllowCreateMode = computed(() => {\n    return props.allowCreate && props.filterable\n  })\n\n  watch(\n    () => props.options,\n    (options) => {\n      const optionLabelsSet = new Set(options.map((option) => getLabel(option)))\n      states.createdOptions = states.createdOptions.filter(\n        (createdOption) => !optionLabelsSet.has(getLabel(createdOption))\n      )\n    }\n  )\n\n  function hasExistingOption(query: string) {\n    const hasOption = (option: Option) => getLabel(option) === query\n    return (\n      (props.options && props.options.some(hasOption)) ||\n      states.createdOptions.some(hasOption)\n    )\n  }\n\n  function selectNewOption(option: Option) {\n    if (!enableAllowCreateMode.value) {\n      return\n    }\n    if (props.multiple && option.created) {\n      createOptionCount.value++\n    } else {\n      cachedSelectedOption.value = option\n    }\n  }\n\n  function createNewOption(query: string) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0) {\n        if (hasExistingOption(query)) {\n          states.createdOptions = states.createdOptions.filter(\n            (createdOption) => getLabel(createdOption) !== states.previousQuery\n          )\n          return\n        }\n        const newOption = {\n          [aliasProps.value.value]: query,\n          [aliasProps.value.label]: query,\n          created: true,\n          [aliasProps.value.disabled]: false,\n        }\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption\n        } else {\n          states.createdOptions.push(newOption)\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value\n        } else {\n          const selectedOption = cachedSelectedOption.value\n          states.createdOptions.length = 0\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption)\n          }\n        }\n      }\n    }\n  }\n\n  function removeNewOption(option: Option) {\n    if (\n      !enableAllowCreateMode.value ||\n      !option ||\n      !option.created ||\n      (option.created &&\n        props.reserveKeyword &&\n        states.inputValue === getLabel(option))\n    ) {\n      return\n    }\n    const idx = states.createdOptions.findIndex(\n      (it) => getValue(it) === getValue(option)\n    )\n    if (~idx) {\n      states.createdOptions.splice(idx, 1)\n      createOptionCount.value--\n    }\n  }\n\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0\n      createOptionCount.value = 0\n    }\n  }\n\n  return {\n    createNewOption,\n    removeNewOption,\n    selectNewOption,\n    clearAllNewOption,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}