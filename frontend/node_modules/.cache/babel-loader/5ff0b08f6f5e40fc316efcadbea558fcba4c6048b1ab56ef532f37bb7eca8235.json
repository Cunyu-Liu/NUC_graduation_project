{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { computed, unref, shallowRef, ref, watch, onBeforeUnmount } from 'vue';\nimport { createPopper } from '@popperjs/core';\nimport { fromPairs } from 'lodash-unified';\nconst usePopper = (referenceElementRef, popperElementRef, opts = {}) => {\n  const stateUpdater = {\n    name: \"updateState\",\n    enabled: true,\n    phase: \"write\",\n    fn: ({\n      state\n    }) => {\n      const derivedState = deriveState(state);\n      Object.assign(states.value, derivedState);\n    },\n    requires: [\"computeStyles\"]\n  };\n  const options = computed(() => {\n    const {\n      onFirstUpdate,\n      placement,\n      strategy,\n      modifiers\n    } = unref(opts);\n    return {\n      onFirstUpdate,\n      placement: placement || \"bottom\",\n      strategy: strategy || \"absolute\",\n      modifiers: [...(modifiers || []), stateUpdater, {\n        name: \"applyStyles\",\n        enabled: false\n      }]\n    };\n  });\n  const instanceRef = shallowRef();\n  const states = ref({\n    styles: {\n      popper: {\n        position: unref(options).strategy,\n        left: \"0\",\n        top: \"0\"\n      },\n      arrow: {\n        position: \"absolute\"\n      }\n    },\n    attributes: {}\n  });\n  const destroy = () => {\n    if (!instanceRef.value) return;\n    instanceRef.value.destroy();\n    instanceRef.value = void 0;\n  };\n  watch(options, newOptions => {\n    const instance = unref(instanceRef);\n    if (instance) {\n      instance.setOptions(newOptions);\n    }\n  }, {\n    deep: true\n  });\n  watch([referenceElementRef, popperElementRef], ([referenceElement, popperElement]) => {\n    destroy();\n    if (!referenceElement || !popperElement) return;\n    instanceRef.value = createPopper(referenceElement, popperElement, unref(options));\n  });\n  onBeforeUnmount(() => {\n    destroy();\n  });\n  return {\n    state: computed(() => {\n      var _a;\n      return {\n        ...(((_a = unref(instanceRef)) == null ? void 0 : _a.state) || {})\n      };\n    }),\n    styles: computed(() => unref(states).styles),\n    attributes: computed(() => unref(states).attributes),\n    update: () => {\n      var _a;\n      return (_a = unref(instanceRef)) == null ? void 0 : _a.update();\n    },\n    forceUpdate: () => {\n      var _a;\n      return (_a = unref(instanceRef)) == null ? void 0 : _a.forceUpdate();\n    },\n    instanceRef: computed(() => unref(instanceRef))\n  };\n};\nfunction deriveState(state) {\n  const elements = Object.keys(state.elements);\n  const styles = fromPairs(elements.map(element => [element, state.styles[element] || {}]));\n  const attributes = fromPairs(elements.map(element => [element, state.attributes[element]]));\n  return {\n    styles,\n    attributes\n  };\n}\nexport { usePopper };","map":{"version":3,"names":["usePopper","referenceElementRef","popperElementRef","opts","stateUpdater","name","enabled","phase","fn","state","derivedState","deriveState","Object","assign","states","value","requires","options","computed","onFirstUpdate","placement","strategy","modifiers","unref","instanceRef","shallowRef","ref","styles","popper","position","left","top","arrow","attributes","destroy","watch","newOptions","instance","setOptions","deep","referenceElement","popperElement","createPopper","onBeforeUnmount","_a","update","forceUpdate","elements","keys","fromPairs","map","element"],"sources":["../../../../../packages/hooks/use-popper/index.ts"],"sourcesContent":["import { computed, onBeforeUnmount, ref, shallowRef, unref, watch } from 'vue'\nimport { createPopper } from '@popperjs/core'\nimport { fromPairs } from 'lodash-unified'\n\nimport type { Ref } from 'vue'\nimport type {\n  Instance,\n  Modifier,\n  Options,\n  State,\n  VirtualElement,\n} from '@popperjs/core'\n\ntype ElementType = HTMLElement | undefined\ntype ReferenceElement = ElementType | VirtualElement\nexport type PartialOptions = Partial<Options>\n\nexport const usePopper = (\n  referenceElementRef: Ref<ReferenceElement>,\n  popperElementRef: Ref<ElementType>,\n  opts: Ref<PartialOptions> | PartialOptions = {} as PartialOptions\n) => {\n  const stateUpdater = {\n    name: 'updateState',\n    enabled: true,\n    phase: 'write',\n    fn: ({ state }) => {\n      const derivedState = deriveState(state)\n\n      Object.assign(states.value, derivedState)\n    },\n    requires: ['computeStyles'],\n  } as Modifier<'updateState', any>\n\n  const options = computed<Options>(() => {\n    const { onFirstUpdate, placement, strategy, modifiers } = unref(opts)\n\n    return {\n      onFirstUpdate,\n      placement: placement || 'bottom',\n      strategy: strategy || 'absolute',\n      modifiers: [\n        ...(modifiers || []),\n        stateUpdater,\n        { name: 'applyStyles', enabled: false },\n      ],\n    }\n  })\n\n  const instanceRef = shallowRef<Instance | undefined>()\n  const states = ref<Pick<State, 'styles' | 'attributes'>>({\n    styles: {\n      popper: {\n        position: unref(options).strategy,\n        left: '0',\n        top: '0',\n      },\n      arrow: {\n        position: 'absolute',\n      },\n    },\n    attributes: {},\n  })\n\n  const destroy = () => {\n    if (!instanceRef.value) return\n\n    instanceRef.value.destroy()\n    instanceRef.value = undefined\n  }\n\n  watch(\n    options,\n    (newOptions) => {\n      const instance = unref(instanceRef)\n      if (instance) {\n        instance.setOptions(newOptions)\n      }\n    },\n    {\n      deep: true,\n    }\n  )\n\n  watch(\n    [referenceElementRef, popperElementRef],\n    ([referenceElement, popperElement]) => {\n      destroy()\n      if (!referenceElement || !popperElement) return\n\n      instanceRef.value = createPopper(\n        referenceElement,\n        popperElement,\n        unref(options)\n      )\n    }\n  )\n\n  onBeforeUnmount(() => {\n    destroy()\n  })\n\n  return {\n    state: computed(() => ({ ...(unref(instanceRef)?.state || {}) })),\n    styles: computed(() => unref(states).styles),\n    attributes: computed(() => unref(states).attributes),\n    update: () => unref(instanceRef)?.update(),\n    forceUpdate: () => unref(instanceRef)?.forceUpdate(),\n    // Preventing end users from modifying the instance.\n    instanceRef: computed(() => unref(instanceRef)),\n  }\n}\n\nfunction deriveState(state: State) {\n  const elements = Object.keys(state.elements) as unknown as Array<\n    keyof State['elements']\n  >\n\n  const styles = fromPairs(\n    elements.map(\n      (element) =>\n        [element, state.styles[element] || {}] as [\n          string,\n          State['styles'][keyof State['styles']],\n        ]\n    )\n  )\n\n  const attributes = fromPairs(\n    elements.map(\n      (element) =>\n        [element, state.attributes[element]] as [\n          string,\n          State['attributes'][keyof State['attributes']],\n        ]\n    )\n  )\n\n  return {\n    styles,\n    attributes,\n  }\n}\n\nexport type UsePopperReturn = ReturnType<typeof usePopper>\n"],"mappings":";;;;;AAiBO,MAAMA,SAAA,GAAYA,CACvBC,mBAAA,EACAC,gBACA,EAAAC,IAAA,GAA6C,EAC1C;EACH,MAAMC,YAAe;IACnBC,IAAM;IACNC,OAAS;IACTC,KAAO;IACPC,EAAI,EAAAA,CAAC;MAAEC;IAAA,CAAY;MACX,MAAAC,YAAA,GAAeC,WAAA,CAAYF,KAAK;MAE/BG,MAAA,CAAAC,MAAA,CAAOC,MAAO,CAAAC,KAAA,EAAOL,YAAY;IAAA,CAC1C;IACAM,QAAA,EAAU,CAAC,eAAe;EAAA,CAC5B;EAEM,MAAAC,OAAA,GAAUC,QAAA,CAAkB,MAAM;IACtC,MAAM;MAAEC,aAAe;MAAAC,SAAA;MAAWC,QAAA;MAAUC;IAAU,IAAIC,KAAA,CAAMpB,IAAI;IAE7D;MACLgB,aAAA;MACAC,SAAA,EAAWA,SAAa;MACxBC,QAAA,EAAUA,QAAY;MACtBC,SAAW,GACT,IAAIA,SAAA,IAAa,EAAC,GAClBlB,YAAA,EACA;QAAEC,IAAA,EAAM,aAAe;QAAAC,OAAA,EAAS;MAAM;IACxC,CACF;EAAA,CACD;EAED,MAAMkB,WAAA,GAAcC,UAAiC;EACrD,MAAMX,MAAA,GAASY,GAA0C;IACvDC,MAAQ;MACNC,MAAQ;QACNC,QAAA,EAAUN,KAAM,CAAAN,OAAO,CAAE,CAAAI,QAAA;QACzBS,IAAM;QACNC,GAAK;MAAA,CACP;MACAC,KAAO;QACLH,QAAU;MAAA;IACZ,CACF;IACAI,UAAA,EAAY;EAAC,CACd;EAED,MAAMC,OAAA,GAAUA,CAAA,KAAM;IACpB,IAAI,CAACV,WAAY,CAAAT,KAAA,EAAO;IAExBS,WAAA,CAAYT,KAAA,CAAMmB,OAAQ;IAC1BV,WAAA,CAAYT,KAAQ;EAAA,CACtB;EAEAoB,KAAA,CACElB,OAAA,EACCmB,UAAe;IACR,MAAAC,QAAA,GAAWd,KAAA,CAAMC,WAAW;IAClC,IAAIa,QAAU;MACZA,QAAA,CAASC,UAAA,CAAWF,UAAU;IAAA;EAChC,CACF,EACA;IACEG,IAAM;EAAA,CACR,CACF;EAEAJ,KAAA,CACE,CAAClC,mBAAA,EAAqBC,gBAAgB,GACtC,CAAC,CAACsC,gBAAkB,EAAAC,aAAa,CAAM;IAC7BP,OAAA;IACJ,KAACM,gBAAA,IAAoB,CAACC,aAAA,EAAe;IAEzCjB,WAAA,CAAYT,KAAQ,GAAA2B,YAAA,CAClBF,gBAAA,EACAC,aAAA,EACAlB,KAAA,CAAMN,OAAO,EACf;EAAA,CACF,CACF;EAEA0B,eAAA,CAAgB,MAAM;IACZT,OAAA;EAAA,CACT;EAEM;IACLzB,KAAA,EAAOS,QAAA,CAAS,MAAG;MAvGvB,IAAA0B,EAAA;MAuG2B;QAAE,MAAIA,EAAM,GAAArB,KAAA,CAAAC,WAAW,MAAjB,IAAoB,YAAAoB,EAAA,CAAAnC,KAAA,KAAS,EAAI;MAAA;IAAA,CAAE;IAChEkB,MAAA,EAAQT,QAAS,OAAMK,KAAM,CAAAT,MAAM,EAAEa,MAAM;IAC3CM,UAAA,EAAYf,QAAS,OAAMK,KAAM,CAAAT,MAAM,EAAEmB,UAAU;IACnDY,MAAA,EAAQA,CAAA,KAAG;MA1Gf,IAAAD,EAAA;MA0GwB,QAAAA,EAAA,GAAArB,KAAA,CAAAC,WAAW,MAAjB,IAAoB,YAAAoB,EAAA,CAAAC,MAAA;IAAA;IAClCC,WAAA,EAAaA,CAAA,KAAG;MA3GpB,IAAAF,EAAA;MA2G6B,QAAAA,EAAA,GAAArB,KAAA,CAAAC,WAAW,MAAjB,IAAoB,YAAAoB,EAAA,CAAAE,WAAA;IAAA;IAEvCtB,WAAa,EAAAN,QAAA,CAAS,MAAMK,KAAA,CAAMC,WAAW,CAAC;EAAA,CAChD;AACF;AAEA,SAASb,YAAYF,KAAc;EACjC,MAAMsC,QAAW,GAAAnC,MAAA,CAAOoC,IAAK,CAAAvC,KAAA,CAAMsC,QAAQ;EAI3C,MAAMpB,MAAS,GAAAsB,SAAA,CACbF,QAAS,CAAAG,GAAA,CACNC,OAAA,IACC,CAACA,OAAA,EAAS1C,KAAA,CAAMkB,MAAO,CAAAwB,OAAA,KAAY,EAAE,EAIzC,CACF;EAEA,MAAMlB,UAAa,GAAAgB,SAAA,CACjBF,QAAS,CAAAG,GAAA,CACNC,OACC,KAACA,OAAS,EAAA1C,KAAA,CAAMwB,UAAA,CAAWkB,OAAQ,GAIvC,CACF;EAEO;IACLxB,MAAA;IACAM;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}