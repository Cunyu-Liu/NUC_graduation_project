{"ast":null,"code":"import { unref as _unref, resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"message-avatar\"\n};\nconst _hoisted_2 = {\n  class: \"message-content\"\n};\nconst _hoisted_3 = {\n  class: \"message-header\"\n};\nconst _hoisted_4 = {\n  class: \"message-author\"\n};\nconst _hoisted_5 = {\n  class: \"message-time\"\n};\nconst _hoisted_6 = [\"innerHTML\"];\nconst _hoisted_7 = {\n  key: 0,\n  class: \"message-references\"\n};\nconst _hoisted_8 = {\n  class: \"references-list\"\n};\nimport { computed } from 'vue';\nimport { ChatDotRound } from '@element-plus/icons-vue';\nimport { marked } from 'marked';\nexport default {\n  __name: 'ChatMessage',\n  props: {\n    content: {\n      type: String,\n      required: true\n    },\n    isUser: {\n      type: Boolean,\n      default: false\n    },\n    timestamp: {\n      type: Date,\n      default: () => new Date()\n    },\n    references: {\n      type: Array,\n      default: () => []\n    },\n    userName: {\n      type: String,\n      default: ''\n    }\n  },\n  emits: ['viewReference'],\n  setup(__props) {\n    const props = __props;\n    const userInitial = computed(() => {\n      return props.userName ? props.userName.charAt(0).toUpperCase() : 'U';\n    });\n    const renderedContent = computed(() => {\n      // 使用 marked 渲染 markdown\n      return marked.parse(props.content, {\n        breaks: true\n      });\n    });\n    const formatTime = date => {\n      if (!date) return '';\n      const d = new Date(date);\n      return d.toLocaleTimeString('zh-CN', {\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      });\n    };\n    return (_ctx, _cache) => {\n      const _component_el_avatar = _resolveComponent(\"el-avatar\");\n      const _component_el_tag = _resolveComponent(\"el-tag\");\n      return _openBlock(), _createElementBlock(\"div\", {\n        class: _normalizeClass([\"chat-message\", {\n          'user-message': __props.isUser,\n          'ai-message': !__props.isUser\n        }])\n      }, [_createElementVNode(\"div\", _hoisted_1, [!__props.isUser ? (_openBlock(), _createBlock(_component_el_avatar, {\n        key: 0,\n        size: 36,\n        icon: _unref(ChatDotRound),\n        class: \"ai-avatar\"\n      }, null, 8, [\"icon\"])) : (_openBlock(), _createBlock(_component_el_avatar, {\n        key: 1,\n        size: 36,\n        class: \"user-avatar\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString(userInitial.value), 1)]),\n        _: 1\n      }))]), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"span\", _hoisted_4, _toDisplayString(__props.isUser ? '我' : 'AI 助手'), 1), _createElementVNode(\"span\", _hoisted_5, _toDisplayString(formatTime(__props.timestamp)), 1)]), _createElementVNode(\"div\", {\n        class: \"message-body\",\n        innerHTML: renderedContent.value\n      }, null, 8, _hoisted_6), !__props.isUser && __props.references.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [_cache[0] || (_cache[0] = _createElementVNode(\"div\", {\n        class: \"references-title\"\n      }, \"参考来源：\", -1)), _createElementVNode(\"div\", _hoisted_8, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.references, (ref, index) => {\n        return _openBlock(), _createBlock(_component_el_tag, {\n          key: index,\n          size: \"small\",\n          type: \"info\",\n          class: \"reference-tag\",\n          onClick: $event => _ctx.$emit('viewReference', ref)\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString(ref.title || `论文 ${index + 1}`), 1)]),\n          _: 2\n        }, 1032, [\"onClick\"]);\n      }), 128))])])) : _createCommentVNode(\"\", true)])], 2);\n    };\n  }\n};","map":{"version":3,"names":["computed","ChatDotRound","marked","props","__props","userInitial","userName","charAt","toUpperCase","renderedContent","parse","content","breaks","formatTime","date","d","Date","toLocaleTimeString","hour","minute","second","_createElementBlock","class","_normalizeClass","isUser","_createElementVNode","_hoisted_1","_createBlock","_component_el_avatar","size","icon","_unref","value","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","_hoisted_5","timestamp","innerHTML","references","length","_hoisted_7","_hoisted_8","_Fragment","_renderList","ref","index","_component_el_tag","key","type","onClick","$event","_ctx","$emit","title"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/components/ChatMessage.vue"],"sourcesContent":["<template>\n  <div class=\"chat-message\" :class=\"{ 'user-message': isUser, 'ai-message': !isUser }\">\n    <div class=\"message-avatar\">\n      <el-avatar v-if=\"!isUser\" :size=\"36\" :icon=\"ChatDotRound\" class=\"ai-avatar\" />\n      <el-avatar v-else :size=\"36\" class=\"user-avatar\">{{ userInitial }}</el-avatar>\n    </div>\n    <div class=\"message-content\">\n      <div class=\"message-header\">\n        <span class=\"message-author\">{{ isUser ? '我' : 'AI 助手' }}</span>\n        <span class=\"message-time\">{{ formatTime(timestamp) }}</span>\n      </div>\n      <div class=\"message-body\" v-html=\"renderedContent\"></div>\n      <div v-if=\"!isUser && references.length > 0\" class=\"message-references\">\n        <div class=\"references-title\">参考来源：</div>\n        <div class=\"references-list\">\n          <el-tag\n            v-for=\"(ref, index) in references\"\n            :key=\"index\"\n            size=\"small\"\n            type=\"info\"\n            class=\"reference-tag\"\n            @click=\"$emit('viewReference', ref)\"\n          >\n            {{ ref.title || `论文 ${index + 1}` }}\n          </el-tag>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { computed } from 'vue'\nimport { ChatDotRound } from '@element-plus/icons-vue'\nimport { marked } from 'marked'\n\nconst props = defineProps({\n  content: {\n    type: String,\n    required: true\n  },\n  isUser: {\n    type: Boolean,\n    default: false\n  },\n  timestamp: {\n    type: Date,\n    default: () => new Date()\n  },\n  references: {\n    type: Array,\n    default: () => []\n  },\n  userName: {\n    type: String,\n    default: ''\n  }\n})\n\ndefineEmits(['viewReference'])\n\nconst userInitial = computed(() => {\n  return props.userName ? props.userName.charAt(0).toUpperCase() : 'U'\n})\n\nconst renderedContent = computed(() => {\n  // 使用 marked 渲染 markdown\n  return marked.parse(props.content, { breaks: true })\n})\n\nconst formatTime = (date) => {\n  if (!date) return ''\n  const d = new Date(date)\n  return d.toLocaleTimeString('zh-CN', { \n    hour: '2-digit', \n    minute: '2-digit',\n    second: '2-digit'\n  })\n}\n</script>\n\n<style scoped>\n.chat-message {\n  display: flex;\n  gap: 12px;\n  padding: 16px 20px;\n  animation: fadeIn 0.3s ease;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.user-message {\n  flex-direction: row-reverse;\n}\n\n.user-message .message-content {\n  align-items: flex-end;\n}\n\n.user-message .message-body {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  border-radius: 18px 18px 4px 18px;\n}\n\n.message-avatar {\n  flex-shrink: 0;\n}\n\n.ai-avatar {\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: white;\n}\n\n.user-avatar {\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  font-weight: 500;\n}\n\n.message-content {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  max-width: calc(100% - 60px);\n}\n\n.message-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 13px;\n}\n\n.user-message .message-header {\n  flex-direction: row-reverse;\n}\n\n.message-author {\n  font-weight: 500;\n  color: #1f2937;\n}\n\n.message-time {\n  color: #9ca3af;\n  font-size: 12px;\n}\n\n.message-body {\n  background: #f3f4f6;\n  padding: 12px 16px;\n  border-radius: 18px 18px 18px 4px;\n  color: #1f2937;\n  line-height: 1.7;\n  font-size: 14px;\n  word-wrap: break-word;\n}\n\n.message-body :deep(p) {\n  margin: 0 0 8px 0;\n}\n\n.message-body :deep(p:last-child) {\n  margin-bottom: 0;\n}\n\n.message-body :deep(code) {\n  background: rgba(0, 0, 0, 0.05);\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-family: 'Monaco', 'Menlo', monospace;\n  font-size: 13px;\n}\n\n.message-body :deep(pre) {\n  background: #1f2937;\n  padding: 12px;\n  border-radius: 8px;\n  overflow-x: auto;\n  margin: 8px 0;\n}\n\n.message-body :deep(pre code) {\n  background: none;\n  color: #e5e7eb;\n  padding: 0;\n}\n\n.message-body :deep(ul), .message-body :deep(ol) {\n  margin: 8px 0;\n  padding-left: 20px;\n}\n\n.message-body :deep(li) {\n  margin: 4px 0;\n}\n\n.message-body :deep(blockquote) {\n  border-left: 4px solid #10b981;\n  margin: 8px 0;\n  padding-left: 12px;\n  color: #4b5563;\n}\n\n.message-references {\n  margin-top: 8px;\n}\n\n.references-title {\n  font-size: 12px;\n  color: #6b7280;\n  margin-bottom: 6px;\n}\n\n.references-list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n\n.reference-tag {\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.reference-tag:hover {\n  background: #10b981;\n  color: white;\n}\n</style>\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAgCA,SAASA,QAAQ,QAAQ,KAAI;AAC7B,SAASC,YAAY,QAAQ,yBAAwB;AACrD,SAASC,MAAM,QAAQ,QAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;IAE9B,MAAMC,KAAK,GAAGC,OAAA;IAyBd,MAAMC,WAAW,GAAGL,QAAQ,CAAC,MAAM;MACjC,OAAOG,KAAK,CAACG,QAAQ,GAAGH,KAAK,CAACG,QAAQ,CAACC,MAAM,CAAC,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,GAAG,GAAE;IACrE,CAAC;IAED,MAAMC,eAAe,GAAGT,QAAQ,CAAC,MAAM;MACrC;MACA,OAAOE,MAAM,CAACQ,KAAK,CAACP,KAAK,CAACQ,OAAO,EAAE;QAAEC,MAAM,EAAE;MAAK,CAAC;IACrD,CAAC;IAED,MAAMC,UAAU,GAAIC,IAAI,IAAK;MAC3B,IAAI,CAACA,IAAI,EAAE,OAAO,EAAC;MACnB,MAAMC,CAAC,GAAG,IAAIC,IAAI,CAACF,IAAI;MACvB,OAAOC,CAAC,CAACE,kBAAkB,CAAC,OAAO,EAAE;QACnCC,IAAI,EAAE,SAAS;QACfC,MAAM,EAAE,SAAS;QACjBC,MAAM,EAAE;MACV,CAAC;IACH;;;;2BA7EEC,mBAAA,CA2BM;QA3BDC,KAAK,EAAAC,eAAA,EAAC,cAAc;UAAA,gBAA2BnB,OAAA,CAAAoB,MAAM;UAAA,eAAiBpB,OAAA,CAAAoB;QAAM;UAC/EC,mBAAA,CAGM,OAHNC,UAGM,G,CAFctB,OAAA,CAAAoB,MAAM,I,cAAxBG,YAAA,CAA8EC,oBAAA;;QAAnDC,IAAI,EAAE,EAAE;QAAGC,IAAI,EAAEC,MAAA,CAAA9B,YAAA,CAAY;QAAEqB,KAAK,EAAC;8CAChEK,YAAA,CAA8EC,oBAAA;;QAA3DC,IAAI,EAAE,EAAE;QAAEP,KAAK,EAAC;;0BAAc,MAAiB,C,kCAAdjB,WAAA,CAAA2B,KAAW,M;;aAEjEP,mBAAA,CAqBM,OArBNQ,UAqBM,GApBJR,mBAAA,CAGM,OAHNS,UAGM,GAFJT,mBAAA,CAAgE,QAAhEU,UAAgE,EAAAC,gBAAA,CAAhChC,OAAA,CAAAoB,MAAM,uBACtCC,mBAAA,CAA6D,QAA7DY,UAA6D,EAAAD,gBAAA,CAA/BvB,UAAU,CAACT,OAAA,CAAAkC,SAAS,O,GAEpDb,mBAAA,CAAyD;QAApDH,KAAK,EAAC,cAAc;QAACiB,SAAwB,EAAhB9B,eAAA,CAAAuB;gCACtB5B,OAAA,CAAAoB,MAAM,IAAIpB,OAAA,CAAAoC,UAAU,CAACC,MAAM,Q,cAAvCpB,mBAAA,CAcM,OAdNqB,UAcM,G,0BAbJjB,mBAAA,CAAyC;QAApCH,KAAK,EAAC;MAAkB,GAAC,OAAK,QACnCG,mBAAA,CAWM,OAXNkB,UAWM,I,kBAVJtB,mBAAA,CASSuB,SAAA,QAAAC,WAAA,CARgBzC,OAAA,CAAAoC,UAAU,GAAzBM,GAAG,EAAEC,KAAK;6BADpBpB,YAAA,CASSqB,iBAAA;UAPNC,GAAG,EAAEF,KAAK;UACXlB,IAAI,EAAC,OAAO;UACZqB,IAAI,EAAC,MAAM;UACX5B,KAAK,EAAC,eAAe;UACpB6B,OAAK,EAAAC,MAAA,IAAEC,IAAA,CAAAC,KAAK,kBAAkBR,GAAG;;4BAElC,MAAoC,C,kCAAjCA,GAAG,CAACS,KAAK,UAAUR,KAAK,Y","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}