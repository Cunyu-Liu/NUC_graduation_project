{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineComponent, unref, createVNode, mergeProps, inject, ref, computed, onMounted, nextTick } from 'vue';\nimport { tableV2RowProps } from '../row.mjs';\nimport { TableV2InjectionKey } from '../tokens.mjs';\nimport { placeholderSign } from '../private.mjs';\nimport { isArray, isFunction } from '@vue/shared';\nimport { isNumber } from '../../../../utils/types.mjs';\nconst useTableRow = props => {\n  const {\n    isScrolling\n  } = inject(TableV2InjectionKey);\n  const measured = ref(false);\n  const rowRef = ref();\n  const measurable = computed(() => {\n    return isNumber(props.estimatedRowHeight) && props.rowIndex >= 0;\n  });\n  const doMeasure = (isInit = false) => {\n    const $rowRef = unref(rowRef);\n    if (!$rowRef) return;\n    const {\n      columns,\n      onRowHeightChange,\n      rowKey,\n      rowIndex,\n      style\n    } = props;\n    const {\n      height\n    } = $rowRef.getBoundingClientRect();\n    measured.value = true;\n    nextTick(() => {\n      if (isInit || height !== Number.parseInt(style.height)) {\n        const firstColumn = columns[0];\n        const isPlaceholder = (firstColumn == null ? void 0 : firstColumn.placeholderSign) === placeholderSign;\n        onRowHeightChange == null ? void 0 : onRowHeightChange({\n          rowKey,\n          height,\n          rowIndex\n        }, firstColumn && !isPlaceholder && firstColumn.fixed);\n      }\n    });\n  };\n  const eventHandlers = computed(() => {\n    const {\n      rowData,\n      rowIndex,\n      rowKey,\n      onRowHover\n    } = props;\n    const handlers = props.rowEventHandlers || {};\n    const eventHandlers2 = {};\n    Object.entries(handlers).forEach(([eventName, handler]) => {\n      if (isFunction(handler)) {\n        eventHandlers2[eventName] = event => {\n          handler({\n            event,\n            rowData,\n            rowIndex,\n            rowKey\n          });\n        };\n      }\n    });\n    if (onRowHover) {\n      [{\n        name: \"onMouseleave\",\n        hovered: false\n      }, {\n        name: \"onMouseenter\",\n        hovered: true\n      }].forEach(({\n        name,\n        hovered\n      }) => {\n        const existedHandler = eventHandlers2[name];\n        eventHandlers2[name] = event => {\n          onRowHover({\n            event,\n            hovered,\n            rowData,\n            rowIndex,\n            rowKey\n          });\n          existedHandler == null ? void 0 : existedHandler(event);\n        };\n      });\n    }\n    return eventHandlers2;\n  });\n  const onExpand = expanded => {\n    const {\n      onRowExpand,\n      rowData,\n      rowIndex,\n      rowKey\n    } = props;\n    onRowExpand == null ? void 0 : onRowExpand({\n      expanded,\n      rowData,\n      rowIndex,\n      rowKey\n    });\n  };\n  onMounted(() => {\n    if (unref(measurable)) {\n      doMeasure(true);\n    }\n  });\n  return {\n    isScrolling,\n    measurable,\n    measured,\n    rowRef,\n    eventHandlers,\n    onExpand\n  };\n};\nconst COMPONENT_NAME = \"ElTableV2TableRow\";\nconst TableV2Row = defineComponent({\n  name: COMPONENT_NAME,\n  props: tableV2RowProps,\n  setup(props, {\n    expose,\n    slots,\n    attrs\n  }) {\n    const {\n      eventHandlers,\n      isScrolling,\n      measurable,\n      measured,\n      rowRef,\n      onExpand\n    } = useTableRow(props);\n    expose({\n      onExpand\n    });\n    return () => {\n      const {\n        columns,\n        columnsStyles,\n        expandColumnKey,\n        depth,\n        rowData,\n        rowIndex,\n        style\n      } = props;\n      let ColumnCells = columns.map((column, columnIndex) => {\n        const expandable = isArray(rowData.children) && rowData.children.length > 0 && column.key === expandColumnKey;\n        return slots.cell({\n          column,\n          columns,\n          columnIndex,\n          depth,\n          style: columnsStyles[column.key],\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n          expandIconProps: expandable ? {\n            rowData,\n            rowIndex,\n            onExpand\n          } : void 0\n        });\n      });\n      if (slots.row) {\n        ColumnCells = slots.row({\n          cells: ColumnCells.map(node => {\n            if (isArray(node) && node.length === 1) {\n              return node[0];\n            }\n            return node;\n          }),\n          style,\n          columns,\n          depth,\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling)\n        });\n      }\n      if (unref(measurable)) {\n        const {\n          height,\n          ...exceptHeightStyle\n        } = style || {};\n        const _measured = unref(measured);\n        return createVNode(\"div\", mergeProps({\n          \"ref\": rowRef,\n          \"class\": props.class,\n          \"style\": _measured ? style : exceptHeightStyle,\n          \"role\": \"row\"\n        }, attrs, unref(eventHandlers)), [ColumnCells]);\n      }\n      return createVNode(\"div\", mergeProps(attrs, {\n        \"ref\": rowRef,\n        \"class\": props.class,\n        \"style\": style,\n        \"role\": \"row\"\n      }, unref(eventHandlers)), [ColumnCells]);\n    };\n  }\n});\nvar Row = TableV2Row;\nexport { Row as default };","map":{"version":3,"names":["useTableRow","props","isScrolling","inject","TableV2InjectionKey","measured","ref","rowRef","measurable","computed","isNumber","estimatedRowHeight","rowIndex","doMeasure","isInit","$rowRef","unref","columns","onRowHeightChange","rowKey","style","height","getBoundingClientRect","value","nextTick","Number","parseInt","firstColumn","isPlaceholder","placeholderSign","fixed","eventHandlers","rowData","onRowHover","handlers","rowEventHandlers","eventHandlers2","Object","entries","forEach","eventName","handler","isFunction","event","name","hovered","existedHandler","onExpand","expanded","onRowExpand","onMounted","COMPONENT_NAME","TableV2Row","defineComponent","tableV2RowProps","setup","expose","slots","attrs","columnsStyles","expandColumnKey","depth","ColumnCells","map","column","columnIndex","expandable","isArray","children","length","key","cell","expandIconProps","row","cells","node","exceptHeightStyle","_measured","createVNode","mergeProps","class","Row"],"sources":["../../../../../../../packages/components/table-v2/src/components/row.tsx"],"sourcesContent":["import {\n  computed,\n  defineComponent,\n  inject,\n  nextTick,\n  onMounted,\n  ref,\n  unref,\n} from 'vue'\nimport { isArray, isFunction, isNumber } from '@element-plus/utils'\nimport { tableV2RowProps } from '../row'\nimport { TableV2InjectionKey } from '../tokens'\nimport { placeholderSign } from '../private'\n\nimport type { CSSProperties, RendererElement, RendererNode, VNode } from 'vue'\nimport type { RowEventHandlers, TableV2RowProps } from '../row'\n\ntype CustomizedCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[]\n\ntype DefaultCellsType = VNode<\n  RendererNode,\n  RendererElement,\n  {\n    [key: string]: any\n  }\n>[][]\n\ntype ColumnCellsType = DefaultCellsType | CustomizedCellsType\n\nconst useTableRow = (props: TableV2RowProps) => {\n  const { isScrolling } = inject(TableV2InjectionKey)!\n\n  const measured = ref(false)\n  const rowRef = ref<HTMLElement>()\n  const measurable = computed(() => {\n    return isNumber(props.estimatedRowHeight) && props.rowIndex >= 0\n  })\n\n  const doMeasure = (isInit = false) => {\n    const $rowRef = unref(rowRef)\n    if (!$rowRef) return\n    const { columns, onRowHeightChange, rowKey, rowIndex, style } = props\n    const { height } = $rowRef.getBoundingClientRect()\n    measured.value = true\n\n    nextTick(() => {\n      if (isInit || height !== Number.parseInt(style!.height as string)) {\n        const firstColumn = columns[0]\n        const isPlaceholder = firstColumn?.placeholderSign === placeholderSign\n        onRowHeightChange?.(\n          { rowKey, height, rowIndex },\n          firstColumn && !isPlaceholder && firstColumn.fixed\n        )\n      }\n    })\n  }\n\n  const eventHandlers = computed(() => {\n    const { rowData, rowIndex, rowKey, onRowHover } = props\n    const handlers = props.rowEventHandlers || ({} as RowEventHandlers)\n    const eventHandlers = {} as {\n      [key in keyof RowEventHandlers]: (e: Event) => void\n    }\n\n    Object.entries(handlers).forEach(([eventName, handler]) => {\n      if (isFunction(handler)) {\n        eventHandlers[eventName as keyof RowEventHandlers] = (event: Event) => {\n          handler({\n            event,\n            rowData,\n            rowIndex,\n            rowKey,\n          })\n        }\n      }\n    })\n\n    if (onRowHover) {\n      ;(\n        [\n          { name: 'onMouseleave', hovered: false },\n          { name: 'onMouseenter', hovered: true },\n        ] as const\n      ).forEach(({ name, hovered }) => {\n        const existedHandler = eventHandlers[name]\n        eventHandlers[name] = ((event: MouseEvent) => {\n          onRowHover({\n            event,\n            hovered,\n            rowData,\n            rowIndex,\n            rowKey,\n          })\n\n          existedHandler?.(event)\n        }) as any\n      })\n    }\n    return eventHandlers\n  })\n\n  const onExpand = (expanded: boolean) => {\n    const { onRowExpand, rowData, rowIndex, rowKey } = props\n\n    onRowExpand?.({\n      expanded,\n      rowData,\n      rowIndex,\n      rowKey,\n    })\n  }\n\n  onMounted(() => {\n    if (unref(measurable)) {\n      doMeasure(true)\n    }\n  })\n\n  return { isScrolling, measurable, measured, rowRef, eventHandlers, onExpand }\n}\n\nconst COMPONENT_NAME = 'ElTableV2TableRow'\n\nconst TableV2Row = defineComponent({\n  name: COMPONENT_NAME,\n  props: tableV2RowProps,\n  setup(props, { expose, slots, attrs }) {\n    const {\n      eventHandlers,\n      isScrolling,\n      measurable,\n      measured,\n      rowRef,\n\n      onExpand,\n    } = useTableRow(props)\n\n    expose({\n      /**\n       * @description manually dispatching expand action on row.\n       */\n      onExpand,\n    })\n\n    return () => {\n      const {\n        columns,\n        columnsStyles,\n        expandColumnKey,\n        depth,\n        rowData,\n        rowIndex,\n        style,\n      } = props\n\n      let ColumnCells: ColumnCellsType = columns.map((column, columnIndex) => {\n        const expandable =\n          isArray(rowData.children) &&\n          rowData.children.length > 0 &&\n          column.key === expandColumnKey\n\n        return slots.cell!({\n          column,\n          columns,\n          columnIndex,\n          depth,\n          style: columnsStyles[column.key!],\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n          expandIconProps: expandable\n            ? {\n                rowData,\n                rowIndex,\n                onExpand,\n              }\n            : undefined,\n        })\n      })\n\n      if (slots.row) {\n        ColumnCells = slots.row({\n          cells: ColumnCells.map((node) => {\n            if (isArray(node) && node.length === 1) {\n              return node[0]\n            }\n            return node\n          }),\n          style,\n          columns,\n          depth,\n          rowData,\n          rowIndex,\n          isScrolling: unref(isScrolling),\n        })\n      }\n\n      if (unref(measurable)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const { height, ...exceptHeightStyle } = style || {}\n        const _measured = unref(measured)\n        return (\n          <div\n            ref={rowRef}\n            class={props.class}\n            style={_measured ? style : exceptHeightStyle}\n            role=\"row\"\n            {...attrs}\n            {...unref(eventHandlers)}\n          >\n            {ColumnCells}\n          </div>\n        )\n      }\n\n      return (\n        <div\n          {...attrs}\n          ref={rowRef}\n          class={props.class}\n          style={style}\n          role=\"row\"\n          {...unref(eventHandlers)}\n        >\n          {ColumnCells}\n        </div>\n      )\n    }\n  },\n})\n\nexport default TableV2Row\n\nexport type TableV2RowCellRenderParam = {\n  column: TableV2RowProps['columns'][number]\n  columns: TableV2RowProps['columns']\n  columnIndex: number\n  depth: number\n  style: CSSProperties\n  rowData: any\n  rowIndex: number\n  isScrolling: boolean\n  expandIconProps?: {\n    rowData: any\n    rowIndex: number\n    onExpand: (expand: boolean) => void\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}