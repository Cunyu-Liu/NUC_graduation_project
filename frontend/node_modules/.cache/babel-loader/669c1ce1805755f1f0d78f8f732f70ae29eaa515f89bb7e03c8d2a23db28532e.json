{"ast":null,"code":"import { nextTick } from 'vue';\nimport { createLoadingComponent } from './loading.mjs';\nimport { isClient } from '@vueuse/core';\nimport { isString } from '@vue/shared';\nimport { getStyle, addClass, removeClass } from '../../../utils/dom/style.mjs';\nlet fullscreenInstance = void 0;\nconst Loading = function (options = {}, context) {\n  if (!isClient) return void 0;\n  const resolved = resolveOptions(options);\n  if (resolved.fullscreen && fullscreenInstance) {\n    return fullscreenInstance;\n  }\n  const instance = createLoadingComponent({\n    ...resolved,\n    closed: () => {\n      var _a;\n      (_a = resolved.closed) == null ? void 0 : _a.call(resolved);\n      if (resolved.fullscreen) fullscreenInstance = void 0;\n    }\n  }, context != null ? context : Loading._context);\n  addStyle(resolved, resolved.parent, instance);\n  addClassList(resolved, resolved.parent, instance);\n  resolved.parent.vLoadingAddClassList = () => addClassList(resolved, resolved.parent, instance);\n  let loadingNumber = resolved.parent.getAttribute(\"loading-number\");\n  if (!loadingNumber) {\n    loadingNumber = \"1\";\n  } else {\n    loadingNumber = `${Number.parseInt(loadingNumber) + 1}`;\n  }\n  resolved.parent.setAttribute(\"loading-number\", loadingNumber);\n  resolved.parent.appendChild(instance.$el);\n  nextTick(() => instance.visible.value = resolved.visible);\n  if (resolved.fullscreen) {\n    fullscreenInstance = instance;\n  }\n  return instance;\n};\nconst resolveOptions = options => {\n  var _a, _b, _c, _d;\n  let target;\n  if (isString(options.target)) {\n    target = (_a = document.querySelector(options.target)) != null ? _a : document.body;\n  } else {\n    target = options.target || document.body;\n  }\n  return {\n    parent: target === document.body || options.body ? document.body : target,\n    background: options.background || \"\",\n    svg: options.svg || \"\",\n    svgViewBox: options.svgViewBox || \"\",\n    spinner: options.spinner || false,\n    text: options.text || \"\",\n    fullscreen: target === document.body && ((_b = options.fullscreen) != null ? _b : true),\n    lock: (_c = options.lock) != null ? _c : false,\n    customClass: options.customClass || \"\",\n    visible: (_d = options.visible) != null ? _d : true,\n    beforeClose: options.beforeClose,\n    closed: options.closed,\n    target\n  };\n};\nconst addStyle = async (options, parent, instance) => {\n  const {\n    nextZIndex\n  } = instance.vm.zIndex || instance.vm._.exposed.zIndex;\n  const maskStyle = {};\n  if (options.fullscreen) {\n    instance.originalPosition.value = getStyle(document.body, \"position\");\n    instance.originalOverflow.value = getStyle(document.body, \"overflow\");\n    maskStyle.zIndex = nextZIndex();\n  } else if (options.parent === document.body) {\n    instance.originalPosition.value = getStyle(document.body, \"position\");\n    await nextTick();\n    for (const property of [\"top\", \"left\"]) {\n      const scroll = property === \"top\" ? \"scrollTop\" : \"scrollLeft\";\n      maskStyle[property] = `${options.target.getBoundingClientRect()[property] + document.body[scroll] + document.documentElement[scroll] - Number.parseInt(getStyle(document.body, `margin-${property}`), 10)}px`;\n    }\n    for (const property of [\"height\", \"width\"]) {\n      maskStyle[property] = `${options.target.getBoundingClientRect()[property]}px`;\n    }\n  } else {\n    instance.originalPosition.value = getStyle(parent, \"position\");\n  }\n  for (const [key, value] of Object.entries(maskStyle)) {\n    instance.$el.style[key] = value;\n  }\n};\nconst addClassList = (options, parent, instance) => {\n  const ns = instance.vm.ns || instance.vm._.exposed.ns;\n  if (![\"absolute\", \"fixed\", \"sticky\"].includes(instance.originalPosition.value)) {\n    addClass(parent, ns.bm(\"parent\", \"relative\"));\n  } else {\n    removeClass(parent, ns.bm(\"parent\", \"relative\"));\n  }\n  if (options.fullscreen && options.lock) {\n    addClass(parent, ns.bm(\"parent\", \"hidden\"));\n  } else {\n    removeClass(parent, ns.bm(\"parent\", \"hidden\"));\n  }\n};\nLoading._context = null;\nexport { Loading as default };","map":{"version":3,"names":["fullscreenInstance","Loading","options","context","isClient","resolved","resolveOptions","fullscreen","instance","createLoadingComponent","closed","_a","call","_context","addStyle","parent","addClassList","vLoadingAddClassList","loadingNumber","getAttribute","Number","parseInt","setAttribute","appendChild","$el","nextTick","visible","value","_b","_c","_d","target","isString","document","querySelector","body","background","svg","svgViewBox","spinner","text","lock","customClass","beforeClose","nextZIndex","vm","zIndex","_","exposed","maskStyle","originalPosition","getStyle","originalOverflow","property","scroll","getBoundingClientRect","documentElement","key","Object","entries","style","ns","includes","addClass","bm","removeClass"],"sources":["../../../../../../packages/components/loading/src/service.ts"],"sourcesContent":["// @ts-nocheck\nimport { nextTick } from 'vue'\nimport {\n  addClass,\n  getStyle,\n  isClient,\n  isString,\n  removeClass,\n} from '@element-plus/utils'\nimport { createLoadingComponent } from './loading'\n\nimport type { UseNamespaceReturn, UseZIndexReturn } from '@element-plus/hooks'\nimport type { LoadingInstance } from './loading'\nimport type { LoadingOptionsResolved } from '..'\nimport type { LoadingOptions } from './types'\nimport type { AppContext, CSSProperties } from 'vue'\n\nlet fullscreenInstance: LoadingInstance | undefined = undefined\n\nconst Loading = function (\n  options: LoadingOptions = {},\n  context?: AppContext | null\n): LoadingInstance {\n  if (!isClient) return undefined as any\n\n  const resolved = resolveOptions(options)\n\n  if (resolved.fullscreen && fullscreenInstance) {\n    return fullscreenInstance\n  }\n\n  const instance = createLoadingComponent(\n    {\n      ...resolved,\n      closed: () => {\n        resolved.closed?.()\n        if (resolved.fullscreen) fullscreenInstance = undefined\n      },\n    },\n    context ?? Loading._context\n  )\n\n  addStyle(resolved, resolved.parent, instance)\n  addClassList(resolved, resolved.parent, instance)\n\n  resolved.parent.vLoadingAddClassList = () =>\n    addClassList(resolved, resolved.parent, instance)\n\n  /**\n   * add loading-number to parent.\n   * because if a fullscreen loading is triggered when somewhere\n   * a v-loading.body was triggered before and it's parent is\n   * document.body which with a margin , the fullscreen loading's\n   * destroySelf function will remove 'el-loading-parent--relative',\n   * and then the position of v-loading.body will be error.\n   */\n  let loadingNumber: string | null =\n    resolved.parent.getAttribute('loading-number')\n  if (!loadingNumber) {\n    loadingNumber = '1'\n  } else {\n    loadingNumber = `${Number.parseInt(loadingNumber) + 1}`\n  }\n  resolved.parent.setAttribute('loading-number', loadingNumber)\n\n  resolved.parent.appendChild(instance.$el)\n\n  // after instance render, then modify visible to trigger transition\n  nextTick(() => (instance.visible.value = resolved.visible))\n\n  if (resolved.fullscreen) {\n    fullscreenInstance = instance\n  }\n  return instance\n}\n\nconst resolveOptions = (options: LoadingOptions): LoadingOptionsResolved => {\n  let target: HTMLElement\n  if (isString(options.target)) {\n    target =\n      document.querySelector<HTMLElement>(options.target) ?? document.body\n  } else {\n    target = options.target || document.body\n  }\n  return {\n    parent: target === document.body || options.body ? document.body : target,\n    background: options.background || '',\n    svg: options.svg || '',\n    svgViewBox: options.svgViewBox || '',\n    spinner: options.spinner || false,\n    text: options.text || '',\n    fullscreen: target === document.body && (options.fullscreen ?? true),\n    lock: options.lock ?? false,\n    customClass: options.customClass || '',\n    visible: options.visible ?? true,\n    beforeClose: options.beforeClose,\n    closed: options.closed,\n    target,\n  }\n}\n\nconst addStyle = async (\n  options: LoadingOptionsResolved,\n  parent: HTMLElement,\n  instance: LoadingInstance\n) => {\n  // Compatible with the instance data format of vue@3.2.12 and earlier versions #12351\n  const { nextZIndex } =\n    ((instance.vm as any).zIndex as UseZIndexReturn) ||\n    (instance.vm as any)._.exposed.zIndex\n\n  const maskStyle: CSSProperties = {}\n  if (options.fullscreen) {\n    instance.originalPosition.value = getStyle(document.body, 'position')\n    instance.originalOverflow.value = getStyle(document.body, 'overflow')\n    maskStyle.zIndex = nextZIndex()\n  } else if (options.parent === document.body) {\n    instance.originalPosition.value = getStyle(document.body, 'position')\n    /**\n     * await dom render when visible is true in init,\n     * because some component's height maybe 0.\n     * e.g. el-table.\n     */\n    await nextTick()\n    for (const property of ['top', 'left']) {\n      const scroll = property === 'top' ? 'scrollTop' : 'scrollLeft'\n      maskStyle[property] = `${\n        (options.target as HTMLElement).getBoundingClientRect()[property] +\n        document.body[scroll] +\n        document.documentElement[scroll] -\n        Number.parseInt(getStyle(document.body, `margin-${property}`), 10)\n      }px`\n    }\n    for (const property of ['height', 'width']) {\n      maskStyle[property] = `${\n        (options.target as HTMLElement).getBoundingClientRect()[property]\n      }px`\n    }\n  } else {\n    instance.originalPosition.value = getStyle(parent, 'position')\n  }\n  for (const [key, value] of Object.entries(maskStyle)) {\n    instance.$el.style[key] = value\n  }\n}\n\nconst addClassList = (\n  options: LoadingOptions,\n  parent: HTMLElement,\n  instance: LoadingInstance\n) => {\n  // Compatible with the instance data format of vue@3.2.12 and earlier versions #12351\n  const ns =\n    ((instance.vm as any).ns as UseNamespaceReturn) ||\n    (instance.vm as any)._.exposed.ns\n\n  if (\n    !['absolute', 'fixed', 'sticky'].includes(instance.originalPosition.value)\n  ) {\n    addClass(parent, ns.bm('parent', 'relative'))\n  } else {\n    removeClass(parent, ns.bm('parent', 'relative'))\n  }\n  if (options.fullscreen && options.lock) {\n    addClass(parent, ns.bm('parent', 'hidden'))\n  } else {\n    removeClass(parent, ns.bm('parent', 'hidden'))\n  }\n}\n\nLoading._context = null as AppContext | null\nexport default Loading\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}