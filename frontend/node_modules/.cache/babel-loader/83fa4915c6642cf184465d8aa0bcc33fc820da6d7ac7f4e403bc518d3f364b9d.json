{"ast":null,"code":"import { computed, ref } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nexport default {\n  name: 'UploadDialog',\n  setup(_, {\n    emit\n  }) {\n    const store = useStore();\n    const fileList = ref([]);\n    const visible = computed({\n      get: () => store.state.showUploadDialog,\n      set: val => store.commit('SHOW_UPLOAD_DIALOG', val)\n    });\n    const beforeUpload = file => {\n      const isPDF = file.type === 'application/pdf';\n      const isLt50M = file.size / 1024 / 1024 < 50;\n      if (!isPDF) {\n        ElMessage.error('只能上传PDF文件!');\n        return false;\n      }\n      if (!isLt50M) {\n        ElMessage.error('文件大小不能超过50MB!');\n        return false;\n      }\n      return true;\n    };\n    const handleSuccess = (response, file) => {\n      if (response.success) {\n        ElMessage.success(`${file.name} 上传成功`);\n        emit('uploaded', response.data);\n        fileList.value = [];\n      } else {\n        ElMessage.error(response.error || '上传失败');\n      }\n    };\n    const handleError = error => {\n      console.error('上传错误:', error);\n      if (error.message && error.message.includes('403')) {\n        ElMessage.error('上传失败：权限错误，请检查后端CORS配置');\n      } else if (error.message && error.message.includes('Network Error')) {\n        ElMessage.error('网络错误：请检查后端服务是否启动（端口5001）');\n      } else {\n        ElMessage.error('上传失败: ' + (error.message || '未知错误'));\n      }\n    };\n    return {\n      visible,\n      fileList,\n      beforeUpload,\n      handleSuccess,\n      handleError\n    };\n  }\n};","map":{"version":3,"names":["computed","ref","useStore","ElMessage","name","setup","_","emit","store","fileList","visible","get","state","showUploadDialog","set","val","commit","beforeUpload","file","isPDF","type","isLt50M","size","error","handleSuccess","response","success","data","value","handleError","console","message","includes"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/components/UploadDialog.vue"],"sourcesContent":["<template>\n  <el-dialog\n    v-model=\"visible\"\n    title=\"上传PDF论文\"\n    width=\"500px\"\n    :close-on-click-modal=\"false\"\n  >\n    <el-upload\n      class=\"upload-demo\"\n      drag\n    action=\"/api/upload\"\n    :on-success=\"handleSuccess\"\n    :on-error=\"handleError\"\n    :before-upload=\"beforeUpload\"\n    :file-list=\"fileList\"\n    accept=\".pdf\"\n    :limit=\"5\"\n    multiple\n    >\n      <i class=\"el-icon-upload\"></i>\n      <div class=\"el-upload__text\">\n        将PDF文件拖到此处，或<em>点击上传</em>\n      </div>\n      <template #tip>\n        <div class=\"el-upload__tip\">\n          只支持PDF格式，单个文件不超过50MB\n        </div>\n      </template>\n    </el-upload>\n\n    <template #footer>\n      <el-button @click=\"visible = false\">关闭</el-button>\n    </template>\n  </el-dialog>\n</template>\n\n<script>\nimport { computed, ref } from 'vue'\nimport { useStore } from 'vuex'\nimport { ElMessage } from 'element-plus'\n\nexport default {\n  name: 'UploadDialog',\n  setup(_, { emit }) {\n    const store = useStore()\n    const fileList = ref([])\n\n    const visible = computed({\n      get: () => store.state.showUploadDialog,\n      set: (val) => store.commit('SHOW_UPLOAD_DIALOG', val)\n    })\n\n    const beforeUpload = (file) => {\n      const isPDF = file.type === 'application/pdf'\n      const isLt50M = file.size / 1024 / 1024 < 50\n\n      if (!isPDF) {\n        ElMessage.error('只能上传PDF文件!')\n        return false\n      }\n      if (!isLt50M) {\n        ElMessage.error('文件大小不能超过50MB!')\n        return false\n      }\n      return true\n    }\n\n    const handleSuccess = (response, file) => {\n      if (response.success) {\n        ElMessage.success(`${file.name} 上传成功`)\n        emit('uploaded', response.data)\n        fileList.value = []\n      } else {\n        ElMessage.error(response.error || '上传失败')\n      }\n    }\n\n    const handleError = (error) => {\n      console.error('上传错误:', error)\n      if (error.message && error.message.includes('403')) {\n        ElMessage.error('上传失败：权限错误，请检查后端CORS配置')\n      } else if (error.message && error.message.includes('Network Error')) {\n        ElMessage.error('网络错误：请检查后端服务是否启动（端口5001）')\n      } else {\n        ElMessage.error('上传失败: ' + (error.message || '未知错误'))\n      }\n    }\n\n    return {\n      visible,\n      fileList,\n      beforeUpload,\n      handleSuccess,\n      handleError\n    }\n  }\n}\n</script>\n\n<style scoped>\n.upload-demo {\n  text-align: center;\n}\n\n.el-icon-upload {\n  font-size: 67px;\n  color: #409eff;\n  margin: 20px 0;\n}\n\n.el-upload__text {\n  font-size: 14px;\n  color: #606266;\n}\n\n.el-upload__text em {\n  color: #409eff;\n  font-style: normal;\n}\n</style>\n"],"mappings":"AAqCA,SAASA,QAAQ,EAAEC,GAAE,QAAS,KAAI;AAClC,SAASC,QAAO,QAAS,MAAK;AAC9B,SAASC,SAAQ,QAAS,cAAa;AAEvC,eAAe;EACbC,IAAI,EAAE,cAAc;EACpBC,KAAKA,CAACC,CAAC,EAAE;IAAEC;EAAK,CAAC,EAAE;IACjB,MAAMC,KAAI,GAAIN,QAAQ,CAAC;IACvB,MAAMO,QAAO,GAAIR,GAAG,CAAC,EAAE;IAEvB,MAAMS,OAAM,GAAIV,QAAQ,CAAC;MACvBW,GAAG,EAAEA,CAAA,KAAMH,KAAK,CAACI,KAAK,CAACC,gBAAgB;MACvCC,GAAG,EAAGC,GAAG,IAAKP,KAAK,CAACQ,MAAM,CAAC,oBAAoB,EAAED,GAAG;IACtD,CAAC;IAED,MAAME,YAAW,GAAKC,IAAI,IAAK;MAC7B,MAAMC,KAAI,GAAID,IAAI,CAACE,IAAG,KAAM,iBAAgB;MAC5C,MAAMC,OAAM,GAAIH,IAAI,CAACI,IAAG,GAAI,IAAG,GAAI,IAAG,GAAI,EAAC;MAE3C,IAAI,CAACH,KAAK,EAAE;QACVhB,SAAS,CAACoB,KAAK,CAAC,YAAY;QAC5B,OAAO,KAAI;MACb;MACA,IAAI,CAACF,OAAO,EAAE;QACZlB,SAAS,CAACoB,KAAK,CAAC,eAAe;QAC/B,OAAO,KAAI;MACb;MACA,OAAO,IAAG;IACZ;IAEA,MAAMC,aAAY,GAAIA,CAACC,QAAQ,EAAEP,IAAI,KAAK;MACxC,IAAIO,QAAQ,CAACC,OAAO,EAAE;QACpBvB,SAAS,CAACuB,OAAO,CAAC,GAAGR,IAAI,CAACd,IAAI,OAAO;QACrCG,IAAI,CAAC,UAAU,EAAEkB,QAAQ,CAACE,IAAI;QAC9BlB,QAAQ,CAACmB,KAAI,GAAI,EAAC;MACpB,OAAO;QACLzB,SAAS,CAACoB,KAAK,CAACE,QAAQ,CAACF,KAAI,IAAK,MAAM;MAC1C;IACF;IAEA,MAAMM,WAAU,GAAKN,KAAK,IAAK;MAC7BO,OAAO,CAACP,KAAK,CAAC,OAAO,EAAEA,KAAK;MAC5B,IAAIA,KAAK,CAACQ,OAAM,IAAKR,KAAK,CAACQ,OAAO,CAACC,QAAQ,CAAC,KAAK,CAAC,EAAE;QAClD7B,SAAS,CAACoB,KAAK,CAAC,uBAAuB;MACzC,OAAO,IAAIA,KAAK,CAACQ,OAAM,IAAKR,KAAK,CAACQ,OAAO,CAACC,QAAQ,CAAC,eAAe,CAAC,EAAE;QACnE7B,SAAS,CAACoB,KAAK,CAAC,0BAA0B;MAC5C,OAAO;QACLpB,SAAS,CAACoB,KAAK,CAAC,QAAO,IAAKA,KAAK,CAACQ,OAAM,IAAK,MAAM,CAAC;MACtD;IACF;IAEA,OAAO;MACLrB,OAAO;MACPD,QAAQ;MACRQ,YAAY;MACZO,aAAa;MACbK;IACF;EACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}