{"ast":null,"code":"import { inject, ref, getCurrentInstance, computed, onMounted, watch, toRef, onUnmounted } from 'vue';\nimport { useId } from '../../../../hooks/use-id/index.mjs';\nimport { formContextKey, formItemContextKey } from '../constants.mjs';\nconst useFormItem = () => {\n  const form = inject(formContextKey, void 0);\n  const formItem = inject(formItemContextKey, void 0);\n  return {\n    form,\n    formItem\n  };\n};\nconst useFormItemInputId = (props, {\n  formItemContext,\n  disableIdGeneration,\n  disableIdManagement\n}) => {\n  if (!disableIdGeneration) {\n    disableIdGeneration = ref(false);\n  }\n  if (!disableIdManagement) {\n    disableIdManagement = ref(false);\n  }\n  const instance = getCurrentInstance();\n  const inLabel = () => {\n    let parent = instance == null ? void 0 : instance.parent;\n    while (parent) {\n      if (parent.type.name === \"ElFormItem\") {\n        return false;\n      }\n      if (parent.type.name === \"ElLabelWrap\") {\n        return true;\n      }\n      parent = parent.parent;\n    }\n    return false;\n  };\n  const inputId = ref();\n  let idUnwatch = void 0;\n  const isLabeledByFormItem = computed(() => {\n    var _a;\n    return !!(!(props.label || props.ariaLabel) && formItemContext && formItemContext.inputIds && ((_a = formItemContext.inputIds) == null ? void 0 : _a.length) <= 1);\n  });\n  onMounted(() => {\n    idUnwatch = watch([toRef(props, \"id\"), disableIdGeneration], ([id, disableIdGeneration2]) => {\n      const newId = id != null ? id : !disableIdGeneration2 ? useId().value : void 0;\n      if (newId !== inputId.value) {\n        if ((formItemContext == null ? void 0 : formItemContext.removeInputId) && !inLabel()) {\n          inputId.value && formItemContext.removeInputId(inputId.value);\n          if (!(disableIdManagement == null ? void 0 : disableIdManagement.value) && !disableIdGeneration2 && newId) {\n            formItemContext.addInputId(newId);\n          }\n        }\n        inputId.value = newId;\n      }\n    }, {\n      immediate: true\n    });\n  });\n  onUnmounted(() => {\n    idUnwatch && idUnwatch();\n    if (formItemContext == null ? void 0 : formItemContext.removeInputId) {\n      inputId.value && formItemContext.removeInputId(inputId.value);\n    }\n  });\n  return {\n    isLabeledByFormItem,\n    inputId\n  };\n};\nexport { useFormItem, useFormItemInputId };","map":{"version":3,"names":["useFormItem","form","inject","formContextKey","formItem","formItemContextKey","useFormItemInputId","props","formItemContext","disableIdGeneration","disableIdManagement","ref","instance","getCurrentInstance","inLabel","parent","type","name","inputId","idUnwatch","isLabeledByFormItem","computed","_a","label","ariaLabel","inputIds","length","onMounted","watch","toRef","id","disableIdGeneration2","newId","useId","value","removeInputId","addInputId","immediate","onUnmounted"],"sources":["../../../../../../../packages/components/form/src/hooks/use-form-item.ts"],"sourcesContent":["import {\n  computed,\n  getCurrentInstance,\n  inject,\n  onMounted,\n  onUnmounted,\n  ref,\n  toRef,\n  watch,\n} from 'vue'\nimport { useId } from '@element-plus/hooks/use-id'\nimport { formContextKey, formItemContextKey } from '../constants'\n\nimport type { ComputedRef, Ref, WatchStopHandle } from 'vue'\nimport type { FormItemContext } from '../types'\n\nexport const useFormItem = () => {\n  const form = inject(formContextKey, undefined)\n  const formItem = inject(formItemContextKey, undefined)\n  return {\n    form,\n    formItem,\n  }\n}\n\nexport type IUseFormItemInputCommonProps = {\n  id?: string\n  label?: string | number | boolean | Record<string, any>\n  ariaLabel?: string | number | boolean | Record<string, any>\n}\n\nexport const useFormItemInputId = (\n  props: Partial<IUseFormItemInputCommonProps>,\n  {\n    formItemContext,\n    disableIdGeneration,\n    disableIdManagement,\n  }: {\n    formItemContext?: FormItemContext\n    disableIdGeneration?: ComputedRef<boolean> | Ref<boolean>\n    disableIdManagement?: ComputedRef<boolean> | Ref<boolean>\n  }\n) => {\n  if (!disableIdGeneration) {\n    disableIdGeneration = ref<boolean>(false)\n  }\n  if (!disableIdManagement) {\n    disableIdManagement = ref<boolean>(false)\n  }\n\n  const instance = getCurrentInstance()\n\n  const inLabel = () => {\n    let parent = instance?.parent\n    while (parent) {\n      if (parent.type.name === 'ElFormItem') {\n        return false\n      }\n      if (parent.type.name === 'ElLabelWrap') {\n        return true\n      }\n      parent = parent.parent\n    }\n    return false\n  }\n\n  const inputId = ref<string>()\n  let idUnwatch: WatchStopHandle | undefined = undefined\n\n  const isLabeledByFormItem = computed<boolean>(() => {\n    return !!(\n      !(props.label || props.ariaLabel) &&\n      formItemContext &&\n      formItemContext.inputIds &&\n      formItemContext.inputIds?.length <= 1\n    )\n  })\n\n  // Generate id for ElFormItem label if not provided as prop\n  onMounted(() => {\n    idUnwatch = watch(\n      [toRef(props, 'id'), disableIdGeneration] as any,\n      ([id, disableIdGeneration]: [string, boolean]) => {\n        const newId = id ?? (!disableIdGeneration ? useId().value : undefined)\n        if (newId !== inputId.value) {\n          if (formItemContext?.removeInputId && !inLabel()) {\n            inputId.value && formItemContext.removeInputId(inputId.value)\n            if (!disableIdManagement?.value && !disableIdGeneration && newId) {\n              formItemContext.addInputId(newId)\n            }\n          }\n          inputId.value = newId\n        }\n      },\n      { immediate: true }\n    )\n  })\n\n  onUnmounted(() => {\n    idUnwatch && idUnwatch()\n    if (formItemContext?.removeInputId) {\n      inputId.value && formItemContext.removeInputId(inputId.value)\n    }\n  })\n\n  return {\n    isLabeledByFormItem,\n    inputId,\n  }\n}\n"],"mappings":";;;AAgBO,MAAMA,WAAA,GAAcA,CAAA,KAAM;EACzB,MAAAC,IAAA,GAAOC,MAAO,CAAAC,cAAA,EAAgB,KAAS;EACvC,MAAAC,QAAA,GAAWF,MAAO,CAAAG,kBAAA,EAAoB,KAAS;EAC9C;IACLJ,IAAA;IACAG;EAAA,CACF;AACF;AAQa,MAAAE,kBAAA,GAAqBA,CAChCC,KACA;EACEC,eAAA;EACAC,mBAAA;EACAC;AACF,CAKG;EACH,IAAI,CAACD,mBAAqB;IACxBA,mBAAA,GAAsBE,GAAA,CAAa,KAAK;EAAA;EAE1C,IAAI,CAACD,mBAAqB;IACxBA,mBAAA,GAAsBC,GAAA,CAAa,KAAK;EAAA;EAG1C,MAAMC,QAAA,GAAWC,kBAAmB;EAEpC,MAAMC,OAAA,GAAUA,CAAA,KAAM;IACpB,IAAIC,MAAA,GAASH,QAAU,oBAAAA,QAAA,CAAAG,MAAA;IACvB,OAAOA,MAAQ;MACT,IAAAA,MAAA,CAAOC,IAAK,CAAAC,IAAA,KAAS,YAAc;QAC9B;MAAA;MAEL,IAAAF,MAAA,CAAOC,IAAK,CAAAC,IAAA,KAAS,aAAe;QAC/B;MAAA;MAETF,MAAA,GAASA,MAAO,CAAAA,MAAA;IAAA;IAEX;EAAA,CACT;EAEA,MAAMG,OAAA,GAAUP,GAAY;EAC5B,IAAIQ,SAAyC;EAEvC,MAAAC,mBAAA,GAAsBC,QAAA,CAAkB,MAAM;IArEtD,IAAAC,EAAA;IAsEI,OAAO,CAAC,EACN,EAAEf,KAAA,CAAMgB,KAAS,IAAAhB,KAAA,CAAMiB,SACvB,KAAAhB,eAAA,IACAA,eAAgB,CAAAiB,QAAA,MAChBH,EAAgB,GAAAd,eAAA,CAAAiB,QAAA,KAAhB,gBAAAH,EAAA,CAA0BI,MAAU;EAAA,CAEvC;EAGDC,SAAA,CAAU,MAAM;IACFR,SAAA,GAAAS,KAAA,CACV,CAACC,KAAA,CAAMtB,KAAO,MAAI,GAAGE,mBAAmB,GACxC,CAAC,CAACqB,EAAI,EAAAC,oBAAmB,CAAyB;MAChD,MAAMC,KAAA,GAAQF,EAAO,WAAAA,EAAA,IAACC,oBAAsB,GAAAE,KAAA,GAAQC,KAAQ;MACxD,IAAAF,KAAA,KAAUd,OAAA,CAAQgB,KAAO;QAC3B,KAAI1B,eAAiB,oBAAAA,eAAA,CAAA2B,aAAA,KAAiB,CAACrB,OAAA,EAAW;UAChDI,OAAA,CAAQgB,KAAS,IAAA1B,eAAA,CAAgB2B,aAAc,CAAAjB,OAAA,CAAQgB,KAAK;UAC5D,IAAI,EAACxB,mBAAA,oBAAAA,mBAAA,CAAqBwB,KAAS,MAACH,oBAAA,IAAuBC,KAAO;YAChExB,eAAA,CAAgB4B,UAAA,CAAWJ,KAAK;UAAA;QAClC;QAEFd,OAAA,CAAQgB,KAAQ,GAAAF,KAAA;MAAA;IAClB,CACF,EACA;MAAEK,SAAA,EAAW;IAAK,EACpB;EAAA,CACD;EAEDC,WAAA,CAAY,MAAM;IAChBnB,SAAA,IAAaA,SAAU;IACvB,IAAIX,eAAA,oBAAAA,eAAA,CAAiB2B,aAAe;MAClCjB,OAAA,CAAQgB,KAAS,IAAA1B,eAAA,CAAgB2B,aAAc,CAAAjB,OAAA,CAAQgB,KAAK;IAAA;EAC9D,CACD;EAEM;IACLd,mBAAA;IACAF;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}