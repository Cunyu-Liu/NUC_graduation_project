{"ast":null,"code":"import { getCurrentInstance, ref, computed, onMounted, watch } from 'vue';\nimport { draggable } from '../utils/draggable.mjs';\nimport { useNamespace } from '../../../../hooks/use-namespace/index.mjs';\nimport { addUnit } from '../../../../utils/dom/style.mjs';\nimport { getClientXY } from '../../../../utils/dom/position.mjs';\nimport { getEventCode } from '../../../../utils/dom/event.mjs';\nimport { EVENT_CODE } from '../../../../constants/aria.mjs';\nconst useSvPanel = props => {\n  const instance = getCurrentInstance();\n  const cursorRef = ref();\n  const cursorTop = ref(0);\n  const cursorLeft = ref(0);\n  const background = ref(\"hsl(0, 100%, 50%)\");\n  const saturation = computed(() => props.color.get(\"saturation\"));\n  const brightness = computed(() => props.color.get(\"value\"));\n  const hue = computed(() => props.color.get(\"hue\"));\n  function handleClick(event) {\n    var _a;\n    if (props.disabled) return;\n    const target = event.target;\n    if (target !== cursorRef.value) {\n      handleDrag(event);\n    }\n    (_a = cursorRef.value) == null ? void 0 : _a.focus({\n      preventScroll: true\n    });\n  }\n  function handleDrag(event) {\n    if (props.disabled) return;\n    const el = instance.vnode.el;\n    const rect = el.getBoundingClientRect();\n    const {\n      clientX,\n      clientY\n    } = getClientXY(event);\n    let left = clientX - rect.left;\n    let top = clientY - rect.top;\n    left = Math.max(0, left);\n    left = Math.min(left, rect.width);\n    top = Math.max(0, top);\n    top = Math.min(top, rect.height);\n    cursorLeft.value = left;\n    cursorTop.value = top;\n    props.color.set({\n      saturation: left / rect.width * 100,\n      value: 100 - top / rect.height * 100\n    });\n  }\n  function handleKeydown(event) {\n    if (props.disabled) return;\n    const {\n      shiftKey\n    } = event;\n    const code = getEventCode(event);\n    const step = shiftKey ? 10 : 1;\n    let isPreventDefault = true;\n    switch (code) {\n      case EVENT_CODE.left:\n        incrementSaturation(-step);\n        break;\n      case EVENT_CODE.right:\n        incrementSaturation(step);\n        break;\n      case EVENT_CODE.up:\n        incrementBrightness(step);\n        break;\n      case EVENT_CODE.down:\n        incrementBrightness(-step);\n        break;\n      default:\n        isPreventDefault = false;\n        break;\n    }\n    isPreventDefault && event.preventDefault();\n  }\n  function incrementSaturation(step) {\n    let next = saturation.value + step;\n    next = next < 0 ? 0 : next > 100 ? 100 : next;\n    props.color.set(\"saturation\", next);\n  }\n  function incrementBrightness(step) {\n    let next = brightness.value + step;\n    next = next < 0 ? 0 : next > 100 ? 100 : next;\n    props.color.set(\"value\", next);\n  }\n  return {\n    cursorRef,\n    cursorTop,\n    cursorLeft,\n    background,\n    saturation,\n    brightness,\n    hue,\n    handleClick,\n    handleDrag,\n    handleKeydown\n  };\n};\nconst useSvPanelDOM = (props, {\n  cursorTop,\n  cursorLeft,\n  background,\n  handleDrag\n}) => {\n  const instance = getCurrentInstance();\n  const ns = useNamespace(\"color-svpanel\");\n  function update() {\n    const saturation = props.color.get(\"saturation\");\n    const brightness = props.color.get(\"value\");\n    const el = instance.vnode.el;\n    const {\n      clientWidth: width,\n      clientHeight: height\n    } = el;\n    cursorLeft.value = saturation * width / 100;\n    cursorTop.value = (100 - brightness) * height / 100;\n    background.value = `hsl(${props.color.get(\"hue\")}, 100%, 50%)`;\n  }\n  onMounted(() => {\n    draggable(instance.vnode.el, {\n      drag: event => {\n        handleDrag(event);\n      },\n      end: event => {\n        handleDrag(event);\n      }\n    });\n    update();\n  });\n  watch([() => props.color.get(\"hue\"), () => props.color.get(\"value\"), () => props.color.value], () => update());\n  const rootKls = computed(() => ns.b());\n  const cursorKls = computed(() => ns.e(\"cursor\"));\n  const rootStyle = computed(() => ({\n    backgroundColor: background.value\n  }));\n  const cursorStyle = computed(() => ({\n    top: addUnit(cursorTop.value),\n    left: addUnit(cursorLeft.value)\n  }));\n  return {\n    rootKls,\n    cursorKls,\n    rootStyle,\n    cursorStyle,\n    update\n  };\n};\nexport { useSvPanel, useSvPanelDOM };","map":{"version":3,"names":["useSvPanel","props","instance","getCurrentInstance","cursorRef","ref","cursorTop","cursorLeft","background","saturation","computed","color","get","brightness","hue","handleClick","event","_a","disabled","target","value","handleDrag","focus","preventScroll","el","vnode","rect","getBoundingClientRect","clientX","clientY","getClientXY","left","top","Math","max","min","width","height","set","handleKeydown","shiftKey","code","getEventCode","step","isPreventDefault","EVENT_CODE","incrementSaturation","right","up","incrementBrightness","down","preventDefault","next","useSvPanelDOM","ns","useNamespace","update","clientWidth","clientHeight","onMounted","draggable","drag","end","watch","rootKls","b","cursorKls","e","rootStyle","backgroundColor","cursorStyle","addUnit"],"sources":["../../../../../../../packages/components/color-picker-panel/src/composables/use-sv-panel.ts"],"sourcesContent":["import { computed, getCurrentInstance, onMounted, ref, watch } from 'vue'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { useNamespace } from '@element-plus/hooks'\nimport { addUnit, getClientXY, getEventCode } from '@element-plus/utils'\nimport { draggable } from '../utils/draggable'\n\nimport type { SvPanelProps } from '../props/sv-panel'\n\nexport const useSvPanel = (props: SvPanelProps) => {\n  const instance = getCurrentInstance()!\n\n  const cursorRef = ref<HTMLElement>()\n  const cursorTop = ref(0)\n  const cursorLeft = ref(0)\n  const background = ref('hsl(0, 100%, 50%)')\n\n  const saturation = computed(() => props.color.get('saturation'))\n  const brightness = computed(() => props.color.get('value'))\n  const hue = computed(() => props.color.get('hue'))\n\n  function handleClick(event: MouseEvent | TouchEvent) {\n    if (props.disabled) return\n    const target = event.target\n\n    if (target !== cursorRef.value) {\n      handleDrag(event)\n    }\n    cursorRef.value?.focus({ preventScroll: true })\n  }\n\n  function handleDrag(event: MouseEvent | TouchEvent) {\n    if (props.disabled) return\n\n    const el = instance.vnode.el!\n    const rect = el.getBoundingClientRect()\n    const { clientX, clientY } = getClientXY(event)\n\n    let left = clientX - rect.left\n    let top = clientY - rect.top\n    left = Math.max(0, left)\n    left = Math.min(left, rect.width)\n\n    top = Math.max(0, top)\n    top = Math.min(top, rect.height)\n\n    cursorLeft.value = left\n    cursorTop.value = top\n    props.color.set({\n      saturation: (left / rect.width) * 100,\n      value: 100 - (top / rect.height) * 100,\n    })\n  }\n\n  function handleKeydown(event: KeyboardEvent) {\n    if (props.disabled) return\n    const { shiftKey } = event\n    const code = getEventCode(event)\n    const step = shiftKey ? 10 : 1\n    let isPreventDefault = true\n\n    switch (code) {\n      case EVENT_CODE.left:\n        incrementSaturation(-step)\n        break\n      case EVENT_CODE.right:\n        incrementSaturation(step)\n        break\n      case EVENT_CODE.up:\n        incrementBrightness(step)\n        break\n      case EVENT_CODE.down:\n        incrementBrightness(-step)\n        break\n      default:\n        isPreventDefault = false\n        break\n    }\n\n    isPreventDefault && event.preventDefault()\n  }\n\n  function incrementSaturation(step: number) {\n    let next = saturation.value + step\n    next = next < 0 ? 0 : next > 100 ? 100 : next\n    props.color.set('saturation', next)\n  }\n\n  function incrementBrightness(step: number) {\n    let next = brightness.value + step\n    next = next < 0 ? 0 : next > 100 ? 100 : next\n    props.color.set('value', next)\n  }\n\n  return {\n    cursorRef,\n    cursorTop,\n    cursorLeft,\n    background,\n    saturation,\n    brightness,\n    hue,\n    handleClick,\n    handleDrag,\n    handleKeydown,\n  }\n}\n\nexport const useSvPanelDOM = (\n  props: SvPanelProps,\n  {\n    cursorTop,\n    cursorLeft,\n    background,\n    handleDrag,\n  }: Pick<\n    ReturnType<typeof useSvPanel>,\n    'cursorTop' | 'cursorLeft' | 'background' | 'handleDrag'\n  >\n) => {\n  const instance = getCurrentInstance()!\n  const ns = useNamespace('color-svpanel')\n\n  function update() {\n    const saturation = props.color.get('saturation')\n    const brightness = props.color.get('value')\n\n    const el = instance.vnode.el!\n    const { clientWidth: width, clientHeight: height } = el\n\n    cursorLeft.value = (saturation * width) / 100\n    cursorTop.value = ((100 - brightness) * height) / 100\n\n    background.value = `hsl(${props.color.get('hue')}, 100%, 50%)`\n  }\n\n  onMounted(() => {\n    draggable(instance.vnode.el as HTMLElement, {\n      drag: (event) => {\n        handleDrag(event)\n      },\n      end: (event) => {\n        handleDrag(event)\n      },\n    })\n\n    update()\n  })\n\n  watch(\n    [\n      () => props.color.get('hue'),\n      () => props.color.get('value'),\n      () => props.color.value,\n    ],\n    () => update()\n  )\n\n  const rootKls = computed(() => ns.b())\n  const cursorKls = computed(() => ns.e('cursor'))\n  const rootStyle = computed(() => ({\n    backgroundColor: background.value,\n  }))\n  const cursorStyle = computed(() => ({\n    top: addUnit(cursorTop.value),\n    left: addUnit(cursorLeft.value),\n  }))\n\n  return {\n    rootKls,\n    cursorKls,\n    rootStyle,\n    cursorStyle,\n    update,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}