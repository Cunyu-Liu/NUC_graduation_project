{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"knowledge-graph-page\"\n};\nconst _hoisted_2 = {\n  class: \"header-content\"\n};\nconst _hoisted_3 = {\n  class: \"header-left\"\n};\nconst _hoisted_4 = {\n  class: \"header-right\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Share = _resolveComponent(\"Share\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_Refresh = _resolveComponent(\"Refresh\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_InfoFilled = _resolveComponent(\"InfoFilled\");\n  const _component_Download = _resolveComponent(\"Download\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_el_descriptions_item = _resolveComponent(\"el-descriptions-item\");\n  const _component_el_descriptions = _resolveComponent(\"el-descriptions\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  const _component_KnowledgeGraph = _resolveComponent(\"KnowledgeGraph\", true);\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, {\n    class: \"page-header\"\n  }, {\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"h2\", null, [_createVNode(_component_el_icon, null, {\n      default: _withCtx(() => [_createVNode(_component_Share)]),\n      _: 1 /* STABLE */\n    }), _cache[2] || (_cache[2] = _createTextVNode(\" 知识图谱 \", -1 /* CACHED */))]), _cache[3] || (_cache[3] = _createElementVNode(\"p\", null, \"可视化展示论文之间的引用和关联关系\", -1 /* CACHED */))]), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $setup.buildGraph,\n      loading: $setup.building\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n        default: _withCtx(() => [_createVNode(_component_Refresh)]),\n        _: 1 /* STABLE */\n      }), _cache[4] || (_cache[4] = _createTextVNode(\" 构建图谱 \", -1 /* CACHED */))]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\", \"loading\"]), _createVNode(_component_el_button, {\n      onClick: _cache[0] || (_cache[0] = $event => $setup.showStats = true)\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n        default: _withCtx(() => [_createVNode(_component_InfoFilled)]),\n        _: 1 /* STABLE */\n      }), _cache[5] || (_cache[5] = _createTextVNode(\" 统计信息 \", -1 /* CACHED */))]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_button, {\n      onClick: $setup.exportGraph\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n        default: _withCtx(() => [_createVNode(_component_Download)]),\n        _: 1 /* STABLE */\n      }), _cache[6] || (_cache[6] = _createTextVNode(\" 导出 \", -1 /* CACHED */))]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\"])])])]),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 统计信息对话框 \"), _createVNode(_component_el_dialog, {\n    modelValue: $setup.showStats,\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.showStats = $event),\n    title: \"知识图谱统计\",\n    width: \"500px\"\n  }, {\n    default: _withCtx(() => [$setup.stats ? (_openBlock(), _createBlock(_component_el_descriptions, {\n      key: 0,\n      column: 1,\n      border: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_descriptions_item, {\n        label: \"节点数（论文）\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.stats.total_nodes || 0), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_descriptions_item, {\n        label: \"边数（关系）\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.stats.total_edges || 0), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_descriptions_item, {\n        label: \"平均度数\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString(($setup.stats.avg_degree || 0).toFixed(2)), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    })) : (_openBlock(), _createBlock(_component_el_empty, {\n      key: 1,\n      description: \"暂无统计信息\"\n    }))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_KnowledgeGraph, {\n    ref: \"graphComponent\"\n  }, null, 512 /* NEED_PATCH */)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","_createElementVNode","_hoisted_2","_hoisted_3","_component_el_icon","_component_Share","_hoisted_4","_component_el_button","type","onClick","$setup","buildGraph","loading","building","_component_Refresh","_cache","$event","showStats","_component_InfoFilled","exportGraph","_component_Download","_createCommentVNode","_component_el_dialog","title","width","stats","_createBlock","_component_el_descriptions","column","border","_component_el_descriptions_item","label","total_nodes","total_edges","avg_degree","toFixed","_component_el_empty","description","_component_KnowledgeGraph","ref"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/views/KnowledgeGraph.vue"],"sourcesContent":["<template>\n  <div class=\"knowledge-graph-page\">\n    <el-card class=\"page-header\">\n      <div class=\"header-content\">\n        <div class=\"header-left\">\n          <h2>\n            <el-icon><Share /></el-icon>\n            知识图谱\n          </h2>\n          <p>可视化展示论文之间的引用和关联关系</p>\n        </div>\n        <div class=\"header-right\">\n          <el-button type=\"primary\" @click=\"buildGraph\" :loading=\"building\">\n            <el-icon><Refresh /></el-icon>\n            构建图谱\n          </el-button>\n          <el-button @click=\"showStats = true\">\n            <el-icon><InfoFilled /></el-icon>\n            统计信息\n          </el-button>\n          <el-button @click=\"exportGraph\">\n            <el-icon><Download /></el-icon>\n            导出\n          </el-button>\n        </div>\n      </div>\n    </el-card>\n\n    <!-- 统计信息对话框 -->\n    <el-dialog v-model=\"showStats\" title=\"知识图谱统计\" width=\"500px\">\n      <el-descriptions :column=\"1\" border v-if=\"stats\">\n        <el-descriptions-item label=\"节点数（论文）\">{{ stats.total_nodes || 0 }}</el-descriptions-item>\n        <el-descriptions-item label=\"边数（关系）\">{{ stats.total_edges || 0 }}</el-descriptions-item>\n        <el-descriptions-item label=\"平均度数\">{{ (stats.avg_degree || 0).toFixed(2) }}</el-descriptions-item>\n      </el-descriptions>\n      <el-empty v-else description=\"暂无统计信息\" />\n    </el-dialog>\n\n    <KnowledgeGraph ref=\"graphComponent\" />\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport { Share, Refresh, Download, InfoFilled } from '@element-plus/icons-vue'\nimport KnowledgeGraph from '@/components/KnowledgeGraph.vue'\nimport api from '@/api'\n\nexport default {\n  name: 'KnowledgeGraphView',\n  components: {\n    KnowledgeGraph,\n    Share,\n    Refresh,\n    Download,\n    InfoFilled\n  },\n  setup() {\n    const graphComponent = ref(null)\n    const building = ref(false)\n    const showStats = ref(false)\n    const stats = ref(null)\n\n    // 页面加载时自动构建图谱\n    onMounted(async () => {\n      await loadStats()\n      // 自动构建图谱（如果还没有数据）\n      await buildGraph()\n    })\n\n    const loadStats = async () => {\n      try {\n        const response = await api.getStatistics()\n        if (response.success) {\n          stats.value = {\n            total_nodes: response.data.total_papers,\n            total_edges: response.data.total_relations,\n            avg_degree: response.data.total_relations * 2 / Math.max(response.data.total_papers, 1)\n          }\n        }\n      } catch (error) {\n        console.error('获取统计信息失败:', error)\n      }\n    }\n\n    const buildGraph = async () => {\n      try {\n        building.value = true\n        ElMessage.info('正在构建知识图谱，请稍候...')\n\n        const response = await api.buildKnowledgeGraph([])\n\n        if (response.success) {\n          ElMessage.success(response.message || '知识图谱构建成功')\n          if (graphComponent.value) {\n            await graphComponent.value.refreshGraph()\n          }\n          // 刷新统计信息\n          await loadStats()\n        } else {\n          ElMessage.warning(response.message || '图谱构建未完成')\n        }\n      } catch (error) {\n        console.error('构建知识图谱失败:', error)\n        // 不显示错误，因为可能是图谱已经存在\n        // 直接刷新图谱显示\n        if (graphComponent.value) {\n          await graphComponent.value.refreshGraph()\n        }\n      } finally {\n        building.value = false\n      }\n    }\n\n    const exportGraph = () => {\n      // 导出当前图谱为图片\n      const svg = document.querySelector('.knowledge-graph-container svg')\n      if (!svg) {\n        ElMessage.warning('没有可导出的图谱')\n        return\n      }\n\n      const svgData = new XMLSerializer().serializeToString(svg)\n      const canvas = document.createElement('canvas')\n      const ctx = canvas.getContext('2d')\n      const img = new Image()\n\n      canvas.width = 1920\n      canvas.height = 1080\n\n      img.onload = () => {\n        ctx.fillStyle = '#f8f9fa'\n        ctx.fillRect(0, 0, canvas.width, canvas.height)\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height)\n\n        canvas.toBlob((blob) => {\n          const url = URL.createObjectURL(blob)\n          const a = document.createElement('a')\n          a.href = url\n          a.download = `knowledge_graph_${Date.now()}.png`\n          a.click()\n          URL.revokeObjectURL(url)\n          ElMessage.success('图谱导出成功')\n        })\n      }\n\n      img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)))\n    }\n\n    return {\n      graphComponent,\n      building,\n      showStats,\n      stats,\n      buildGraph,\n      exportGraph\n    }\n  }\n}\n</script>\n\n<style scoped>\n.knowledge-graph-page {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.page-header {\n  margin-bottom: 20px;\n}\n\n.header-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.header-left h2 {\n  margin: 0 0 8px 0;\n  font-size: 24px;\n  color: #303133;\n  display: flex;\n  align-items: center;\n}\n\n.header-left h2 i {\n  margin-right: 10px;\n  color: #409eff;\n}\n\n.header-left p {\n  margin: 0;\n  font-size: 14px;\n  color: #909399;\n}\n\n.header-right {\n  display: flex;\n  gap: 10px;\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAsB;;EAExBA,KAAK,EAAC;AAAgB;;EACpBA,KAAK,EAAC;AAAa;;EAOnBA,KAAK,EAAC;AAAc;;;;;;;;;;;;;;uBAV/BC,mBAAA,CAsCM,OAtCNC,UAsCM,GArCJC,YAAA,CAwBUC,kBAAA;IAxBDJ,KAAK,EAAC;EAAa;sBAC1B,MAsBM,CAtBNK,mBAAA,CAsBM,OAtBNC,UAsBM,GArBJD,mBAAA,CAMM,OANNE,UAMM,GALJF,mBAAA,CAGK,aAFHF,YAAA,CAA4BK,kBAAA;wBAAnB,MAAS,CAATL,YAAA,CAASM,gBAAA,E;;mDAAU,QAE9B,oB,6BACAJ,mBAAA,CAAwB,WAArB,mBAAiB,oB,GAEtBA,mBAAA,CAaM,OAbNK,UAaM,GAZJP,YAAA,CAGYQ,oBAAA;MAHDC,IAAI,EAAC,SAAS;MAAEC,OAAK,EAAEC,MAAA,CAAAC,UAAU;MAAGC,OAAO,EAAEF,MAAA,CAAAG;;wBACtD,MAA8B,CAA9Bd,YAAA,CAA8BK,kBAAA;0BAArB,MAAW,CAAXL,YAAA,CAAWe,kBAAA,E;;qDAAU,QAEhC,oB;;+CACAf,YAAA,CAGYQ,oBAAA;MAHAE,OAAK,EAAAM,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEN,MAAA,CAAAO,SAAS;;wBAC1B,MAAiC,CAAjClB,YAAA,CAAiCK,kBAAA;0BAAxB,MAAc,CAAdL,YAAA,CAAcmB,qBAAA,E;;qDAAU,QAEnC,oB;;QACAnB,YAAA,CAGYQ,oBAAA;MAHAE,OAAK,EAAEC,MAAA,CAAAS;IAAW;wBAC5B,MAA+B,CAA/BpB,YAAA,CAA+BK,kBAAA;0BAAtB,MAAY,CAAZL,YAAA,CAAYqB,mBAAA,E;;qDAAU,MAEjC,oB;;;;MAKNC,mBAAA,aAAgB,EAChBtB,YAAA,CAOYuB,oBAAA;gBAPQZ,MAAA,CAAAO,SAAS;+DAATP,MAAA,CAAAO,SAAS,GAAAD,MAAA;IAAEO,KAAK,EAAC,QAAQ;IAACC,KAAK,EAAC;;sBAFvD,MAMuD,CAHRd,MAAA,CAAAe,KAAK,I,cAA/CC,YAAA,CAIkBC,0BAAA;;MAJAC,MAAM,EAAE,CAAC;MAAEC,MAAM,EAAN;;wBAC3B,MAAyF,CAAzF9B,YAAA,CAAyF+B,+BAAA;QAAnEC,KAAK,EAAC;MAAS;0BAAC,MAA4B,C,kCAAzBrB,MAAA,CAAAe,KAAK,CAACO,WAAW,sB;;UAC1DjC,YAAA,CAAwF+B,+BAAA;QAAlEC,KAAK,EAAC;MAAQ;0BAAC,MAA4B,C,kCAAzBrB,MAAA,CAAAe,KAAK,CAACQ,WAAW,sB;;UACzDlC,YAAA,CAAkG+B,+BAAA;QAA5EC,KAAK,EAAC;MAAM;0BAAC,MAAwC,C,mCAApCrB,MAAA,CAAAe,KAAK,CAACS,UAAU,OAAOC,OAAO,oB;;;;yBAEvET,YAAA,CAAwCU,mBAAA;;MAAvBC,WAAW,EAAC;;;qCAG/BtC,YAAA,CAAuCuC,yBAAA;IAAvBC,GAAG,EAAC;EAAgB,+B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}