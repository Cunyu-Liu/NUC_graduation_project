{"ast":null,"code":"import { inject, ref, computed, unref, watch, onMounted, onBeforeUnmount } from 'vue';\nimport { isUndefined } from 'lodash-unified';\nimport { POPPER_INJECTION_KEY } from '../constants.mjs';\nimport { buildPopperOptions, unwrapMeasurableEl } from '../utils.mjs';\nimport { usePopper } from '../../../../hooks/use-popper/index.mjs';\nconst DEFAULT_ARROW_OFFSET = 0;\nconst usePopperContent = props => {\n  const {\n    popperInstanceRef,\n    contentRef,\n    triggerRef,\n    role\n  } = inject(POPPER_INJECTION_KEY, void 0);\n  const arrowRef = ref();\n  const arrowOffset = computed(() => props.arrowOffset);\n  const eventListenerModifier = computed(() => {\n    return {\n      name: \"eventListeners\",\n      enabled: !!props.visible\n    };\n  });\n  const arrowModifier = computed(() => {\n    var _a;\n    const arrowEl = unref(arrowRef);\n    const offset = (_a = unref(arrowOffset)) != null ? _a : DEFAULT_ARROW_OFFSET;\n    return {\n      name: \"arrow\",\n      enabled: !isUndefined(arrowEl),\n      options: {\n        element: arrowEl,\n        padding: offset\n      }\n    };\n  });\n  const options = computed(() => {\n    return {\n      onFirstUpdate: () => {\n        update();\n      },\n      ...buildPopperOptions(props, [unref(arrowModifier), unref(eventListenerModifier)])\n    };\n  });\n  const computedReference = computed(() => unwrapMeasurableEl(props.referenceEl) || unref(triggerRef));\n  const {\n    attributes,\n    state,\n    styles,\n    update,\n    forceUpdate,\n    instanceRef\n  } = usePopper(computedReference, contentRef, options);\n  watch(instanceRef, instance => popperInstanceRef.value = instance, {\n    flush: \"sync\"\n  });\n  onMounted(() => {\n    watch(() => {\n      var _a, _b;\n      return (_b = (_a = unref(computedReference)) == null ? void 0 : _a.getBoundingClientRect) == null ? void 0 : _b.call(_a);\n    }, () => {\n      update();\n    });\n  });\n  onBeforeUnmount(() => {\n    popperInstanceRef.value = void 0;\n  });\n  return {\n    attributes,\n    arrowRef,\n    contentRef,\n    instanceRef,\n    state,\n    styles,\n    role,\n    forceUpdate,\n    update\n  };\n};\nexport { usePopperContent };","map":{"version":3,"names":["DEFAULT_ARROW_OFFSET","usePopperContent","props","popperInstanceRef","contentRef","triggerRef","role","inject","POPPER_INJECTION_KEY","arrowRef","ref","arrowOffset","computed","eventListenerModifier","name","enabled","visible","arrowModifier","_a","arrowEl","unref","offset","isUndefined","options","element","padding","onFirstUpdate","update","buildPopperOptions","computedReference","unwrapMeasurableEl","referenceEl","attributes","state","styles","forceUpdate","instanceRef","usePopper","watch","instance","value","flush","onMounted","_b","getBoundingClientRect","call","onBeforeUnmount"],"sources":["../../../../../../../packages/components/popper/src/composables/use-content.ts"],"sourcesContent":["import {\n  computed,\n  inject,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n  unref,\n  watch,\n} from 'vue'\nimport { isUndefined } from 'lodash-unified'\nimport { usePopper } from '@element-plus/hooks'\nimport { POPPER_INJECTION_KEY } from '../constants'\nimport { buildPopperOptions, unwrapMeasurableEl } from '../utils'\n\nimport type { Modifier } from '@popperjs/core'\nimport type { PartialOptions } from '@element-plus/hooks'\nimport type { PopperContentProps } from '../content'\n\nconst DEFAULT_ARROW_OFFSET = 0\n\nexport const usePopperContent = (props: PopperContentProps) => {\n  const { popperInstanceRef, contentRef, triggerRef, role } = inject(\n    POPPER_INJECTION_KEY,\n    undefined\n  )!\n\n  const arrowRef = ref<HTMLElement>()\n  const arrowOffset = computed(() => props.arrowOffset)\n\n  const eventListenerModifier = computed(() => {\n    return {\n      name: 'eventListeners',\n      enabled: !!props.visible,\n    } as Modifier<'eventListeners', any>\n  })\n\n  const arrowModifier = computed(() => {\n    const arrowEl = unref(arrowRef)\n    const offset = unref(arrowOffset) ?? DEFAULT_ARROW_OFFSET\n    // Seems like the `phase` and `fn` is required by Modifier type\n    // But on its documentation they didn't specify that.\n    // Refer to https://popper.js.org/docs/v2/modifiers/arrow/\n    return {\n      name: 'arrow',\n      enabled: !isUndefined(arrowEl),\n      options: {\n        element: arrowEl,\n        padding: offset,\n      },\n    } as any\n  })\n\n  const options = computed<PartialOptions>(() => {\n    return {\n      onFirstUpdate: () => {\n        update()\n      },\n      ...buildPopperOptions(props, [\n        unref(arrowModifier),\n        unref(eventListenerModifier),\n      ]),\n    }\n  })\n\n  const computedReference = computed(\n    () => unwrapMeasurableEl(props.referenceEl) || unref(triggerRef)\n  )\n\n  const { attributes, state, styles, update, forceUpdate, instanceRef } =\n    usePopper(computedReference, contentRef, options)\n\n  watch(instanceRef, (instance) => (popperInstanceRef.value = instance), {\n    flush: 'sync',\n  })\n\n  onMounted(() => {\n    watch(\n      () => unref(computedReference)?.getBoundingClientRect?.(),\n      () => {\n        update()\n      }\n    )\n  })\n\n  onBeforeUnmount(() => {\n    popperInstanceRef.value = undefined\n  })\n\n  return {\n    attributes,\n    arrowRef,\n    contentRef,\n    instanceRef,\n    state,\n    styles,\n    role,\n\n    forceUpdate,\n    update,\n  }\n}\n\nexport type UsePopperContentReturn = ReturnType<typeof usePopperContent>\n"],"mappings":";;;;;AAkBA,MAAMA,oBAAuB;AAEhB,MAAAC,gBAAA,GAAoBC,KAA8B;EAC7D,MAAM;IAAEC,iBAAA;IAAmBC,UAAY;IAAAC,UAAA;IAAYC;EAAA,CAAS,GAAAC,MAAA,CAC1DC,oBAAA,EACA,OACF;EAEA,MAAMC,QAAA,GAAWC,GAAiB;EAClC,MAAMC,WAAc,GAAAC,QAAA,CAAS,MAAMV,KAAA,CAAMS,WAAW;EAE9C,MAAAE,qBAAA,GAAwBD,QAAA,CAAS,MAAM;IACpC;MACLE,IAAM;MACNC,OAAA,EAAS,CAAC,CAACb,KAAM,CAAAc;IAAA,CACnB;EAAA,CACD;EAEK,MAAAC,aAAA,GAAgBL,QAAA,CAAS,MAAM;IApCvC,IAAAM,EAAA;IAqCU,MAAAC,OAAA,GAAUC,KAAA,CAAMX,QAAQ;IAC9B,MAAMY,MAAS,IAAAH,EAAA,GAAAE,KAAA,CAAMT,WAAW,MAAjB,IAAsB,GAAAO,EAAA,GAAAlB,oBAAA;IAI9B;MACLc,IAAM;MACNC,OAAA,EAAS,CAACO,WAAA,CAAYH,OAAO;MAC7BI,OAAS;QACPC,OAAS,EAAAL,OAAA;QACTM,OAAS,EAAAJ;MAAA;IACX,CACF;EAAA,CACD;EAEK,MAAAE,OAAA,GAAUX,QAAA,CAAyB,MAAM;IACtC;MACLc,aAAA,EAAeA,CAAA,KAAM;QACZC,MAAA;MAAA,CACT;MACA,GAAGC,kBAAA,CAAmB1B,KAAO,GAC3BkB,KAAA,CAAMH,aAAa,GACnBG,KAAA,CAAMP,qBAAqB,EAC5B;IAAA,CACH;EAAA,CACD;EAED,MAAMgB,iBAAoB,GAAAjB,QAAA,CACxB,MAAMkB,kBAAmB,CAAA5B,KAAA,CAAM6B,WAAW,KAAKX,KAAA,CAAMf,UAAU,EACjE;EAEM;IAAE2B,UAAY;IAAAC,KAAA;IAAOC,MAAQ;IAAAP,MAAA;IAAQQ,WAAa;IAAAC;EAAA,CACtD,GAAAC,SAAA,CAAUR,iBAAmB,EAAAzB,UAAA,EAAYmB,OAAO;EAElDe,KAAA,CAAMF,WAAa,EAACG,QAAc,IAAApC,iBAAA,CAAkBqC,KAAA,GAAQD,QAAW;IACrEE,KAAO;EAAA,CACR;EAEDC,SAAA,CAAU,MAAM;IACdJ,KAAA,CACE,MAAG;MA7ET,IAAApB,EAAA,EAAAyB,EAAA;MA6EkB,QAAAA,EAAA,IAAAzB,EAAA,GAAAE,KAAA,CAAAS,iBAAiB,CAAvB,qBAAAX,EAAA,CAA0B0B,qBAA1B,qBAAAD,EAAA,CAAAE,IAAA,CAAA3B,EAAA;IAAA,GACN,MAAM;MACGS,MAAA;IAAA,CACT,CACF;EAAA,CACD;EAEDmB,eAAA,CAAgB,MAAM;IACpB3C,iBAAA,CAAkBqC,KAAQ;EAAA,CAC3B;EAEM;IACLR,UAAA;IACAvB,QAAA;IACAL,UAAA;IACAgC,WAAA;IACAH,KAAA;IACAC,MAAA;IACA5B,IAAA;IAEA6B,WAAA;IACAR;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}