{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { watch } from 'vue';\nimport { debounce } from 'lodash-unified';\nimport useStore from './index.mjs';\nimport { isObject } from '@vue/shared';\nconst InitialStateMap = {\n  rowKey: \"rowKey\",\n  defaultExpandAll: \"defaultExpandAll\",\n  selectOnIndeterminate: \"selectOnIndeterminate\",\n  indent: \"indent\",\n  lazy: \"lazy\",\n  [\"treeProps.hasChildren\"]: {\n    key: \"lazyColumnIdentifier\",\n    default: \"hasChildren\"\n  },\n  [\"treeProps.children\"]: {\n    key: \"childrenColumnName\",\n    default: \"children\"\n  },\n  [\"treeProps.checkStrictly\"]: {\n    key: \"checkStrictly\",\n    default: false\n  }\n};\nfunction createStore(table, props) {\n  if (!table) {\n    throw new Error(\"Table is required.\");\n  }\n  const store = useStore();\n  store.toggleAllSelection = debounce(store._toggleAllSelection, 10);\n  Object.keys(InitialStateMap).forEach(key => {\n    handleValue(getArrKeysValue(props, key), key, store);\n  });\n  proxyTableProps(store, props);\n  return store;\n}\nfunction proxyTableProps(store, props) {\n  Object.keys(InitialStateMap).forEach(key => {\n    watch(() => getArrKeysValue(props, key), value => {\n      handleValue(value, key, store);\n    });\n  });\n}\nfunction handleValue(value, propsKey, store) {\n  let newVal = value;\n  let storeKey = InitialStateMap[propsKey];\n  if (isObject(storeKey)) {\n    newVal = newVal || storeKey.default;\n    storeKey = storeKey.key;\n  }\n  store.states[storeKey].value = newVal;\n}\nfunction getArrKeysValue(props, key) {\n  if (key.includes(\".\")) {\n    const keyList = key.split(\".\");\n    let value = props;\n    keyList.forEach(k => {\n      value = value[k];\n    });\n    return value;\n  } else {\n    return props[key];\n  }\n}\nexport { createStore };","map":{"version":3,"names":["InitialStateMap","rowKey","defaultExpandAll","selectOnIndeterminate","indent","lazy","key","default","createStore","table","props","Error","store","useStore","toggleAllSelection","debounce","_toggleAllSelection","Object","keys","forEach","handleValue","getArrKeysValue","proxyTableProps","watch","value","propsKey","newVal","storeKey","isObject","states","includes","keyList","split","k"],"sources":["../../../../../../../packages/components/table/src/store/helper.ts"],"sourcesContent":["import { watch } from 'vue'\nimport { debounce } from 'lodash-unified'\nimport { isObject } from '@element-plus/utils'\nimport useStore from '.'\n\nimport type { Store } from '.'\nimport type { DefaultRow, Table, TableProps } from '../table/defaults'\n\nconst InitialStateMap = {\n  rowKey: 'rowKey',\n  defaultExpandAll: 'defaultExpandAll',\n  selectOnIndeterminate: 'selectOnIndeterminate',\n  indent: 'indent',\n  lazy: 'lazy',\n  ['treeProps.hasChildren']: {\n    key: 'lazyColumnIdentifier',\n    default: 'hasChildren',\n  },\n  ['treeProps.children']: {\n    key: 'childrenColumnName',\n    default: 'children',\n  },\n  ['treeProps.checkStrictly']: {\n    key: 'checkStrictly',\n    default: false,\n  },\n}\n\nexport function createStore<T extends DefaultRow>(\n  table: Table<T>,\n  props: TableProps<T>\n) {\n  if (!table) {\n    throw new Error('Table is required.')\n  }\n\n  const store = useStore<T>()\n  // fix https://github.com/ElemeFE/element/issues/14075\n  // related pr https://github.com/ElemeFE/element/pull/14146\n  store.toggleAllSelection = debounce(store._toggleAllSelection, 10)\n  Object.keys(InitialStateMap).forEach((key) => {\n    handleValue(getArrKeysValue(props, key), key, store)\n  })\n  proxyTableProps(store, props)\n  return store\n}\n\nfunction proxyTableProps<T extends DefaultRow>(\n  store: Store<T>,\n  props: TableProps<T>\n) {\n  Object.keys(InitialStateMap).forEach((key) => {\n    watch(\n      () => getArrKeysValue(props, key),\n      (value) => {\n        handleValue(value, key, store)\n      }\n    )\n  })\n}\n\nfunction handleValue<T extends DefaultRow>(\n  value: string | boolean | Record<string, any>,\n  propsKey: string,\n  store: Store<T>\n) {\n  let newVal = value\n  let storeKey = InitialStateMap[propsKey as keyof typeof InitialStateMap]\n  if (isObject(storeKey)) {\n    newVal = newVal || storeKey.default\n    storeKey = storeKey.key\n  }\n  ;((store.states as any)[storeKey] as any).value = newVal\n}\n\nfunction getArrKeysValue<T extends DefaultRow>(\n  props: TableProps<T>,\n  key: string\n) {\n  if ((key as keyof typeof props).includes('.')) {\n    const keyList = (key as keyof typeof props).split('.')\n    let value: string | Record<string, any> = props\n    keyList.forEach((k) => {\n      value = (value as Record<string, any>)[k]\n    })\n    return value\n  } else {\n    return (props as any)[key] as boolean | string\n  }\n}\n"],"mappings":";;;;;;AAQA,MAAMA,eAAkB;EACtBC,MAAQ;EACRC,gBAAkB;EAClBC,qBAAuB;EACvBC,MAAQ;EACRC,IAAM;EACN,CAAC,uBAA0B;IACzBC,GAAK;IACLC,OAAS;EAAA,CACX;EACA,CAAC,oBAAuB;IACtBD,GAAK;IACLC,OAAS;EAAA,CACX;EACA,CAAC,yBAA4B;IAC3BD,GAAK;IACLC,OAAS;EAAA;AAEb;AAEgB,SAAAC,YACdC,KAAA,EACAC,KACA;EACA,IAAI,CAACD,KAAO;IACJ,UAAIE,KAAA,CAAM,oBAAoB;EAAA;EAGtC,MAAMC,KAAA,GAAQC,QAAY;EAG1BD,KAAA,CAAME,kBAAqB,GAAAC,QAAA,CAASH,KAAM,CAAAI,mBAAA,EAAqB,EAAE;EACjEC,MAAA,CAAOC,IAAK,CAAAlB,eAAe,CAAE,CAAAmB,OAAA,CAASb,GAAQ;IAC5Cc,WAAA,CAAYC,eAAgB,CAAAX,KAAA,EAAOJ,GAAG,GAAGA,GAAA,EAAKM,KAAK;EAAA,CACpD;EACDU,eAAA,CAAgBV,KAAA,EAAOF,KAAK;EACrB,OAAAE,KAAA;AACT;AAEA,SAASU,gBACPV,KAAA,EACAF,KACA;EACAO,MAAA,CAAOC,IAAK,CAAAlB,eAAe,CAAE,CAAAmB,OAAA,CAASb,GAAQ;IAC5CiB,KAAA,CACE,MAAMF,eAAgB,CAAAX,KAAA,EAAOJ,GAAG,GAC/BkB,KAAU;MACGJ,WAAA,CAAAI,KAAA,EAAOlB,GAAA,EAAKM,KAAK;IAAA,CAC/B,CACF;EAAA,CACD;AACH;AAEA,SAASQ,YACPI,KACA,EAAAC,QAAA,EACAb,KACA;EACA,IAAIc,MAAS,GAAAF,KAAA;EACb,IAAIG,QAAA,GAAW3B,eAAgB,CAAAyB,QAAA;EAC3B,IAAAG,QAAA,CAASD,QAAQ,CAAG;IACtBD,MAAA,GAASA,MAAA,IAAUC,QAAS,CAAApB,OAAA;IAC5BoB,QAAA,GAAWA,QAAS,CAAArB,GAAA;EAAA;EAEnBM,KAAA,CAAMiB,MAAe,CAAAF,QAAA,EAAkBH,KAAQ,GAAAE,MAAA;AACpD;AAEA,SAASL,gBACPX,KAAA,EACAJ,GACA;EACK,IAAAA,GAAA,CAA2BwB,QAAS,IAAG,CAAG;IACvC,MAAAC,OAAA,GAAWzB,GAA2B,CAAA0B,KAAA,CAAM,GAAG;IACrD,IAAIR,KAAsC,GAAAd,KAAA;IAClCqB,OAAA,CAAAZ,OAAA,CAASc,CAAM;MACrBT,KAAA,GAASA,KAA8B,CAAAS,CAAA;IAAA,CACxC;IACM,OAAAT,KAAA;EAAA,CACF;IACL,OAAQd,KAAc,CAAAJ,GAAA;EAAA;AAE1B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}