{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, watch, provide, computed } from 'vue';\nimport { collapseContextKey } from './constants.mjs';\nimport { castArray } from 'lodash-unified';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { UPDATE_MODEL_EVENT, CHANGE_EVENT } from '../../../constants/event.mjs';\nimport { isPromise } from '@vue/shared';\nimport { isBoolean } from '../../../utils/types.mjs';\nimport { throwError, debugWarn } from '../../../utils/error.mjs';\nconst SCOPE = \"ElCollapse\";\nconst useCollapse = (props, emit) => {\n  const activeNames = ref(castArray(props.modelValue));\n  const setActiveNames = _activeNames => {\n    activeNames.value = _activeNames;\n    const value = props.accordion ? activeNames.value[0] : activeNames.value;\n    emit(UPDATE_MODEL_EVENT, value);\n    emit(CHANGE_EVENT, value);\n  };\n  const handleChange = name => {\n    if (props.accordion) {\n      setActiveNames([activeNames.value[0] === name ? \"\" : name]);\n    } else {\n      const _activeNames = [...activeNames.value];\n      const index = _activeNames.indexOf(name);\n      if (index > -1) {\n        _activeNames.splice(index, 1);\n      } else {\n        _activeNames.push(name);\n      }\n      setActiveNames(_activeNames);\n    }\n  };\n  const handleItemClick = async name => {\n    const {\n      beforeCollapse\n    } = props;\n    if (!beforeCollapse) {\n      handleChange(name);\n      return;\n    }\n    const shouldChange = beforeCollapse(name);\n    const isPromiseOrBool = [isPromise(shouldChange), isBoolean(shouldChange)].includes(true);\n    if (!isPromiseOrBool) {\n      throwError(SCOPE, \"beforeCollapse must return type `Promise<boolean>` or `boolean`\");\n    }\n    if (isPromise(shouldChange)) {\n      shouldChange.then(result => {\n        if (result !== false) {\n          handleChange(name);\n        }\n      }).catch(e => {\n        debugWarn(SCOPE, `some error occurred: ${e}`);\n      });\n    } else if (shouldChange) {\n      handleChange(name);\n    }\n  };\n  watch(() => props.modelValue, () => activeNames.value = castArray(props.modelValue), {\n    deep: true\n  });\n  provide(collapseContextKey, {\n    activeNames,\n    handleItemClick\n  });\n  return {\n    activeNames,\n    setActiveNames\n  };\n};\nconst useCollapseDOM = props => {\n  const ns = useNamespace(\"collapse\");\n  const rootKls = computed(() => [ns.b(), ns.b(`icon-position-${props.expandIconPosition}`)]);\n  return {\n    rootKls\n  };\n};\nexport { useCollapse, useCollapseDOM };","map":{"version":3,"names":["SCOPE","useCollapse","props","emit","activeNames","ref","castArray","modelValue","setActiveNames","_activeNames","value","accordion","UPDATE_MODEL_EVENT","CHANGE_EVENT","handleChange","name","index","indexOf","splice","push","handleItemClick","beforeCollapse","shouldChange","isPromiseOrBool","isPromise","isBoolean","includes","throwError","then","result","catch","e","debugWarn","watch","deep","provide","collapseContextKey","useCollapseDOM","ns","useNamespace","rootKls","computed","b","expandIconPosition"],"sources":["../../../../../../packages/components/collapse/src/use-collapse.ts"],"sourcesContent":["import { computed, provide, ref, watch } from 'vue'\nimport {\n  debugWarn,\n  ensureArray,\n  isBoolean,\n  isPromise,\n  throwError,\n} from '@element-plus/utils'\nimport { useNamespace } from '@element-plus/hooks'\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { collapseContextKey } from './constants'\n\nimport type { SetupContext } from 'vue'\nimport type {\n  CollapseActiveName,\n  CollapseEmits,\n  CollapseProps,\n} from './collapse'\n\nconst SCOPE = 'ElCollapse'\nexport const useCollapse = (\n  props: CollapseProps,\n  emit: SetupContext<CollapseEmits>['emit']\n) => {\n  const activeNames = ref(ensureArray(props.modelValue))\n\n  const setActiveNames = (_activeNames: CollapseActiveName[]) => {\n    activeNames.value = _activeNames\n    const value = props.accordion ? activeNames.value[0] : activeNames.value\n    emit(UPDATE_MODEL_EVENT, value)\n    emit(CHANGE_EVENT, value)\n  }\n\n  const handleChange = (name: CollapseActiveName) => {\n    if (props.accordion) {\n      setActiveNames([activeNames.value[0] === name ? '' : name])\n    } else {\n      const _activeNames = [...activeNames.value]\n      const index = _activeNames.indexOf(name)\n\n      if (index > -1) {\n        _activeNames.splice(index, 1)\n      } else {\n        _activeNames.push(name)\n      }\n      setActiveNames(_activeNames)\n    }\n  }\n\n  const handleItemClick = async (name: CollapseActiveName) => {\n    const { beforeCollapse } = props\n    if (!beforeCollapse) {\n      handleChange(name)\n      return\n    }\n\n    const shouldChange = beforeCollapse(name)\n    const isPromiseOrBool = [\n      isPromise(shouldChange),\n      isBoolean(shouldChange),\n    ].includes(true)\n    if (!isPromiseOrBool) {\n      throwError(\n        SCOPE,\n        'beforeCollapse must return type `Promise<boolean>` or `boolean`'\n      )\n    }\n\n    if (isPromise(shouldChange)) {\n      shouldChange\n        .then((result) => {\n          if (result !== false) {\n            handleChange(name)\n          }\n        })\n        .catch((e) => {\n          debugWarn(SCOPE, `some error occurred: ${e}`)\n        })\n    } else if (shouldChange) {\n      handleChange(name)\n    }\n  }\n\n  watch(\n    () => props.modelValue,\n    () => (activeNames.value = ensureArray(props.modelValue)),\n    { deep: true }\n  )\n\n  provide(collapseContextKey, {\n    activeNames,\n    handleItemClick,\n  })\n  return {\n    activeNames,\n    setActiveNames,\n  }\n}\n\nexport const useCollapseDOM = (props: CollapseProps) => {\n  const ns = useNamespace('collapse')\n\n  const rootKls = computed(() => [\n    ns.b(),\n    ns.b(`icon-position-${props.expandIconPosition}`),\n  ])\n\n  return {\n    rootKls,\n  }\n}\n"],"mappings":";;;;;;;;;AAmBA,MAAMA,KAAQ;AACD,MAAAC,WAAA,GAAcA,CACzBC,KAAA,EACAC,IACG;EACH,MAAMC,WAAc,GAAAC,GAAA,CAAIC,SAAY,CAAAJ,KAAA,CAAMK,UAAU,CAAC;EAE/C,MAAAC,cAAA,GAAkBC,YAAuC;IAC7DL,WAAA,CAAYM,KAAQ,GAAAD,YAAA;IACpB,MAAMC,KAAA,GAAQR,KAAM,CAAAS,SAAA,GAAYP,WAAY,CAAAM,KAAA,CAAM,KAAKN,WAAY,CAAAM,KAAA;IACnEP,IAAA,CAAKS,kBAAA,EAAoBF,KAAK;IAC9BP,IAAA,CAAKU,YAAA,EAAcH,KAAK;EAAA,CAC1B;EAEM,MAAAI,YAAA,GAAgBC,IAA6B;IACjD,IAAIb,KAAA,CAAMS,SAAW;MACnBH,cAAA,CAAe,CAACJ,WAAY,CAAAM,KAAA,CAAM,OAAOK,IAAO,QAAKA,IAAI,CAAC;IAAA,CACrD;MACL,MAAMN,YAAe,IAAC,GAAGL,WAAA,CAAYM,KAAK;MACpC,MAAAM,KAAA,GAAQP,YAAa,CAAAQ,OAAA,CAAQF,IAAI;MAEvC,IAAIC,KAAA,GAAQ,CAAI;QACDP,YAAA,CAAAS,MAAA,CAAOF,KAAA,EAAO,CAAC;MAAA,CACvB;QACLP,YAAA,CAAaU,IAAA,CAAKJ,IAAI;MAAA;MAExBP,cAAA,CAAeC,YAAY;IAAA;EAC7B,CACF;EAEM,MAAAW,eAAA,GAAkB,MAAOL,IAA6B;IACpD;MAAEM;IAAA,CAAmB,GAAAnB,KAAA;IAC3B,IAAI,CAACmB,cAAgB;MACnBP,YAAA,CAAaC,IAAI;MACjB;IAAA;IAGI,MAAAO,YAAA,GAAeD,cAAA,CAAeN,IAAI;IACxC,MAAMQ,eAAkB,IACtBC,SAAA,CAAUF,YAAY,GACtBG,SAAA,CAAUH,YAAY,EACxB,CAAEI,QAAA,CAAS,IAAI;IACf,IAAI,CAACH,eAAiB;MACpBI,UAAA,CACE3B,KAAA,EACA,kEACF;IAAA;IAGE,IAAAwB,SAAA,CAAUF,YAAY,CAAG;MAExBA,YAAA,CAAAM,IAAA,CAAMC,MAAW;QAChB,IAAIA,MAAA,KAAW,KAAO;UACpBf,YAAA,CAAaC,IAAI;QAAA;MACnB,CACD,EACAe,KAAM,CAACC,CAAM;QACFC,SAAA,CAAAhC,KAAA,EAAO,wBAAwB+B,CAAG;MAAA,CAC7C;IAAA,WACMT,YAAc;MACvBR,YAAA,CAAaC,IAAI;IAAA;EACnB,CACF;EAEAkB,KAAA,CACE,MAAM/B,KAAM,CAAAK,UAAA,EACZ,MAAOH,WAAA,CAAYM,KAAQ,GAAAJ,SAAA,CAAYJ,KAAA,CAAMK,UAAU,GACvD;IAAE2B,IAAA,EAAM;EAAK,EACf;EAEAC,OAAA,CAAQC,kBAAoB;IAC1BhC,WAAA;IACAgB;EAAA,CACD;EACM;IACLhB,WAAA;IACAI;EAAA,CACF;AACF;AAEa,MAAA6B,cAAA,GAAkBnC,KAAyB;EAChD,MAAAoC,EAAA,GAAKC,YAAA,CAAa,UAAU;EAE5B,MAAAC,OAAA,GAAUC,QAAA,CAAS,MAAM,CAC7BH,EAAA,CAAGI,CAAE,IACLJ,EAAG,CAAAI,CAAA,CAAE,iBAAiBxC,KAAA,CAAMyC,kBAAoB,IACjD;EAEM;IACLH;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}