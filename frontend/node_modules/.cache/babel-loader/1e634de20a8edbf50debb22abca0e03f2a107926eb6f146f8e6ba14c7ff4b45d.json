{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { defineComponent, computed, ref, openBlock, createElementBlock, normalizeClass, unref, createVNode, mergeProps, createSlots, renderList, withCtx, renderSlot, normalizeProps, guardReactiveProps, createElementVNode, normalizeStyle, withModifiers, nextTick } from 'vue';\nimport { pick } from 'lodash-unified';\nimport { ElInput } from '../../input/index.mjs';\nimport { ElTooltip } from '../../tooltip/index.mjs';\nimport { mentionProps, mentionEmits, mentionDefaultProps } from './mention.mjs';\nimport { getCursorPosition, getMentionCtx } from './helper.mjs';\nimport ElMentionDropdown from './mention-dropdown.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { inputProps } from '../../input/src/input2.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { useFormDisabled } from '../../form/src/hooks/use-form-common-props.mjs';\nimport { useId } from '../../../hooks/use-id/index.mjs';\nimport { useFocusController } from '../../../hooks/use-focus-controller/index.mjs';\nimport { UPDATE_MODEL_EVENT, INPUT_EVENT } from '../../../constants/event.mjs';\nimport { getEventCode } from '../../../utils/dom/event.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { isFunction } from '@vue/shared';\nconst _sfc_main = defineComponent({\n  ...{\n    name: \"ElMention\",\n    inheritAttrs: false\n  },\n  __name: \"mention\",\n  props: mentionProps,\n  emits: mentionEmits,\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    const props = __props;\n    const emit = __emit;\n    const passInputProps = computed(() => pick(props, Object.keys(inputProps)));\n    const ns = useNamespace(\"mention\");\n    const disabled = useFormDisabled();\n    const contentId = useId();\n    const elInputRef = ref();\n    const tooltipRef = ref();\n    const dropdownRef = ref();\n    const visible = ref(false);\n    const cursorStyle = ref();\n    const mentionCtx = ref();\n    const computedPlacement = computed(() => props.showArrow ? props.placement : `${props.placement}-start`);\n    const computedFallbackPlacements = computed(() => props.showArrow ? [\"bottom\", \"top\"] : [\"bottom-start\", \"top-start\"]);\n    const aliasProps = computed(() => ({\n      ...mentionDefaultProps,\n      ...props.props\n    }));\n    const mapOption = option => {\n      const base = {\n        label: option[aliasProps.value.label],\n        value: option[aliasProps.value.value],\n        disabled: option[aliasProps.value.disabled]\n      };\n      return {\n        ...option,\n        ...base\n      };\n    };\n    const options = computed(() => props.options.map(mapOption));\n    const filteredOptions = computed(() => {\n      const {\n        filterOption\n      } = props;\n      if (!mentionCtx.value || !filterOption) return options.value;\n      return options.value.filter(option => filterOption(mentionCtx.value.pattern, option));\n    });\n    const dropdownVisible = computed(() => {\n      return visible.value && (!!filteredOptions.value.length || props.loading);\n    });\n    const hoveringId = computed(() => {\n      var _a;\n      return `${contentId.value}-${(_a = dropdownRef.value) == null ? void 0 : _a.hoveringIndex}`;\n    });\n    const handleInputChange = value => {\n      emit(UPDATE_MODEL_EVENT, value);\n      emit(INPUT_EVENT, value);\n      syncAfterCursorMove();\n    };\n    const handleInputKeyDown = event => {\n      var _a, _b, _c, _d;\n      if ((_a = elInputRef.value) == null ? void 0 : _a.isComposing) return;\n      const code = getEventCode(event);\n      switch (code) {\n        case EVENT_CODE.left:\n        case EVENT_CODE.right:\n          syncAfterCursorMove();\n          break;\n        case EVENT_CODE.up:\n        case EVENT_CODE.down:\n          if (!visible.value) return;\n          event.preventDefault();\n          (_b = dropdownRef.value) == null ? void 0 : _b.navigateOptions(code === EVENT_CODE.up ? \"prev\" : \"next\");\n          break;\n        case EVENT_CODE.enter:\n        case EVENT_CODE.numpadEnter:\n          if (!visible.value) {\n            props.type !== \"textarea\" && syncAfterCursorMove();\n            return;\n          }\n          event.preventDefault();\n          if ((_c = dropdownRef.value) == null ? void 0 : _c.hoverOption) {\n            (_d = dropdownRef.value) == null ? void 0 : _d.selectHoverOption();\n          } else {\n            visible.value = false;\n          }\n          break;\n        case EVENT_CODE.esc:\n          if (!visible.value) return;\n          event.preventDefault();\n          visible.value = false;\n          break;\n        case EVENT_CODE.backspace:\n          if (props.whole && mentionCtx.value) {\n            const {\n              splitIndex,\n              selectionEnd,\n              pattern,\n              prefixIndex,\n              prefix\n            } = mentionCtx.value;\n            const inputEl = getInputEl();\n            if (!inputEl) return;\n            const inputValue = inputEl.value;\n            const matchOption = options.value.find(item => item.value === pattern);\n            const isWhole = isFunction(props.checkIsWhole) ? props.checkIsWhole(pattern, prefix) : matchOption;\n            if (isWhole && splitIndex !== -1 && splitIndex + 1 === selectionEnd) {\n              event.preventDefault();\n              const newValue = inputValue.slice(0, prefixIndex) + inputValue.slice(splitIndex + 1);\n              emit(UPDATE_MODEL_EVENT, newValue);\n              emit(INPUT_EVENT, newValue);\n              emit(\"whole-remove\", pattern, prefix);\n              const newSelectionEnd = prefixIndex;\n              nextTick(() => {\n                inputEl.selectionStart = newSelectionEnd;\n                inputEl.selectionEnd = newSelectionEnd;\n                syncDropdownVisible();\n              });\n            }\n          }\n      }\n    };\n    const {\n      wrapperRef\n    } = useFocusController(elInputRef, {\n      disabled,\n      afterFocus() {\n        syncAfterCursorMove();\n      },\n      beforeBlur(event) {\n        var _a;\n        return (_a = tooltipRef.value) == null ? void 0 : _a.isFocusInsideContent(event);\n      },\n      afterBlur() {\n        visible.value = false;\n      }\n    });\n    const handleInputMouseDown = () => {\n      syncAfterCursorMove();\n    };\n    const getOriginalOption = mentionOption => {\n      return props.options.find(option => {\n        return mentionOption.value === option[aliasProps.value.value];\n      });\n    };\n    const handleSelect = item => {\n      if (!mentionCtx.value) return;\n      const inputEl = getInputEl();\n      if (!inputEl) return;\n      const inputValue = inputEl.value;\n      const {\n        split\n      } = props;\n      const newEndPart = inputValue.slice(mentionCtx.value.end);\n      const alreadySeparated = newEndPart.startsWith(split);\n      const newMiddlePart = `${item.value}${alreadySeparated ? \"\" : split}`;\n      const newValue = inputValue.slice(0, mentionCtx.value.start) + newMiddlePart + newEndPart;\n      emit(UPDATE_MODEL_EVENT, newValue);\n      emit(INPUT_EVENT, newValue);\n      emit(\"select\", getOriginalOption(item), mentionCtx.value.prefix);\n      const newSelectionEnd = mentionCtx.value.start + newMiddlePart.length + (alreadySeparated ? 1 : 0);\n      nextTick(() => {\n        inputEl.selectionStart = newSelectionEnd;\n        inputEl.selectionEnd = newSelectionEnd;\n        inputEl.focus();\n        syncDropdownVisible();\n      });\n    };\n    const getInputEl = () => {\n      var _a, _b;\n      return props.type === \"textarea\" ? (_a = elInputRef.value) == null ? void 0 : _a.textarea : (_b = elInputRef.value) == null ? void 0 : _b.input;\n    };\n    const syncAfterCursorMove = () => {\n      setTimeout(() => {\n        syncCursor();\n        syncDropdownVisible();\n        nextTick(() => {\n          var _a;\n          return (_a = tooltipRef.value) == null ? void 0 : _a.updatePopper();\n        });\n      }, 0);\n    };\n    const syncCursor = () => {\n      const inputEl = getInputEl();\n      if (!inputEl) return;\n      const caretPosition = getCursorPosition(inputEl);\n      const inputRect = inputEl.getBoundingClientRect();\n      const wrapperRect = wrapperRef.value.getBoundingClientRect();\n      cursorStyle.value = {\n        position: \"absolute\",\n        width: 0,\n        height: `${caretPosition.height}px`,\n        left: `${caretPosition.left + inputRect.left - wrapperRect.left}px`,\n        top: `${caretPosition.top + inputRect.top - wrapperRect.top}px`\n      };\n    };\n    const syncDropdownVisible = () => {\n      const inputEl = getInputEl();\n      if (document.activeElement !== inputEl) {\n        visible.value = false;\n        return;\n      }\n      const {\n        prefix,\n        split\n      } = props;\n      mentionCtx.value = getMentionCtx(inputEl, prefix, split);\n      if (mentionCtx.value && mentionCtx.value.splitIndex === -1) {\n        visible.value = true;\n        emit(\"search\", mentionCtx.value.pattern, mentionCtx.value.prefix);\n        return;\n      }\n      visible.value = false;\n    };\n    __expose({\n      input: elInputRef,\n      tooltip: tooltipRef,\n      dropdownVisible\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", {\n        ref_key: \"wrapperRef\",\n        ref: wrapperRef,\n        class: normalizeClass(unref(ns).b())\n      }, [createVNode(unref(ElInput), mergeProps(mergeProps(passInputProps.value, _ctx.$attrs), {\n        ref_key: \"elInputRef\",\n        ref: elInputRef,\n        \"model-value\": _ctx.modelValue,\n        disabled: unref(disabled),\n        role: dropdownVisible.value ? \"combobox\" : void 0,\n        \"aria-activedescendant\": dropdownVisible.value ? hoveringId.value || \"\" : void 0,\n        \"aria-controls\": dropdownVisible.value ? unref(contentId) : void 0,\n        \"aria-expanded\": dropdownVisible.value || void 0,\n        \"aria-label\": _ctx.ariaLabel,\n        \"aria-autocomplete\": dropdownVisible.value ? \"none\" : void 0,\n        \"aria-haspopup\": dropdownVisible.value ? \"listbox\" : void 0,\n        onInput: handleInputChange,\n        onKeydown: handleInputKeyDown,\n        onMousedown: handleInputMouseDown\n      }), createSlots({\n        _: 2\n      }, [renderList(_ctx.$slots, (_, name) => {\n        return {\n          name,\n          fn: withCtx(slotProps => [renderSlot(_ctx.$slots, name, normalizeProps(guardReactiveProps(slotProps)))])\n        };\n      })]), 1040, [\"model-value\", \"disabled\", \"role\", \"aria-activedescendant\", \"aria-controls\", \"aria-expanded\", \"aria-label\", \"aria-autocomplete\", \"aria-haspopup\"]), createVNode(unref(ElTooltip), {\n        ref_key: \"tooltipRef\",\n        ref: tooltipRef,\n        visible: dropdownVisible.value,\n        \"popper-class\": [unref(ns).e(\"popper\"), _ctx.popperClass],\n        \"popper-style\": _ctx.popperStyle,\n        \"popper-options\": _ctx.popperOptions,\n        placement: computedPlacement.value,\n        \"fallback-placements\": computedFallbackPlacements.value,\n        effect: \"light\",\n        pure: \"\",\n        offset: _ctx.offset,\n        \"show-arrow\": _ctx.showArrow\n      }, {\n        default: withCtx(() => [createElementVNode(\"div\", {\n          style: normalizeStyle(cursorStyle.value)\n        }, null, 4)]),\n        content: withCtx(() => [createVNode(ElMentionDropdown, {\n          ref_key: \"dropdownRef\",\n          ref: dropdownRef,\n          options: filteredOptions.value,\n          disabled: unref(disabled),\n          loading: _ctx.loading,\n          \"content-id\": unref(contentId),\n          \"aria-label\": _ctx.ariaLabel,\n          onSelect: handleSelect,\n          onClick: _cache[0] || (_cache[0] = withModifiers($event => {\n            var _a;\n            return (_a = elInputRef.value) == null ? void 0 : _a.focus();\n          }, [\"stop\"]))\n        }, createSlots({\n          _: 2\n        }, [renderList(_ctx.$slots, (_, name) => {\n          return {\n            name,\n            fn: withCtx(slotProps => [renderSlot(_ctx.$slots, name, normalizeProps(guardReactiveProps(slotProps)))])\n          };\n        })]), 1032, [\"options\", \"disabled\", \"loading\", \"content-id\", \"aria-label\"])]),\n        _: 3\n      }, 8, [\"visible\", \"popper-class\", \"popper-style\", \"popper-options\", \"placement\", \"fallback-placements\", \"offset\", \"show-arrow\"])], 2);\n    };\n  }\n});\nvar Mention = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/mention/src/mention.vue\"]]);\nexport { Mention as default };","map":{"version":3,"names":["props","__props","emit","__emit","passInputProps","computed","pick","Object","keys","inputProps","ns","useNamespace","disabled","useFormDisabled","contentId","useId","elInputRef","ref","tooltipRef","dropdownRef","visible","cursorStyle","mentionCtx","computedPlacement","showArrow","placement","computedFallbackPlacements","aliasProps","mentionDefaultProps","mapOption","option","base","label","value","options","map","filteredOptions","filterOption","filter","pattern","dropdownVisible","length","loading","hoveringId","_a","hoveringIndex","handleInputChange","UPDATE_MODEL_EVENT","INPUT_EVENT","syncAfterCursorMove","handleInputKeyDown","event","isComposing","code","getEventCode","EVENT_CODE","left","right","up","down","preventDefault","_b","navigateOptions","enter","numpadEnter","type","_c","hoverOption","_d","selectHoverOption","esc","backspace","whole","splitIndex","selectionEnd","prefixIndex","prefix","inputEl","getInputEl","inputValue","matchOption","find","item","isWhole","isFunction","checkIsWhole","newValue","slice","newSelectionEnd","nextTick","selectionStart","syncDropdownVisible","wrapperRef","useFocusController","afterFocus","beforeBlur","isFocusInsideContent","afterBlur","handleInputMouseDown","getOriginalOption","mentionOption","handleSelect","split","newEndPart","end","alreadySeparated","startsWith","newMiddlePart","start","focus","textarea","input","setTimeout","syncCursor","updatePopper","caretPosition","getCursorPosition","inputRect","getBoundingClientRect","wrapperRect","position","width","height","top","document","activeElement","getMentionCtx","__expose","tooltip","openBlock","createElementBlock","ref_key","class","normalizeClass","unref","b","createVNode","ElInput","mergeProps","_ctx","$attrs","modelValue","role","ariaLabel","onInput","onKeydown","onMousedown","createSlots","_","$slots","name","fn","withCtx","slotProps","renderSlot","normalizeProps","guardReactiveProps","ElTooltip","e","popperClass","popperStyle","popperOptions","effect","pure","offset","default","createElementVNode","style","normalizeStyle","content","ElMentionDropdown","onSelect","onClick","_cache","withModifiers","$event"],"sources":["../../../../../../packages/components/mention/src/mention.vue"],"sourcesContent":["<template>\n  <div ref=\"wrapperRef\" :class=\"ns.b()\">\n    <el-input\n      v-bind=\"mergeProps(passInputProps, $attrs)\"\n      ref=\"elInputRef\"\n      :model-value=\"modelValue\"\n      :disabled=\"disabled\"\n      :role=\"dropdownVisible ? 'combobox' : undefined\"\n      :aria-activedescendant=\"dropdownVisible ? hoveringId || '' : undefined\"\n      :aria-controls=\"dropdownVisible ? contentId : undefined\"\n      :aria-expanded=\"dropdownVisible || undefined\"\n      :aria-label=\"ariaLabel\"\n      :aria-autocomplete=\"dropdownVisible ? 'none' : undefined\"\n      :aria-haspopup=\"dropdownVisible ? 'listbox' : undefined\"\n      @input=\"handleInputChange\"\n      @keydown=\"handleInputKeyDown\"\n      @mousedown=\"handleInputMouseDown\"\n    >\n      <template v-for=\"(_, name) in $slots\" #[name]=\"slotProps\">\n        <slot :name=\"name\" v-bind=\"slotProps\" />\n      </template>\n    </el-input>\n    <el-tooltip\n      ref=\"tooltipRef\"\n      :visible=\"dropdownVisible\"\n      :popper-class=\"[ns.e('popper'), popperClass!]\"\n      :popper-style=\"popperStyle\"\n      :popper-options=\"popperOptions\"\n      :placement=\"computedPlacement\"\n      :fallback-placements=\"computedFallbackPlacements\"\n      effect=\"light\"\n      pure\n      :offset=\"offset\"\n      :show-arrow=\"showArrow\"\n    >\n      <template #default>\n        <div :style=\"cursorStyle\" />\n      </template>\n      <template #content>\n        <el-mention-dropdown\n          ref=\"dropdownRef\"\n          :options=\"filteredOptions\"\n          :disabled=\"disabled\"\n          :loading=\"loading\"\n          :content-id=\"contentId\"\n          :aria-label=\"ariaLabel\"\n          @select=\"handleSelect\"\n          @click.stop=\"elInputRef?.focus()\"\n        >\n          <template v-for=\"(_, name) in $slots\" #[name]=\"slotProps\">\n            <slot :name=\"name\" v-bind=\"slotProps\" />\n          </template>\n        </el-mention-dropdown>\n      </template>\n    </el-tooltip>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, mergeProps, nextTick, ref } from 'vue'\nimport { pick } from 'lodash-unified'\nimport { useFocusController, useId, useNamespace } from '@element-plus/hooks'\nimport ElInput, { inputProps } from '@element-plus/components/input'\nimport ElTooltip from '@element-plus/components/tooltip'\nimport {\n  EVENT_CODE,\n  INPUT_EVENT,\n  UPDATE_MODEL_EVENT,\n} from '@element-plus/constants'\nimport { useFormDisabled } from '@element-plus/components/form'\nimport { getEventCode, isFunction } from '@element-plus/utils'\nimport { mentionDefaultProps, mentionEmits, mentionProps } from './mention'\nimport { getCursorPosition, getMentionCtx } from './helper'\nimport ElMentionDropdown from './mention-dropdown.vue'\n\nimport type { Placement } from '@popperjs/core'\nimport type { CSSProperties } from 'vue'\nimport type { InputInstance } from '@element-plus/components/input'\nimport type { TooltipInstance } from '@element-plus/components/tooltip'\nimport type { MentionCtx, MentionOption } from './types'\n\ndefineOptions({\n  name: 'ElMention',\n  inheritAttrs: false,\n})\n\nconst props = defineProps(mentionProps)\nconst emit = defineEmits(mentionEmits)\n\nconst passInputProps = computed(() => pick(props, Object.keys(inputProps)))\n\nconst ns = useNamespace('mention')\nconst disabled = useFormDisabled()\nconst contentId = useId()\n\nconst elInputRef = ref<InputInstance>()\nconst tooltipRef = ref<TooltipInstance>()\nconst dropdownRef = ref<InstanceType<typeof ElMentionDropdown>>()\n\nconst visible = ref(false)\nconst cursorStyle = ref<CSSProperties>()\nconst mentionCtx = ref<MentionCtx>()\n\nconst computedPlacement = computed<Placement>(() =>\n  props.showArrow ? props.placement : `${props.placement}-start`\n)\n\nconst computedFallbackPlacements = computed<Placement[]>(() =>\n  props.showArrow ? ['bottom', 'top'] : ['bottom-start', 'top-start']\n)\n\nconst aliasProps = computed(() => ({\n  ...mentionDefaultProps,\n  ...props.props,\n}))\n\nconst mapOption = (option: MentionOption) => {\n  const base = {\n    label: option[aliasProps.value.label],\n    value: option[aliasProps.value.value],\n    disabled: option[aliasProps.value.disabled],\n  }\n  return { ...option, ...base }\n}\n\nconst options = computed(() => props.options.map(mapOption))\n\nconst filteredOptions = computed(() => {\n  const { filterOption } = props\n  if (!mentionCtx.value || !filterOption) return options.value\n  return options.value.filter((option) =>\n    filterOption(mentionCtx.value!.pattern, option)\n  )\n})\n\nconst dropdownVisible = computed(() => {\n  return visible.value && (!!filteredOptions.value.length || props.loading)\n})\n\nconst hoveringId = computed(() => {\n  return `${contentId.value}-${dropdownRef.value?.hoveringIndex}`\n})\n\nconst handleInputChange = (value: string) => {\n  emit(UPDATE_MODEL_EVENT, value)\n  emit(INPUT_EVENT, value)\n  syncAfterCursorMove()\n}\n\nconst handleInputKeyDown = (event: KeyboardEvent | Event) => {\n  if (elInputRef.value?.isComposing) return\n  const code = getEventCode(event as KeyboardEvent)\n\n  switch (code) {\n    case EVENT_CODE.left:\n    case EVENT_CODE.right:\n      syncAfterCursorMove()\n      break\n    case EVENT_CODE.up:\n    case EVENT_CODE.down:\n      if (!visible.value) return\n      event.preventDefault()\n      dropdownRef.value?.navigateOptions(\n        code === EVENT_CODE.up ? 'prev' : 'next'\n      )\n      break\n    case EVENT_CODE.enter:\n    case EVENT_CODE.numpadEnter:\n      if (!visible.value) {\n        props.type !== 'textarea' && syncAfterCursorMove()\n        return\n      }\n      event.preventDefault()\n      if (dropdownRef.value?.hoverOption) {\n        dropdownRef.value?.selectHoverOption()\n      } else {\n        visible.value = false\n      }\n      break\n    case EVENT_CODE.esc:\n      if (!visible.value) return\n      event.preventDefault()\n      visible.value = false\n      break\n    case EVENT_CODE.backspace:\n      if (props.whole && mentionCtx.value) {\n        const { splitIndex, selectionEnd, pattern, prefixIndex, prefix } =\n          mentionCtx.value\n        const inputEl = getInputEl()\n        if (!inputEl) return\n        const inputValue = inputEl.value\n        const matchOption = options.value.find((item) => item.value === pattern)\n        const isWhole = isFunction(props.checkIsWhole)\n          ? props.checkIsWhole(pattern, prefix)\n          : matchOption\n        if (isWhole && splitIndex !== -1 && splitIndex + 1 === selectionEnd) {\n          event.preventDefault()\n          const newValue =\n            inputValue.slice(0, prefixIndex) + inputValue.slice(splitIndex + 1)\n          emit(UPDATE_MODEL_EVENT, newValue)\n          emit(INPUT_EVENT, newValue)\n          emit('whole-remove', pattern, prefix)\n\n          const newSelectionEnd = prefixIndex\n          nextTick(() => {\n            // input value is updated\n            inputEl.selectionStart = newSelectionEnd\n            inputEl.selectionEnd = newSelectionEnd\n            syncDropdownVisible()\n          })\n        }\n      }\n  }\n}\n\nconst { wrapperRef } = useFocusController(elInputRef, {\n  disabled,\n  afterFocus() {\n    syncAfterCursorMove()\n  },\n  beforeBlur(event) {\n    return tooltipRef.value?.isFocusInsideContent(event)\n  },\n  afterBlur() {\n    visible.value = false\n  },\n})\n\nconst handleInputMouseDown = () => {\n  syncAfterCursorMove()\n}\n\n// Ensure that the original option passed by users is returned\nconst getOriginalOption = (mentionOption: MentionOption) => {\n  return props.options.find((option: MentionOption) => {\n    return mentionOption.value === option[aliasProps.value.value]\n  })\n}\n\nconst handleSelect = (item: MentionOption) => {\n  if (!mentionCtx.value) return\n  const inputEl = getInputEl()\n  if (!inputEl) return\n  const inputValue = inputEl.value\n  const { split } = props\n\n  const newEndPart = inputValue.slice(mentionCtx.value.end)\n  const alreadySeparated = newEndPart.startsWith(split)\n  const newMiddlePart = `${item.value}${alreadySeparated ? '' : split}`\n\n  const newValue =\n    inputValue.slice(0, mentionCtx.value.start) + newMiddlePart + newEndPart\n\n  emit(UPDATE_MODEL_EVENT, newValue)\n  emit(INPUT_EVENT, newValue)\n  emit('select', getOriginalOption(item)!, mentionCtx.value.prefix)\n\n  const newSelectionEnd =\n    mentionCtx.value.start + newMiddlePart.length + (alreadySeparated ? 1 : 0)\n\n  nextTick(() => {\n    // input value is updated\n    inputEl.selectionStart = newSelectionEnd\n    inputEl.selectionEnd = newSelectionEnd\n    inputEl.focus()\n    syncDropdownVisible()\n  })\n}\n\nconst getInputEl = () =>\n  props.type === 'textarea'\n    ? elInputRef.value?.textarea\n    : elInputRef.value?.input\n\nconst syncAfterCursorMove = () => {\n  // can't use nextTick(), get cursor position will be wrong\n  setTimeout(() => {\n    syncCursor()\n    syncDropdownVisible()\n    nextTick(() => tooltipRef.value?.updatePopper())\n  }, 0)\n}\n\nconst syncCursor = () => {\n  const inputEl = getInputEl()\n  if (!inputEl) return\n\n  const caretPosition = getCursorPosition(inputEl)\n  const inputRect = inputEl.getBoundingClientRect()\n  const wrapperRect = wrapperRef.value!.getBoundingClientRect()\n\n  cursorStyle.value = {\n    position: 'absolute',\n    width: 0,\n    height: `${caretPosition.height}px`,\n    left: `${caretPosition.left + inputRect.left - wrapperRect.left}px`,\n    top: `${caretPosition.top + inputRect.top - wrapperRect.top}px`,\n  }\n}\n\nconst syncDropdownVisible = () => {\n  const inputEl = getInputEl()\n  if (document.activeElement !== inputEl) {\n    visible.value = false\n    return\n  }\n  const { prefix, split } = props\n  mentionCtx.value = getMentionCtx(inputEl, prefix, split)\n  if (mentionCtx.value && mentionCtx.value.splitIndex === -1) {\n    visible.value = true\n    emit('search', mentionCtx.value.pattern, mentionCtx.value.prefix)\n    return\n  }\n  visible.value = false\n}\n\ndefineExpose({\n  input: elInputRef,\n  tooltip: tooltipRef,\n  dropdownVisible,\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}