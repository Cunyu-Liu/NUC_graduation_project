{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { getCurrentInstance, ref } from 'vue';\nimport { getKeysMap, getRowIdentity, toggleRowStatus } from '../util.mjs';\nfunction useExpand(watcherData) {\n  const instance = getCurrentInstance();\n  const defaultExpandAll = ref(false);\n  const expandRows = ref([]);\n  const updateExpandRows = () => {\n    const data = watcherData.data.value || [];\n    const rowKey = watcherData.rowKey.value;\n    if (defaultExpandAll.value) {\n      expandRows.value = data.slice();\n    } else if (rowKey) {\n      const expandRowsMap = getKeysMap(expandRows.value, rowKey);\n      expandRows.value = data.reduce((prev, row) => {\n        const rowId = getRowIdentity(row, rowKey);\n        const rowInfo = expandRowsMap[rowId];\n        if (rowInfo) {\n          prev.push(row);\n        }\n        return prev;\n      }, []);\n    } else {\n      expandRows.value = [];\n    }\n  };\n  const toggleRowExpansion = (row, expanded) => {\n    const changed = toggleRowStatus(expandRows.value, row, expanded, void 0, void 0, void 0, watcherData.rowKey.value);\n    if (changed) {\n      instance.emit(\"expand-change\", row, expandRows.value.slice());\n    }\n  };\n  const setExpandRowKeys = rowKeys => {\n    instance.store.assertRowKey();\n    const data = watcherData.data.value || [];\n    const rowKey = watcherData.rowKey.value;\n    const keysMap = getKeysMap(data, rowKey);\n    expandRows.value = rowKeys.reduce((prev, cur) => {\n      const info = keysMap[cur];\n      if (info) {\n        prev.push(info.row);\n      }\n      return prev;\n    }, []);\n  };\n  const isRowExpanded = row => {\n    const rowKey = watcherData.rowKey.value;\n    if (rowKey) {\n      const expandMap = getKeysMap(expandRows.value, rowKey);\n      return !!expandMap[getRowIdentity(row, rowKey)];\n    }\n    return expandRows.value.includes(row);\n  };\n  return {\n    updateExpandRows,\n    toggleRowExpansion,\n    setExpandRowKeys,\n    isRowExpanded,\n    states: {\n      expandRows,\n      defaultExpandAll\n    }\n  };\n}\nexport { useExpand as default };","map":{"version":3,"names":["useExpand","watcherData","instance","getCurrentInstance","defaultExpandAll","ref","expandRows","updateExpandRows","data","value","rowKey","slice","expandRowsMap","getKeysMap","reduce","prev","row","rowId","getRowIdentity","rowInfo","push","toggleRowExpansion","expanded","changed","toggleRowStatus","emit","setExpandRowKeys","rowKeys","store","assertRowKey","keysMap","cur","info","isRowExpanded","expandMap","includes","states"],"sources":["../../../../../../../packages/components/table/src/store/expand.ts"],"sourcesContent":["import { getCurrentInstance, ref } from 'vue'\nimport { getKeysMap, getRowIdentity, toggleRowStatus } from '../util'\n\nimport type { Ref } from 'vue'\nimport type { WatcherPropsData } from '.'\nimport type { DefaultRow, Table } from '../table/defaults'\n\nfunction useExpand<T extends DefaultRow>(watcherData: WatcherPropsData<T>) {\n  const instance = getCurrentInstance() as Table<T>\n  const defaultExpandAll = ref(false)\n  const expandRows: Ref<T[]> = ref([])\n  const updateExpandRows = () => {\n    const data = watcherData.data.value || []\n    const rowKey = watcherData.rowKey.value\n    if (defaultExpandAll.value) {\n      expandRows.value = data.slice()\n    } else if (rowKey) {\n      // TODO：这里的代码可以优化\n      const expandRowsMap = getKeysMap(expandRows.value, rowKey)\n      expandRows.value = data.reduce((prev: T[], row: T) => {\n        const rowId = getRowIdentity(row, rowKey)\n        const rowInfo = expandRowsMap[rowId]\n        if (rowInfo) {\n          prev.push(row)\n        }\n        return prev\n      }, [])\n    } else {\n      expandRows.value = []\n    }\n  }\n\n  const toggleRowExpansion = (row: T, expanded?: boolean) => {\n    const changed = toggleRowStatus(\n      expandRows.value,\n      row,\n      expanded,\n      undefined,\n      undefined,\n      undefined,\n      watcherData.rowKey.value\n    )\n    if (changed) {\n      instance.emit('expand-change', row, expandRows.value.slice())\n    }\n  }\n\n  const setExpandRowKeys = (rowKeys: (string | number)[]) => {\n    instance.store.assertRowKey()\n    // TODO：这里的代码可以优化\n    const data = watcherData.data.value || []\n    const rowKey = watcherData.rowKey.value\n    const keysMap = getKeysMap(data, rowKey)\n    expandRows.value = rowKeys.reduce((prev: T[], cur) => {\n      const info = keysMap[cur]\n      if (info) {\n        prev.push(info.row)\n      }\n      return prev\n    }, [])\n  }\n\n  const isRowExpanded = (row: T): boolean => {\n    const rowKey = watcherData.rowKey.value\n    if (rowKey) {\n      const expandMap = getKeysMap(expandRows.value, rowKey)\n      return !!expandMap[getRowIdentity(row, rowKey)]\n    }\n    return expandRows.value.includes(row)\n  }\n  return {\n    updateExpandRows,\n    toggleRowExpansion,\n    setExpandRowKeys,\n    isRowExpanded,\n    states: {\n      expandRows,\n      defaultExpandAll,\n    },\n  }\n}\n\nexport default useExpand\n"],"mappings":";;;;;AAOA,SAASA,UAAgCC,WAAkC;EACzE,MAAMC,QAAA,GAAWC,kBAAmB;EAC9B,MAAAC,gBAAA,GAAmBC,GAAA,CAAI,KAAK;EAC5B,MAAAC,UAAA,GAAuBD,GAAI,GAAE;EACnC,MAAME,gBAAA,GAAmBA,CAAA,KAAM;IAC7B,MAAMC,IAAO,GAAAP,WAAA,CAAYO,IAAK,CAAAC,KAAA,IAAS,EAAC;IAClC,MAAAC,MAAA,GAAST,WAAA,CAAYS,MAAO,CAAAD,KAAA;IAClC,IAAIL,gBAAA,CAAiBK,KAAO;MACfH,UAAA,CAAAG,KAAA,GAAQD,IAAA,CAAKG,KAAM;IAAA,WACrBD,MAAQ;MAEjB,MAAME,aAAgB,GAAAC,UAAA,CAAWP,UAAW,CAAAG,KAAA,EAAOC,MAAM;MACzDJ,UAAA,CAAWG,KAAQ,GAAAD,IAAA,CAAKM,MAAO,EAACC,IAAA,EAAWC,GAAW;QAC9C,MAAAC,KAAA,GAAQC,cAAe,CAAAF,GAAA,EAAKN,MAAM;QACxC,MAAMS,OAAA,GAAUP,aAAc,CAAAK,KAAA;QAC9B,IAAIE,OAAS;UACXJ,IAAA,CAAKK,IAAA,CAAKJ,GAAG;QAAA;QAER,OAAAD,IAAA;MAAA,CACT,EAAG,EAAE;IAAA,CACA;MACLT,UAAA,CAAWG,KAAA,GAAQ,EAAC;IAAA;EACtB,CACF;EAEM,MAAAY,kBAAA,GAAqBA,CAACL,GAAA,EAAQM,QAAuB;IACzD,MAAMC,OAAU,GAAAC,eAAA,CACdlB,UAAW,CAAAG,KAAA,EACXO,GAAA,EACAM,QAAA,EACA,QACA,QACA,QACArB,WAAA,CAAYS,MAAO,CAAAD,KAAA,CACrB;IACA,IAAIc,OAAS;MACXrB,QAAA,CAASuB,IAAA,CAAK,eAAiB,EAAAT,GAAA,EAAKV,UAAW,CAAAG,KAAA,CAAME,KAAA,EAAO;IAAA;EAC9D,CACF;EAEM,MAAAe,gBAAA,GAAoBC,OAAiC;IACzDzB,QAAA,CAAS0B,KAAA,CAAMC,YAAa;IAE5B,MAAMrB,IAAO,GAAAP,WAAA,CAAYO,IAAK,CAAAC,KAAA,IAAS,EAAC;IAClC,MAAAC,MAAA,GAAST,WAAA,CAAYS,MAAO,CAAAD,KAAA;IAC5B,MAAAqB,OAAA,GAAUjB,UAAW,CAAAL,IAAA,EAAME,MAAM;IACvCJ,UAAA,CAAWG,KAAQ,GAAAkB,OAAA,CAAQb,MAAO,EAACC,IAAA,EAAWgB,GAAQ;MACpD,MAAMC,IAAA,GAAOF,OAAQ,CAAAC,GAAA;MACrB,IAAIC,IAAM;QACHjB,IAAA,CAAAK,IAAA,CAAKY,IAAA,CAAKhB,GAAG;MAAA;MAEb,OAAAD,IAAA;IAAA,CACT,EAAG,EAAE;EAAA,CACP;EAEM,MAAAkB,aAAA,GAAiBjB,GAAoB;IACnC,MAAAN,MAAA,GAAST,WAAA,CAAYS,MAAO,CAAAD,KAAA;IAClC,IAAIC,MAAQ;MACV,MAAMwB,SAAY,GAAArB,UAAA,CAAWP,UAAW,CAAAG,KAAA,EAAOC,MAAM;MACrD,OAAO,CAAC,CAACwB,SAAU,CAAAhB,cAAA,CAAeF,GAAA,EAAKN,MAAM;IAAA;IAExC,OAAAJ,UAAA,CAAWG,KAAM,CAAA0B,QAAA,CAASnB,GAAG;EAAA,CACtC;EACO;IACLT,gBAAA;IACAc,kBAAA;IACAK,gBAAA;IACAO,aAAA;IACAG,MAAQ;MACN9B,UAAA;MACAF;IAAA;EACF,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}