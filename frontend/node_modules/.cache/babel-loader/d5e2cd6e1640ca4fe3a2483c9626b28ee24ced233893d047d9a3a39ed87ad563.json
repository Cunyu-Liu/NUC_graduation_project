{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport { ref, computed, onMounted, nextTick, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { Plus, Fold, Expand, ChatLineRound, MoreFilled, Setting, Document, Delete, ChatDotRound, Cpu, Paperclip, Search, Globe, Promotion, Loading, Edit } from '@element-plus/icons-vue';\nimport api from '@/api';\nimport { marked } from 'marked';\nimport DOMPurify from 'dompurify';\nimport hljs from 'highlight.js';\n\n// é…ç½® marked\n\nexport default {\n  __name: 'KimiChat',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    marked.setOptions({\n      highlight: function (code, lang) {\n        if (lang && hljs.getLanguage(lang)) {\n          return hljs.highlight(code, {\n            language: lang\n          }).value;\n        }\n        return hljs.highlightAuto(code).value;\n      },\n      breaks: true,\n      gfm: true\n    });\n    const store = useStore();\n\n    // ==================== çŠ¶æ€ ====================\n    const sidebarCollapsed = ref(false);\n    const currentChatId = ref(null);\n    const chatHistory = ref([]);\n    const messages = ref([]);\n    const inputMessage = ref('');\n    const isTyping = ref(false);\n    const currentModel = ref('glm-4-plus');\n    const messagesContainer = ref(null);\n    const useRag = ref(true);\n    const useWebSearch = ref(false);\n    const selectedPapers = ref([]);\n    const uploadedFiles = ref([]); // å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨\n    const isUploading = ref(false); // ä¸Šä¼ ä¸­çŠ¶æ€\n\n    // è®ºæ–‡é€‰æ‹©\n    const showPaperSelector = ref(false);\n    const paperSearch = ref('');\n    const papers = ref([]);\n    const tempSelectedPapers = ref([]);\n    const paperTable = ref(null);\n\n    // è®¾ç½®\n    const showSettings = ref(false);\n    const settings = ref({\n      model: 'glm-4-plus',\n      temperature: 0.7,\n      maxTokens: 4000,\n      useRag: true,\n      autoReference: true\n    });\n\n    // é‡å‘½å\n    const showRenameDialog = ref(false);\n    const renameValue = ref('');\n    const renameChatId = ref(null);\n\n    // ==================== è®¡ç®—å±æ€§ ====================\n    const userAvatar = computed(() => store.getters.currentUser?.avatar || '');\n    const userInitial = computed(() => {\n      const name = store.getters.currentUser?.full_name || store.getters.currentUser?.username || 'U';\n      return name.charAt(0).toUpperCase();\n    });\n    const currentChatTitle = computed(() => {\n      const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n      return chat?.preview || 'æ–°å¯¹è¯';\n    });\n    const canSend = computed(() => {\n      return inputMessage.value.trim().length > 0 && !isTyping.value;\n    });\n    const inputRows = computed(() => {\n      const lines = inputMessage.value.split('\\n').length;\n      return Math.min(Math.max(lines, 1), 5);\n    });\n    const filteredPapers = computed(() => {\n      if (!paperSearch.value) return papers.value;\n      const query = paperSearch.value.toLowerCase();\n      return papers.value.filter(p => (p.title || '').toLowerCase().includes(query) || (p.abstract || '').toLowerCase().includes(query));\n    });\n\n    // ==================== å¿«æ·åŠŸèƒ½å¡ç‰‡ ====================\n    const quickCards = [{\n      key: 'summary',\n      label: 'æ–‡çŒ®ç»¼è¿°',\n      icon: 'Document',\n      prompt: 'è¯·åŸºäºæˆ‘çš„è®ºæ–‡åº“ç”Ÿæˆä¸€ä»½æ–‡çŒ®ç»¼è¿°'\n    }, {\n      key: 'gaps',\n      label: 'ç ”ç©¶ç©ºç™½',\n      icon: 'Search',\n      prompt: 'è¯·åˆ†æå½“å‰ç ”ç©¶é¢†åŸŸçš„ä¸»è¦ç©ºç™½'\n    }, {\n      key: 'code',\n      label: 'ä»£ç ç”Ÿæˆ',\n      icon: 'Cpu',\n      prompt: 'è¯·å¸®æˆ‘ç”Ÿæˆå®ç°XXç®—æ³•çš„ä»£ç '\n    }, {\n      key: 'trends',\n      label: 'è¶‹åŠ¿åˆ†æ',\n      icon: 'TrendCharts',\n      prompt: 'è¯·åˆ†æè¯¥é¢†åŸŸçš„ç ”ç©¶è¶‹åŠ¿'\n    }];\n    const exampleQuestions = ['å¸®æˆ‘æ€»ç»“è¿™å‡ ç¯‡è®ºæ–‡çš„æ ¸å¿ƒè´¡çŒ®', 'è¿™äº›è®ºæ–‡ä¸­ä½¿ç”¨äº†å“ªäº›ä¸»è¦æ–¹æ³•ï¼Ÿ', 'è¿™ä¸ªé¢†åŸŸçš„ç ”ç©¶ç°çŠ¶å¦‚ä½•ï¼Ÿ', 'æœ‰å“ªäº›æ½œåœ¨çš„ç ”ç©¶æ–¹å‘å€¼å¾—æ¢ç´¢ï¼Ÿ', 'å¸®æˆ‘æ¯”è¾ƒè®ºæ–‡Aå’Œè®ºæ–‡Bçš„æ–¹æ³•å·®å¼‚', 'è¯·è§£é‡Šè®ºæ–‡ä¸­çš„XXç®—æ³•åŸç†'];\n\n    // ==================== æ–¹æ³• ====================\n    const formatTime = timestamp => {\n      if (!timestamp) return '';\n      const date = new Date(timestamp);\n      return date.toLocaleTimeString('zh-CN', {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    };\n    const renderMessage = content => {\n      if (!content) return '';\n      const html = marked(content);\n      return DOMPurify.sanitize(html);\n    };\n    const scrollToBottom = () => {\n      nextTick(() => {\n        if (messagesContainer.value) {\n          messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;\n        }\n      });\n    };\n\n    // ==================== èŠå¤©æ“ä½œ ====================\n    const loadChatHistory = async () => {\n      try {\n        // è¿™é‡Œå¯ä»¥è°ƒç”¨åç«¯ API è·å–ä¼šè¯åˆ—è¡¨\n        // ç›®å‰ä½¿ç”¨æœ¬åœ°å­˜å‚¨\n        const saved = localStorage.getItem('kimi_chat_history');\n        if (saved) {\n          chatHistory.value = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.error('åŠ è½½èŠå¤©å†å²å¤±è´¥:', e);\n      }\n    };\n    const saveChatHistory = () => {\n      try {\n        localStorage.setItem('kimi_chat_history', JSON.stringify(chatHistory.value));\n      } catch (e) {\n        console.error('ä¿å­˜èŠå¤©å†å²å¤±è´¥:', e);\n      }\n    };\n    const createNewChat = () => {\n      const newChatId = `chat_${Date.now()}`;\n      currentChatId.value = newChatId;\n      messages.value = [];\n      selectedPapers.value = [];\n\n      // æ·»åŠ åˆ°å†å²\n      chatHistory.value.unshift({\n        chat_id: newChatId,\n        preview: 'æ–°å¯¹è¯',\n        created_at: new Date().toISOString(),\n        message_count: 0\n      });\n      saveChatHistory();\n    };\n    const switchChat = async chatId => {\n      if (currentChatId.value === chatId) return;\n      currentChatId.value = chatId;\n\n      // åŠ è½½è¯¥ä¼šè¯çš„æ¶ˆæ¯å†å²\n      try {\n        const response = await api.getChatHistory(chatId);\n        if (response.success) {\n          messages.value = response.data || [];\n        }\n      } catch (e) {\n        console.error('åŠ è½½æ¶ˆæ¯å†å²å¤±è´¥:', e);\n        messages.value = [];\n      }\n      scrollToBottom();\n    };\n    const renameChat = chatId => {\n      renameChatId.value = chatId;\n      renameValue.value = '';\n      showRenameDialog.value = true;\n    };\n    const confirmRename = () => {\n      if (!renameValue.value.trim()) {\n        ElMessage.warning('è¯·è¾“å…¥æ–°åç§°');\n        return;\n      }\n      const chat = chatHistory.value.find(c => c.chat_id === renameChatId.value);\n      if (chat) {\n        chat.preview = renameValue.value;\n        saveChatHistory();\n        ElMessage.success('é‡å‘½åæˆåŠŸ');\n      }\n      showRenameDialog.value = false;\n    };\n    const deleteChat = async chatId => {\n      try {\n        await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¹è¯å—ï¼Ÿ', 'æç¤º', {\n          confirmButtonText: 'ç¡®å®š',\n          cancelButtonText: 'å–æ¶ˆ',\n          type: 'warning'\n        });\n\n        // è°ƒç”¨åç«¯ API åˆ é™¤\n        await api.deleteChat({\n          chatId\n        });\n\n        // ä»åˆ—è¡¨ä¸­ç§»é™¤\n        chatHistory.value = chatHistory.value.filter(c => c.chat_id !== chatId);\n\n        // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰ä¼šè¯ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªæˆ–æ–°å»º\n        if (currentChatId.value === chatId) {\n          if (chatHistory.value.length > 0) {\n            switchChat(chatHistory.value[0].chat_id);\n          } else {\n            createNewChat();\n          }\n        }\n        saveChatHistory();\n        ElMessage.success('åˆ é™¤æˆåŠŸ');\n      } catch (e) {\n        if (e !== 'cancel') {\n          console.error('åˆ é™¤å¤±è´¥:', e);\n        }\n      }\n    };\n    const clearCurrentChat = async () => {\n      if (messages.value.length === 0) return;\n      try {\n        await ElMessageBox.confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰å¯¹è¯å—ï¼Ÿ', 'æç¤º', {\n          confirmButtonText: 'ç¡®å®š',\n          cancelButtonText: 'å–æ¶ˆ',\n          type: 'warning'\n        });\n        await api.clearChat({\n          chatId: currentChatId.value\n        });\n        messages.value = [];\n\n        // æ›´æ–°é¢„è§ˆ\n        const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n        if (chat) {\n          chat.preview = 'æ–°å¯¹è¯';\n          chat.message_count = 0;\n          saveChatHistory();\n        }\n        ElMessage.success('å·²æ¸…ç©º');\n      } catch (e) {\n        if (e !== 'cancel') {\n          console.error('æ¸…ç©ºå¤±è´¥:', e);\n        }\n      }\n    };\n\n    // ==================== æ¶ˆæ¯å‘é€ ====================\n    const handleEnter = e => {\n      if (e.shiftKey) {\n        // Shift+Enter æ¢è¡Œ\n        return;\n      }\n      e.preventDefault();\n      sendMessage();\n    };\n    const handleInput = () => {\n      // å¯ä»¥åœ¨è¿™é‡Œå®ç°è¾“å…¥æç¤ºç­‰åŠŸèƒ½\n    };\n    const sendQuickMessage = prompt => {\n      inputMessage.value = prompt;\n      sendMessage();\n    };\n    const sendMessage = async (content = null) => {\n      const message = content || inputMessage.value.trim();\n      if (!message || isTyping.value) return;\n\n      // æ¸…ç©ºè¾“å…¥æ¡†\n      if (!content) {\n        inputMessage.value = '';\n      }\n\n      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n      messages.value.push({\n        role: 'user',\n        content: message,\n        timestamp: new Date().toISOString(),\n        references: []\n      });\n      scrollToBottom();\n      isTyping.value = true;\n      try {\n        // å‡†å¤‡ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹\n        const filesData = uploadedFiles.value.map(file => ({\n          filename: file.name,\n          content: file.content,\n          content_type: file.content_type,\n          size: file.size\n        }));\n\n        // è°ƒç”¨æµå¼ API\n        const response = await fetch('/api/chat/stream', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\n          },\n          body: JSON.stringify({\n            message,\n            chatId: currentChatId.value,\n            papers: selectedPapers.value.map(p => p.id),\n            model: currentModel.value,\n            temperature: settings.value.temperature,\n            useRag: useRag.value,\n            useWebSearch: useWebSearch.value,\n            files: filesData.length > 0 ? filesData : undefined\n          })\n        });\n        const reader = response.body.getReader();\n        const decoder = new TextDecoder();\n        let fullContent = '';\n\n        // æ·»åŠ  AI æ¶ˆæ¯å ä½\n        messages.value.push({\n          role: 'assistant',\n          content: '',\n          timestamp: new Date().toISOString(),\n          references: []\n        });\n\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const {\n            done,\n            value\n          } = await reader.read();\n          if (done) break;\n          const chunk = decoder.decode(value);\n          const lines = chunk.split('\\n\\n');\n          for (const line of lines) {\n            if (line.startsWith('data: ')) {\n              try {\n                const data = JSON.parse(line.slice(6));\n                if (data.done) {\n                  isTyping.value = false;\n                } else if (data.content) {\n                  fullContent += data.content;\n                  messages.value[messages.value.length - 1].content = fullContent;\n                  scrollToBottom();\n                }\n              } catch (e) {\n                console.error('è§£æ SSE æ•°æ®å¤±è´¥:', e);\n              }\n            }\n          }\n        }\n\n        // æ›´æ–°ä¼šè¯é¢„è§ˆ\n        const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n        if (chat) {\n          chat.preview = message.slice(0, 30) + (message.length > 30 ? '...' : '');\n          chat.message_count = messages.value.length;\n          saveChatHistory();\n        }\n      } catch (error) {\n        console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);\n        ElMessage.error('å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•');\n        isTyping.value = false;\n      }\n    };\n\n    // ==================== è®ºæ–‡é€‰æ‹© ====================\n    const loadPapers = async () => {\n      try {\n        const response = await api.getPapersList({\n          limit: 1000\n        });\n        if (response.success) {\n          // API è¿”å›çš„ data ç›´æ¥æ˜¯æ•°ç»„ï¼Œä¸æ˜¯ { items: [...] }\n          papers.value = Array.isArray(response.data) ? response.data : response.data.items || [];\n          console.log(`[DEBUG] åŠ è½½äº† ${papers.value.length} ç¯‡è®ºæ–‡`);\n        } else {\n          console.error('[ERROR] åŠ è½½è®ºæ–‡å¤±è´¥:', response.error);\n          papers.value = [];\n        }\n      } catch (error) {\n        console.error('[ERROR] åŠ è½½è®ºæ–‡å¤±è´¥:', error);\n        papers.value = [];\n      }\n    };\n    const handlePaperSelectionChange = selection => {\n      tempSelectedPapers.value = selection;\n    };\n    const confirmPaperSelection = () => {\n      selectedPapers.value = [...tempSelectedPapers.value];\n      showPaperSelector.value = false;\n\n      // å°†å…³è”è®ºæ–‡ä¿å­˜åˆ°å½“å‰ä¼šè¯ä¸Šä¸‹æ–‡\n      const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n      if (chat) {\n        chat.connected_papers = selectedPapers.value.map(p => p.id);\n        saveChatHistory();\n      }\n      ElMessage.success(`å·²å…³è” ${selectedPapers.value.length} ç¯‡è®ºæ–‡ï¼ŒRAGå°†ä¼˜å…ˆæ£€ç´¢è¿™äº›è®ºæ–‡`);\n    };\n    const viewPaper = paperId => {\n      window.open(`#/papers/${paperId}`, '_blank');\n    };\n\n    // ==================== è®¾ç½® ====================\n    const saveSettings = () => {\n      localStorage.setItem('kimi_chat_settings', JSON.stringify(settings.value));\n      showSettings.value = false;\n      ElMessage.success('è®¾ç½®å·²ä¿å­˜');\n    };\n    const loadSettings = () => {\n      try {\n        const saved = localStorage.getItem('kimi_chat_settings');\n        if (saved) {\n          settings.value = {\n            ...settings.value,\n            ...JSON.parse(saved)\n          };\n        }\n      } catch (e) {\n        console.error('åŠ è½½è®¾ç½®å¤±è´¥:', e);\n      }\n    };\n\n    // ==================== æ–‡ä»¶ä¸Šä¼  ====================\n    const handleUpload = () => {\n      // åˆ›å»ºéšè—çš„æ–‡ä»¶è¾“å…¥\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.txt,.pdf,.doc,.docx,.md,.py,.js,.json,.java,.c,.cpp,.html,.css';\n      input.multiple = true;\n      input.style.display = 'none';\n      input.onchange = e => {\n        handleFileSelect(e);\n        // æ¸…ç†åˆ›å»ºçš„inputå…ƒç´ \n        document.body.removeChild(input);\n      };\n      document.body.appendChild(input);\n      input.click();\n    };\n    const handleFileSelect = async event => {\n      const files = event.target.files;\n      if (!files || files.length === 0) return;\n      isUploading.value = true;\n      for (const file of files) {\n        // æ£€æŸ¥æ–‡ä»¶å¤§å° (10MB)\n        if (file.size > 10 * 1024 * 1024) {\n          ElMessage.warning(`${file.name} è¶…è¿‡ 10MBï¼Œå·²è·³è¿‡`);\n          continue;\n        }\n        try {\n          const formData = new FormData();\n          formData.append('file', file);\n          ElMessage.info(`æ­£åœ¨ä¸Šä¼  ${file.name}...`);\n          const response = await fetch('/api/chat/upload', {\n            method: 'POST',\n            headers: {\n              'Authorization': `Bearer ${localStorage.getItem('token')}`\n            },\n            body: formData\n          });\n          const result = await response.json();\n          if (result.success) {\n            uploadedFiles.value.push({\n              name: result.data.filename,\n              hash: result.data.file_hash,\n              content: result.data.content,\n              content_type: result.data.content_type,\n              size: result.data.size\n            });\n            ElMessage.success(`${file.name} ä¸Šä¼ æˆåŠŸ`);\n          } else {\n            ElMessage.error(`${file.name} ä¸Šä¼ å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);\n          }\n        } catch (error) {\n          console.error('ä¸Šä¼ é”™è¯¯:', error);\n          ElMessage.error(`${file.name} ä¸Šä¼ å¤±è´¥: ${error.message || 'ç½‘ç»œé”™è¯¯'}`);\n        }\n      }\n      isUploading.value = false;\n    };\n    const removeFile = index => {\n      uploadedFiles.value.splice(index, 1);\n    };\n\n    // ç›‘å¬è®ºæ–‡é€‰æ‹©å¯¹è¯æ¡†æ‰“å¼€\n    watch(showPaperSelector, async newVal => {\n      if (newVal) {\n        // å¯¹è¯æ¡†æ‰“å¼€æ—¶åŠ è½½è®ºæ–‡åˆ—è¡¨\n        await loadPapers();\n\n        // åˆå§‹åŒ–å·²é€‰æ‹©çš„è®ºæ–‡\n        await nextTick();\n        if (paperTable.value && selectedPapers.value.length > 0) {\n          // æ¸…ç©ºå½“å‰é€‰æ‹©\n          paperTable.value.clearSelection();\n\n          // é‡æ–°é€‰ä¸­å·²å…³è”çš„è®ºæ–‡\n          selectedPapers.value.forEach(paper => {\n            const row = papers.value.find(p => p.id === paper.id);\n            if (row) {\n              paperTable.value.toggleRowSelection(row, true);\n            }\n          });\n        }\n\n        // åŒæ­¥tempSelectedPapers\n        tempSelectedPapers.value = [...selectedPapers.value];\n      }\n    });\n\n    // ==================== ç”Ÿå‘½å‘¨æœŸ ====================\n    onMounted(() => {\n      loadChatHistory();\n      loadPapers();\n      loadSettings();\n\n      // å¦‚æœæ²¡æœ‰ä¼šè¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„\n      if (chatHistory.value.length === 0) {\n        createNewChat();\n      } else {\n        // åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªä¼šè¯\n        switchChat(chatHistory.value[0].chat_id);\n      }\n\n      // æ£€æŸ¥ä¸Šä¼ æŒ‰é’®å¯ç”¨æ€§\n      console.log('[DEBUG] KimiChat å·²æŒ‚è½½ï¼Œä¸Šä¼ åŠŸèƒ½å·²å°±ç»ª');\n    });\n    const __returned__ = {\n      store,\n      sidebarCollapsed,\n      currentChatId,\n      chatHistory,\n      messages,\n      inputMessage,\n      isTyping,\n      currentModel,\n      messagesContainer,\n      useRag,\n      useWebSearch,\n      selectedPapers,\n      uploadedFiles,\n      isUploading,\n      showPaperSelector,\n      paperSearch,\n      papers,\n      tempSelectedPapers,\n      paperTable,\n      showSettings,\n      settings,\n      showRenameDialog,\n      renameValue,\n      renameChatId,\n      userAvatar,\n      userInitial,\n      currentChatTitle,\n      canSend,\n      inputRows,\n      filteredPapers,\n      quickCards,\n      exampleQuestions,\n      formatTime,\n      renderMessage,\n      scrollToBottom,\n      loadChatHistory,\n      saveChatHistory,\n      createNewChat,\n      switchChat,\n      renameChat,\n      confirmRename,\n      deleteChat,\n      clearCurrentChat,\n      handleEnter,\n      handleInput,\n      sendQuickMessage,\n      sendMessage,\n      loadPapers,\n      handlePaperSelectionChange,\n      confirmPaperSelection,\n      viewPaper,\n      saveSettings,\n      loadSettings,\n      handleUpload,\n      handleFileSelect,\n      removeFile,\n      ref,\n      computed,\n      onMounted,\n      nextTick,\n      watch,\n      get useStore() {\n        return useStore;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get Plus() {\n        return Plus;\n      },\n      get Fold() {\n        return Fold;\n      },\n      get Expand() {\n        return Expand;\n      },\n      get ChatLineRound() {\n        return ChatLineRound;\n      },\n      get MoreFilled() {\n        return MoreFilled;\n      },\n      get Setting() {\n        return Setting;\n      },\n      get Document() {\n        return Document;\n      },\n      get Delete() {\n        return Delete;\n      },\n      get ChatDotRound() {\n        return ChatDotRound;\n      },\n      get Cpu() {\n        return Cpu;\n      },\n      get Paperclip() {\n        return Paperclip;\n      },\n      get Search() {\n        return Search;\n      },\n      get Globe() {\n        return Globe;\n      },\n      get Promotion() {\n        return Promotion;\n      },\n      get Loading() {\n        return Loading;\n      },\n      get Edit() {\n        return Edit;\n      },\n      get api() {\n        return api;\n      },\n      get marked() {\n        return marked;\n      },\n      get DOMPurify() {\n        return DOMPurify;\n      },\n      get hljs() {\n        return hljs;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","nextTick","watch","useStore","ElMessage","ElMessageBox","Plus","Fold","Expand","ChatLineRound","MoreFilled","Setting","Document","Delete","ChatDotRound","Cpu","Paperclip","Search","Globe","Promotion","Loading","Edit","api","marked","DOMPurify","hljs","setOptions","highlight","code","lang","getLanguage","language","value","highlightAuto","breaks","gfm","store","sidebarCollapsed","currentChatId","chatHistory","messages","inputMessage","isTyping","currentModel","messagesContainer","useRag","useWebSearch","selectedPapers","uploadedFiles","isUploading","showPaperSelector","paperSearch","papers","tempSelectedPapers","paperTable","showSettings","settings","model","temperature","maxTokens","autoReference","showRenameDialog","renameValue","renameChatId","userAvatar","getters","currentUser","avatar","userInitial","name","full_name","username","charAt","toUpperCase","currentChatTitle","chat","find","c","chat_id","preview","canSend","trim","length","inputRows","lines","split","Math","min","max","filteredPapers","query","toLowerCase","filter","p","title","includes","abstract","quickCards","key","label","icon","prompt","exampleQuestions","formatTime","timestamp","date","Date","toLocaleTimeString","hour","minute","renderMessage","content","html","sanitize","scrollToBottom","scrollTop","scrollHeight","loadChatHistory","saved","localStorage","getItem","JSON","parse","e","console","error","saveChatHistory","setItem","stringify","createNewChat","newChatId","now","unshift","created_at","toISOString","message_count","switchChat","chatId","response","getChatHistory","success","data","renameChat","confirmRename","warning","deleteChat","confirm","confirmButtonText","cancelButtonText","type","clearCurrentChat","clearChat","handleEnter","shiftKey","preventDefault","sendMessage","handleInput","sendQuickMessage","message","push","role","references","filesData","map","file","filename","content_type","size","fetch","method","headers","body","id","files","undefined","reader","getReader","decoder","TextDecoder","fullContent","done","read","chunk","decode","line","startsWith","slice","loadPapers","getPapersList","limit","Array","isArray","items","log","handlePaperSelectionChange","selection","confirmPaperSelection","connected_papers","viewPaper","paperId","window","open","saveSettings","loadSettings","handleUpload","input","document","createElement","accept","multiple","style","display","onchange","handleFileSelect","removeChild","appendChild","click","event","target","formData","FormData","append","info","result","json","hash","file_hash","removeFile","index","splice","newVal","clearSelection","forEach","paper","row","toggleRowSelection"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/views/KimiChat.vue"],"sourcesContent":["<template>\n  <div class=\"kimi-chat-container\">\n    <!-- å·¦ä¾§è¾¹æ  -->\n    <aside class=\"sidebar\" :class=\"{ 'collapsed': sidebarCollapsed }\">\n      <!-- æ–°å»ºå¯¹è¯æŒ‰é’® -->\n      <div class=\"sidebar-header\">\n        <button class=\"new-chat-btn\" @click=\"createNewChat\">\n          <el-icon><Plus /></el-icon>\n          <span>æ–°å»ºå¯¹è¯</span>\n        </button>\n        <button class=\"collapse-btn\" @click=\"sidebarCollapsed = !sidebarCollapsed\">\n          <el-icon><Fold v-if=\"!sidebarCollapsed\" /><Expand v-else /></el-icon>\n        </button>\n      </div>\n\n      <!-- å¯¹è¯å†å²åˆ—è¡¨ -->\n      <div class=\"chat-history\">\n        <div\n          v-for=\"chat in chatHistory\"\n          :key=\"chat.chat_id\"\n          class=\"chat-item\"\n          :class=\"{ active: currentChatId === chat.chat_id }\"\n          @click=\"switchChat(chat.chat_id)\"\n        >\n          <el-icon class=\"chat-icon\"><ChatLineRound /></el-icon>\n          <span class=\"chat-title\">{{ chat.preview || 'æ–°å¯¹è¯' }}</span>\n          <div class=\"chat-actions\" @click.stop>\n            <el-dropdown trigger=\"click\" :teleported=\"false\">\n              <el-icon class=\"more-icon\"><MoreFilled /></el-icon>\n              <template #dropdown>\n                <el-dropdown-menu>\n                  <el-dropdown-item @click=\"renameChat(chat.chat_id)\">\n                    <el-icon><Edit /></el-icon> é‡å‘½å\n                  </el-dropdown-item>\n                  <el-dropdown-item divided @click=\"deleteChat(chat.chat_id)\" class=\"danger\">\n                    <el-icon><Delete /></el-icon> åˆ é™¤\n                  </el-dropdown-item>\n                </el-dropdown-menu>\n              </template>\n            </el-dropdown>\n          </div>\n        </div>\n      </div>\n\n      <!-- åº•éƒ¨è®¾ç½® -->\n      <div class=\"sidebar-footer\">\n        <button class=\"footer-btn\" @click=\"showSettings = true\">\n          <el-icon><Setting /></el-icon>\n          <span>è®¾ç½®</span>\n        </button>\n      </div>\n    </aside>\n\n    <!-- ä¸»èŠå¤©åŒºåŸŸ -->\n    <main class=\"chat-main\">\n      <!-- é¡¶éƒ¨å¯¼èˆª -->\n      <header class=\"chat-header\">\n        <div class=\"header-left\">\n          <h2 class=\"chat-title\">{{ currentChatTitle }}</h2>\n          <el-tag v-if=\"selectedPapers.length > 0\" type=\"success\" size=\"small\">\n            å·²å…³è” {{ selectedPapers.length }} ç¯‡è®ºæ–‡\n          </el-tag>\n        </div>\n        <div class=\"header-right\">\n          <el-select v-model=\"currentModel\" size=\"small\" class=\"model-select\">\n            <el-option label=\"GLM-4-Plus\" value=\"glm-4-plus\" />\n            <el-option label=\"GLM-4-Flash\" value=\"glm-4-flash\" />\n          </el-select>\n          <el-tooltip content=\"å…³è”è®ºæ–‡\">\n            <el-button circle size=\"small\" @click=\"showPaperSelector = true\">\n              <el-icon><Document /></el-icon>\n            </el-button>\n          </el-tooltip>\n          <el-tooltip content=\"æ¸…ç©ºå¯¹è¯\">\n            <el-button circle size=\"small\" @click=\"clearCurrentChat\">\n              <el-icon><Delete /></el-icon>\n            </el-button>\n          </el-tooltip>\n        </div>\n      </header>\n\n      <!-- æ¶ˆæ¯åˆ—è¡¨åŒºåŸŸ -->\n      <div ref=\"messagesContainer\" class=\"messages-area\">\n        <!-- æ¬¢è¿é¡µé¢ -->\n        <div v-if=\"messages.length === 0\" class=\"welcome-section\">\n          <div class=\"welcome-logo\">\n            <el-icon :size=\"80\" color=\"#10b981\"><ChatDotRound /></el-icon>\n          </div>\n          <h1 class=\"welcome-title\">AI ç§‘ç ”åŠ©æ‰‹</h1>\n          <p class=\"welcome-subtitle\">\n            åŸºäºæ‚¨çš„è®ºæ–‡åº“ï¼Œæä¾›æ·±åº¦æ–‡çŒ®åˆ†æã€ç ”ç©¶å»ºè®®ã€ä»£ç ç”Ÿæˆç­‰æœåŠ¡\n          </p>\n\n          <!-- å¿«æ·åŠŸèƒ½å¡ç‰‡ -->\n          <div class=\"quick-cards\">\n            <div\n              v-for=\"card in quickCards\"\n              :key=\"card.key\"\n              class=\"quick-card\"\n              @click=\"sendQuickMessage(card.prompt)\"\n            >\n              <el-icon :size=\"24\"><component :is=\"card.icon\" /></el-icon>\n              <span>{{ card.label }}</span>\n            </div>\n          </div>\n\n          <!-- ç¤ºä¾‹é—®é¢˜ -->\n          <div class=\"example-questions\">\n            <div class=\"section-title\">ä½ å¯ä»¥è¿™æ ·é—®æˆ‘ï¼š</div>\n            <div class=\"question-tags\">\n              <el-tag\n                v-for=\"q in exampleQuestions\"\n                :key=\"q\"\n                class=\"question-tag\"\n                effect=\"plain\"\n                @click=\"sendMessage(q)\"\n              >\n                {{ q }}\n              </el-tag>\n            </div>\n          </div>\n        </div>\n\n        <!-- æ¶ˆæ¯åˆ—è¡¨ -->\n        <template v-else>\n          <div\n            v-for=\"(message, index) in messages\"\n            :key=\"index\"\n            class=\"message-wrapper\"\n            :class=\"{ 'user-message': message.role === 'user', 'ai-message': message.role === 'assistant' }\"\n          >\n            <div class=\"message-avatar\">\n              <el-avatar\n                v-if=\"message.role === 'user'\"\n                :size=\"36\"\n                :src=\"userAvatar\"\n              >\n                {{ userInitial }}\n              </el-avatar>\n              <div v-else class=\"ai-avatar\">\n                <el-icon :size=\"20\"><Cpu /></el-icon>\n              </div>\n            </div>\n\n            <div class=\"message-content\">\n              <!-- æ¶ˆæ¯å¤´éƒ¨ -->\n              <div class=\"message-header\">\n                <span class=\"message-role\">{{ message.role === 'user' ? 'æˆ‘' : 'AI åŠ©æ‰‹' }}</span>\n                <span class=\"message-time\">{{ formatTime(message.timestamp) }}</span>\n              </div>\n\n              <!-- æ¶ˆæ¯ä½“ -->\n              <div class=\"message-body\" v-html=\"renderMessage(message.content)\"></div>\n\n              <!-- å¼•ç”¨è®ºæ–‡ -->\n              <div v-if=\"message.references && message.references.length > 0\" class=\"message-references\">\n                <div class=\"ref-title\">å¼•ç”¨æ–‡çŒ®ï¼š</div>\n                <div class=\"ref-list\">\n                  <el-tag\n                    v-for=\"ref in message.references\"\n                    :key=\"ref.paper_id\"\n                    size=\"small\"\n                    type=\"info\"\n                    class=\"ref-tag\"\n                    @click=\"viewPaper(ref.paper_id)\"\n                  >\n                    {{ ref.title }}\n                  </el-tag>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- AI æ­£åœ¨è¾“å…¥ -->\n          <div v-if=\"isTyping\" class=\"message-wrapper ai-message typing\">\n            <div class=\"message-avatar\">\n              <div class=\"ai-avatar\">\n                <el-icon :size=\"20\"><Cpu /></el-icon>\n              </div>\n            </div>\n            <div class=\"message-content\">\n              <div class=\"typing-indicator\">\n                <span></span>\n                <span></span>\n                <span></span>\n              </div>\n            </div>\n          </div>\n        </template>\n      </div>\n\n      <!-- è¾“å…¥åŒºåŸŸ -->\n      <footer class=\"input-area\">\n        <div class=\"input-toolbar\">\n          <el-tooltip content=\"ä¸Šä¼ æ–‡ä»¶\">\n            <button class=\"tool-btn\" @click=\"handleUpload\">\n              <el-icon><Paperclip /></el-icon>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"å…³è”è®ºæ–‡\">\n            <button class=\"tool-btn\" @click=\"showPaperSelector = true\" :class=\"{ active: selectedPapers.length > 0 }\">\n              <el-icon><Document /></el-icon>\n              <span v-if=\"selectedPapers.length > 0\" class=\"badge\">{{ selectedPapers.length }}</span>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"ä½¿ç”¨ RAG\">\n            <button\n              class=\"tool-btn\"\n              :class=\"{ active: useRag }\"\n              @click=\"useRag = !useRag\"\n            >\n              <el-icon><Search /></el-icon>\n              <span>RAG</span>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"ç½‘ç»œæœç´¢\">\n            <button\n              class=\"tool-btn\"\n              :class=\"{ active: useWebSearch }\"\n              @click=\"useWebSearch = !useWebSearch\"\n            >\n              <el-icon><Globe /></el-icon>\n              <span>è”ç½‘</span>\n            </button>\n          </el-tooltip>\n        </div>\n\n        <div class=\"input-box\">\n          <el-input\n            v-model=\"inputMessage\"\n            type=\"textarea\"\n            :rows=\"inputRows\"\n            placeholder=\"è¾“å…¥æ‚¨çš„é—®é¢˜ï¼ŒAI å°†åŸºäºæ‚¨çš„è®ºæ–‡åº“è¿›è¡Œå›ç­”...\"\n            resize=\"none\"\n            @keydown.enter.prevent=\"handleEnter\"\n            @input=\"handleInput\"\n          />\n          <button\n            class=\"send-btn\"\n            :disabled=\"!canSend\"\n            @click=\"sendMessage()\"\n          >\n            <el-icon v-if=\"!isTyping\"><Promotion /></el-icon>\n            <el-icon v-else class=\"loading\"><Loading /></el-icon>\n          </button>\n        </div>\n\n        <!-- å·²ä¸Šä¼ æ–‡ä»¶æ˜¾ç¤º -->\n        <div v-if=\"uploadedFiles.length > 0\" class=\"uploaded-files\">\n          <div class=\"uploaded-files-title\">\n            <el-icon><Document /></el-icon>\n            <span>å·²ä¸Šä¼  {{ uploadedFiles.length }} ä¸ªæ–‡ä»¶</span>\n          </div>\n          <div class=\"uploaded-files-list\">\n            <el-tag\n              v-for=\"(file, index) in uploadedFiles\"\n              :key=\"file.hash\"\n              closable\n              size=\"small\"\n              type=\"info\"\n              @close=\"removeFile(index)\"\n              class=\"uploaded-file-tag\"\n            >\n              {{ file.name }}\n            </el-tag>\n          </div>\n        </div>\n\n        <div class=\"input-hint\">\n          <span>Enter å‘é€ï¼ŒShift + Enter æ¢è¡Œ</span>\n          <span v-if=\"inputMessage.length > 0\">{{ inputMessage.length }} å­—ç¬¦</span>\n        </div>\n      </footer>\n    </main>\n\n    <!-- è®ºæ–‡é€‰æ‹©å¯¹è¯æ¡† -->\n    <el-dialog v-model=\"showPaperSelector\" title=\"é€‰æ‹©å…³è”è®ºæ–‡\" width=\"700px\">\n      <div class=\"paper-selector\">\n        <!-- å…³è”è®ºæ–‡åŠŸèƒ½è¯´æ˜ -->\n        <el-alert\n          title=\"ğŸ’¡ å…³è”è®ºæ–‡åŠŸèƒ½è¯´æ˜\"\n          type=\"info\"\n          :closable=\"false\"\n          class=\"paper-help-alert\"\n        >\n          <template #default>\n            <div class=\"paper-help-content\">\n              <p><strong>ä»€ä¹ˆæ˜¯å…³è”è®ºæ–‡ï¼Ÿ</strong></p>\n              <p>å…³è”è®ºæ–‡æ˜¯æŒ‡åœ¨AIå›ç­”æ‚¨çš„é—®é¢˜æ—¶ï¼Œ<strong>ä¼˜å…ˆå‚è€ƒ</strong>çš„è®ºæ–‡ã€‚è¿™å¯ä»¥è®©AIçš„å›ç­”æ›´è´´åˆæ‚¨çš„ç ”ç©¶å†…å®¹ã€‚</p>\n              <p style=\"margin-top: 8px;\"><strong>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</strong></p>\n              <ul>\n                <li>é€‰æ‹©æ‚¨æƒ³è¦é‡ç‚¹å‚è€ƒçš„è®ºæ–‡ï¼ˆå¯å¤šé€‰ï¼‰</li>\n                <li>ç‚¹å‡»\"ç¡®å®š\"åï¼Œè¿™äº›è®ºæ–‡ä¼šåœ¨RAGæ£€ç´¢æ—¶è¢«ä¼˜å…ˆæœç´¢</li>\n                <li>å‘é€æ¶ˆæ¯æ—¶ï¼ŒAIä¼šä¼˜å…ˆåˆ†æè¿™äº›è®ºæ–‡çš„å†…å®¹æ¥å›ç­”æ‚¨çš„é—®é¢˜</li>\n              </ul>\n            </div>\n          </template>\n        </el-alert>\n\n        <el-input\n          v-model=\"paperSearch\"\n          placeholder=\"æœç´¢è®ºæ–‡...\"\n          clearable\n          class=\"paper-search\"\n        >\n          <template #prefix>\n            <el-icon><Search /></el-icon>\n          </template>\n        </el-input>\n\n        <el-table\n          :data=\"filteredPapers\"\n          style=\"width: 100%\"\n          max-height=\"400\"\n          @selection-change=\"handlePaperSelectionChange\"\n          ref=\"paperTable\"\n        >\n          <el-table-column type=\"selection\" width=\"55\" />\n          <el-table-column prop=\"title\" label=\"è®ºæ–‡æ ‡é¢˜\" show-overflow-tooltip min-width=\"250\" />\n          <el-table-column prop=\"year\" label=\"å¹´ä»½\" width=\"80\" />\n          <el-table-column prop=\"venue\" label=\"æœŸåˆŠ/ä¼šè®®\" show-overflow-tooltip />\n        </el-table>\n      </div>\n\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <span>å·²é€‰æ‹© {{ tempSelectedPapers.length }} ç¯‡è®ºæ–‡</span>\n          <div>\n            <el-button @click=\"showPaperSelector = false\">å–æ¶ˆ</el-button>\n            <el-button type=\"primary\" @click=\"confirmPaperSelection\">ç¡®å®š</el-button>\n          </div>\n        </div>\n      </template>\n    </el-dialog>\n\n    <!-- è®¾ç½®å¯¹è¯æ¡† -->\n    <el-dialog v-model=\"showSettings\" title=\"èŠå¤©è®¾ç½®\" width=\"500px\">\n      <el-form label-width=\"100px\">\n        <el-form-item label=\"é»˜è®¤æ¨¡å‹\">\n          <el-select v-model=\"settings.model\" style=\"width: 100%\">\n            <el-option label=\"GLM-4-Plus\" value=\"glm-4-plus\" />\n            <el-option label=\"GLM-4-Flash\" value=\"glm-4-flash\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"æ¸©åº¦\">\n          <el-slider v-model=\"settings.temperature\" :min=\"0\" :max=\"1\" :step=\"0.1\" show-stops />\n          <div class=\"slider-hint\">è¾ƒä½çš„å€¼ä½¿è¾“å‡ºæ›´ç¡®å®šï¼Œè¾ƒé«˜çš„å€¼ä½¿è¾“å‡ºæ›´éšæœº</div>\n        </el-form-item>\n        <el-form-item label=\"æœ€å¤§é•¿åº¦\">\n          <el-input-number v-model=\"settings.maxTokens\" :min=\"1000\" :max=\"8000\" :step=\"1000\" style=\"width: 100%\" />\n        </el-form-item>\n        <el-form-item label=\"å¯ç”¨ RAG\">\n          <el-switch v-model=\"settings.useRag\" />\n        </el-form-item>\n        <el-form-item label=\"è‡ªåŠ¨å¼•ç”¨\">\n          <el-switch v-model=\"settings.autoReference\" />\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"showSettings = false\">å…³é—­</el-button>\n        <el-button type=\"primary\" @click=\"saveSettings\">ä¿å­˜è®¾ç½®</el-button>\n      </template>\n    </el-dialog>\n\n    <!-- é‡å‘½åå¯¹è¯æ¡† -->\n    <el-dialog v-model=\"showRenameDialog\" title=\"é‡å‘½åå¯¹è¯\" width=\"400px\">\n      <el-input v-model=\"renameValue\" placeholder=\"è¾“å…¥æ–°åç§°\" />\n      <template #footer>\n        <el-button @click=\"showRenameDialog = false\">å–æ¶ˆ</el-button>\n        <el-button type=\"primary\" @click=\"confirmRename\">ç¡®å®š</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, nextTick, watch } from 'vue'\nimport { useStore } from 'vuex'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport {\n  Plus, Fold, Expand, ChatLineRound, MoreFilled, Setting,\n  Document, Delete, ChatDotRound, Cpu, Paperclip, Search,\n  Globe, Promotion, Loading, Edit\n} from '@element-plus/icons-vue'\nimport api from '@/api'\nimport { marked } from 'marked'\nimport DOMPurify from 'dompurify'\nimport hljs from 'highlight.js'\n\n// é…ç½® marked\nmarked.setOptions({\n  highlight: function(code, lang) {\n    if (lang && hljs.getLanguage(lang)) {\n      return hljs.highlight(code, { language: lang }).value\n    }\n    return hljs.highlightAuto(code).value\n  },\n  breaks: true,\n  gfm: true\n})\n\nconst store = useStore()\n\n// ==================== çŠ¶æ€ ====================\nconst sidebarCollapsed = ref(false)\nconst currentChatId = ref(null)\nconst chatHistory = ref([])\nconst messages = ref([])\nconst inputMessage = ref('')\nconst isTyping = ref(false)\nconst currentModel = ref('glm-4-plus')\nconst messagesContainer = ref(null)\nconst useRag = ref(true)\nconst useWebSearch = ref(false)\nconst selectedPapers = ref([])\nconst uploadedFiles = ref([])  // å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨\nconst isUploading = ref(false)  // ä¸Šä¼ ä¸­çŠ¶æ€\n\n// è®ºæ–‡é€‰æ‹©\nconst showPaperSelector = ref(false)\nconst paperSearch = ref('')\nconst papers = ref([])\nconst tempSelectedPapers = ref([])\nconst paperTable = ref(null)\n\n// è®¾ç½®\nconst showSettings = ref(false)\nconst settings = ref({\n  model: 'glm-4-plus',\n  temperature: 0.7,\n  maxTokens: 4000,\n  useRag: true,\n  autoReference: true\n})\n\n// é‡å‘½å\nconst showRenameDialog = ref(false)\nconst renameValue = ref('')\nconst renameChatId = ref(null)\n\n// ==================== è®¡ç®—å±æ€§ ====================\nconst userAvatar = computed(() => store.getters.currentUser?.avatar || '')\nconst userInitial = computed(() => {\n  const name = store.getters.currentUser?.full_name || store.getters.currentUser?.username || 'U'\n  return name.charAt(0).toUpperCase()\n})\n\nconst currentChatTitle = computed(() => {\n  const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n  return chat?.preview || 'æ–°å¯¹è¯'\n})\n\nconst canSend = computed(() => {\n  return inputMessage.value.trim().length > 0 && !isTyping.value\n})\n\nconst inputRows = computed(() => {\n  const lines = inputMessage.value.split('\\n').length\n  return Math.min(Math.max(lines, 1), 5)\n})\n\nconst filteredPapers = computed(() => {\n  if (!paperSearch.value) return papers.value\n  const query = paperSearch.value.toLowerCase()\n  return papers.value.filter(p =>\n    (p.title || '').toLowerCase().includes(query) ||\n    (p.abstract || '').toLowerCase().includes(query)\n  )\n})\n\n// ==================== å¿«æ·åŠŸèƒ½å¡ç‰‡ ====================\nconst quickCards = [\n  { key: 'summary', label: 'æ–‡çŒ®ç»¼è¿°', icon: 'Document', prompt: 'è¯·åŸºäºæˆ‘çš„è®ºæ–‡åº“ç”Ÿæˆä¸€ä»½æ–‡çŒ®ç»¼è¿°' },\n  { key: 'gaps', label: 'ç ”ç©¶ç©ºç™½', icon: 'Search', prompt: 'è¯·åˆ†æå½“å‰ç ”ç©¶é¢†åŸŸçš„ä¸»è¦ç©ºç™½' },\n  { key: 'code', label: 'ä»£ç ç”Ÿæˆ', icon: 'Cpu', prompt: 'è¯·å¸®æˆ‘ç”Ÿæˆå®ç°XXç®—æ³•çš„ä»£ç ' },\n  { key: 'trends', label: 'è¶‹åŠ¿åˆ†æ', icon: 'TrendCharts', prompt: 'è¯·åˆ†æè¯¥é¢†åŸŸçš„ç ”ç©¶è¶‹åŠ¿' },\n]\n\nconst exampleQuestions = [\n  'å¸®æˆ‘æ€»ç»“è¿™å‡ ç¯‡è®ºæ–‡çš„æ ¸å¿ƒè´¡çŒ®',\n  'è¿™äº›è®ºæ–‡ä¸­ä½¿ç”¨äº†å“ªäº›ä¸»è¦æ–¹æ³•ï¼Ÿ',\n  'è¿™ä¸ªé¢†åŸŸçš„ç ”ç©¶ç°çŠ¶å¦‚ä½•ï¼Ÿ',\n  'æœ‰å“ªäº›æ½œåœ¨çš„ç ”ç©¶æ–¹å‘å€¼å¾—æ¢ç´¢ï¼Ÿ',\n  'å¸®æˆ‘æ¯”è¾ƒè®ºæ–‡Aå’Œè®ºæ–‡Bçš„æ–¹æ³•å·®å¼‚',\n  'è¯·è§£é‡Šè®ºæ–‡ä¸­çš„XXç®—æ³•åŸç†'\n]\n\n// ==================== æ–¹æ³• ====================\nconst formatTime = (timestamp) => {\n  if (!timestamp) return ''\n  const date = new Date(timestamp)\n  return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })\n}\n\nconst renderMessage = (content) => {\n  if (!content) return ''\n  const html = marked(content)\n  return DOMPurify.sanitize(html)\n}\n\nconst scrollToBottom = () => {\n  nextTick(() => {\n    if (messagesContainer.value) {\n      messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight\n    }\n  })\n}\n\n// ==================== èŠå¤©æ“ä½œ ====================\nconst loadChatHistory = async () => {\n  try {\n    // è¿™é‡Œå¯ä»¥è°ƒç”¨åç«¯ API è·å–ä¼šè¯åˆ—è¡¨\n    // ç›®å‰ä½¿ç”¨æœ¬åœ°å­˜å‚¨\n    const saved = localStorage.getItem('kimi_chat_history')\n    if (saved) {\n      chatHistory.value = JSON.parse(saved)\n    }\n  } catch (e) {\n    console.error('åŠ è½½èŠå¤©å†å²å¤±è´¥:', e)\n  }\n}\n\nconst saveChatHistory = () => {\n  try {\n    localStorage.setItem('kimi_chat_history', JSON.stringify(chatHistory.value))\n  } catch (e) {\n    console.error('ä¿å­˜èŠå¤©å†å²å¤±è´¥:', e)\n  }\n}\n\nconst createNewChat = () => {\n  const newChatId = `chat_${Date.now()}`\n  currentChatId.value = newChatId\n  messages.value = []\n  selectedPapers.value = []\n\n  // æ·»åŠ åˆ°å†å²\n  chatHistory.value.unshift({\n    chat_id: newChatId,\n    preview: 'æ–°å¯¹è¯',\n    created_at: new Date().toISOString(),\n    message_count: 0\n  })\n\n  saveChatHistory()\n}\n\nconst switchChat = async (chatId) => {\n  if (currentChatId.value === chatId) return\n\n  currentChatId.value = chatId\n\n  // åŠ è½½è¯¥ä¼šè¯çš„æ¶ˆæ¯å†å²\n  try {\n    const response = await api.getChatHistory(chatId)\n    if (response.success) {\n      messages.value = response.data || []\n    }\n  } catch (e) {\n    console.error('åŠ è½½æ¶ˆæ¯å†å²å¤±è´¥:', e)\n    messages.value = []\n  }\n\n  scrollToBottom()\n}\n\nconst renameChat = (chatId) => {\n  renameChatId.value = chatId\n  renameValue.value = ''\n  showRenameDialog.value = true\n}\n\nconst confirmRename = () => {\n  if (!renameValue.value.trim()) {\n    ElMessage.warning('è¯·è¾“å…¥æ–°åç§°')\n    return\n  }\n\n  const chat = chatHistory.value.find(c => c.chat_id === renameChatId.value)\n  if (chat) {\n    chat.preview = renameValue.value\n    saveChatHistory()\n    ElMessage.success('é‡å‘½åæˆåŠŸ')\n  }\n\n  showRenameDialog.value = false\n}\n\nconst deleteChat = async (chatId) => {\n  try {\n    await ElMessageBox.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¹è¯å—ï¼Ÿ', 'æç¤º', {\n      confirmButtonText: 'ç¡®å®š',\n      cancelButtonText: 'å–æ¶ˆ',\n      type: 'warning'\n    })\n\n    // è°ƒç”¨åç«¯ API åˆ é™¤\n    await api.deleteChat({ chatId })\n\n    // ä»åˆ—è¡¨ä¸­ç§»é™¤\n    chatHistory.value = chatHistory.value.filter(c => c.chat_id !== chatId)\n\n    // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰ä¼šè¯ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªæˆ–æ–°å»º\n    if (currentChatId.value === chatId) {\n      if (chatHistory.value.length > 0) {\n        switchChat(chatHistory.value[0].chat_id)\n      } else {\n        createNewChat()\n      }\n    }\n\n    saveChatHistory()\n    ElMessage.success('åˆ é™¤æˆåŠŸ')\n  } catch (e) {\n    if (e !== 'cancel') {\n      console.error('åˆ é™¤å¤±è´¥:', e)\n    }\n  }\n}\n\nconst clearCurrentChat = async () => {\n  if (messages.value.length === 0) return\n\n  try {\n    await ElMessageBox.confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰å¯¹è¯å—ï¼Ÿ', 'æç¤º', {\n      confirmButtonText: 'ç¡®å®š',\n      cancelButtonText: 'å–æ¶ˆ',\n      type: 'warning'\n    })\n\n    await api.clearChat({ chatId: currentChatId.value })\n    messages.value = []\n\n    // æ›´æ–°é¢„è§ˆ\n    const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n    if (chat) {\n      chat.preview = 'æ–°å¯¹è¯'\n      chat.message_count = 0\n      saveChatHistory()\n    }\n\n    ElMessage.success('å·²æ¸…ç©º')\n  } catch (e) {\n    if (e !== 'cancel') {\n      console.error('æ¸…ç©ºå¤±è´¥:', e)\n    }\n  }\n}\n\n// ==================== æ¶ˆæ¯å‘é€ ====================\nconst handleEnter = (e) => {\n  if (e.shiftKey) {\n    // Shift+Enter æ¢è¡Œ\n    return\n  }\n  e.preventDefault()\n  sendMessage()\n}\n\nconst handleInput = () => {\n  // å¯ä»¥åœ¨è¿™é‡Œå®ç°è¾“å…¥æç¤ºç­‰åŠŸèƒ½\n}\n\nconst sendQuickMessage = (prompt) => {\n  inputMessage.value = prompt\n  sendMessage()\n}\n\nconst sendMessage = async (content = null) => {\n  const message = content || inputMessage.value.trim()\n  if (!message || isTyping.value) return\n\n  // æ¸…ç©ºè¾“å…¥æ¡†\n  if (!content) {\n    inputMessage.value = ''\n  }\n\n  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n  messages.value.push({\n    role: 'user',\n    content: message,\n    timestamp: new Date().toISOString(),\n    references: []\n  })\n\n  scrollToBottom()\n  isTyping.value = true\n\n  try {\n    // å‡†å¤‡ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹\n    const filesData = uploadedFiles.value.map(file => ({\n      filename: file.name,\n      content: file.content,\n      content_type: file.content_type,\n      size: file.size\n    }))\n\n    // è°ƒç”¨æµå¼ API\n    const response = await fetch('/api/chat/stream', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      },\n      body: JSON.stringify({\n        message,\n        chatId: currentChatId.value,\n        papers: selectedPapers.value.map(p => p.id),\n        model: currentModel.value,\n        temperature: settings.value.temperature,\n        useRag: useRag.value,\n        useWebSearch: useWebSearch.value,\n        files: filesData.length > 0 ? filesData : undefined\n      })\n    })\n\n    const reader = response.body.getReader()\n    const decoder = new TextDecoder()\n    let fullContent = ''\n\n    // æ·»åŠ  AI æ¶ˆæ¯å ä½\n    messages.value.push({\n      role: 'assistant',\n      content: '',\n      timestamp: new Date().toISOString(),\n      references: []\n    })\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const { done, value } = await reader.read()\n      if (done) break\n\n      const chunk = decoder.decode(value)\n      const lines = chunk.split('\\n\\n')\n\n      for (const line of lines) {\n        if (line.startsWith('data: ')) {\n          try {\n            const data = JSON.parse(line.slice(6))\n\n            if (data.done) {\n              isTyping.value = false\n            } else if (data.content) {\n              fullContent += data.content\n              messages.value[messages.value.length - 1].content = fullContent\n              scrollToBottom()\n            }\n          } catch (e) {\n            console.error('è§£æ SSE æ•°æ®å¤±è´¥:', e)\n          }\n        }\n      }\n    }\n\n    // æ›´æ–°ä¼šè¯é¢„è§ˆ\n    const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n    if (chat) {\n      chat.preview = message.slice(0, 30) + (message.length > 30 ? '...' : '')\n      chat.message_count = messages.value.length\n      saveChatHistory()\n    }\n\n  } catch (error) {\n    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error)\n    ElMessage.error('å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•')\n    isTyping.value = false\n  }\n}\n\n// ==================== è®ºæ–‡é€‰æ‹© ====================\nconst loadPapers = async () => {\n  try {\n    const response = await api.getPapersList({ limit: 1000 })\n    if (response.success) {\n      // API è¿”å›çš„ data ç›´æ¥æ˜¯æ•°ç»„ï¼Œä¸æ˜¯ { items: [...] }\n      papers.value = Array.isArray(response.data) ? response.data : (response.data.items || [])\n      console.log(`[DEBUG] åŠ è½½äº† ${papers.value.length} ç¯‡è®ºæ–‡`)\n    } else {\n      console.error('[ERROR] åŠ è½½è®ºæ–‡å¤±è´¥:', response.error)\n      papers.value = []\n    }\n  } catch (error) {\n    console.error('[ERROR] åŠ è½½è®ºæ–‡å¤±è´¥:', error)\n    papers.value = []\n  }\n}\n\nconst handlePaperSelectionChange = (selection) => {\n  tempSelectedPapers.value = selection\n}\n\nconst confirmPaperSelection = () => {\n  selectedPapers.value = [...tempSelectedPapers.value]\n  showPaperSelector.value = false\n  \n  // å°†å…³è”è®ºæ–‡ä¿å­˜åˆ°å½“å‰ä¼šè¯ä¸Šä¸‹æ–‡\n  const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n  if (chat) {\n    chat.connected_papers = selectedPapers.value.map(p => p.id)\n    saveChatHistory()\n  }\n  \n  ElMessage.success(`å·²å…³è” ${selectedPapers.value.length} ç¯‡è®ºæ–‡ï¼ŒRAGå°†ä¼˜å…ˆæ£€ç´¢è¿™äº›è®ºæ–‡`)\n}\n\nconst viewPaper = (paperId) => {\n  window.open(`#/papers/${paperId}`, '_blank')\n}\n\n// ==================== è®¾ç½® ====================\nconst saveSettings = () => {\n  localStorage.setItem('kimi_chat_settings', JSON.stringify(settings.value))\n  showSettings.value = false\n  ElMessage.success('è®¾ç½®å·²ä¿å­˜')\n}\n\nconst loadSettings = () => {\n  try {\n    const saved = localStorage.getItem('kimi_chat_settings')\n    if (saved) {\n      settings.value = { ...settings.value, ...JSON.parse(saved) }\n    }\n  } catch (e) {\n    console.error('åŠ è½½è®¾ç½®å¤±è´¥:', e)\n  }\n}\n\n// ==================== æ–‡ä»¶ä¸Šä¼  ====================\nconst handleUpload = () => {\n  // åˆ›å»ºéšè—çš„æ–‡ä»¶è¾“å…¥\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.accept = '.txt,.pdf,.doc,.docx,.md,.py,.js,.json,.java,.c,.cpp,.html,.css'\n  input.multiple = true\n  input.style.display = 'none'\n  input.onchange = (e) => {\n    handleFileSelect(e)\n    // æ¸…ç†åˆ›å»ºçš„inputå…ƒç´ \n    document.body.removeChild(input)\n  }\n  document.body.appendChild(input)\n  input.click()\n}\n\nconst handleFileSelect = async (event) => {\n  const files = event.target.files\n  if (!files || files.length === 0) return\n  \n  isUploading.value = true\n  \n  for (const file of files) {\n    // æ£€æŸ¥æ–‡ä»¶å¤§å° (10MB)\n    if (file.size > 10 * 1024 * 1024) {\n      ElMessage.warning(`${file.name} è¶…è¿‡ 10MBï¼Œå·²è·³è¿‡`)\n      continue\n    }\n    \n    try {\n      const formData = new FormData()\n      formData.append('file', file)\n      \n      ElMessage.info(`æ­£åœ¨ä¸Šä¼  ${file.name}...`)\n      \n      const response = await fetch('/api/chat/upload', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`\n        },\n        body: formData\n      })\n      \n      const result = await response.json()\n      \n      if (result.success) {\n        uploadedFiles.value.push({\n          name: result.data.filename,\n          hash: result.data.file_hash,\n          content: result.data.content,\n          content_type: result.data.content_type,\n          size: result.data.size\n        })\n        ElMessage.success(`${file.name} ä¸Šä¼ æˆåŠŸ`)\n      } else {\n        ElMessage.error(`${file.name} ä¸Šä¼ å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`)\n      }\n    } catch (error) {\n      console.error('ä¸Šä¼ é”™è¯¯:', error)\n      ElMessage.error(`${file.name} ä¸Šä¼ å¤±è´¥: ${error.message || 'ç½‘ç»œé”™è¯¯'}`)\n    }\n  }\n  \n  isUploading.value = false\n}\n\nconst removeFile = (index) => {\n  uploadedFiles.value.splice(index, 1)\n}\n\n// ç›‘å¬è®ºæ–‡é€‰æ‹©å¯¹è¯æ¡†æ‰“å¼€\nwatch(showPaperSelector, async (newVal) => {\n  if (newVal) {\n    // å¯¹è¯æ¡†æ‰“å¼€æ—¶åŠ è½½è®ºæ–‡åˆ—è¡¨\n    await loadPapers()\n    \n    // åˆå§‹åŒ–å·²é€‰æ‹©çš„è®ºæ–‡\n    await nextTick()\n    if (paperTable.value && selectedPapers.value.length > 0) {\n      // æ¸…ç©ºå½“å‰é€‰æ‹©\n      paperTable.value.clearSelection()\n      \n      // é‡æ–°é€‰ä¸­å·²å…³è”çš„è®ºæ–‡\n      selectedPapers.value.forEach(paper => {\n        const row = papers.value.find(p => p.id === paper.id)\n        if (row) {\n          paperTable.value.toggleRowSelection(row, true)\n        }\n      })\n    }\n    \n    // åŒæ­¥tempSelectedPapers\n    tempSelectedPapers.value = [...selectedPapers.value]\n  }\n})\n\n// ==================== ç”Ÿå‘½å‘¨æœŸ ====================\nonMounted(() => {\n  loadChatHistory()\n  loadPapers()\n  loadSettings()\n\n  // å¦‚æœæ²¡æœ‰ä¼šè¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„\n  if (chatHistory.value.length === 0) {\n    createNewChat()\n  } else {\n    // åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªä¼šè¯\n    switchChat(chatHistory.value[0].chat_id)\n  }\n  \n  // æ£€æŸ¥ä¸Šä¼ æŒ‰é’®å¯ç”¨æ€§\n  console.log('[DEBUG] KimiChat å·²æŒ‚è½½ï¼Œä¸Šä¼ åŠŸèƒ½å·²å°±ç»ª')\n})\n</script>\n\n<style scoped>\n.kimi-chat-container {\n  display: flex;\n  height: calc(100vh - 64px);\n  background: #f9fafb;\n}\n\n/* ==================== ä¾§è¾¹æ  ==================== */\n.sidebar {\n  width: 260px;\n  background: #ffffff;\n  border-right: 1px solid #e5e7eb;\n  display: flex;\n  flex-direction: column;\n  transition: width 0.3s ease;\n}\n\n.sidebar.collapsed {\n  width: 60px;\n}\n\n.sidebar-header {\n  padding: 16px;\n  display: flex;\n  gap: 8px;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.new-chat-btn {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 10px 16px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: white;\n  border: none;\n  border-radius: 10px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.new-chat-btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n}\n\n.collapse-btn {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #f3f4f6;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.collapse-btn:hover {\n  background: #e5e7eb;\n}\n\n.sidebar.collapsed .new-chat-btn span {\n  display: none;\n}\n\n/* å¯¹è¯å†å² */\n.chat-history {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px;\n}\n\n.chat-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  border-radius: 8px;\n  cursor: pointer;\n  margin-bottom: 4px;\n  transition: all 0.2s;\n  position: relative;\n}\n\n.chat-item:hover {\n  background: #f3f4f6;\n}\n\n.chat-item.active {\n  background: #d1fae5;\n}\n\n.chat-item.active .chat-title {\n  color: #059669;\n  font-weight: 500;\n}\n\n.chat-icon {\n  font-size: 16px;\n  color: #6b7280;\n  flex-shrink: 0;\n}\n\n.chat-item.active .chat-icon {\n  color: #059669;\n}\n\n.chat-title {\n  flex: 1;\n  font-size: 14px;\n  color: #374151;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.chat-actions {\n  opacity: 0;\n  transition: opacity 0.2s;\n}\n\n.chat-item:hover .chat-actions {\n  opacity: 1;\n}\n\n.more-icon {\n  padding: 4px;\n  border-radius: 4px;\n  color: #6b7280;\n  cursor: pointer;\n}\n\n.more-icon:hover {\n  background: #e5e7eb;\n  color: #374151;\n}\n\n.sidebar.collapsed .chat-title,\n.sidebar.collapsed .chat-actions {\n  display: none;\n}\n\n/* ä¾§è¾¹æ åº•éƒ¨ */\n.sidebar-footer {\n  padding: 12px 16px;\n  border-top: 1px solid #e5e7eb;\n}\n\n.footer-btn {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  background: transparent;\n  border: none;\n  border-radius: 8px;\n  color: #6b7280;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.footer-btn:hover {\n  background: #f3f4f6;\n  color: #374151;\n}\n\n.sidebar.collapsed .footer-btn span {\n  display: none;\n}\n\n/* ==================== ä¸»èŠå¤©åŒºåŸŸ ==================== */\n.chat-main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n/* é¡¶éƒ¨å¯¼èˆª */\n.chat-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 24px;\n  background: #ffffff;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.chat-title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #111827;\n  margin: 0;\n}\n\n.header-right {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.model-select {\n  width: 140px;\n}\n\n/* æ¶ˆæ¯åŒºåŸŸ */\n.messages-area {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px;\n}\n\n/* æ¬¢è¿é¡µé¢ */\n.welcome-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 100%;\n  text-align: center;\n  padding: 40px 20px;\n}\n\n.welcome-logo {\n  margin-bottom: 24px;\n  animation: float 3s ease-in-out infinite;\n}\n\n@keyframes float {\n  0%, 100% { transform: translateY(0); }\n  50% { transform: translateY(-10px); }\n}\n\n.welcome-title {\n  font-size: 32px;\n  font-weight: 700;\n  color: #111827;\n  margin-bottom: 12px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n.welcome-subtitle {\n  font-size: 16px;\n  color: #6b7280;\n  max-width: 500px;\n  margin-bottom: 40px;\n}\n\n/* å¿«æ·å¡ç‰‡ */\n.quick-cards {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 16px;\n  max-width: 600px;\n  margin-bottom: 48px;\n}\n\n.quick-card {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 10px;\n  padding: 20px 16px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.quick-card:hover {\n  border-color: #10b981;\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);\n  transform: translateY(-2px);\n}\n\n.quick-card span {\n  font-size: 14px;\n  color: #374151;\n  font-weight: 500;\n}\n\n.quick-card:hover span {\n  color: #059669;\n}\n\n/* ç¤ºä¾‹é—®é¢˜ */\n.example-questions {\n  max-width: 600px;\n}\n\n.section-title {\n  font-size: 14px;\n  color: #9ca3af;\n  margin-bottom: 16px;\n}\n\n.question-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  justify-content: center;\n}\n\n.question-tag {\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.question-tag:hover {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n/* æ¶ˆæ¯æ ·å¼ */\n.message-wrapper {\n  display: flex;\n  gap: 12px;\n  margin-bottom: 24px;\n  max-width: 90%;\n}\n\n.message-wrapper.user-message {\n  margin-left: auto;\n  flex-direction: row-reverse;\n}\n\n.message-wrapper.ai-message {\n  margin-right: auto;\n}\n\n.message-avatar {\n  flex-shrink: 0;\n}\n\n.ai-avatar {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  border-radius: 50%;\n  color: white;\n}\n\n.message-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.message-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 6px;\n}\n\n.user-message .message-header {\n  justify-content: flex-end;\n}\n\n.message-role {\n  font-size: 13px;\n  font-weight: 600;\n  color: #374151;\n}\n\n.message-time {\n  font-size: 12px;\n  color: #9ca3af;\n}\n\n.message-body {\n  padding: 14px 18px;\n  border-radius: 12px;\n  font-size: 15px;\n  line-height: 1.7;\n  color: #374151;\n}\n\n.user-message .message-body {\n  background: #10b981;\n  color: white;\n  border-bottom-right-radius: 4px;\n}\n\n.ai-message .message-body {\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-bottom-left-radius: 4px;\n}\n\n.ai-message .message-body :deep(p) {\n  margin: 0 0 12px 0;\n}\n\n.ai-message .message-body :deep(p:last-child) {\n  margin-bottom: 0;\n}\n\n.ai-message .message-body :deep(pre) {\n  background: #1f2937;\n  border-radius: 8px;\n  padding: 16px;\n  overflow-x: auto;\n  margin: 12px 0;\n}\n\n.ai-message .message-body :deep(code) {\n  font-family: 'Menlo', 'Monaco', 'Courier New', monospace;\n  font-size: 13px;\n}\n\n.ai-message .message-body :deep(:not(pre) > code) {\n  background: #f3f4f6;\n  padding: 2px 6px;\n  border-radius: 4px;\n  color: #ec4899;\n}\n\n.ai-message .message-body :deep(ul), .ai-message .message-body :deep(ol) {\n  padding-left: 20px;\n  margin: 12px 0;\n}\n\n.ai-message .message-body :deep(li) {\n  margin: 6px 0;\n}\n\n.ai-message .message-body :deep(h1), .ai-message .message-body :deep(h2), .ai-message .message-body :deep(h3) {\n  margin: 20px 0 12px 0;\n  color: #111827;\n}\n\n.ai-message .message-body :deep(blockquote) {\n  border-left: 4px solid #10b981;\n  margin: 12px 0;\n  padding: 8px 16px;\n  background: #f0fdf4;\n  border-radius: 0 8px 8px 0;\n}\n\n/* å¼•ç”¨æ–‡çŒ® */\n.message-references {\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px dashed #e5e7eb;\n}\n\n.ref-title {\n  font-size: 12px;\n  color: #9ca3af;\n  margin-bottom: 8px;\n}\n\n.ref-list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.ref-tag {\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.ref-tag:hover {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n/* æ­£åœ¨è¾“å…¥åŠ¨ç”» */\n.typing-indicator {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 16px 18px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  border-bottom-left-radius: 4px;\n}\n\n.typing-indicator span {\n  width: 8px;\n  height: 8px;\n  background: #10b981;\n  border-radius: 50%;\n  animation: typing 1.4s infinite ease-in-out both;\n}\n\n.typing-indicator span:nth-child(1) {\n  animation-delay: -0.32s;\n}\n\n.typing-indicator span:nth-child(2) {\n  animation-delay: -0.16s;\n}\n\n@keyframes typing {\n  0%, 80%, 100% {\n    transform: scale(0);\n    opacity: 0.5;\n  }\n  40% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n/* ==================== è¾“å…¥åŒºåŸŸ ==================== */\n.input-area {\n  background: #ffffff;\n  border-top: 1px solid #e5e7eb;\n  padding: 16px 24px;\n}\n\n.input-toolbar {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 10px;\n}\n\n.tool-btn {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  color: #6b7280;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n}\n\n.tool-btn:hover {\n  background: #f3f4f6;\n  color: #374151;\n}\n\n.tool-btn.active {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n.tool-btn .badge {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  width: 18px;\n  height: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #ef4444;\n  color: white;\n  font-size: 11px;\n  border-radius: 50%;\n}\n\n.input-box {\n  display: flex;\n  gap: 12px;\n  align-items: flex-end;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  padding: 12px 16px;\n  transition: all 0.2s;\n}\n\n.input-box:focus-within {\n  background: #ffffff;\n  border-color: #10b981;\n  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);\n}\n\n.input-box :deep(.el-textarea__inner) {\n  background: transparent;\n  border: none;\n  padding: 0;\n  font-size: 15px;\n  resize: none;\n  box-shadow: none;\n}\n\n.input-box :deep(.el-textarea__inner:focus) {\n  box-shadow: none;\n}\n\n.send-btn {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  border: none;\n  border-radius: 10px;\n  color: white;\n  cursor: pointer;\n  transition: all 0.2s;\n  flex-shrink: 0;\n}\n\n.send-btn:hover:not(:disabled) {\n  transform: scale(1.05);\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n}\n\n.send-btn:disabled {\n  background: #d1d5db;\n  cursor: not-allowed;\n}\n\n.send-btn .loading {\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n.input-hint {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 8px;\n  font-size: 12px;\n  color: #9ca3af;\n}\n\n/* ==================== å¯¹è¯æ¡†æ ·å¼ ==================== */\n.dialog-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.paper-selector {\n  max-height: 500px;\n}\n\n.paper-search {\n  margin-bottom: 16px;\n}\n\n.slider-hint {\n  font-size: 12px;\n  color: #9ca3af;\n  margin-top: 4px;\n}\n\n/* å…³è”è®ºæ–‡å¸®åŠ©æç¤º */\n.paper-help-alert {\n  margin-bottom: 16px;\n}\n\n.paper-help-content {\n  font-size: 13px;\n  line-height: 1.6;\n}\n\n.paper-help-content p {\n  margin: 4px 0;\n}\n\n.paper-help-content ul {\n  margin: 4px 0;\n  padding-left: 20px;\n}\n\n.paper-help-content li {\n  margin: 2px 0;\n}\n\n/* å·²ä¸Šä¼ æ–‡ä»¶æ˜¾ç¤º */\n.uploaded-files {\n  margin-bottom: 12px;\n  padding: 12px;\n  background: #f0fdf4;\n  border: 1px solid #bbf7d0;\n  border-radius: 8px;\n}\n\n.uploaded-files-title {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-size: 13px;\n  color: #166534;\n  font-weight: 500;\n  margin-bottom: 8px;\n}\n\n.uploaded-files-list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.uploaded-file-tag {\n  max-width: 200px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* ä¸‹æ‹‰èœå•å±é™©é¡¹ */\n:deep(.el-dropdown-menu__item.danger) {\n  color: #ef4444;\n}\n\n:deep(.el-dropdown-menu__item.danger:hover) {\n  background: #fef2f2;\n  color: #dc2626;\n}\n\n/* å“åº”å¼ */\n@media (max-width: 768px) {\n  .sidebar {\n    position: absolute;\n    z-index: 100;\n    height: 100%;\n  }\n\n  .sidebar.collapsed {\n    transform: translateX(-100%);\n  }\n\n  .quick-cards {\n    grid-template-columns: repeat(2, 1fr);\n  }\n\n  .message-wrapper {\n    max-width: 100%;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}