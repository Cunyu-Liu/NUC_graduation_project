{"ast":null,"code":"import { ref, inject, computed, nextTick } from 'vue';\nimport { getValidDateOfYear, getValidDateOfMonth } from '../utils.mjs';\nimport { PICKER_BASE_INJECTION_KEY } from '../../../time-picker/src/constants.mjs';\nimport { useLocale } from '../../../../hooks/use-locale/index.mjs';\nconst usePanelDateRange = (props, emit, leftDate, rightDate) => {\n  const leftCurrentView = ref(\"date\");\n  const leftCurrentViewRef = ref();\n  const rightCurrentView = ref(\"date\");\n  const rightCurrentViewRef = ref();\n  const pickerBase = inject(PICKER_BASE_INJECTION_KEY);\n  const {\n    disabledDate\n  } = pickerBase.props;\n  const {\n    t,\n    lang\n  } = useLocale();\n  const leftYear = computed(() => {\n    return leftDate.value.year();\n  });\n  const leftMonth = computed(() => {\n    return leftDate.value.month();\n  });\n  const rightYear = computed(() => {\n    return rightDate.value.year();\n  });\n  const rightMonth = computed(() => {\n    return rightDate.value.month();\n  });\n  function computedYearLabel(currentView, yearValue) {\n    const yearTranslation = t(\"el.datepicker.year\");\n    if (currentView.value === \"year\") {\n      const startYear = Math.floor(yearValue.value / 10) * 10;\n      return yearTranslation ? `${startYear} ${yearTranslation} - ${startYear + 9} ${yearTranslation}` : `${startYear} - ${startYear + 9}`;\n    }\n    return `${yearValue.value} ${yearTranslation}`;\n  }\n  function focusPicker(currentViewRef) {\n    currentViewRef == null ? void 0 : currentViewRef.focus();\n  }\n  async function showPicker(pickerType, view) {\n    if (props.disabled) return;\n    const currentView = pickerType === \"left\" ? leftCurrentView : rightCurrentView;\n    const currentViewRef = pickerType === \"left\" ? leftCurrentViewRef : rightCurrentViewRef;\n    currentView.value = view;\n    await nextTick();\n    focusPicker(currentViewRef.value);\n  }\n  async function handlePick(mode, pickerType, value) {\n    if (props.disabled) return;\n    const isLeftPicker = pickerType === \"left\";\n    const startDate = isLeftPicker ? leftDate : rightDate;\n    const endDate = isLeftPicker ? rightDate : leftDate;\n    const currentView = isLeftPicker ? leftCurrentView : rightCurrentView;\n    const currentViewRef = isLeftPicker ? leftCurrentViewRef : rightCurrentViewRef;\n    if (mode === \"year\") {\n      const data = startDate.value.year(value);\n      startDate.value = getValidDateOfYear(data, lang.value, disabledDate);\n    }\n    if (mode === \"month\") {\n      startDate.value = getValidDateOfMonth(startDate.value, startDate.value.year(), value, lang.value, disabledDate);\n    }\n    if (!props.unlinkPanels) {\n      endDate.value = pickerType === \"left\" ? startDate.value.add(1, \"month\") : startDate.value.subtract(1, \"month\");\n    }\n    currentView.value = mode === \"year\" ? \"month\" : \"date\";\n    await nextTick();\n    focusPicker(currentViewRef.value);\n    handlePanelChange(mode);\n  }\n  function handlePanelChange(mode) {\n    emit(\"panel-change\", [leftDate.value.toDate(), rightDate.value.toDate()], mode);\n  }\n  function adjustDateByView(currentView, date, forward) {\n    const action = forward ? \"add\" : \"subtract\";\n    return currentView === \"year\" ? date[action](10, \"year\") : date[action](1, \"year\");\n  }\n  return {\n    leftCurrentView,\n    rightCurrentView,\n    leftCurrentViewRef,\n    rightCurrentViewRef,\n    leftYear,\n    rightYear,\n    leftMonth,\n    rightMonth,\n    leftYearLabel: computed(() => computedYearLabel(leftCurrentView, leftYear)),\n    rightYearLabel: computed(() => computedYearLabel(rightCurrentView, rightYear)),\n    showLeftPicker: view => showPicker(\"left\", view),\n    showRightPicker: view => showPicker(\"right\", view),\n    handleLeftYearPick: year => handlePick(\"year\", \"left\", year),\n    handleRightYearPick: year => handlePick(\"year\", \"right\", year),\n    handleLeftMonthPick: month => handlePick(\"month\", \"left\", month),\n    handleRightMonthPick: month => handlePick(\"month\", \"right\", month),\n    handlePanelChange,\n    adjustDateByView\n  };\n};\nexport { usePanelDateRange };","map":{"version":3,"names":["usePanelDateRange","props","emit","leftDate","rightDate","leftCurrentView","ref","leftCurrentViewRef","rightCurrentView","rightCurrentViewRef","pickerBase","inject","PICKER_BASE_INJECTION_KEY","disabledDate","t","lang","useLocale","leftYear","computed","value","year","leftMonth","month","rightYear","rightMonth","computedYearLabel","currentView","yearValue","yearTranslation","startYear","Math","floor","focusPicker","currentViewRef","focus","showPicker","pickerType","view","disabled","nextTick","handlePick","mode","isLeftPicker","startDate","endDate","data","getValidDateOfYear","getValidDateOfMonth","unlinkPanels","add","subtract","handlePanelChange","toDate","adjustDateByView","date","forward","action","leftYearLabel","rightYearLabel","showLeftPicker","showRightPicker","handleLeftYearPick","handleRightYearPick","handleLeftMonthPick","handleRightMonthPick"],"sources":["../../../../../../../packages/components/date-picker-panel/src/composables/use-panel-date-range.ts"],"sourcesContent":["import { computed, inject, nextTick, ref } from 'vue'\nimport { useLocale } from '@element-plus/hooks'\nimport { PICKER_BASE_INJECTION_KEY } from '@element-plus/components/time-picker'\nimport { getValidDateOfMonth, getValidDateOfYear } from '../utils'\n\nimport type { PanelDateRangeProps } from '../props/panel-date-range'\nimport type { Dayjs } from 'dayjs'\nimport type { ComputedRef, Ref } from 'vue'\n\ntype CurrentView = 'date' | 'year' | 'month'\ntype CurrentViewRef = { focus: () => void }\n\nexport type Emits = (\n  event: 'pick' | 'set-picker-option' | 'calendar-change' | 'panel-change',\n  ...args: any[]\n) => void\n\nexport const usePanelDateRange = (\n  props: PanelDateRangeProps,\n  emit: Emits,\n  leftDate: Ref<Dayjs>,\n  rightDate: Ref<Dayjs>\n) => {\n  const leftCurrentView = ref<CurrentView>('date')\n  const leftCurrentViewRef = ref<CurrentViewRef>()\n  const rightCurrentView = ref<CurrentView>('date')\n  const rightCurrentViewRef = ref<CurrentViewRef>()\n  const pickerBase = inject(PICKER_BASE_INJECTION_KEY) as any\n  const { disabledDate } = pickerBase.props\n  const { t, lang } = useLocale()\n\n  const leftYear = computed(() => {\n    return leftDate.value.year()\n  })\n  const leftMonth = computed(() => {\n    return leftDate.value.month()\n  })\n\n  const rightYear = computed(() => {\n    return rightDate.value.year()\n  })\n  const rightMonth = computed(() => {\n    return rightDate.value.month()\n  })\n\n  function computedYearLabel(\n    currentView: Ref<CurrentView>,\n    yearValue: ComputedRef<number>\n  ) {\n    const yearTranslation = t('el.datepicker.year')\n    if (currentView.value === 'year') {\n      const startYear = Math.floor(yearValue.value! / 10) * 10\n      return yearTranslation\n        ? `${startYear} ${yearTranslation} - ${\n            startYear + 9\n          } ${yearTranslation}`\n        : `${startYear} - ${startYear + 9}`\n    }\n    return `${yearValue.value} ${yearTranslation}`\n  }\n\n  function focusPicker(currentViewRef?: CurrentViewRef) {\n    currentViewRef?.focus()\n  }\n\n  async function showPicker(\n    pickerType: 'left' | 'right',\n    view: 'month' | 'year'\n  ) {\n    if (props.disabled) return\n    const currentView =\n      pickerType === 'left' ? leftCurrentView : rightCurrentView\n    const currentViewRef =\n      pickerType === 'left' ? leftCurrentViewRef : rightCurrentViewRef\n    currentView.value = view\n    await nextTick()\n    focusPicker(currentViewRef.value)\n  }\n\n  async function handlePick(\n    mode: 'month' | 'year',\n    pickerType: 'left' | 'right',\n    value: number\n  ) {\n    if (props.disabled) return\n    const isLeftPicker = pickerType === 'left'\n    const startDate = isLeftPicker ? leftDate : rightDate\n    const endDate = isLeftPicker ? rightDate : leftDate\n    const currentView = isLeftPicker ? leftCurrentView : rightCurrentView\n    const currentViewRef = isLeftPicker\n      ? leftCurrentViewRef\n      : rightCurrentViewRef\n\n    if (mode === 'year') {\n      const data = startDate.value.year(value)\n      startDate.value = getValidDateOfYear(data, lang.value, disabledDate)\n    }\n\n    if (mode === 'month') {\n      startDate.value = getValidDateOfMonth(\n        startDate.value,\n        startDate.value.year(),\n        value,\n        lang.value,\n        disabledDate\n      )\n    }\n\n    if (!props.unlinkPanels) {\n      endDate.value =\n        pickerType === 'left'\n          ? startDate.value.add(1, 'month')\n          : startDate.value.subtract(1, 'month')\n    }\n\n    currentView.value = mode === 'year' ? 'month' : 'date'\n    await nextTick()\n    focusPicker(currentViewRef.value)\n    handlePanelChange(mode)\n  }\n\n  function handlePanelChange(mode: 'month' | 'year') {\n    emit(\n      'panel-change',\n      [leftDate.value.toDate(), rightDate.value.toDate()],\n      mode\n    )\n  }\n\n  function adjustDateByView(\n    currentView: CurrentView,\n    date: Dayjs,\n    forward: boolean\n  ) {\n    const action = forward ? 'add' : 'subtract'\n    return currentView === 'year'\n      ? date[action](10, 'year')\n      : date[action](1, 'year')\n  }\n\n  return {\n    leftCurrentView,\n    rightCurrentView,\n    leftCurrentViewRef,\n    rightCurrentViewRef,\n    leftYear,\n    rightYear,\n    leftMonth,\n    rightMonth,\n    leftYearLabel: computed(() => computedYearLabel(leftCurrentView, leftYear)),\n    rightYearLabel: computed(() =>\n      computedYearLabel(rightCurrentView, rightYear)\n    ),\n    showLeftPicker: (view: 'month' | 'year') => showPicker('left', view),\n    showRightPicker: (view: 'month' | 'year') => showPicker('right', view),\n    handleLeftYearPick: (year: number) => handlePick('year', 'left', year),\n    handleRightYearPick: (year: number) => handlePick('year', 'right', year),\n    handleLeftMonthPick: (month: number) => handlePick('month', 'left', month),\n    handleRightMonthPick: (month: number) =>\n      handlePick('month', 'right', month),\n    handlePanelChange,\n    adjustDateByView,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}