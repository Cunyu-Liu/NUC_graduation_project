{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { ref, onMounted, computed, watch, nextTick } from 'vue';\nimport * as d3 from 'd3';\nimport { ElMessage } from 'element-plus';\nimport api from '@/api';\n\n// Props\n\nexport default {\n  __name: 'KnowledgeGraph',\n  props: {\n    paperIds: {\n      type: Array,\n      default: () => []\n    }\n  },\n  emits: ['build'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    const props = __props;\n    const emit = __emit;\n\n    // 响应式数据\n    const loading = ref(false);\n    const graphData = ref({\n      nodes: {},\n      edges: []\n    });\n    const drawerVisible = ref(false);\n    const selectedNode = ref(null);\n    const connectedNodes = ref([]);\n    const relationFilter = ref([]);\n\n    // D3相关\n    const svgElement = ref(null);\n    const graphContainer = ref(null);\n    let svg, g, simulation, zoom;\n\n    // 关系类型颜色映射\n    const relationColors = {\n      'cites': '#FF6B6B',\n      'extends': '#4ECDC4',\n      'improves': '#45B7D1',\n      'applies': '#FFA07A',\n      'contradicts': '#98D8C8',\n      'related': '#F7DC6F',\n      'similar': '#BB8FCE'\n    };\n\n    // 关系类型中文映射\n    const relationTypeNames = {\n      'cites': '引用',\n      'extends': '扩展',\n      'improves': '改进',\n      'applies': '应用',\n      'contradicts': '矛盾',\n      'related': '相关',\n      'similar': '相似'\n    };\n\n    // 计算属性\n    const relationTypes = computed(() => {\n      const types = new Set();\n      graphData.value.edges.forEach(edge => {\n        if (edge.type) types.add(edge.type);\n      });\n      return Array.from(types);\n    });\n    const filteredEdges = computed(() => {\n      if (relationFilter.value.length === 0) {\n        return graphData.value.edges;\n      }\n      return graphData.value.edges.filter(edge => relationFilter.value.includes(edge.type));\n    });\n\n    // 方法\n    const initGraph = () => {\n      if (!svgElement.value) return;\n      const container = graphContainer.value;\n      const width = container.clientWidth;\n      const height = container.clientHeight;\n\n      // 清除之前的SVG内容\n      d3.select(svgElement.value).selectAll('*').remove();\n\n      // 创建SVG\n      svg = d3.select(svgElement.value).attr('width', width).attr('height', height);\n\n      // 添加缩放行为\n      zoom = d3.zoom().scaleExtent([0.1, 4]).on('zoom', event => {\n        g.attr('transform', event.transform);\n      });\n      svg.call(zoom);\n\n      // 创建主分组\n      g = svg.append('g');\n\n      // 添加箭头标记\n      const defs = svg.append('defs');\n      Object.keys(relationColors).forEach(type => {\n        defs.append('marker').attr('id', `arrow-${type}`).attr('viewBox', '0 0 10 10').attr('refX', 25).attr('refY', 5).attr('markerWidth', 6).attr('markerHeight', 6).attr('orient', 'auto-start-reverse').append('path').attr('d', 'M 0 0 L 10 5 L 0 10 z').attr('fill', relationColors[type]);\n      });\n    };\n    const updateGraph = () => {\n      if (!g) return;\n\n      // 清除之前的内容\n      g.selectAll('*').remove();\n\n      // 准备节点数据\n      const nodes = Object.entries(graphData.value.nodes).map(([id, data]) => ({\n        id: parseInt(id),\n        ...data\n      }));\n\n      // 检查是否有数据\n      if (nodes.length === 0) {\n        console.log('[DEBUG] 没有节点数据');\n        return;\n      }\n      console.log(`[DEBUG] 渲染图谱: ${nodes.length} 个节点, ${filteredEdges.value.length} 条边`);\n\n      // 创建节点映射用于边的连接\n      const nodeMap = new Map(nodes.map(n => [n.id, n]));\n\n      // 准备边数据 - 确保source和target引用节点对象\n      const links = filteredEdges.value.map(edge => ({\n        ...edge,\n        source: nodeMap.get(edge.source),\n        target: nodeMap.get(edge.target)\n      })).filter(edge => edge.source && edge.target); // 过滤掉无效的边\n\n      // 创建力导向布局\n      simulation = d3.forceSimulation(nodes).force('link', d3.forceLink(links).id(d => d.id).distance(150)).force('charge', d3.forceManyBody().strength(-400)).force('center', d3.forceCenter(graphContainer.value.clientWidth / 2, graphContainer.value.clientHeight / 2)).force('collision', d3.forceCollide().radius(40));\n\n      // 绘制边\n      const linkElements = g.append('g').attr('class', 'links').selectAll('line').data(links).join('line').attr('stroke', d => relationColors[d.type] || '#999').attr('stroke-width', d => Math.max(2, d.strength * 4 || 2)).attr('marker-end', d => `url(#arrow-${d.type})`).attr('opacity', 0.7);\n\n      // 绘制边标签\n      const linkLabels = g.append('g').attr('class', 'link-labels').selectAll('text').data(links).join('text').text(d => d.type).attr('font-size', '10px').attr('fill', '#666').attr('text-anchor', 'middle').attr('dy', -5);\n\n      // 绘制节点组\n      const nodeElements = g.append('g').attr('class', 'nodes').selectAll('g').data(nodes).join('g').attr('class', 'node').call(d3.drag().on('start', dragstarted).on('drag', dragged).on('end', dragended)).on('click', (event, d) => showNodeDetail(d));\n\n      // 节点圆形 - 根据是否有关系调整大小\n      nodeElements.append('circle').attr('r', d => {\n        const connectionCount = links.filter(l => l.source.id === d.id || l.target.id === d.id).length;\n        return 20 + Math.min(connectionCount * 3, 15);\n      }).attr('fill', d => {\n        const connectionCount = links.filter(l => l.source.id === d.id || l.target.id === d.id).length;\n        // 连接越多，颜色越深\n        return d3.interpolateBlues(0.3 + Math.min(connectionCount * 0.1, 0.5));\n      }).attr('stroke', '#fff').attr('stroke-width', 2).style('cursor', 'pointer');\n\n      // 节点标签\n      nodeElements.append('text').text(d => {\n        const title = d.title || d.data?.title || 'Paper';\n        return title.length > 12 ? title.substring(0, 12) + '...' : title;\n      }).attr('x', 0).attr('y', 35).attr('text-anchor', 'middle').attr('font-size', '11px').attr('fill', '#333').attr('font-weight', '500');\n\n      // 更新位置\n      simulation.on('tick', () => {\n        linkElements.attr('x1', d => d.source.x).attr('y1', d => d.source.y).attr('x2', d => d.target.x).attr('y2', d => d.target.y);\n        linkLabels.attr('x', d => (d.source.x + d.target.x) / 2).attr('y', d => (d.source.y + d.target.y) / 2);\n        nodeElements.attr('transform', d => `translate(${d.x},${d.y})`);\n      });\n    };\n    const showNodeDetail = nodeData => {\n      selectedNode.value = {\n        data: nodeData\n      };\n\n      // 查找关联节点\n      connectedNodes.value = [];\n      filteredEdges.value.forEach(edge => {\n        const sourceId = typeof edge.source === 'object' ? edge.source.id : edge.source;\n        const targetId = typeof edge.target === 'object' ? edge.target.id : edge.target;\n        if (sourceId === nodeData.id) {\n          const connected = graphData.value.nodes[targetId];\n          if (connected) {\n            connectedNodes.value.push({\n              data: connected,\n              relation: edge.type\n            });\n          }\n        } else if (targetId === nodeData.id) {\n          const connected = graphData.value.nodes[sourceId];\n          if (connected) {\n            connectedNodes.value.push({\n              data: connected,\n              relation: edge.type\n            });\n          }\n        }\n      });\n      drawerVisible.value = true;\n    };\n    const focusNode = nodeId => {\n      // 缩放到指定节点\n      const node = graphData.value.nodes[nodeId];\n      if (node && svg) {\n        const transform = d3.zoomIdentity.translate(graphContainer.value.clientWidth / 2, graphContainer.value.clientHeight / 2).scale(2).translate(-node.x || 0, -node.y || 0);\n        svg.transition().duration(750).call(zoom.transform, transform);\n      }\n    };\n    const dragstarted = (event, d) => {\n      if (!event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    };\n    const dragged = (event, d) => {\n      d.fx = event.x;\n      d.fy = event.y;\n    };\n    const dragended = (event, d) => {\n      if (!event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    };\n    const getRelationColor = type => {\n      return relationColors[type] || '#999';\n    };\n    const refreshGraph = async () => {\n      loading.value = true;\n      try {\n        const response = await api.getKnowledgeGraph(props.paperIds);\n        if (response.success) {\n          graphData.value = response.data;\n          console.log('[DEBUG] 获取到图谱数据:', graphData.value);\n\n          // 等待DOM更新后再初始化图谱\n          await nextTick();\n          initGraph();\n          updateGraph();\n          const nodeCount = Object.keys(graphData.value.nodes).length;\n          const edgeCount = graphData.value.edges.length;\n          if (nodeCount > 0) {\n            ElMessage.success(`图谱加载成功: ${nodeCount} 个节点, ${edgeCount} 条边`);\n          } else {\n            ElMessage.info('暂无图谱数据，请先分析论文');\n          }\n        } else {\n          ElMessage.error(response.error || '图谱加载失败');\n        }\n      } catch (error) {\n        console.error('图谱加载失败:', error);\n        ElMessage.error('图谱加载失败: ' + (error.message || '未知错误'));\n      } finally {\n        loading.value = false;\n      }\n    };\n    const resetZoom = () => {\n      if (svg && zoom) {\n        svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);\n      }\n    };\n\n    // 暴露方法给父组件\n    __expose({\n      refreshGraph\n    });\n\n    // 生命周期\n    onMounted(async () => {\n      await refreshGraph();\n\n      // 响应式调整\n      window.addEventListener('resize', () => {\n        if (graphContainer.value && svgElement.value) {\n          const width = graphContainer.value.clientWidth;\n          const height = graphContainer.value.clientHeight;\n          d3.select(svgElement.value).attr('width', width).attr('height', height);\n        }\n      });\n    });\n\n    // 监听props变化\n    watch(() => props.paperIds, () => {\n      refreshGraph();\n    });\n\n    // 监听过滤器变化\n    watch(relationFilter, () => {\n      updateGraph();\n    });\n    const __returned__ = {\n      props,\n      emit,\n      loading,\n      graphData,\n      drawerVisible,\n      selectedNode,\n      connectedNodes,\n      relationFilter,\n      svgElement,\n      graphContainer,\n      get svg() {\n        return svg;\n      },\n      set svg(v) {\n        svg = v;\n      },\n      get g() {\n        return g;\n      },\n      set g(v) {\n        g = v;\n      },\n      get simulation() {\n        return simulation;\n      },\n      set simulation(v) {\n        simulation = v;\n      },\n      get zoom() {\n        return zoom;\n      },\n      set zoom(v) {\n        zoom = v;\n      },\n      relationColors,\n      relationTypeNames,\n      relationTypes,\n      filteredEdges,\n      initGraph,\n      updateGraph,\n      showNodeDetail,\n      focusNode,\n      dragstarted,\n      dragged,\n      dragended,\n      getRelationColor,\n      refreshGraph,\n      resetZoom,\n      ref,\n      onMounted,\n      computed,\n      watch,\n      nextTick,\n      get d3() {\n        return d3;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get api() {\n        return api;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","watch","nextTick","d3","ElMessage","api","props","__props","emit","__emit","loading","graphData","nodes","edges","drawerVisible","selectedNode","connectedNodes","relationFilter","svgElement","graphContainer","svg","g","simulation","zoom","relationColors","relationTypeNames","relationTypes","types","Set","value","forEach","edge","type","add","Array","from","filteredEdges","length","filter","includes","initGraph","container","width","clientWidth","height","clientHeight","select","selectAll","remove","attr","scaleExtent","on","event","transform","call","append","defs","Object","keys","updateGraph","entries","map","id","data","parseInt","console","log","nodeMap","Map","n","links","source","get","target","forceSimulation","force","forceLink","d","distance","forceManyBody","strength","forceCenter","forceCollide","radius","linkElements","join","Math","max","linkLabels","text","nodeElements","drag","dragstarted","dragged","dragended","showNodeDetail","connectionCount","l","min","interpolateBlues","style","title","substring","x","y","nodeData","sourceId","targetId","connected","push","relation","focusNode","nodeId","node","zoomIdentity","translate","scale","transition","duration","active","alphaTarget","restart","fx","fy","getRelationColor","refreshGraph","response","getKnowledgeGraph","paperIds","success","nodeCount","edgeCount","info","error","message","resetZoom","__expose","window","addEventListener"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/components/KnowledgeGraph.vue"],"sourcesContent":["<template>\n  <div class=\"knowledge-graph-container\">\n    <div class=\"graph-header\">\n      <h2>知识图谱可视化</h2>\n      <div class=\"controls\">\n        <el-button @click=\"refreshGraph\" icon=\"Refresh\" :loading=\"loading\">刷新</el-button>\n        <el-button @click=\"resetZoom\" icon=\"ZoomOut\">重置视图</el-button>\n        <el-select v-model=\"relationFilter\" placeholder=\"关系类型\" multiple style=\"width: 200px\">\n          <el-option v-for=\"type in relationTypes\" :key=\"type\" :label=\"relationTypeNames[type] || type\" :value=\"type\" />\n        </el-select>\n      </div>\n    </div>\n\n    <!-- SVG容器 -->\n    <div ref=\"graphContainer\" class=\"graph-container\">\n      <svg ref=\"svgElement\" width=\"100%\" height=\"100%\"></svg>\n\n      <!-- 空状态 -->\n      <el-empty\n        v-if=\"!loading && Object.keys(graphData.nodes).length === 0\"\n        description=\"暂无图谱数据，请先分析论文或构建图谱\"\n        class=\"graph-empty\"\n      >\n        <el-button type=\"primary\" @click=\"$emit('build')\">构建知识图谱</el-button>\n      </el-empty>\n\n      <!-- 只有节点没有边的情况 -->\n      <el-alert\n        v-if=\"!loading && Object.keys(graphData.nodes).length > 0 && filteredEdges.length === 0\"\n        title=\"论文已加载，暂无关系数据\"\n        type=\"info\"\n        :closable=\"false\"\n        class=\"graph-info\"\n      />\n    </div>\n\n    <!-- 加载状态 -->\n    <div v-if=\"loading\" class=\"loading-overlay\">\n      <el-icon class=\"is-loading\" :size=\"40\"><Loading /></el-icon>\n      <p>正在构建知识图谱...</p>\n    </div>\n\n    <!-- 节点详情面板 -->\n    <el-drawer v-model=\"drawerVisible\" title=\"节点详情\" size=\"400px\" direction=\"rtl\">\n      <div v-if=\"selectedNode\" class=\"node-detail\">\n        <h3>{{ selectedNode.data.title || '未命名论文' }}</h3>\n        <el-divider />\n\n        <el-descriptions :column=\"1\" border>\n          <el-descriptions-item label=\"ID\">{{ selectedNode.data.id }}</el-descriptions-item>\n          <el-descriptions-item label=\"年份\">{{ selectedNode.data.year || 'N/A' }}</el-descriptions-item>\n          <el-descriptions-item label=\"发表场所\">{{ selectedNode.data.venue || 'N/A' }}</el-descriptions-item>\n          <el-descriptions-item label=\"作者数量\">\n            {{ selectedNode.data.authors?.length || 0 }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"摘要长度\">\n            {{ selectedNode.data.abstract?.length || 0 }} 字符\n          </el-descriptions-item>\n        </el-descriptions>\n\n        <el-divider />\n\n        <!-- 关联论文 -->\n        <h4>关联论文</h4>\n        <div v-if=\"connectedNodes.length > 0\" class=\"connected-papers\">\n          <el-card\n            v-for=\"node in connectedNodes\"\n            :key=\"node.data.id\"\n            class=\"paper-card\"\n            shadow=\"hover\"\n          >\n            <div class=\"paper-title\" @click=\"focusNode(node.data.id)\">\n              {{ node.data.title || '未命名论文' }}\n            </div>\n            <div class=\"paper-meta\">\n              <span>{{ node.data.year || '未知年份' }}</span>\n              <span>{{ node.data.venue || '未知期刊' }}</span>\n            </div>\n          </el-card>\n        </div>\n        <el-empty v-else description=\"无关联论文\" />\n      </div>\n    </el-drawer>\n\n    <!-- 图例 -->\n    <div class=\"legend-panel\" v-if=\"relationTypes.length > 0\">\n      <div class=\"legend-title\">关系类型</div>\n      <div v-for=\"type in relationTypes\" :key=\"type\" class=\"legend-item\">\n        <span class=\"legend-color\" :style=\"{ backgroundColor: getRelationColor(type) }\"></span>\n        <span class=\"legend-label\">{{ type }}</span>\n      </div>\n    </div>\n\n    <!-- 统计信息 -->\n    <div class=\"stats-panel\" v-if=\"!loading\">\n      <el-tag type=\"info\">节点: {{ Object.keys(graphData.nodes).length }}</el-tag>\n      <el-tag type=\"success\" style=\"margin-left: 8px;\">关系: {{ filteredEdges.length }}</el-tag>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed, watch, nextTick } from 'vue'\nimport * as d3 from 'd3'\nimport { ElMessage } from 'element-plus'\nimport api from '@/api'\n\n// Props\nconst props = defineProps({\n  paperIds: {\n    type: Array,\n    default: () => []\n  }\n})\n\nconst emit = defineEmits(['build'])\n\n// 响应式数据\nconst loading = ref(false)\nconst graphData = ref({ nodes: {}, edges: [] })\nconst drawerVisible = ref(false)\nconst selectedNode = ref(null)\nconst connectedNodes = ref([])\nconst relationFilter = ref([])\n\n// D3相关\nconst svgElement = ref(null)\nconst graphContainer = ref(null)\nlet svg, g, simulation, zoom\n\n// 关系类型颜色映射\nconst relationColors = {\n  'cites': '#FF6B6B',\n  'extends': '#4ECDC4',\n  'improves': '#45B7D1',\n  'applies': '#FFA07A',\n  'contradicts': '#98D8C8',\n  'related': '#F7DC6F',\n  'similar': '#BB8FCE'\n}\n\n// 关系类型中文映射\nconst relationTypeNames = {\n  'cites': '引用',\n  'extends': '扩展',\n  'improves': '改进',\n  'applies': '应用',\n  'contradicts': '矛盾',\n  'related': '相关',\n  'similar': '相似'\n}\n\n// 计算属性\nconst relationTypes = computed(() => {\n  const types = new Set()\n  graphData.value.edges.forEach(edge => {\n    if (edge.type) types.add(edge.type)\n  })\n  return Array.from(types)\n})\n\nconst filteredEdges = computed(() => {\n  if (relationFilter.value.length === 0) {\n    return graphData.value.edges\n  }\n  return graphData.value.edges.filter(edge =>\n    relationFilter.value.includes(edge.type)\n  )\n})\n\n// 方法\nconst initGraph = () => {\n  if (!svgElement.value) return\n\n  const container = graphContainer.value\n  const width = container.clientWidth\n  const height = container.clientHeight\n\n  // 清除之前的SVG内容\n  d3.select(svgElement.value).selectAll('*').remove()\n\n  // 创建SVG\n  svg = d3.select(svgElement.value)\n    .attr('width', width)\n    .attr('height', height)\n\n  // 添加缩放行为\n  zoom = d3.zoom()\n    .scaleExtent([0.1, 4])\n    .on('zoom', (event) => {\n      g.attr('transform', event.transform)\n    })\n\n  svg.call(zoom)\n\n  // 创建主分组\n  g = svg.append('g')\n\n  // 添加箭头标记\n  const defs = svg.append('defs')\n  Object.keys(relationColors).forEach(type => {\n    defs.append('marker')\n      .attr('id', `arrow-${type}`)\n      .attr('viewBox', '0 0 10 10')\n      .attr('refX', 25)\n      .attr('refY', 5)\n      .attr('markerWidth', 6)\n      .attr('markerHeight', 6)\n      .attr('orient', 'auto-start-reverse')\n      .append('path')\n      .attr('d', 'M 0 0 L 10 5 L 0 10 z')\n      .attr('fill', relationColors[type])\n  })\n}\n\nconst updateGraph = () => {\n  if (!g) return\n\n  // 清除之前的内容\n  g.selectAll('*').remove()\n\n  // 准备节点数据\n  const nodes = Object.entries(graphData.value.nodes).map(([id, data]) => ({\n    id: parseInt(id),\n    ...data\n  }))\n\n  // 检查是否有数据\n  if (nodes.length === 0) {\n    console.log('[DEBUG] 没有节点数据')\n    return\n  }\n\n  console.log(`[DEBUG] 渲染图谱: ${nodes.length} 个节点, ${filteredEdges.value.length} 条边`)\n\n  // 创建节点映射用于边的连接\n  const nodeMap = new Map(nodes.map(n => [n.id, n]))\n\n  // 准备边数据 - 确保source和target引用节点对象\n  const links = filteredEdges.value.map(edge => ({\n    ...edge,\n    source: nodeMap.get(edge.source),\n    target: nodeMap.get(edge.target)\n  })).filter(edge => edge.source && edge.target) // 过滤掉无效的边\n\n  // 创建力导向布局\n  simulation = d3.forceSimulation(nodes)\n    .force('link', d3.forceLink(links)\n      .id(d => d.id)\n      .distance(150)\n    )\n    .force('charge', d3.forceManyBody().strength(-400))\n    .force('center', d3.forceCenter(\n      graphContainer.value.clientWidth / 2,\n      graphContainer.value.clientHeight / 2\n    ))\n    .force('collision', d3.forceCollide().radius(40))\n\n  // 绘制边\n  const linkElements = g.append('g')\n    .attr('class', 'links')\n    .selectAll('line')\n    .data(links)\n    .join('line')\n    .attr('stroke', d => relationColors[d.type] || '#999')\n    .attr('stroke-width', d => Math.max(2, d.strength * 4 || 2))\n    .attr('marker-end', d => `url(#arrow-${d.type})`)\n    .attr('opacity', 0.7)\n\n  // 绘制边标签\n  const linkLabels = g.append('g')\n    .attr('class', 'link-labels')\n    .selectAll('text')\n    .data(links)\n    .join('text')\n    .text(d => d.type)\n    .attr('font-size', '10px')\n    .attr('fill', '#666')\n    .attr('text-anchor', 'middle')\n    .attr('dy', -5)\n\n  // 绘制节点组\n  const nodeElements = g.append('g')\n    .attr('class', 'nodes')\n    .selectAll('g')\n    .data(nodes)\n    .join('g')\n    .attr('class', 'node')\n    .call(d3.drag()\n      .on('start', dragstarted)\n      .on('drag', dragged)\n      .on('end', dragended)\n    )\n    .on('click', (event, d) => showNodeDetail(d))\n\n  // 节点圆形 - 根据是否有关系调整大小\n  nodeElements.append('circle')\n    .attr('r', d => {\n      const connectionCount = links.filter(l => l.source.id === d.id || l.target.id === d.id).length\n      return 20 + Math.min(connectionCount * 3, 15)\n    })\n    .attr('fill', d => {\n      const connectionCount = links.filter(l => l.source.id === d.id || l.target.id === d.id).length\n      // 连接越多，颜色越深\n      return d3.interpolateBlues(0.3 + Math.min(connectionCount * 0.1, 0.5))\n    })\n    .attr('stroke', '#fff')\n    .attr('stroke-width', 2)\n    .style('cursor', 'pointer')\n\n  // 节点标签\n  nodeElements.append('text')\n    .text(d => {\n      const title = d.title || d.data?.title || 'Paper'\n      return title.length > 12 ? title.substring(0, 12) + '...' : title\n    })\n    .attr('x', 0)\n    .attr('y', 35)\n    .attr('text-anchor', 'middle')\n    .attr('font-size', '11px')\n    .attr('fill', '#333')\n    .attr('font-weight', '500')\n\n  // 更新位置\n  simulation.on('tick', () => {\n    linkElements\n      .attr('x1', d => d.source.x)\n      .attr('y1', d => d.source.y)\n      .attr('x2', d => d.target.x)\n      .attr('y2', d => d.target.y)\n\n    linkLabels\n      .attr('x', d => (d.source.x + d.target.x) / 2)\n      .attr('y', d => (d.source.y + d.target.y) / 2)\n\n    nodeElements\n      .attr('transform', d => `translate(${d.x},${d.y})`)\n  })\n}\n\nconst showNodeDetail = (nodeData) => {\n  selectedNode.value = { data: nodeData }\n\n  // 查找关联节点\n  connectedNodes.value = []\n  filteredEdges.value.forEach(edge => {\n    const sourceId = typeof edge.source === 'object' ? edge.source.id : edge.source\n    const targetId = typeof edge.target === 'object' ? edge.target.id : edge.target\n\n    if (sourceId === nodeData.id) {\n      const connected = graphData.value.nodes[targetId]\n      if (connected) {\n        connectedNodes.value.push({ data: connected, relation: edge.type })\n      }\n    } else if (targetId === nodeData.id) {\n      const connected = graphData.value.nodes[sourceId]\n      if (connected) {\n        connectedNodes.value.push({ data: connected, relation: edge.type })\n      }\n    }\n  })\n\n  drawerVisible.value = true\n}\n\nconst focusNode = (nodeId) => {\n  // 缩放到指定节点\n  const node = graphData.value.nodes[nodeId]\n  if (node && svg) {\n    const transform = d3.zoomIdentity\n      .translate(\n        graphContainer.value.clientWidth / 2,\n        graphContainer.value.clientHeight / 2\n      )\n      .scale(2)\n      .translate(-node.x || 0, -node.y || 0)\n\n    svg.transition()\n      .duration(750)\n      .call(zoom.transform, transform)\n  }\n}\n\nconst dragstarted = (event, d) => {\n  if (!event.active) simulation.alphaTarget(0.3).restart()\n  d.fx = d.x\n  d.fy = d.y\n}\n\nconst dragged = (event, d) => {\n  d.fx = event.x\n  d.fy = event.y\n}\n\nconst dragended = (event, d) => {\n  if (!event.active) simulation.alphaTarget(0)\n  d.fx = null\n  d.fy = null\n}\n\nconst getRelationColor = (type) => {\n  return relationColors[type] || '#999'\n}\n\nconst refreshGraph = async () => {\n  loading.value = true\n  try {\n    const response = await api.getKnowledgeGraph(props.paperIds)\n    if (response.success) {\n      graphData.value = response.data\n      console.log('[DEBUG] 获取到图谱数据:', graphData.value)\n\n      // 等待DOM更新后再初始化图谱\n      await nextTick()\n      initGraph()\n      updateGraph()\n\n      const nodeCount = Object.keys(graphData.value.nodes).length\n      const edgeCount = graphData.value.edges.length\n\n      if (nodeCount > 0) {\n        ElMessage.success(`图谱加载成功: ${nodeCount} 个节点, ${edgeCount} 条边`)\n      } else {\n        ElMessage.info('暂无图谱数据，请先分析论文')\n      }\n    } else {\n      ElMessage.error(response.error || '图谱加载失败')\n    }\n  } catch (error) {\n    console.error('图谱加载失败:', error)\n    ElMessage.error('图谱加载失败: ' + (error.message || '未知错误'))\n  } finally {\n    loading.value = false\n  }\n}\n\nconst resetZoom = () => {\n  if (svg && zoom) {\n    svg.transition()\n      .duration(750)\n      .call(zoom.transform, d3.zoomIdentity)\n  }\n}\n\n// 暴露方法给父组件\ndefineExpose({\n  refreshGraph\n})\n\n// 生命周期\nonMounted(async () => {\n  await refreshGraph()\n\n  // 响应式调整\n  window.addEventListener('resize', () => {\n    if (graphContainer.value && svgElement.value) {\n      const width = graphContainer.value.clientWidth\n      const height = graphContainer.value.clientHeight\n      d3.select(svgElement.value)\n        .attr('width', width)\n        .attr('height', height)\n    }\n  })\n})\n\n// 监听props变化\nwatch(() => props.paperIds, () => {\n  refreshGraph()\n})\n\n// 监听过滤器变化\nwatch(relationFilter, () => {\n  updateGraph()\n})\n</script>\n\n<style scoped>\n.knowledge-graph-container {\n  width: 100%;\n  height: calc(100vh - 200px);\n  display: flex;\n  flex-direction: column;\n  background: #f8f9fa;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.graph-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px;\n  border-bottom: 1px solid #e0e0e0;\n  background: white;\n}\n\n.graph-header h2 {\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.controls {\n  display: flex;\n  gap: 12px;\n}\n\n.graph-container {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n}\n\n.graph-empty {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n\n.graph-info {\n  position: absolute;\n  top: 10px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: auto;\n}\n\n.loading-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  background: rgba(255, 255, 255, 0.9);\n  z-index: 10;\n}\n\n.node-detail h3 {\n  font-size: 18px;\n  margin-bottom: 16px;\n  color: #303133;\n}\n\n.connected-papers {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.paper-card {\n  cursor: pointer;\n}\n\n.paper-title {\n  font-size: 14px;\n  font-weight: 600;\n  color: #409EFF;\n  margin-bottom: 8px;\n}\n\n.paper-title:hover {\n  text-decoration: underline;\n}\n\n.paper-meta {\n  display: flex;\n  gap: 12px;\n  font-size: 12px;\n  color: #909399;\n}\n\n.legend-panel {\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n  background: rgba(255, 255, 255, 0.95);\n  padding: 16px;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n  max-height: 200px;\n  overflow-y: auto;\n}\n\n.legend-title {\n  font-weight: 600;\n  margin-bottom: 12px;\n}\n\n.legend-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 8px;\n  font-size: 12px;\n}\n\n.legend-color {\n  width: 20px;\n  height: 4px;\n  border-radius: 2px;\n}\n\n.stats-panel {\n  position: absolute;\n  bottom: 20px;\n  left: 20px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}