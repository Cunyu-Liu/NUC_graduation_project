{"ast":null,"code":"import { ref, reactive, defineComponent, h, Transition, withCtx, withDirectives, createVNode, vShow, createApp, toRefs } from 'vue';\nimport { useGlobalComponentSettings } from '../../config-provider/src/hooks/use-global-config.mjs';\nimport { removeClass } from '../../../utils/dom/style.mjs';\nfunction createLoadingComponent(options, appContext) {\n  let afterLeaveTimer;\n  const afterLeaveFlag = ref(false);\n  const data = reactive({\n    ...options,\n    originalPosition: \"\",\n    originalOverflow: \"\",\n    visible: false\n  });\n  function setText(text) {\n    data.text = text;\n  }\n  function destroySelf() {\n    const target = data.parent;\n    const ns = vm.ns;\n    if (!target.vLoadingAddClassList) {\n      let loadingNumber = target.getAttribute(\"loading-number\");\n      loadingNumber = Number.parseInt(loadingNumber) - 1;\n      if (!loadingNumber) {\n        removeClass(target, ns.bm(\"parent\", \"relative\"));\n        target.removeAttribute(\"loading-number\");\n      } else {\n        target.setAttribute(\"loading-number\", loadingNumber.toString());\n      }\n      removeClass(target, ns.bm(\"parent\", \"hidden\"));\n    }\n    removeElLoadingChild();\n    loadingInstance.unmount();\n  }\n  function removeElLoadingChild() {\n    var _a, _b;\n    (_b = (_a = vm.$el) == null ? void 0 : _a.parentNode) == null ? void 0 : _b.removeChild(vm.$el);\n  }\n  function close() {\n    var _a;\n    if (options.beforeClose && !options.beforeClose()) return;\n    afterLeaveFlag.value = true;\n    clearTimeout(afterLeaveTimer);\n    afterLeaveTimer = setTimeout(handleAfterLeave, 400);\n    data.visible = false;\n    (_a = options.closed) == null ? void 0 : _a.call(options);\n  }\n  function handleAfterLeave() {\n    if (!afterLeaveFlag.value) return;\n    const target = data.parent;\n    afterLeaveFlag.value = false;\n    target.vLoadingAddClassList = void 0;\n    destroySelf();\n  }\n  const elLoadingComponent = defineComponent({\n    name: \"ElLoading\",\n    setup(_, {\n      expose\n    }) {\n      const {\n        ns,\n        zIndex\n      } = useGlobalComponentSettings(\"loading\");\n      expose({\n        ns,\n        zIndex\n      });\n      return () => {\n        const svg = data.spinner || data.svg;\n        const spinner = h(\"svg\", {\n          class: \"circular\",\n          viewBox: data.svgViewBox ? data.svgViewBox : \"0 0 50 50\",\n          ...(svg ? {\n            innerHTML: svg\n          } : {})\n        }, [h(\"circle\", {\n          class: \"path\",\n          cx: \"25\",\n          cy: \"25\",\n          r: \"20\",\n          fill: \"none\"\n        })]);\n        const spinnerText = data.text ? h(\"p\", {\n          class: ns.b(\"text\")\n        }, [data.text]) : void 0;\n        return h(Transition, {\n          name: ns.b(\"fade\"),\n          onAfterLeave: handleAfterLeave\n        }, {\n          default: withCtx(() => [withDirectives(createVNode(\"div\", {\n            style: {\n              backgroundColor: data.background || \"\"\n            },\n            class: [ns.b(\"mask\"), data.customClass, ns.is(\"fullscreen\", data.fullscreen)]\n          }, [h(\"div\", {\n            class: ns.b(\"spinner\")\n          }, [spinner, spinnerText])]), [[vShow, data.visible]])])\n        });\n      };\n    }\n  });\n  const loadingInstance = createApp(elLoadingComponent);\n  Object.assign(loadingInstance._context, appContext != null ? appContext : {});\n  const vm = loadingInstance.mount(document.createElement(\"div\"));\n  return {\n    ...toRefs(data),\n    setText,\n    removeElLoadingChild,\n    close,\n    handleAfterLeave,\n    vm,\n    get $el() {\n      return vm.$el;\n    }\n  };\n}\nexport { createLoadingComponent };","map":{"version":3,"names":["createLoadingComponent","options","appContext","afterLeaveTimer","afterLeaveFlag","ref","data","reactive","originalPosition","originalOverflow","visible","setText","text","destroySelf","target","parent","ns","vm","vLoadingAddClassList","loadingNumber","getAttribute","Number","parseInt","removeClass","bm","removeAttribute","setAttribute","toString","removeElLoadingChild","loadingInstance","unmount","_a","_b","$el","parentNode","removeChild","close","beforeClose","value","clearTimeout","setTimeout","handleAfterLeave","closed","call","elLoadingComponent","defineComponent","name","setup","_","expose","zIndex","useGlobalComponentSettings","svg","spinner","h","class","viewBox","svgViewBox","innerHTML","cx","cy","r","fill","spinnerText","b","Transition","onAfterLeave","default","withCtx","withDirectives","createVNode","style","backgroundColor","background","customClass","is","fullscreen","vShow","createApp","Object","assign","_context","mount","document","createElement","toRefs"],"sources":["../../../../../../packages/components/loading/src/loading.ts"],"sourcesContent":["import {\n  Transition,\n  createApp,\n  createVNode,\n  defineComponent,\n  h,\n  reactive,\n  ref,\n  toRefs,\n  vShow,\n  withCtx,\n  withDirectives,\n} from 'vue'\nimport { removeClass } from '@element-plus/utils'\nimport { useGlobalComponentSettings } from '@element-plus/components/config-provider'\n\nimport type { AppContext, VNode } from 'vue'\nimport type { UseNamespaceReturn } from '@element-plus/hooks'\nimport type { LoadingOptionsResolved } from './types'\n\nexport function createLoadingComponent(\n  options: LoadingOptionsResolved,\n  appContext: AppContext | null\n) {\n  let afterLeaveTimer: ReturnType<typeof setTimeout>\n  // IMPORTANT NOTE: this is only a hacking way to expose the injections on an\n  // instance, DO NOT FOLLOW this pattern in your own code.\n  const afterLeaveFlag = ref(false)\n  const data = reactive({\n    ...options,\n    originalPosition: '',\n    originalOverflow: '',\n    visible: false,\n  })\n\n  function setText(text: string | VNode | VNode[]) {\n    data.text = text\n  }\n\n  function destroySelf() {\n    const target = data.parent\n    const ns = (vm as any).ns as UseNamespaceReturn\n    if (!target.vLoadingAddClassList) {\n      let loadingNumber: number | string | null =\n        target.getAttribute('loading-number')\n      loadingNumber = Number.parseInt(loadingNumber as any) - 1\n      if (!loadingNumber) {\n        removeClass(target, ns.bm('parent', 'relative'))\n        target.removeAttribute('loading-number')\n      } else {\n        target.setAttribute('loading-number', loadingNumber.toString())\n      }\n      removeClass(target, ns.bm('parent', 'hidden'))\n    }\n    removeElLoadingChild()\n    loadingInstance.unmount()\n  }\n  function removeElLoadingChild(): void {\n    vm.$el?.parentNode?.removeChild(vm.$el)\n  }\n  function close() {\n    if (options.beforeClose && !options.beforeClose()) return\n\n    afterLeaveFlag.value = true\n    clearTimeout(afterLeaveTimer)\n\n    afterLeaveTimer = setTimeout(handleAfterLeave, 400)\n    data.visible = false\n\n    options.closed?.()\n  }\n\n  function handleAfterLeave() {\n    if (!afterLeaveFlag.value) return\n    const target = data.parent\n    afterLeaveFlag.value = false\n    target.vLoadingAddClassList = undefined\n    destroySelf()\n  }\n\n  const elLoadingComponent = defineComponent({\n    name: 'ElLoading',\n    setup(_, { expose }) {\n      const { ns, zIndex } = useGlobalComponentSettings('loading')\n\n      expose({\n        ns,\n        zIndex,\n      })\n\n      return () => {\n        const svg = data.spinner || data.svg\n        const spinner = h(\n          'svg',\n          {\n            class: 'circular',\n            viewBox: data.svgViewBox ? data.svgViewBox : '0 0 50 50',\n            ...(svg ? { innerHTML: svg } : {}),\n          },\n          [\n            h('circle', {\n              class: 'path',\n              cx: '25',\n              cy: '25',\n              r: '20',\n              fill: 'none',\n            }),\n          ]\n        )\n\n        const spinnerText = data.text\n          ? h('p', { class: ns.b('text') }, [data.text])\n          : undefined\n\n        return h(\n          Transition,\n          {\n            name: ns.b('fade'),\n            onAfterLeave: handleAfterLeave,\n          },\n          {\n            default: withCtx(() => [\n              withDirectives(\n                createVNode(\n                  'div',\n                  {\n                    style: {\n                      backgroundColor: data.background || '',\n                    },\n                    class: [\n                      ns.b('mask'),\n                      data.customClass,\n                      ns.is('fullscreen', data.fullscreen),\n                    ],\n                  },\n                  [\n                    h(\n                      'div',\n                      {\n                        class: ns.b('spinner'),\n                      },\n                      [spinner, spinnerText]\n                    ),\n                  ]\n                ),\n                [[vShow, data.visible]]\n              ),\n            ]),\n          }\n        )\n      }\n    },\n  })\n\n  const loadingInstance = createApp(elLoadingComponent)\n  Object.assign(loadingInstance._context, appContext ?? {})\n  const vm = loadingInstance.mount(document.createElement('div'))\n\n  return {\n    ...toRefs(data),\n    setText,\n    removeElLoadingChild,\n    close,\n    handleAfterLeave,\n    vm,\n    get $el(): HTMLElement {\n      return vm.$el\n    },\n  }\n}\n\nexport type LoadingInstance = ReturnType<typeof createLoadingComponent>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}