{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = {\n  class: \"knowledge-graph-container\"\n};\nconst _hoisted_2 = {\n  class: \"graph-header\"\n};\nconst _hoisted_3 = {\n  class: \"controls\"\n};\nconst _hoisted_4 = {\n  ref: \"graphContainer\",\n  class: \"graph-container\"\n};\nconst _hoisted_5 = {\n  ref: \"svgElement\",\n  width: \"100%\",\n  height: \"100%\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"loading-overlay\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"node-detail\"\n};\nconst _hoisted_8 = {\n  key: 0,\n  class: \"connected-papers\"\n};\nconst _hoisted_9 = [\"onClick\"];\nconst _hoisted_10 = {\n  class: \"paper-meta\"\n};\nconst _hoisted_11 = {\n  key: 1,\n  class: \"legend-panel\"\n};\nconst _hoisted_12 = {\n  class: \"legend-label\"\n};\nconst _hoisted_13 = {\n  key: 2,\n  class: \"stats-panel\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_el_empty = _resolveComponent(\"el-empty\");\n  const _component_el_alert = _resolveComponent(\"el-alert\");\n  const _component_Loading = _resolveComponent(\"Loading\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_divider = _resolveComponent(\"el-divider\");\n  const _component_el_descriptions_item = _resolveComponent(\"el-descriptions-item\");\n  const _component_el_descriptions = _resolveComponent(\"el-descriptions\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_el_drawer = _resolveComponent(\"el-drawer\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[5] || (_cache[5] = _createElementVNode(\"h2\", null, \"知识图谱可视化\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_button, {\n    onClick: $setup.refreshGraph,\n    icon: \"Refresh\",\n    loading: $setup.loading\n  }, {\n    default: _withCtx(() => [...(_cache[3] || (_cache[3] = [_createTextVNode(\"刷新\", -1 /* CACHED */)]))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"loading\"]), _createVNode(_component_el_button, {\n    onClick: $setup.resetZoom,\n    icon: \"ZoomOut\"\n  }, {\n    default: _withCtx(() => [...(_cache[4] || (_cache[4] = [_createTextVNode(\"重置视图\", -1 /* CACHED */)]))]),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_el_select, {\n    modelValue: $setup.relationFilter,\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.relationFilter = $event),\n    placeholder: \"关系类型\",\n    multiple: \"\",\n    style: {\n      \"width\": \"200px\"\n    }\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.relationTypes, type => {\n      return _openBlock(), _createBlock(_component_el_option, {\n        key: type,\n        label: type,\n        value: type\n      }, null, 8 /* PROPS */, [\"label\", \"value\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"])])]), _createCommentVNode(\" SVG容器 \"), _createElementVNode(\"div\", _hoisted_4, [(_openBlock(), _createElementBlock(\"svg\", _hoisted_5, null, 512 /* NEED_PATCH */)), _createCommentVNode(\" 空状态 \"), !$setup.loading && Object.keys($setup.graphData.nodes).length === 0 ? (_openBlock(), _createBlock(_component_el_empty, {\n    key: 0,\n    description: \"暂无图谱数据，请先分析论文或构建图谱\",\n    class: \"graph-empty\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: _cache[1] || (_cache[1] = $event => _ctx.$emit('build'))\n    }, {\n      default: _withCtx(() => [...(_cache[6] || (_cache[6] = [_createTextVNode(\"构建知识图谱\", -1 /* CACHED */)]))]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  })) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 只有节点没有边的情况 \"), !$setup.loading && Object.keys($setup.graphData.nodes).length > 0 && $setup.filteredEdges.length === 0 ? (_openBlock(), _createBlock(_component_el_alert, {\n    key: 1,\n    title: \"论文已加载，暂无关系数据\",\n    type: \"info\",\n    closable: false,\n    class: \"graph-info\"\n  })) : _createCommentVNode(\"v-if\", true)], 512 /* NEED_PATCH */), _createCommentVNode(\" 加载状态 \"), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_createVNode(_component_el_icon, {\n    class: \"is-loading\",\n    size: 40\n  }, {\n    default: _withCtx(() => [_createVNode(_component_Loading)]),\n    _: 1 /* STABLE */\n  }), _cache[7] || (_cache[7] = _createElementVNode(\"p\", null, \"正在构建知识图谱...\", -1 /* CACHED */))])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 节点详情面板 \"), _createVNode(_component_el_drawer, {\n    modelValue: $setup.drawerVisible,\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.drawerVisible = $event),\n    title: \"节点详情\",\n    size: \"400px\",\n    direction: \"rtl\"\n  }, {\n    default: _withCtx(() => [$setup.selectedNode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [_createElementVNode(\"h3\", null, _toDisplayString($setup.selectedNode.data.title || '未命名论文'), 1 /* TEXT */), _createVNode(_component_el_divider), _createVNode(_component_el_descriptions, {\n      column: 1,\n      border: \"\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_descriptions_item, {\n        label: \"ID\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.selectedNode.data.id), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_descriptions_item, {\n        label: \"年份\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.selectedNode.data.year || 'N/A'), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_descriptions_item, {\n        label: \"发表场所\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.selectedNode.data.venue || 'N/A'), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_descriptions_item, {\n        label: \"作者数量\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.selectedNode.data.authors?.length || 0), 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_el_descriptions_item, {\n        label: \"摘要长度\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString($setup.selectedNode.data.abstract?.length || 0) + \" 字符 \", 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_divider), _createCommentVNode(\" 关联论文 \"), _cache[8] || (_cache[8] = _createElementVNode(\"h4\", null, \"关联论文\", -1 /* CACHED */)), $setup.connectedNodes.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.connectedNodes, node => {\n      return _openBlock(), _createBlock(_component_el_card, {\n        key: node.data.id,\n        class: \"paper-card\",\n        shadow: \"hover\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"div\", {\n          class: \"paper-title\",\n          onClick: $event => $setup.focusNode(node.data.id)\n        }, _toDisplayString(node.data.title || '未命名论文'), 9 /* TEXT, PROPS */, _hoisted_9), _createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"span\", null, _toDisplayString(node.data.year || '未知年份'), 1 /* TEXT */), _createElementVNode(\"span\", null, _toDisplayString(node.data.venue || '未知期刊'), 1 /* TEXT */)])]),\n        _: 2 /* DYNAMIC */\n      }, 1024 /* DYNAMIC_SLOTS */);\n    }), 128 /* KEYED_FRAGMENT */))])) : (_openBlock(), _createBlock(_component_el_empty, {\n      key: 1,\n      description: \"无关联论文\"\n    }))])) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"modelValue\"]), _createCommentVNode(\" 图例 \"), $setup.relationTypes.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [_cache[9] || (_cache[9] = _createElementVNode(\"div\", {\n    class: \"legend-title\"\n  }, \"关系类型\", -1 /* CACHED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.relationTypes, type => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: type,\n      class: \"legend-item\"\n    }, [_createElementVNode(\"span\", {\n      class: \"legend-color\",\n      style: _normalizeStyle({\n        backgroundColor: $setup.getRelationColor(type)\n      })\n    }, null, 4 /* STYLE */), _createElementVNode(\"span\", _hoisted_12, _toDisplayString(type), 1 /* TEXT */)]);\n  }), 128 /* KEYED_FRAGMENT */))])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 统计信息 \"), !$setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [_createVNode(_component_el_tag, {\n    type: \"info\"\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"节点: \" + _toDisplayString(Object.keys($setup.graphData.nodes).length), 1 /* TEXT */)]),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_el_tag, {\n    type: \"success\",\n    style: {\n      \"margin-left\": \"8px\"\n    }\n  }, {\n    default: _withCtx(() => [_createTextVNode(\"关系: \" + _toDisplayString($setup.filteredEdges.length), 1 /* TEXT */)]),\n    _: 1 /* STABLE */\n  })])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","ref","width","height","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_el_button","onClick","$setup","refreshGraph","icon","loading","_cache","resetZoom","_component_el_select","relationFilter","$event","placeholder","multiple","style","_Fragment","_renderList","relationTypes","type","_createBlock","_component_el_option","key","label","value","_createCommentVNode","_hoisted_4","_hoisted_5","Object","keys","graphData","nodes","length","_component_el_empty","description","_ctx","$emit","filteredEdges","_component_el_alert","title","closable","_hoisted_6","_component_el_icon","size","_component_Loading","_component_el_drawer","drawerVisible","direction","selectedNode","_hoisted_7","_toDisplayString","data","_component_el_divider","_component_el_descriptions","column","border","_component_el_descriptions_item","id","year","venue","authors","abstract","connectedNodes","_hoisted_8","node","_component_el_card","shadow","focusNode","_hoisted_9","_hoisted_10","_hoisted_11","_normalizeStyle","backgroundColor","getRelationColor","_hoisted_12","_hoisted_13","_component_el_tag"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/components/KnowledgeGraph.vue"],"sourcesContent":["<template>\n  <div class=\"knowledge-graph-container\">\n    <div class=\"graph-header\">\n      <h2>知识图谱可视化</h2>\n      <div class=\"controls\">\n        <el-button @click=\"refreshGraph\" icon=\"Refresh\" :loading=\"loading\">刷新</el-button>\n        <el-button @click=\"resetZoom\" icon=\"ZoomOut\">重置视图</el-button>\n        <el-select v-model=\"relationFilter\" placeholder=\"关系类型\" multiple style=\"width: 200px\">\n          <el-option v-for=\"type in relationTypes\" :key=\"type\" :label=\"type\" :value=\"type\" />\n        </el-select>\n      </div>\n    </div>\n\n    <!-- SVG容器 -->\n    <div ref=\"graphContainer\" class=\"graph-container\">\n      <svg ref=\"svgElement\" width=\"100%\" height=\"100%\"></svg>\n\n      <!-- 空状态 -->\n      <el-empty\n        v-if=\"!loading && Object.keys(graphData.nodes).length === 0\"\n        description=\"暂无图谱数据，请先分析论文或构建图谱\"\n        class=\"graph-empty\"\n      >\n        <el-button type=\"primary\" @click=\"$emit('build')\">构建知识图谱</el-button>\n      </el-empty>\n\n      <!-- 只有节点没有边的情况 -->\n      <el-alert\n        v-if=\"!loading && Object.keys(graphData.nodes).length > 0 && filteredEdges.length === 0\"\n        title=\"论文已加载，暂无关系数据\"\n        type=\"info\"\n        :closable=\"false\"\n        class=\"graph-info\"\n      />\n    </div>\n\n    <!-- 加载状态 -->\n    <div v-if=\"loading\" class=\"loading-overlay\">\n      <el-icon class=\"is-loading\" :size=\"40\"><Loading /></el-icon>\n      <p>正在构建知识图谱...</p>\n    </div>\n\n    <!-- 节点详情面板 -->\n    <el-drawer v-model=\"drawerVisible\" title=\"节点详情\" size=\"400px\" direction=\"rtl\">\n      <div v-if=\"selectedNode\" class=\"node-detail\">\n        <h3>{{ selectedNode.data.title || '未命名论文' }}</h3>\n        <el-divider />\n\n        <el-descriptions :column=\"1\" border>\n          <el-descriptions-item label=\"ID\">{{ selectedNode.data.id }}</el-descriptions-item>\n          <el-descriptions-item label=\"年份\">{{ selectedNode.data.year || 'N/A' }}</el-descriptions-item>\n          <el-descriptions-item label=\"发表场所\">{{ selectedNode.data.venue || 'N/A' }}</el-descriptions-item>\n          <el-descriptions-item label=\"作者数量\">\n            {{ selectedNode.data.authors?.length || 0 }}\n          </el-descriptions-item>\n          <el-descriptions-item label=\"摘要长度\">\n            {{ selectedNode.data.abstract?.length || 0 }} 字符\n          </el-descriptions-item>\n        </el-descriptions>\n\n        <el-divider />\n\n        <!-- 关联论文 -->\n        <h4>关联论文</h4>\n        <div v-if=\"connectedNodes.length > 0\" class=\"connected-papers\">\n          <el-card\n            v-for=\"node in connectedNodes\"\n            :key=\"node.data.id\"\n            class=\"paper-card\"\n            shadow=\"hover\"\n          >\n            <div class=\"paper-title\" @click=\"focusNode(node.data.id)\">\n              {{ node.data.title || '未命名论文' }}\n            </div>\n            <div class=\"paper-meta\">\n              <span>{{ node.data.year || '未知年份' }}</span>\n              <span>{{ node.data.venue || '未知期刊' }}</span>\n            </div>\n          </el-card>\n        </div>\n        <el-empty v-else description=\"无关联论文\" />\n      </div>\n    </el-drawer>\n\n    <!-- 图例 -->\n    <div class=\"legend-panel\" v-if=\"relationTypes.length > 0\">\n      <div class=\"legend-title\">关系类型</div>\n      <div v-for=\"type in relationTypes\" :key=\"type\" class=\"legend-item\">\n        <span class=\"legend-color\" :style=\"{ backgroundColor: getRelationColor(type) }\"></span>\n        <span class=\"legend-label\">{{ type }}</span>\n      </div>\n    </div>\n\n    <!-- 统计信息 -->\n    <div class=\"stats-panel\" v-if=\"!loading\">\n      <el-tag type=\"info\">节点: {{ Object.keys(graphData.nodes).length }}</el-tag>\n      <el-tag type=\"success\" style=\"margin-left: 8px;\">关系: {{ filteredEdges.length }}</el-tag>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed, watch, nextTick } from 'vue'\nimport * as d3 from 'd3'\nimport { ElMessage } from 'element-plus'\nimport api from '@/api'\n\n// Props\nconst props = defineProps({\n  paperIds: {\n    type: Array,\n    default: () => []\n  }\n})\n\nconst emit = defineEmits(['build'])\n\n// 响应式数据\nconst loading = ref(false)\nconst graphData = ref({ nodes: {}, edges: [] })\nconst drawerVisible = ref(false)\nconst selectedNode = ref(null)\nconst connectedNodes = ref([])\nconst relationFilter = ref([])\n\n// D3相关\nconst svgElement = ref(null)\nconst graphContainer = ref(null)\nlet svg, g, simulation, zoom\n\n// 关系类型颜色映射\nconst relationColors = {\n  'cites': '#FF6B6B',\n  'extends': '#4ECDC4',\n  'improves': '#45B7D1',\n  'applies': '#FFA07A',\n  'contradicts': '#98D8C8',\n  'related': '#F7DC6F',\n  'similar': '#BB8FCE'\n}\n\n// 计算属性\nconst relationTypes = computed(() => {\n  const types = new Set()\n  graphData.value.edges.forEach(edge => {\n    if (edge.type) types.add(edge.type)\n  })\n  return Array.from(types)\n})\n\nconst filteredEdges = computed(() => {\n  if (relationFilter.value.length === 0) {\n    return graphData.value.edges\n  }\n  return graphData.value.edges.filter(edge =>\n    relationFilter.value.includes(edge.type)\n  )\n})\n\n// 方法\nconst initGraph = () => {\n  if (!svgElement.value) return\n\n  const container = graphContainer.value\n  const width = container.clientWidth\n  const height = container.clientHeight\n\n  // 清除之前的SVG内容\n  d3.select(svgElement.value).selectAll('*').remove()\n\n  // 创建SVG\n  svg = d3.select(svgElement.value)\n    .attr('width', width)\n    .attr('height', height)\n\n  // 添加缩放行为\n  zoom = d3.zoom()\n    .scaleExtent([0.1, 4])\n    .on('zoom', (event) => {\n      g.attr('transform', event.transform)\n    })\n\n  svg.call(zoom)\n\n  // 创建主分组\n  g = svg.append('g')\n\n  // 添加箭头标记\n  const defs = svg.append('defs')\n  Object.keys(relationColors).forEach(type => {\n    defs.append('marker')\n      .attr('id', `arrow-${type}`)\n      .attr('viewBox', '0 0 10 10')\n      .attr('refX', 25)\n      .attr('refY', 5)\n      .attr('markerWidth', 6)\n      .attr('markerHeight', 6)\n      .attr('orient', 'auto-start-reverse')\n      .append('path')\n      .attr('d', 'M 0 0 L 10 5 L 0 10 z')\n      .attr('fill', relationColors[type])\n  })\n}\n\nconst updateGraph = () => {\n  if (!g) return\n\n  // 清除之前的内容\n  g.selectAll('*').remove()\n\n  // 准备节点数据\n  const nodes = Object.entries(graphData.value.nodes).map(([id, data]) => ({\n    id: parseInt(id),\n    ...data\n  }))\n\n  // 检查是否有数据\n  if (nodes.length === 0) {\n    console.log('[DEBUG] 没有节点数据')\n    return\n  }\n\n  console.log(`[DEBUG] 渲染图谱: ${nodes.length} 个节点, ${filteredEdges.value.length} 条边`)\n\n  // 创建节点映射用于边的连接\n  const nodeMap = new Map(nodes.map(n => [n.id, n]))\n\n  // 准备边数据 - 确保source和target引用节点对象\n  const links = filteredEdges.value.map(edge => ({\n    ...edge,\n    source: nodeMap.get(edge.source),\n    target: nodeMap.get(edge.target)\n  })).filter(edge => edge.source && edge.target) // 过滤掉无效的边\n\n  // 创建力导向布局\n  simulation = d3.forceSimulation(nodes)\n    .force('link', d3.forceLink(links)\n      .id(d => d.id)\n      .distance(150)\n    )\n    .force('charge', d3.forceManyBody().strength(-400))\n    .force('center', d3.forceCenter(\n      graphContainer.value.clientWidth / 2,\n      graphContainer.value.clientHeight / 2\n    ))\n    .force('collision', d3.forceCollide().radius(40))\n\n  // 绘制边\n  const linkElements = g.append('g')\n    .attr('class', 'links')\n    .selectAll('line')\n    .data(links)\n    .join('line')\n    .attr('stroke', d => relationColors[d.type] || '#999')\n    .attr('stroke-width', d => Math.max(2, d.strength * 4 || 2))\n    .attr('marker-end', d => `url(#arrow-${d.type})`)\n    .attr('opacity', 0.7)\n\n  // 绘制边标签\n  const linkLabels = g.append('g')\n    .attr('class', 'link-labels')\n    .selectAll('text')\n    .data(links)\n    .join('text')\n    .text(d => d.type)\n    .attr('font-size', '10px')\n    .attr('fill', '#666')\n    .attr('text-anchor', 'middle')\n    .attr('dy', -5)\n\n  // 绘制节点组\n  const nodeElements = g.append('g')\n    .attr('class', 'nodes')\n    .selectAll('g')\n    .data(nodes)\n    .join('g')\n    .attr('class', 'node')\n    .call(d3.drag()\n      .on('start', dragstarted)\n      .on('drag', dragged)\n      .on('end', dragended)\n    )\n    .on('click', (event, d) => showNodeDetail(d))\n\n  // 节点圆形 - 根据是否有关系调整大小\n  nodeElements.append('circle')\n    .attr('r', d => {\n      const connectionCount = links.filter(l => l.source.id === d.id || l.target.id === d.id).length\n      return 20 + Math.min(connectionCount * 3, 15)\n    })\n    .attr('fill', d => {\n      const connectionCount = links.filter(l => l.source.id === d.id || l.target.id === d.id).length\n      // 连接越多，颜色越深\n      return d3.interpolateBlues(0.3 + Math.min(connectionCount * 0.1, 0.5))\n    })\n    .attr('stroke', '#fff')\n    .attr('stroke-width', 2)\n    .style('cursor', 'pointer')\n\n  // 节点标签\n  nodeElements.append('text')\n    .text(d => {\n      const title = d.title || d.data?.title || 'Paper'\n      return title.length > 12 ? title.substring(0, 12) + '...' : title\n    })\n    .attr('x', 0)\n    .attr('y', 35)\n    .attr('text-anchor', 'middle')\n    .attr('font-size', '11px')\n    .attr('fill', '#333')\n    .attr('font-weight', '500')\n\n  // 更新位置\n  simulation.on('tick', () => {\n    linkElements\n      .attr('x1', d => d.source.x)\n      .attr('y1', d => d.source.y)\n      .attr('x2', d => d.target.x)\n      .attr('y2', d => d.target.y)\n\n    linkLabels\n      .attr('x', d => (d.source.x + d.target.x) / 2)\n      .attr('y', d => (d.source.y + d.target.y) / 2)\n\n    nodeElements\n      .attr('transform', d => `translate(${d.x},${d.y})`)\n  })\n}\n\nconst showNodeDetail = (nodeData) => {\n  selectedNode.value = { data: nodeData }\n\n  // 查找关联节点\n  connectedNodes.value = []\n  filteredEdges.value.forEach(edge => {\n    const sourceId = typeof edge.source === 'object' ? edge.source.id : edge.source\n    const targetId = typeof edge.target === 'object' ? edge.target.id : edge.target\n\n    if (sourceId === nodeData.id) {\n      const connected = graphData.value.nodes[targetId]\n      if (connected) {\n        connectedNodes.value.push({ data: connected, relation: edge.type })\n      }\n    } else if (targetId === nodeData.id) {\n      const connected = graphData.value.nodes[sourceId]\n      if (connected) {\n        connectedNodes.value.push({ data: connected, relation: edge.type })\n      }\n    }\n  })\n\n  drawerVisible.value = true\n}\n\nconst focusNode = (nodeId) => {\n  // 缩放到指定节点\n  const node = graphData.value.nodes[nodeId]\n  if (node && svg) {\n    const transform = d3.zoomIdentity\n      .translate(\n        graphContainer.value.clientWidth / 2,\n        graphContainer.value.clientHeight / 2\n      )\n      .scale(2)\n      .translate(-node.x || 0, -node.y || 0)\n\n    svg.transition()\n      .duration(750)\n      .call(zoom.transform, transform)\n  }\n}\n\nconst dragstarted = (event, d) => {\n  if (!event.active) simulation.alphaTarget(0.3).restart()\n  d.fx = d.x\n  d.fy = d.y\n}\n\nconst dragged = (event, d) => {\n  d.fx = event.x\n  d.fy = event.y\n}\n\nconst dragended = (event, d) => {\n  if (!event.active) simulation.alphaTarget(0)\n  d.fx = null\n  d.fy = null\n}\n\nconst getRelationColor = (type) => {\n  return relationColors[type] || '#999'\n}\n\nconst refreshGraph = async () => {\n  loading.value = true\n  try {\n    const response = await api.getKnowledgeGraph(props.paperIds)\n    if (response.success) {\n      graphData.value = response.data\n      console.log('[DEBUG] 获取到图谱数据:', graphData.value)\n\n      // 等待DOM更新后再初始化图谱\n      await nextTick()\n      initGraph()\n      updateGraph()\n\n      const nodeCount = Object.keys(graphData.value.nodes).length\n      const edgeCount = graphData.value.edges.length\n\n      if (nodeCount > 0) {\n        ElMessage.success(`图谱加载成功: ${nodeCount} 个节点, ${edgeCount} 条边`)\n      } else {\n        ElMessage.info('暂无图谱数据，请先分析论文')\n      }\n    } else {\n      ElMessage.error(response.error || '图谱加载失败')\n    }\n  } catch (error) {\n    console.error('图谱加载失败:', error)\n    ElMessage.error('图谱加载失败: ' + (error.message || '未知错误'))\n  } finally {\n    loading.value = false\n  }\n}\n\nconst resetZoom = () => {\n  if (svg && zoom) {\n    svg.transition()\n      .duration(750)\n      .call(zoom.transform, d3.zoomIdentity)\n  }\n}\n\n// 暴露方法给父组件\ndefineExpose({\n  refreshGraph\n})\n\n// 生命周期\nonMounted(async () => {\n  await refreshGraph()\n\n  // 响应式调整\n  window.addEventListener('resize', () => {\n    if (graphContainer.value && svgElement.value) {\n      const width = graphContainer.value.clientWidth\n      const height = graphContainer.value.clientHeight\n      d3.select(svgElement.value)\n        .attr('width', width)\n        .attr('height', height)\n    }\n  })\n})\n\n// 监听props变化\nwatch(() => props.paperIds, () => {\n  refreshGraph()\n})\n\n// 监听过滤器变化\nwatch(relationFilter, () => {\n  updateGraph()\n})\n</script>\n\n<style scoped>\n.knowledge-graph-container {\n  width: 100%;\n  height: calc(100vh - 200px);\n  display: flex;\n  flex-direction: column;\n  background: #f8f9fa;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.graph-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px;\n  border-bottom: 1px solid #e0e0e0;\n  background: white;\n}\n\n.graph-header h2 {\n  margin: 0;\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.controls {\n  display: flex;\n  gap: 12px;\n}\n\n.graph-container {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n}\n\n.graph-empty {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n\n.graph-info {\n  position: absolute;\n  top: 10px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: auto;\n}\n\n.loading-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  background: rgba(255, 255, 255, 0.9);\n  z-index: 10;\n}\n\n.node-detail h3 {\n  font-size: 18px;\n  margin-bottom: 16px;\n  color: #303133;\n}\n\n.connected-papers {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.paper-card {\n  cursor: pointer;\n}\n\n.paper-title {\n  font-size: 14px;\n  font-weight: 600;\n  color: #409EFF;\n  margin-bottom: 8px;\n}\n\n.paper-title:hover {\n  text-decoration: underline;\n}\n\n.paper-meta {\n  display: flex;\n  gap: 12px;\n  font-size: 12px;\n  color: #909399;\n}\n\n.legend-panel {\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n  background: rgba(255, 255, 255, 0.95);\n  padding: 16px;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n  max-height: 200px;\n  overflow-y: auto;\n}\n\n.legend-title {\n  font-weight: 600;\n  margin-bottom: 12px;\n}\n\n.legend-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 8px;\n  font-size: 12px;\n}\n\n.legend-color {\n  width: 20px;\n  height: 4px;\n  border-radius: 2px;\n}\n\n.stats-panel {\n  position: absolute;\n  bottom: 20px;\n  left: 20px;\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAA2B;;EAC/BA,KAAK,EAAC;AAAc;;EAElBA,KAAK,EAAC;AAAU;;EAUlBC,GAAG,EAAC,gBAAgB;EAACD,KAAK,EAAC;;;EACzBC,GAAG,EAAC,YAAY;EAACC,KAAK,EAAC,MAAM;EAACC,MAAM,EAAC;;;;EAsBxBH,KAAK,EAAC;;;;EAOCA,KAAK,EAAC;;;;EAoBSA,KAAK,EAAC;;;;EAUnCA,KAAK,EAAC;AAAY;;;EAW1BA,KAAK,EAAC;;;EAIDA,KAAK,EAAC;AAAc;;;EAKzBA,KAAK,EAAC;;;;;;;;;;;;;;;;uBA7FbI,mBAAA,CAiGM,OAjGNC,UAiGM,GAhGJC,mBAAA,CASM,OATNC,UASM,G,0BARJD,mBAAA,CAAgB,YAAZ,SAAO,qBACXA,mBAAA,CAMM,OANNE,UAMM,GALJC,YAAA,CAAiFC,oBAAA;IAArEC,OAAK,EAAEC,MAAA,CAAAC,YAAY;IAAEC,IAAI,EAAC,SAAS;IAAEC,OAAO,EAAEH,MAAA,CAAAG;;sBAAS,MAAE,KAAAC,MAAA,QAAAA,MAAA,O,iBAAF,IAAE,mB;;kCACrEP,YAAA,CAA6DC,oBAAA;IAAjDC,OAAK,EAAEC,MAAA,CAAAK,SAAS;IAAEH,IAAI,EAAC;;sBAAU,MAAI,KAAAE,MAAA,QAAAA,MAAA,O,iBAAJ,MAAI,mB;;MACjDP,YAAA,CAEYS,oBAAA;gBAFQN,MAAA,CAAAO,cAAc;+DAAdP,MAAA,CAAAO,cAAc,GAAAC,MAAA;IAAEC,WAAW,EAAC,MAAM;IAACC,QAAQ,EAAR,EAAQ;IAACC,KAAoB,EAApB;MAAA;IAAA;;sBACnD,MAA6B,E,kBAAxCnB,mBAAA,CAAmFoB,SAAA,QAAAC,WAAA,CAAzDb,MAAA,CAAAc,aAAa,EAArBC,IAAI;2BAAtBC,YAAA,CAAmFC,oBAAA;QAAzCC,GAAG,EAAEH,IAAI;QAAGI,KAAK,EAAEJ,IAAI;QAAGK,KAAK,EAAEL;;;;yCAKjFM,mBAAA,WAAc,EACd3B,mBAAA,CAoBM,OApBN4B,UAoBM,I,cAnBJ9B,mBAAA,CAAuD,OAAvD+B,UAAuD,gCAEvDF,mBAAA,SAAY,E,CAEHrB,MAAA,CAAAG,OAAO,IAAIqB,MAAM,CAACC,IAAI,CAACzB,MAAA,CAAA0B,SAAS,CAACC,KAAK,EAAEC,MAAM,U,cADvDZ,YAAA,CAMWa,mBAAA;;IAJTC,WAAW,EAAC,oBAAoB;IAChC1C,KAAK,EAAC;;sBAEN,MAAoE,CAApES,YAAA,CAAoEC,oBAAA;MAAzDiB,IAAI,EAAC,SAAS;MAAEhB,OAAK,EAAAK,MAAA,QAAAA,MAAA,MAAAI,MAAA,IAAEuB,IAAA,CAAAC,KAAK;;wBAAW,MAAM,KAAA5B,MAAA,QAAAA,MAAA,O,iBAAN,QAAM,mB;;;;2CAG1DiB,mBAAA,gBAAmB,E,CAEVrB,MAAA,CAAAG,OAAO,IAAIqB,MAAM,CAACC,IAAI,CAACzB,MAAA,CAAA0B,SAAS,CAACC,KAAK,EAAEC,MAAM,QAAQ5B,MAAA,CAAAiC,aAAa,CAACL,MAAM,U,cADnFZ,YAAA,CAMEkB,mBAAA;;IAJAC,KAAK,EAAC,cAAc;IACpBpB,IAAI,EAAC,MAAM;IACVqB,QAAQ,EAAE,KAAK;IAChBhD,KAAK,EAAC;mEAIViC,mBAAA,UAAa,EACFrB,MAAA,CAAAG,OAAO,I,cAAlBX,mBAAA,CAGM,OAHN6C,UAGM,GAFJxC,YAAA,CAA4DyC,kBAAA;IAAnDlD,KAAK,EAAC,YAAY;IAAEmD,IAAI,EAAE;;sBAAI,MAAW,CAAX1C,YAAA,CAAW2C,kBAAA,E;;gCAClD9C,mBAAA,CAAkB,WAAf,aAAW,oB,wCAGhB2B,mBAAA,YAAe,EACfxB,YAAA,CAuCY4C,oBAAA;gBAvCQzC,MAAA,CAAA0C,aAAa;+DAAb1C,MAAA,CAAA0C,aAAa,GAAAlC,MAAA;IAAE2B,KAAK,EAAC,MAAM;IAACI,IAAI,EAAC,OAAO;IAACI,SAAS,EAAC;;sBACrE,MAqCM,CArCK3C,MAAA,CAAA4C,YAAY,I,cAAvBpD,mBAAA,CAqCM,OArCNqD,UAqCM,GApCJnD,mBAAA,CAAiD,YAAAoD,gBAAA,CAA1C9C,MAAA,CAAA4C,YAAY,CAACG,IAAI,CAACZ,KAAK,6BAC9BtC,YAAA,CAAcmD,qBAAA,GAEdnD,YAAA,CAUkBoD,0BAAA;MAVAC,MAAM,EAAE,CAAC;MAAEC,MAAM,EAAN;;wBAC3B,MAAkF,CAAlFtD,YAAA,CAAkFuD,+BAAA;QAA5DjC,KAAK,EAAC;MAAI;0BAAC,MAA0B,C,kCAAvBnB,MAAA,CAAA4C,YAAY,CAACG,IAAI,CAACM,EAAE,iB;;UACxDxD,YAAA,CAA6FuD,+BAAA;QAAvEjC,KAAK,EAAC;MAAI;0BAAC,MAAqC,C,kCAAlCnB,MAAA,CAAA4C,YAAY,CAACG,IAAI,CAACO,IAAI,0B;;UAC1DzD,YAAA,CAAgGuD,+BAAA;QAA1EjC,KAAK,EAAC;MAAM;0BAAC,MAAsC,C,kCAAnCnB,MAAA,CAAA4C,YAAY,CAACG,IAAI,CAACQ,KAAK,0B;;UAC7D1D,YAAA,CAEuBuD,+BAAA;QAFDjC,KAAK,EAAC;MAAM;0BAChC,MAA4C,C,kCAAzCnB,MAAA,CAAA4C,YAAY,CAACG,IAAI,CAACS,OAAO,EAAE5B,MAAM,sB;;UAEtC/B,YAAA,CAEuBuD,+BAAA;QAFDjC,KAAK,EAAC;MAAM;0BAChC,MAA6C,C,kCAA1CnB,MAAA,CAAA4C,YAAY,CAACG,IAAI,CAACU,QAAQ,EAAE7B,MAAM,SAAQ,MAC/C,gB;;;;QAGF/B,YAAA,CAAcmD,qBAAA,GAEd3B,mBAAA,UAAa,E,0BACb3B,mBAAA,CAAa,YAAT,MAAI,qBACGM,MAAA,CAAA0D,cAAc,CAAC9B,MAAM,Q,cAAhCpC,mBAAA,CAeM,OAfNmE,UAeM,I,kBAdJnE,mBAAA,CAaUoB,SAAA,QAAAC,WAAA,CAZOb,MAAA,CAAA0D,cAAc,EAAtBE,IAAI;2BADb5C,YAAA,CAaU6C,kBAAA;QAXP3C,GAAG,EAAE0C,IAAI,CAACb,IAAI,CAACM,EAAE;QAClBjE,KAAK,EAAC,YAAY;QAClB0E,MAAM,EAAC;;0BAEP,MAEM,CAFNpE,mBAAA,CAEM;UAFDN,KAAK,EAAC,aAAa;UAAEW,OAAK,EAAAS,MAAA,IAAER,MAAA,CAAA+D,SAAS,CAACH,IAAI,CAACb,IAAI,CAACM,EAAE;4BAClDO,IAAI,CAACb,IAAI,CAACZ,KAAK,mCAAA6B,UAAA,GAEpBtE,mBAAA,CAGM,OAHNuE,WAGM,GAFJvE,mBAAA,CAA2C,cAAAoD,gBAAA,CAAlCc,IAAI,CAACb,IAAI,CAACO,IAAI,4BACvB5D,mBAAA,CAA4C,cAAAoD,gBAAA,CAAnCc,IAAI,CAACb,IAAI,CAACQ,KAAK,2B;;;uDAI9BvC,YAAA,CAAuCa,mBAAA;;MAAtBC,WAAW,EAAC;;;qCAIjCT,mBAAA,QAAW,EACqBrB,MAAA,CAAAc,aAAa,CAACc,MAAM,Q,cAApDpC,mBAAA,CAMM,OANN0E,WAMM,G,0BALJxE,mBAAA,CAAoC;IAA/BN,KAAK,EAAC;EAAc,GAAC,MAAI,sB,kBAC9BI,mBAAA,CAGMoB,SAAA,QAAAC,WAAA,CAHcb,MAAA,CAAAc,aAAa,EAArBC,IAAI;yBAAhBvB,mBAAA,CAGM;MAH8B0B,GAAG,EAAEH,IAAI;MAAE3B,KAAK,EAAC;QACnDM,mBAAA,CAAuF;MAAjFN,KAAK,EAAC,cAAc;MAAEuB,KAAK,EAAAwD,eAAA;QAAAC,eAAA,EAAqBpE,MAAA,CAAAqE,gBAAgB,CAACtD,IAAI;MAAA;6BAC3ErB,mBAAA,CAA4C,QAA5C4E,WAA4C,EAAAxB,gBAAA,CAAd/B,IAAI,iB;yEAItCM,mBAAA,UAAa,E,CACmBrB,MAAA,CAAAG,OAAO,I,cAAvCX,mBAAA,CAGM,OAHN+E,WAGM,GAFJ1E,YAAA,CAA0E2E,iBAAA;IAAlEzD,IAAI,EAAC;EAAM;sBAAC,MAAI,C,iBAAJ,MAAI,GAAA+B,gBAAA,CAAGtB,MAAM,CAACC,IAAI,CAACzB,MAAA,CAAA0B,SAAS,CAACC,KAAK,EAAEC,MAAM,iB;;MAC9D/B,YAAA,CAAwF2E,iBAAA;IAAhFzD,IAAI,EAAC,SAAS;IAACJ,KAAyB,EAAzB;MAAA;IAAA;;sBAA0B,MAAI,C,iBAAJ,MAAI,GAAAmC,gBAAA,CAAG9C,MAAA,CAAAiC,aAAa,CAACL,MAAM,iB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}