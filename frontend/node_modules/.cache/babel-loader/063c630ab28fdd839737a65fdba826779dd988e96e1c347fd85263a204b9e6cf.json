{"ast":null,"code":"import { shallowRef, ref } from 'vue';\nimport { getStyle, setStyle } from '../../../../utils/dom/style.mjs';\nimport { useNamespace } from '../../../../hooks/use-namespace/index.mjs';\nimport { isUndefined } from '../../../../utils/types.mjs';\nfunction useDragTag({\n  wrapperRef,\n  handleDragged,\n  afterDragged\n}) {\n  const ns = useNamespace(\"input-tag\");\n  const dropIndicatorRef = shallowRef();\n  const showDropIndicator = ref(false);\n  let draggingIndex;\n  let draggingTag;\n  let dropIndex;\n  let dropType;\n  function getTagClassName(index) {\n    return `.${ns.e(\"inner\")} .${ns.namespace.value}-tag:nth-child(${index + 1})`;\n  }\n  function handleDragStart(event, index) {\n    draggingIndex = index;\n    draggingTag = wrapperRef.value.querySelector(getTagClassName(index));\n    if (draggingTag) {\n      draggingTag.style.opacity = \"0.5\";\n    }\n    event.dataTransfer.effectAllowed = \"move\";\n  }\n  function handleDragOver(event, index) {\n    dropIndex = index;\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"move\";\n    if (isUndefined(draggingIndex) || draggingIndex === index) {\n      showDropIndicator.value = false;\n      return;\n    }\n    const dropPosition = wrapperRef.value.querySelector(getTagClassName(index)).getBoundingClientRect();\n    const dropPrev = !(draggingIndex + 1 === index);\n    const dropNext = !(draggingIndex - 1 === index);\n    const distance = event.clientX - dropPosition.left;\n    const prevPercent = dropPrev ? dropNext ? 0.5 : 1 : -1;\n    const nextPercent = dropNext ? dropPrev ? 0.5 : 0 : 1;\n    if (distance <= dropPosition.width * prevPercent) {\n      dropType = \"before\";\n    } else if (distance > dropPosition.width * nextPercent) {\n      dropType = \"after\";\n    } else {\n      dropType = void 0;\n    }\n    const innerEl = wrapperRef.value.querySelector(`.${ns.e(\"inner\")}`);\n    const innerPosition = innerEl.getBoundingClientRect();\n    const gap = Number.parseFloat(getStyle(innerEl, \"gap\")) / 2;\n    const indicatorTop = dropPosition.top - innerPosition.top;\n    let indicatorLeft = -9999;\n    if (dropType === \"before\") {\n      indicatorLeft = Math.max(dropPosition.left - innerPosition.left - gap, Math.floor(-gap / 2));\n    } else if (dropType === \"after\") {\n      const left = dropPosition.right - innerPosition.left;\n      indicatorLeft = left + (innerPosition.width === left ? Math.floor(gap / 2) : gap);\n    }\n    setStyle(dropIndicatorRef.value, {\n      top: `${indicatorTop}px`,\n      left: `${indicatorLeft}px`\n    });\n    showDropIndicator.value = !!dropType;\n  }\n  function handleDragEnd(event) {\n    event.preventDefault();\n    if (draggingTag) {\n      draggingTag.style.opacity = \"\";\n    }\n    if (dropType && !isUndefined(draggingIndex) && !isUndefined(dropIndex) && draggingIndex !== dropIndex) {\n      handleDragged(draggingIndex, dropIndex, dropType);\n    }\n    showDropIndicator.value = false;\n    draggingIndex = void 0;\n    draggingTag = null;\n    dropIndex = void 0;\n    dropType = void 0;\n    afterDragged == null ? void 0 : afterDragged();\n  }\n  return {\n    dropIndicatorRef,\n    showDropIndicator,\n    handleDragStart,\n    handleDragOver,\n    handleDragEnd\n  };\n}\nexport { useDragTag };","map":{"version":3,"names":["useDragTag","wrapperRef","handleDragged","afterDragged","ns","useNamespace","dropIndicatorRef","shallowRef","showDropIndicator","ref","draggingIndex","draggingTag","dropIndex","dropType","getTagClassName","index","e","namespace","value","handleDragStart","event","querySelector","style","opacity","dataTransfer","effectAllowed","handleDragOver","preventDefault","dropEffect","isUndefined","dropPosition","getBoundingClientRect","dropPrev","dropNext","distance","clientX","left","prevPercent","nextPercent","width","innerEl","innerPosition","gap","Number","parseFloat","getStyle","indicatorTop","top","indicatorLeft","Math","max","floor","right","setStyle","handleDragEnd"],"sources":["../../../../../../../packages/components/input-tag/src/composables/use-drag-tag.ts"],"sourcesContent":["import { ref, shallowRef } from 'vue'\nimport { useNamespace } from '@element-plus/hooks'\nimport { getStyle, isUndefined, setStyle } from '@element-plus/utils'\n\nimport type { ShallowRef } from 'vue'\n\ntype DropType = 'before' | 'after'\n\ninterface UseDragTagOptions {\n  wrapperRef: ShallowRef<HTMLElement | undefined>\n  handleDragged: (\n    draggingIndex: number,\n    dropIndex: number,\n    type: DropType\n  ) => void\n  afterDragged?: () => void\n}\n\nexport function useDragTag({\n  wrapperRef,\n  handleDragged,\n  afterDragged,\n}: UseDragTagOptions) {\n  const ns = useNamespace('input-tag')\n  const dropIndicatorRef = shallowRef<HTMLElement>()\n  const showDropIndicator = ref(false)\n\n  let draggingIndex: number | undefined\n  let draggingTag: HTMLElement | null\n  let dropIndex: number | undefined\n  let dropType: DropType | undefined\n\n  function getTagClassName(index: number) {\n    return `.${ns.e('inner')} .${ns.namespace.value}-tag:nth-child(${\n      index + 1\n    })`\n  }\n\n  function handleDragStart(event: DragEvent, index: number) {\n    draggingIndex = index\n    draggingTag = wrapperRef.value!.querySelector<HTMLElement>(\n      getTagClassName(index)\n    )\n\n    if (draggingTag) {\n      draggingTag.style.opacity = '0.5'\n    }\n    event.dataTransfer!.effectAllowed = 'move'\n  }\n\n  function handleDragOver(event: DragEvent, index: number) {\n    dropIndex = index\n    event.preventDefault()\n    event.dataTransfer!.dropEffect = 'move'\n\n    if (isUndefined(draggingIndex) || draggingIndex === index) {\n      showDropIndicator.value = false\n      return\n    }\n\n    const dropPosition = wrapperRef\n      .value!.querySelector<HTMLElement>(getTagClassName(index))!\n      .getBoundingClientRect()\n    const dropPrev = !(draggingIndex + 1 === index)\n    const dropNext = !(draggingIndex - 1 === index)\n    const distance = event.clientX - dropPosition.left\n    const prevPercent = dropPrev ? (dropNext ? 0.5 : 1) : -1\n    const nextPercent = dropNext ? (dropPrev ? 0.5 : 0) : 1\n\n    if (distance <= dropPosition.width * prevPercent) {\n      dropType = 'before'\n    } else if (distance > dropPosition.width * nextPercent) {\n      dropType = 'after'\n    } else {\n      dropType = undefined\n    }\n\n    const innerEl = wrapperRef.value!.querySelector<HTMLElement>(\n      `.${ns.e('inner')}`\n    )!\n    const innerPosition = innerEl.getBoundingClientRect()\n    const gap = Number.parseFloat(getStyle(innerEl, 'gap')) / 2\n\n    const indicatorTop = dropPosition.top - innerPosition.top\n    let indicatorLeft = -9999\n\n    if (dropType === 'before') {\n      indicatorLeft = Math.max(\n        dropPosition.left - innerPosition.left - gap,\n        Math.floor(-gap / 2)\n      )\n    } else if (dropType === 'after') {\n      const left = dropPosition.right - innerPosition.left\n      indicatorLeft =\n        left + (innerPosition.width === left ? Math.floor(gap / 2) : gap)\n    }\n\n    setStyle(dropIndicatorRef.value!, {\n      top: `${indicatorTop}px`,\n      left: `${indicatorLeft}px`,\n    })\n    showDropIndicator.value = !!dropType\n  }\n\n  function handleDragEnd(event: DragEvent) {\n    event.preventDefault()\n\n    if (draggingTag) {\n      draggingTag.style.opacity = ''\n    }\n\n    if (\n      dropType &&\n      !isUndefined(draggingIndex) &&\n      !isUndefined(dropIndex) &&\n      draggingIndex !== dropIndex\n    ) {\n      handleDragged(draggingIndex, dropIndex, dropType)\n    }\n\n    showDropIndicator.value = false\n    draggingIndex = undefined\n    draggingTag = null\n    dropIndex = undefined\n    dropType = undefined\n    afterDragged?.()\n  }\n\n  return {\n    dropIndicatorRef,\n    showDropIndicator,\n    handleDragStart,\n    handleDragOver,\n    handleDragEnd,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}