{"ast":null,"code":"import { defineComponent, inject, provide, onMounted, watch, unref, onBeforeUnmount, openBlock, createElementBlock, mergeProps, createVNode, withCtx, renderSlot } from 'vue';\nimport { isNil } from 'lodash-unified';\nimport ElFocusTrap from '../../focus-trap/src/focus-trap.mjs';\nimport { POPPER_CONTENT_INJECTION_KEY } from './constants.mjs';\nimport { popperContentProps, popperContentEmits } from './content.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { usePopperContentFocusTrap } from './composables/use-focus-trap.mjs';\nimport { usePopperContent } from './composables/use-content.mjs';\nimport { usePopperContentDOM } from './composables/use-content-dom.mjs';\nimport { formItemContextKey } from '../../form/src/constants.mjs';\nimport { NOOP } from '@vue/shared';\nimport { isElement } from '../../../utils/types.mjs';\nconst _sfc_main = defineComponent({\n  ...{\n    name: \"ElPopperContent\"\n  },\n  __name: \"content\",\n  props: popperContentProps,\n  emits: popperContentEmits,\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    const emit = __emit;\n    const props = __props;\n    const {\n      focusStartRef,\n      trapped,\n      onFocusAfterReleased,\n      onFocusAfterTrapped,\n      onFocusInTrap,\n      onFocusoutPrevented,\n      onReleaseRequested\n    } = usePopperContentFocusTrap(props, emit);\n    const {\n      attributes,\n      arrowRef,\n      contentRef,\n      styles,\n      instanceRef,\n      role,\n      update\n    } = usePopperContent(props);\n    const {\n      ariaModal,\n      arrowStyle,\n      contentAttrs,\n      contentClass,\n      contentStyle,\n      updateZIndex\n    } = usePopperContentDOM(props, {\n      styles,\n      attributes,\n      role\n    });\n    const formItemContext = inject(formItemContextKey, void 0);\n    provide(POPPER_CONTENT_INJECTION_KEY, {\n      arrowStyle,\n      arrowRef\n    });\n    if (formItemContext) {\n      provide(formItemContextKey, {\n        ...formItemContext,\n        addInputId: NOOP,\n        removeInputId: NOOP\n      });\n    }\n    let triggerTargetAriaStopWatch = void 0;\n    const updatePopper = (shouldUpdateZIndex = true) => {\n      update();\n      shouldUpdateZIndex && updateZIndex();\n    };\n    const togglePopperAlive = () => {\n      updatePopper(false);\n      if (props.visible && props.focusOnShow) {\n        trapped.value = true;\n      } else if (props.visible === false) {\n        trapped.value = false;\n      }\n    };\n    onMounted(() => {\n      watch(() => props.triggerTargetEl, (triggerTargetEl, prevTriggerTargetEl) => {\n        triggerTargetAriaStopWatch == null ? void 0 : triggerTargetAriaStopWatch();\n        triggerTargetAriaStopWatch = void 0;\n        const el = unref(triggerTargetEl || contentRef.value);\n        const prevEl = unref(prevTriggerTargetEl || contentRef.value);\n        if (isElement(el)) {\n          triggerTargetAriaStopWatch = watch([role, () => props.ariaLabel, ariaModal, () => props.id], watches => {\n            [\"role\", \"aria-label\", \"aria-modal\", \"id\"].forEach((key, idx) => {\n              isNil(watches[idx]) ? el.removeAttribute(key) : el.setAttribute(key, watches[idx]);\n            });\n          }, {\n            immediate: true\n          });\n        }\n        if (prevEl !== el && isElement(prevEl)) {\n          [\"role\", \"aria-label\", \"aria-modal\", \"id\"].forEach(key => {\n            prevEl.removeAttribute(key);\n          });\n        }\n      }, {\n        immediate: true\n      });\n      watch(() => props.visible, togglePopperAlive, {\n        immediate: true\n      });\n    });\n    onBeforeUnmount(() => {\n      triggerTargetAriaStopWatch == null ? void 0 : triggerTargetAriaStopWatch();\n      triggerTargetAriaStopWatch = void 0;\n      contentRef.value = void 0;\n    });\n    __expose({\n      popperContentRef: contentRef,\n      popperInstanceRef: instanceRef,\n      updatePopper,\n      contentStyle\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", mergeProps({\n        ref_key: \"contentRef\",\n        ref: contentRef\n      }, unref(contentAttrs), {\n        style: unref(contentStyle),\n        class: unref(contentClass),\n        tabindex: \"-1\",\n        onMouseenter: _cache[0] || (_cache[0] = e => _ctx.$emit(\"mouseenter\", e)),\n        onMouseleave: _cache[1] || (_cache[1] = e => _ctx.$emit(\"mouseleave\", e))\n      }), [createVNode(unref(ElFocusTrap), {\n        loop: _ctx.loop,\n        trapped: unref(trapped),\n        \"trap-on-focus-in\": true,\n        \"focus-trap-el\": unref(contentRef),\n        \"focus-start-el\": unref(focusStartRef),\n        onFocusAfterTrapped: unref(onFocusAfterTrapped),\n        onFocusAfterReleased: unref(onFocusAfterReleased),\n        onFocusin: unref(onFocusInTrap),\n        onFocusoutPrevented: unref(onFocusoutPrevented),\n        onReleaseRequested: unref(onReleaseRequested)\n      }, {\n        default: withCtx(() => [renderSlot(_ctx.$slots, \"default\")]),\n        _: 3\n      }, 8, [\"loop\", \"trapped\", \"focus-trap-el\", \"focus-start-el\", \"onFocusAfterTrapped\", \"onFocusAfterReleased\", \"onFocusin\", \"onFocusoutPrevented\", \"onReleaseRequested\"])], 16);\n    };\n  }\n});\nvar ElPopperContent = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/popper/src/content.vue\"]]);\nexport { ElPopperContent as default };","map":{"version":3,"names":["emit","__emit","props","__props","focusStartRef","trapped","onFocusAfterReleased","onFocusAfterTrapped","onFocusInTrap","onFocusoutPrevented","onReleaseRequested","usePopperContentFocusTrap","attributes","arrowRef","contentRef","styles","instanceRef","role","update","usePopperContent","ariaModal","arrowStyle","contentAttrs","contentClass","contentStyle","updateZIndex","usePopperContentDOM","formItemContext","inject","formItemContextKey","provide","POPPER_CONTENT_INJECTION_KEY","addInputId","NOOP","removeInputId","triggerTargetAriaStopWatch","updatePopper","shouldUpdateZIndex","togglePopperAlive","visible","focusOnShow","value","onMounted","watch","triggerTargetEl","prevTriggerTargetEl","el","unref","prevEl","isElement","ariaLabel","id","watches","forEach","key","idx","isNil","removeAttribute","setAttribute","immediate","onBeforeUnmount","__expose","popperContentRef","popperInstanceRef","openBlock","createElementBlock","mergeProps","ref_key","ref","style","class","tabindex","onMouseenter","_cache","e","_ctx","$emit","onMouseleave","createVNode","ElFocusTrap","loop","onFocusin","default","withCtx","renderSlot","$slots","_"],"sources":["../../../../../../packages/components/popper/src/content.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"contentRef\"\n    v-bind=\"contentAttrs\"\n    :style=\"contentStyle\"\n    :class=\"contentClass\"\n    tabindex=\"-1\"\n    @mouseenter=\"(e) => $emit('mouseenter', e)\"\n    @mouseleave=\"(e) => $emit('mouseleave', e)\"\n  >\n    <el-focus-trap\n      :loop=\"loop\"\n      :trapped=\"trapped\"\n      :trap-on-focus-in=\"true\"\n      :focus-trap-el=\"contentRef\"\n      :focus-start-el=\"focusStartRef\"\n      @focus-after-trapped=\"onFocusAfterTrapped\"\n      @focus-after-released=\"onFocusAfterReleased\"\n      @focusin=\"onFocusInTrap\"\n      @focusout-prevented=\"onFocusoutPrevented\"\n      @release-requested=\"onReleaseRequested\"\n    >\n      <slot />\n    </el-focus-trap>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { inject, onBeforeUnmount, onMounted, provide, unref, watch } from 'vue'\nimport { isNil } from 'lodash-unified'\nimport { NOOP, isElement } from '@element-plus/utils'\nimport ElFocusTrap from '@element-plus/components/focus-trap'\nimport { formItemContextKey } from '@element-plus/components/form'\nimport { POPPER_CONTENT_INJECTION_KEY } from './constants'\nimport { popperContentEmits, popperContentProps } from './content'\nimport {\n  usePopperContent,\n  usePopperContentDOM,\n  usePopperContentFocusTrap,\n} from './composables'\n\nimport type { WatchStopHandle } from 'vue'\n\ndefineOptions({\n  name: 'ElPopperContent',\n})\n\nconst emit = defineEmits(popperContentEmits)\n\nconst props = defineProps(popperContentProps)\n\nconst {\n  focusStartRef,\n  trapped,\n\n  onFocusAfterReleased,\n  onFocusAfterTrapped,\n  onFocusInTrap,\n  onFocusoutPrevented,\n  onReleaseRequested,\n} = usePopperContentFocusTrap(props, emit)\n\nconst { attributes, arrowRef, contentRef, styles, instanceRef, role, update } =\n  usePopperContent(props)\n\nconst {\n  ariaModal,\n  arrowStyle,\n  contentAttrs,\n  contentClass,\n  contentStyle,\n  updateZIndex,\n} = usePopperContentDOM(props, {\n  styles,\n  attributes,\n  role,\n})\n\nconst formItemContext = inject(formItemContextKey, undefined)\n\nprovide(POPPER_CONTENT_INJECTION_KEY, {\n  arrowStyle,\n  arrowRef,\n})\n\nif (formItemContext) {\n  // disallow auto-id from inside popper content\n  provide(formItemContextKey, {\n    ...formItemContext,\n    addInputId: NOOP,\n    removeInputId: NOOP,\n  })\n}\n\nlet triggerTargetAriaStopWatch: WatchStopHandle | undefined = undefined\n\nconst updatePopper = (shouldUpdateZIndex = true) => {\n  update()\n  shouldUpdateZIndex && updateZIndex()\n}\n\nconst togglePopperAlive = () => {\n  updatePopper(false)\n  if (props.visible && props.focusOnShow) {\n    trapped.value = true\n  } else if (props.visible === false) {\n    trapped.value = false\n  }\n}\n\nonMounted(() => {\n  watch(\n    () => props.triggerTargetEl,\n    (triggerTargetEl, prevTriggerTargetEl) => {\n      triggerTargetAriaStopWatch?.()\n      triggerTargetAriaStopWatch = undefined\n\n      const el = unref(triggerTargetEl || contentRef.value)\n      const prevEl = unref(prevTriggerTargetEl || contentRef.value)\n\n      if (isElement(el)) {\n        triggerTargetAriaStopWatch = watch(\n          [role, () => props.ariaLabel, ariaModal, () => props.id],\n          (watches) => {\n            ;['role', 'aria-label', 'aria-modal', 'id'].forEach((key, idx) => {\n              isNil(watches[idx])\n                ? el.removeAttribute(key)\n                : el.setAttribute(key, watches[idx]!)\n            })\n          },\n          { immediate: true }\n        )\n      }\n      if (prevEl !== el && isElement(prevEl)) {\n        ;['role', 'aria-label', 'aria-modal', 'id'].forEach((key) => {\n          prevEl.removeAttribute(key)\n        })\n      }\n    },\n    { immediate: true }\n  )\n\n  watch(() => props.visible, togglePopperAlive, { immediate: true })\n})\n\nonBeforeUnmount(() => {\n  triggerTargetAriaStopWatch?.()\n  triggerTargetAriaStopWatch = undefined\n  contentRef.value = undefined\n})\n\ndefineExpose({\n  /**\n   * @description popper content element\n   */\n  popperContentRef: contentRef,\n  /**\n   * @description popperjs instance\n   */\n  popperInstanceRef: instanceRef,\n  /**\n   * @description method for updating popper\n   */\n  updatePopper,\n\n  /**\n   * @description content style\n   */\n  contentStyle,\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}