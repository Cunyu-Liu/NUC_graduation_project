{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport { unref as _unref, createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createElementVNode as _createElementVNode, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, withModifiers as _withModifiers, normalizeClass as _normalizeClass, resolveDynamicComponent as _resolveDynamicComponent, withKeys as _withKeys } from \"vue\";\nconst _hoisted_1 = {\n  class: \"kimi-chat-container\"\n};\nconst _hoisted_2 = {\n  class: \"sidebar-header\"\n};\nconst _hoisted_3 = {\n  class: \"chat-history\"\n};\nconst _hoisted_4 = [\"onClick\"];\nconst _hoisted_5 = {\n  class: \"chat-title\"\n};\nconst _hoisted_6 = {\n  class: \"sidebar-footer\"\n};\nconst _hoisted_7 = {\n  class: \"chat-main\"\n};\nconst _hoisted_8 = {\n  class: \"chat-header\"\n};\nconst _hoisted_9 = {\n  class: \"header-left\"\n};\nconst _hoisted_10 = {\n  class: \"chat-title\"\n};\nconst _hoisted_11 = {\n  class: \"header-right\"\n};\nconst _hoisted_12 = {\n  key: 0,\n  class: \"welcome-section\"\n};\nconst _hoisted_13 = {\n  class: \"welcome-logo\"\n};\nconst _hoisted_14 = {\n  class: \"quick-cards\"\n};\nconst _hoisted_15 = [\"onClick\"];\nconst _hoisted_16 = {\n  class: \"example-questions\"\n};\nconst _hoisted_17 = {\n  class: \"question-tags\"\n};\nconst _hoisted_18 = {\n  class: \"message-avatar\"\n};\nconst _hoisted_19 = {\n  key: 1,\n  class: \"ai-avatar\"\n};\nconst _hoisted_20 = {\n  class: \"message-content\"\n};\nconst _hoisted_21 = {\n  class: \"message-header\"\n};\nconst _hoisted_22 = {\n  class: \"message-role\"\n};\nconst _hoisted_23 = {\n  class: \"message-time\"\n};\nconst _hoisted_24 = [\"innerHTML\"];\nconst _hoisted_25 = {\n  key: 0,\n  class: \"message-references\"\n};\nconst _hoisted_26 = {\n  class: \"ref-list\"\n};\nconst _hoisted_27 = {\n  key: 0,\n  class: \"message-wrapper ai-message typing\"\n};\nconst _hoisted_28 = {\n  class: \"message-avatar\"\n};\nconst _hoisted_29 = {\n  class: \"ai-avatar\"\n};\nconst _hoisted_30 = {\n  class: \"input-area\"\n};\nconst _hoisted_31 = {\n  class: \"input-toolbar\"\n};\nconst _hoisted_32 = {\n  key: 0,\n  class: \"badge\"\n};\nconst _hoisted_33 = {\n  class: \"input-box\"\n};\nconst _hoisted_34 = [\"disabled\"];\nconst _hoisted_35 = {\n  class: \"input-hint\"\n};\nconst _hoisted_36 = {\n  key: 0\n};\nconst _hoisted_37 = {\n  class: \"paper-selector\"\n};\nconst _hoisted_38 = {\n  class: \"dialog-footer\"\n};\nimport { ref, computed, onMounted, nextTick, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { Plus, Fold, Expand, ChatLineRound, MoreFilled, Setting, Document, Delete, ChatDotRound, Cpu, Paperclip, Search, Globe, Promotion, Loading, Edit } from '@element-plus/icons-vue';\nimport api from '@/api';\nimport { marked } from 'marked';\nimport DOMPurify from 'dompurify';\nimport hljs from 'highlight.js';\n\n// 配置 marked\n\nexport default {\n  __name: 'KimiChat',\n  setup(__props) {\n    marked.setOptions({\n      highlight: function (code, lang) {\n        if (lang && hljs.getLanguage(lang)) {\n          return hljs.highlight(code, {\n            language: lang\n          }).value;\n        }\n        return hljs.highlightAuto(code).value;\n      },\n      breaks: true,\n      gfm: true\n    });\n    const store = useStore();\n\n    // ==================== 状态 ====================\n    const sidebarCollapsed = ref(false);\n    const currentChatId = ref(null);\n    const chatHistory = ref([]);\n    const messages = ref([]);\n    const inputMessage = ref('');\n    const isTyping = ref(false);\n    const currentModel = ref('glm-4-plus');\n    const messagesContainer = ref(null);\n    const useRag = ref(true);\n    const useWebSearch = ref(false);\n    const selectedPapers = ref([]);\n\n    // 论文选择\n    const showPaperSelector = ref(false);\n    const paperSearch = ref('');\n    const papers = ref([]);\n    const tempSelectedPapers = ref([]);\n    const paperTable = ref(null);\n\n    // 设置\n    const showSettings = ref(false);\n    const settings = ref({\n      model: 'glm-4-plus',\n      temperature: 0.7,\n      maxTokens: 4000,\n      useRag: true,\n      autoReference: true\n    });\n\n    // 重命名\n    const showRenameDialog = ref(false);\n    const renameValue = ref('');\n    const renameChatId = ref(null);\n\n    // ==================== 计算属性 ====================\n    const userAvatar = computed(() => store.getters.currentUser?.avatar || '');\n    const userInitial = computed(() => {\n      const name = store.getters.currentUser?.full_name || store.getters.currentUser?.username || 'U';\n      return name.charAt(0).toUpperCase();\n    });\n    const currentChatTitle = computed(() => {\n      const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n      return chat?.preview || '新对话';\n    });\n    const canSend = computed(() => {\n      return inputMessage.value.trim().length > 0 && !isTyping.value;\n    });\n    const inputRows = computed(() => {\n      const lines = inputMessage.value.split('\\n').length;\n      return Math.min(Math.max(lines, 1), 5);\n    });\n    const filteredPapers = computed(() => {\n      if (!paperSearch.value) return papers.value;\n      const query = paperSearch.value.toLowerCase();\n      return papers.value.filter(p => (p.title || '').toLowerCase().includes(query) || (p.abstract || '').toLowerCase().includes(query));\n    });\n\n    // ==================== 快捷功能卡片 ====================\n    const quickCards = [{\n      key: 'summary',\n      label: '文献综述',\n      icon: 'Document',\n      prompt: '请基于我的论文库生成一份文献综述'\n    }, {\n      key: 'gaps',\n      label: '研究空白',\n      icon: 'Search',\n      prompt: '请分析当前研究领域的主要空白'\n    }, {\n      key: 'code',\n      label: '代码生成',\n      icon: 'Cpu',\n      prompt: '请帮我生成实现XX算法的代码'\n    }, {\n      key: 'trends',\n      label: '趋势分析',\n      icon: 'TrendCharts',\n      prompt: '请分析该领域的研究趋势'\n    }];\n    const exampleQuestions = ['帮我总结这几篇论文的核心贡献', '这些论文中使用了哪些主要方法？', '这个领域的研究现状如何？', '有哪些潜在的研究方向值得探索？', '帮我比较论文A和论文B的方法差异', '请解释论文中的XX算法原理'];\n\n    // ==================== 方法 ====================\n    const formatTime = timestamp => {\n      if (!timestamp) return '';\n      const date = new Date(timestamp);\n      return date.toLocaleTimeString('zh-CN', {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    };\n    const renderMessage = content => {\n      if (!content) return '';\n      const html = marked(content);\n      return DOMPurify.sanitize(html);\n    };\n    const scrollToBottom = () => {\n      nextTick(() => {\n        if (messagesContainer.value) {\n          messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;\n        }\n      });\n    };\n\n    // ==================== 聊天操作 ====================\n    const loadChatHistory = async () => {\n      try {\n        // 这里可以调用后端 API 获取会话列表\n        // 目前使用本地存储\n        const saved = localStorage.getItem('kimi_chat_history');\n        if (saved) {\n          chatHistory.value = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.error('加载聊天历史失败:', e);\n      }\n    };\n    const saveChatHistory = () => {\n      try {\n        localStorage.setItem('kimi_chat_history', JSON.stringify(chatHistory.value));\n      } catch (e) {\n        console.error('保存聊天历史失败:', e);\n      }\n    };\n    const createNewChat = () => {\n      const newChatId = `chat_${Date.now()}`;\n      currentChatId.value = newChatId;\n      messages.value = [];\n      selectedPapers.value = [];\n\n      // 添加到历史\n      chatHistory.value.unshift({\n        chat_id: newChatId,\n        preview: '新对话',\n        created_at: new Date().toISOString(),\n        message_count: 0\n      });\n      saveChatHistory();\n    };\n    const switchChat = async chatId => {\n      if (currentChatId.value === chatId) return;\n      currentChatId.value = chatId;\n\n      // 加载该会话的消息历史\n      try {\n        const response = await api.getChatHistory(chatId);\n        if (response.success) {\n          messages.value = response.data || [];\n        }\n      } catch (e) {\n        console.error('加载消息历史失败:', e);\n        messages.value = [];\n      }\n      scrollToBottom();\n    };\n    const renameChat = chatId => {\n      renameChatId.value = chatId;\n      renameValue.value = '';\n      showRenameDialog.value = true;\n    };\n    const confirmRename = () => {\n      if (!renameValue.value.trim()) {\n        ElMessage.warning('请输入新名称');\n        return;\n      }\n      const chat = chatHistory.value.find(c => c.chat_id === renameChatId.value);\n      if (chat) {\n        chat.preview = renameValue.value;\n        saveChatHistory();\n        ElMessage.success('重命名成功');\n      }\n      showRenameDialog.value = false;\n    };\n    const deleteChat = async chatId => {\n      try {\n        await ElMessageBox.confirm('确定要删除这个对话吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n\n        // 调用后端 API 删除\n        await api.deleteChat({\n          chatId\n        });\n\n        // 从列表中移除\n        chatHistory.value = chatHistory.value.filter(c => c.chat_id !== chatId);\n\n        // 如果删除的是当前会话，切换到第一个或新建\n        if (currentChatId.value === chatId) {\n          if (chatHistory.value.length > 0) {\n            switchChat(chatHistory.value[0].chat_id);\n          } else {\n            createNewChat();\n          }\n        }\n        saveChatHistory();\n        ElMessage.success('删除成功');\n      } catch (e) {\n        if (e !== 'cancel') {\n          console.error('删除失败:', e);\n        }\n      }\n    };\n    const clearCurrentChat = async () => {\n      if (messages.value.length === 0) return;\n      try {\n        await ElMessageBox.confirm('确定要清空当前对话吗？', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n        await api.clearChat({\n          chatId: currentChatId.value\n        });\n        messages.value = [];\n\n        // 更新预览\n        const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n        if (chat) {\n          chat.preview = '新对话';\n          chat.message_count = 0;\n          saveChatHistory();\n        }\n        ElMessage.success('已清空');\n      } catch (e) {\n        if (e !== 'cancel') {\n          console.error('清空失败:', e);\n        }\n      }\n    };\n\n    // ==================== 消息发送 ====================\n    const handleEnter = e => {\n      if (e.shiftKey) {\n        // Shift+Enter 换行\n        return;\n      }\n      e.preventDefault();\n      sendMessage();\n    };\n    const handleInput = () => {\n      // 可以在这里实现输入提示等功能\n    };\n    const sendQuickMessage = prompt => {\n      inputMessage.value = prompt;\n      sendMessage();\n    };\n    const sendMessage = async (content = null) => {\n      const message = content || inputMessage.value.trim();\n      if (!message || isTyping.value) return;\n\n      // 清空输入框\n      if (!content) {\n        inputMessage.value = '';\n      }\n\n      // 添加用户消息\n      messages.value.push({\n        role: 'user',\n        content: message,\n        timestamp: new Date().toISOString(),\n        references: []\n      });\n      scrollToBottom();\n      isTyping.value = true;\n      try {\n        // 调用流式 API\n        const response = await fetch('/api/chat/stream', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\n          },\n          body: JSON.stringify({\n            message,\n            chatId: currentChatId.value,\n            papers: selectedPapers.value.map(p => p.id),\n            model: currentModel.value,\n            temperature: settings.value.temperature,\n            useRag: useRag.value\n          })\n        });\n        const reader = response.body.getReader();\n        const decoder = new TextDecoder();\n        let fullContent = '';\n\n        // 添加 AI 消息占位\n        messages.value.push({\n          role: 'assistant',\n          content: '',\n          timestamp: new Date().toISOString(),\n          references: []\n        });\n\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const {\n            done,\n            value\n          } = await reader.read();\n          if (done) break;\n          const chunk = decoder.decode(value);\n          const lines = chunk.split('\\n\\n');\n          for (const line of lines) {\n            if (line.startsWith('data: ')) {\n              try {\n                const data = JSON.parse(line.slice(6));\n                if (data.done) {\n                  isTyping.value = false;\n                } else if (data.content) {\n                  fullContent += data.content;\n                  messages.value[messages.value.length - 1].content = fullContent;\n                  scrollToBottom();\n                }\n              } catch (e) {\n                console.error('解析 SSE 数据失败:', e);\n              }\n            }\n          }\n        }\n\n        // 更新会话预览\n        const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value);\n        if (chat) {\n          chat.preview = message.slice(0, 30) + (message.length > 30 ? '...' : '');\n          chat.message_count = messages.value.length;\n          saveChatHistory();\n        }\n      } catch (error) {\n        console.error('发送消息失败:', error);\n        ElMessage.error('发送失败，请重试');\n        isTyping.value = false;\n      }\n    };\n\n    // ==================== 论文选择 ====================\n    const loadPapers = async () => {\n      try {\n        const response = await api.getPapersList({\n          limit: 100\n        });\n        if (response.success) {\n          papers.value = response.data.items || [];\n        }\n      } catch (error) {\n        console.error('加载论文失败:', error);\n      }\n    };\n    const handlePaperSelectionChange = selection => {\n      tempSelectedPapers.value = selection;\n    };\n    const confirmPaperSelection = () => {\n      selectedPapers.value = [...tempSelectedPapers.value];\n      showPaperSelector.value = false;\n      ElMessage.success(`已关联 ${selectedPapers.value.length} 篇论文`);\n    };\n    const viewPaper = paperId => {\n      window.open(`#/papers/${paperId}`, '_blank');\n    };\n\n    // ==================== 设置 ====================\n    const saveSettings = () => {\n      localStorage.setItem('kimi_chat_settings', JSON.stringify(settings.value));\n      showSettings.value = false;\n      ElMessage.success('设置已保存');\n    };\n    const loadSettings = () => {\n      try {\n        const saved = localStorage.getItem('kimi_chat_settings');\n        if (saved) {\n          settings.value = {\n            ...settings.value,\n            ...JSON.parse(saved)\n          };\n        }\n      } catch (e) {\n        console.error('加载设置失败:', e);\n      }\n    };\n\n    // ==================== 其他操作 ====================\n    const handleUpload = () => {\n      ElMessage.info('文件上传功能开发中');\n    };\n\n    // ==================== 生命周期 ====================\n    onMounted(() => {\n      loadChatHistory();\n      loadPapers();\n      loadSettings();\n\n      // 如果没有会话，创建一个新的\n      if (chatHistory.value.length === 0) {\n        createNewChat();\n      } else {\n        // 切换到第一个会话\n        switchChat(chatHistory.value[0].chat_id);\n      }\n    });\n    return (_ctx, _cache) => {\n      const _component_el_icon = _resolveComponent(\"el-icon\");\n      const _component_el_dropdown_item = _resolveComponent(\"el-dropdown-item\");\n      const _component_el_dropdown_menu = _resolveComponent(\"el-dropdown-menu\");\n      const _component_el_dropdown = _resolveComponent(\"el-dropdown\");\n      const _component_el_tag = _resolveComponent(\"el-tag\");\n      const _component_el_option = _resolveComponent(\"el-option\");\n      const _component_el_select = _resolveComponent(\"el-select\");\n      const _component_el_button = _resolveComponent(\"el-button\");\n      const _component_el_tooltip = _resolveComponent(\"el-tooltip\");\n      const _component_el_avatar = _resolveComponent(\"el-avatar\");\n      const _component_el_input = _resolveComponent(\"el-input\");\n      const _component_el_table_column = _resolveComponent(\"el-table-column\");\n      const _component_el_table = _resolveComponent(\"el-table\");\n      const _component_el_dialog = _resolveComponent(\"el-dialog\");\n      const _component_el_form_item = _resolveComponent(\"el-form-item\");\n      const _component_el_slider = _resolveComponent(\"el-slider\");\n      const _component_el_input_number = _resolveComponent(\"el-input-number\");\n      const _component_el_switch = _resolveComponent(\"el-switch\");\n      const _component_el_form = _resolveComponent(\"el-form\");\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"aside\", {\n        class: _normalizeClass([\"sidebar\", {\n          'collapsed': sidebarCollapsed.value\n        }])\n      }, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"button\", {\n        class: \"new-chat-btn\",\n        onClick: createNewChat\n      }, [_createVNode(_component_el_icon, null, {\n        default: _withCtx(() => [_createVNode(_unref(Plus))]),\n        _: 1\n      }), _cache[23] || (_cache[23] = _createElementVNode(\"span\", null, \"新建对话\", -1))]), _createElementVNode(\"button\", {\n        class: \"collapse-btn\",\n        onClick: _cache[0] || (_cache[0] = $event => sidebarCollapsed.value = !sidebarCollapsed.value)\n      }, [_createVNode(_component_el_icon, null, {\n        default: _withCtx(() => [!sidebarCollapsed.value ? (_openBlock(), _createBlock(_unref(Fold), {\n          key: 0\n        })) : (_openBlock(), _createBlock(_unref(Expand), {\n          key: 1\n        }))]),\n        _: 1\n      })])]), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(chatHistory.value, chat => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: chat.chat_id,\n          class: _normalizeClass([\"chat-item\", {\n            active: currentChatId.value === chat.chat_id\n          }]),\n          onClick: $event => switchChat(chat.chat_id)\n        }, [_createVNode(_component_el_icon, {\n          class: \"chat-icon\"\n        }, {\n          default: _withCtx(() => [_createVNode(_unref(ChatLineRound))]),\n          _: 1\n        }), _createElementVNode(\"span\", _hoisted_5, _toDisplayString(chat.preview || '新对话'), 1), _createElementVNode(\"div\", {\n          class: \"chat-actions\",\n          onClick: _cache[1] || (_cache[1] = _withModifiers(() => {}, [\"stop\"]))\n        }, [_createVNode(_component_el_dropdown, {\n          trigger: \"click\",\n          teleported: false\n        }, {\n          dropdown: _withCtx(() => [_createVNode(_component_el_dropdown_menu, null, {\n            default: _withCtx(() => [_createVNode(_component_el_dropdown_item, {\n              onClick: $event => renameChat(chat.chat_id)\n            }, {\n              default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n                default: _withCtx(() => [_createVNode(_unref(Edit))]),\n                _: 1\n              }), _cache[24] || (_cache[24] = _createTextVNode(\" 重命名 \", -1))]),\n              _: 1\n            }, 8, [\"onClick\"]), _createVNode(_component_el_dropdown_item, {\n              divided: \"\",\n              onClick: $event => deleteChat(chat.chat_id),\n              class: \"danger\"\n            }, {\n              default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n                default: _withCtx(() => [_createVNode(_unref(Delete))]),\n                _: 1\n              }), _cache[25] || (_cache[25] = _createTextVNode(\" 删除 \", -1))]),\n              _: 1\n            }, 8, [\"onClick\"])]),\n            _: 2\n          }, 1024)]),\n          default: _withCtx(() => [_createVNode(_component_el_icon, {\n            class: \"more-icon\"\n          }, {\n            default: _withCtx(() => [_createVNode(_unref(MoreFilled))]),\n            _: 1\n          })]),\n          _: 2\n        }, 1024)])], 10, _hoisted_4);\n      }), 128))]), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"button\", {\n        class: \"footer-btn\",\n        onClick: _cache[2] || (_cache[2] = $event => showSettings.value = true)\n      }, [_createVNode(_component_el_icon, null, {\n        default: _withCtx(() => [_createVNode(_unref(Setting))]),\n        _: 1\n      }), _cache[26] || (_cache[26] = _createElementVNode(\"span\", null, \"设置\", -1))])])], 2), _createElementVNode(\"main\", _hoisted_7, [_createElementVNode(\"header\", _hoisted_8, [_createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"h2\", _hoisted_10, _toDisplayString(currentChatTitle.value), 1), selectedPapers.value.length > 0 ? (_openBlock(), _createBlock(_component_el_tag, {\n        key: 0,\n        type: \"success\",\n        size: \"small\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(\" 已关联 \" + _toDisplayString(selectedPapers.value.length) + \" 篇论文 \", 1)]),\n        _: 1\n      })) : _createCommentVNode(\"\", true)]), _createElementVNode(\"div\", _hoisted_11, [_createVNode(_component_el_select, {\n        modelValue: currentModel.value,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => currentModel.value = $event),\n        size: \"small\",\n        class: \"model-select\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_option, {\n          label: \"GLM-4-Plus\",\n          value: \"glm-4-plus\"\n        }), _createVNode(_component_el_option, {\n          label: \"GLM-4-Flash\",\n          value: \"glm-4-flash\"\n        })]),\n        _: 1\n      }, 8, [\"modelValue\"]), _createVNode(_component_el_tooltip, {\n        content: \"关联论文\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          circle: \"\",\n          size: \"small\",\n          onClick: _cache[4] || (_cache[4] = $event => showPaperSelector.value = true)\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n            default: _withCtx(() => [_createVNode(_unref(Document))]),\n            _: 1\n          })]),\n          _: 1\n        })]),\n        _: 1\n      }), _createVNode(_component_el_tooltip, {\n        content: \"清空对话\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          circle: \"\",\n          size: \"small\",\n          onClick: clearCurrentChat\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n            default: _withCtx(() => [_createVNode(_unref(Delete))]),\n            _: 1\n          })]),\n          _: 1\n        })]),\n        _: 1\n      })])]), _createElementVNode(\"div\", {\n        ref_key: \"messagesContainer\",\n        ref: messagesContainer,\n        class: \"messages-area\"\n      }, [messages.value.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, [_createElementVNode(\"div\", _hoisted_13, [_createVNode(_component_el_icon, {\n        size: 80,\n        color: \"#10b981\"\n      }, {\n        default: _withCtx(() => [_createVNode(_unref(ChatDotRound))]),\n        _: 1\n      })]), _cache[28] || (_cache[28] = _createElementVNode(\"h1\", {\n        class: \"welcome-title\"\n      }, \"AI 科研助手\", -1)), _cache[29] || (_cache[29] = _createElementVNode(\"p\", {\n        class: \"welcome-subtitle\"\n      }, \" 基于您的论文库，提供深度文献分析、研究建议、代码生成等服务 \", -1)), _createElementVNode(\"div\", _hoisted_14, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList(quickCards, card => {\n        return _createElementVNode(\"div\", {\n          key: card.key,\n          class: \"quick-card\",\n          onClick: $event => sendQuickMessage(card.prompt)\n        }, [_createVNode(_component_el_icon, {\n          size: 24\n        }, {\n          default: _withCtx(() => [(_openBlock(), _createBlock(_resolveDynamicComponent(card.icon)))]),\n          _: 2\n        }, 1024), _createElementVNode(\"span\", null, _toDisplayString(card.label), 1)], 8, _hoisted_15);\n      }), 64))]), _createElementVNode(\"div\", _hoisted_16, [_cache[27] || (_cache[27] = _createElementVNode(\"div\", {\n        class: \"section-title\"\n      }, \"你可以这样问我：\", -1)), _createElementVNode(\"div\", _hoisted_17, [(_openBlock(), _createElementBlock(_Fragment, null, _renderList(exampleQuestions, q => {\n        return _createVNode(_component_el_tag, {\n          key: q,\n          class: \"question-tag\",\n          effect: \"plain\",\n          onClick: $event => sendMessage(q)\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString(q), 1)]),\n          _: 2\n        }, 1032, [\"onClick\"]);\n      }), 64))])])])) : (_openBlock(), _createElementBlock(_Fragment, {\n        key: 1\n      }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(messages.value, (message, index) => {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: index,\n          class: _normalizeClass([\"message-wrapper\", {\n            'user-message': message.role === 'user',\n            'ai-message': message.role === 'assistant'\n          }])\n        }, [_createElementVNode(\"div\", _hoisted_18, [message.role === 'user' ? (_openBlock(), _createBlock(_component_el_avatar, {\n          key: 0,\n          size: 36,\n          src: userAvatar.value\n        }, {\n          default: _withCtx(() => [_createTextVNode(_toDisplayString(userInitial.value), 1)]),\n          _: 1\n        }, 8, [\"src\"])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [_createVNode(_component_el_icon, {\n          size: 20\n        }, {\n          default: _withCtx(() => [_createVNode(_unref(Cpu))]),\n          _: 1\n        })]))]), _createElementVNode(\"div\", _hoisted_20, [_createElementVNode(\"div\", _hoisted_21, [_createElementVNode(\"span\", _hoisted_22, _toDisplayString(message.role === 'user' ? '我' : 'AI 助手'), 1), _createElementVNode(\"span\", _hoisted_23, _toDisplayString(formatTime(message.timestamp)), 1)]), _createElementVNode(\"div\", {\n          class: \"message-body\",\n          innerHTML: renderMessage(message.content)\n        }, null, 8, _hoisted_24), message.references && message.references.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_25, [_cache[30] || (_cache[30] = _createElementVNode(\"div\", {\n          class: \"ref-title\"\n        }, \"引用文献：\", -1)), _createElementVNode(\"div\", _hoisted_26, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(message.references, ref => {\n          return _openBlock(), _createBlock(_component_el_tag, {\n            key: ref.paper_id,\n            size: \"small\",\n            type: \"info\",\n            class: \"ref-tag\",\n            onClick: $event => viewPaper(ref.paper_id)\n          }, {\n            default: _withCtx(() => [_createTextVNode(_toDisplayString(ref.title), 1)]),\n            _: 2\n          }, 1032, [\"onClick\"]);\n        }), 128))])])) : _createCommentVNode(\"\", true)])], 2);\n      }), 128)), isTyping.value ? (_openBlock(), _createElementBlock(\"div\", _hoisted_27, [_createElementVNode(\"div\", _hoisted_28, [_createElementVNode(\"div\", _hoisted_29, [_createVNode(_component_el_icon, {\n        size: 20\n      }, {\n        default: _withCtx(() => [_createVNode(_unref(Cpu))]),\n        _: 1\n      })])]), _cache[31] || (_cache[31] = _createElementVNode(\"div\", {\n        class: \"message-content\"\n      }, [_createElementVNode(\"div\", {\n        class: \"typing-indicator\"\n      }, [_createElementVNode(\"span\"), _createElementVNode(\"span\"), _createElementVNode(\"span\")])], -1))])) : _createCommentVNode(\"\", true)], 64))], 512), _createElementVNode(\"footer\", _hoisted_30, [_createElementVNode(\"div\", _hoisted_31, [_createVNode(_component_el_tooltip, {\n        content: \"上传文件\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"button\", {\n          class: \"tool-btn\",\n          onClick: handleUpload\n        }, [_createVNode(_component_el_icon, null, {\n          default: _withCtx(() => [_createVNode(_unref(Paperclip))]),\n          _: 1\n        })])]),\n        _: 1\n      }), _createVNode(_component_el_tooltip, {\n        content: \"关联论文\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"button\", {\n          class: \"tool-btn\",\n          onClick: _cache[5] || (_cache[5] = $event => showPaperSelector.value = true)\n        }, [_createVNode(_component_el_icon, null, {\n          default: _withCtx(() => [_createVNode(_unref(Document))]),\n          _: 1\n        }), selectedPapers.value.length > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_32, _toDisplayString(selectedPapers.value.length), 1)) : _createCommentVNode(\"\", true)])]),\n        _: 1\n      }), _createVNode(_component_el_tooltip, {\n        content: \"使用 RAG\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"button\", {\n          class: _normalizeClass([\"tool-btn\", {\n            active: useRag.value\n          }]),\n          onClick: _cache[6] || (_cache[6] = $event => useRag.value = !useRag.value)\n        }, [_createVNode(_component_el_icon, null, {\n          default: _withCtx(() => [_createVNode(_unref(Search))]),\n          _: 1\n        }), _cache[32] || (_cache[32] = _createElementVNode(\"span\", null, \"RAG\", -1))], 2)]),\n        _: 1\n      }), _createVNode(_component_el_tooltip, {\n        content: \"网络搜索\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"button\", {\n          class: _normalizeClass([\"tool-btn\", {\n            active: useWebSearch.value\n          }]),\n          onClick: _cache[7] || (_cache[7] = $event => useWebSearch.value = !useWebSearch.value)\n        }, [_createVNode(_component_el_icon, null, {\n          default: _withCtx(() => [_createVNode(_unref(Globe))]),\n          _: 1\n        }), _cache[33] || (_cache[33] = _createElementVNode(\"span\", null, \"联网\", -1))], 2)]),\n        _: 1\n      })]), _createElementVNode(\"div\", _hoisted_33, [_createVNode(_component_el_input, {\n        modelValue: inputMessage.value,\n        \"onUpdate:modelValue\": _cache[8] || (_cache[8] = $event => inputMessage.value = $event),\n        type: \"textarea\",\n        rows: inputRows.value,\n        placeholder: \"输入您的问题，AI 将基于您的论文库进行回答...\",\n        resize: \"none\",\n        onKeydown: _withKeys(_withModifiers(handleEnter, [\"prevent\"]), [\"enter\"]),\n        onInput: handleInput\n      }, null, 8, [\"modelValue\", \"rows\", \"onKeydown\"]), _createElementVNode(\"button\", {\n        class: \"send-btn\",\n        disabled: !canSend.value,\n        onClick: _cache[9] || (_cache[9] = $event => sendMessage())\n      }, [!isTyping.value ? (_openBlock(), _createBlock(_component_el_icon, {\n        key: 0\n      }, {\n        default: _withCtx(() => [_createVNode(_unref(Promotion))]),\n        _: 1\n      })) : (_openBlock(), _createBlock(_component_el_icon, {\n        key: 1,\n        class: \"loading\"\n      }, {\n        default: _withCtx(() => [_createVNode(_unref(Loading))]),\n        _: 1\n      }))], 8, _hoisted_34)]), _createElementVNode(\"div\", _hoisted_35, [_cache[34] || (_cache[34] = _createElementVNode(\"span\", null, \"Enter 发送，Shift + Enter 换行\", -1)), inputMessage.value.length > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_36, _toDisplayString(inputMessage.value.length) + \" 字符\", 1)) : _createCommentVNode(\"\", true)])])]), _createVNode(_component_el_dialog, {\n        modelValue: showPaperSelector.value,\n        \"onUpdate:modelValue\": _cache[12] || (_cache[12] = $event => showPaperSelector.value = $event),\n        title: \"选择关联论文\",\n        width: \"700px\"\n      }, {\n        footer: _withCtx(() => [_createElementVNode(\"div\", _hoisted_38, [_createElementVNode(\"span\", null, \"已选择 \" + _toDisplayString(tempSelectedPapers.value.length) + \" 篇论文\", 1), _createElementVNode(\"div\", null, [_createVNode(_component_el_button, {\n          onClick: _cache[11] || (_cache[11] = $event => showPaperSelector.value = false)\n        }, {\n          default: _withCtx(() => [...(_cache[35] || (_cache[35] = [_createTextVNode(\"取消\", -1)]))]),\n          _: 1\n        }), _createVNode(_component_el_button, {\n          type: \"primary\",\n          onClick: confirmPaperSelection\n        }, {\n          default: _withCtx(() => [...(_cache[36] || (_cache[36] = [_createTextVNode(\"确定\", -1)]))]),\n          _: 1\n        })])])]),\n        default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_37, [_createVNode(_component_el_input, {\n          modelValue: paperSearch.value,\n          \"onUpdate:modelValue\": _cache[10] || (_cache[10] = $event => paperSearch.value = $event),\n          placeholder: \"搜索论文...\",\n          clearable: \"\",\n          class: \"paper-search\"\n        }, {\n          prefix: _withCtx(() => [_createVNode(_component_el_icon, null, {\n            default: _withCtx(() => [_createVNode(_unref(Search))]),\n            _: 1\n          })]),\n          _: 1\n        }, 8, [\"modelValue\"]), _createVNode(_component_el_table, {\n          data: filteredPapers.value,\n          style: {\n            \"width\": \"100%\"\n          },\n          \"max-height\": \"400\",\n          onSelectionChange: handlePaperSelectionChange,\n          ref_key: \"paperTable\",\n          ref: paperTable\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_table_column, {\n            type: \"selection\",\n            width: \"55\"\n          }), _createVNode(_component_el_table_column, {\n            prop: \"title\",\n            label: \"论文标题\",\n            \"show-overflow-tooltip\": \"\",\n            \"min-width\": \"250\"\n          }), _createVNode(_component_el_table_column, {\n            prop: \"year\",\n            label: \"年份\",\n            width: \"80\"\n          }), _createVNode(_component_el_table_column, {\n            prop: \"venue\",\n            label: \"期刊/会议\",\n            \"show-overflow-tooltip\": \"\"\n          })]),\n          _: 1\n        }, 8, [\"data\"])])]),\n        _: 1\n      }, 8, [\"modelValue\"]), _createVNode(_component_el_dialog, {\n        modelValue: showSettings.value,\n        \"onUpdate:modelValue\": _cache[19] || (_cache[19] = $event => showSettings.value = $event),\n        title: \"聊天设置\",\n        width: \"500px\"\n      }, {\n        footer: _withCtx(() => [_createVNode(_component_el_button, {\n          onClick: _cache[18] || (_cache[18] = $event => showSettings.value = false)\n        }, {\n          default: _withCtx(() => [...(_cache[38] || (_cache[38] = [_createTextVNode(\"关闭\", -1)]))]),\n          _: 1\n        }), _createVNode(_component_el_button, {\n          type: \"primary\",\n          onClick: saveSettings\n        }, {\n          default: _withCtx(() => [...(_cache[39] || (_cache[39] = [_createTextVNode(\"保存设置\", -1)]))]),\n          _: 1\n        })]),\n        default: _withCtx(() => [_createVNode(_component_el_form, {\n          \"label-width\": \"100px\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_form_item, {\n            label: \"默认模型\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_select, {\n              modelValue: settings.value.model,\n              \"onUpdate:modelValue\": _cache[13] || (_cache[13] = $event => settings.value.model = $event),\n              style: {\n                \"width\": \"100%\"\n              }\n            }, {\n              default: _withCtx(() => [_createVNode(_component_el_option, {\n                label: \"GLM-4-Plus\",\n                value: \"glm-4-plus\"\n              }), _createVNode(_component_el_option, {\n                label: \"GLM-4-Flash\",\n                value: \"glm-4-flash\"\n              })]),\n              _: 1\n            }, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_el_form_item, {\n            label: \"温度\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_slider, {\n              modelValue: settings.value.temperature,\n              \"onUpdate:modelValue\": _cache[14] || (_cache[14] = $event => settings.value.temperature = $event),\n              min: 0,\n              max: 1,\n              step: 0.1,\n              \"show-stops\": \"\"\n            }, null, 8, [\"modelValue\"]), _cache[37] || (_cache[37] = _createElementVNode(\"div\", {\n              class: \"slider-hint\"\n            }, \"较低的值使输出更确定，较高的值使输出更随机\", -1))]),\n            _: 1\n          }), _createVNode(_component_el_form_item, {\n            label: \"最大长度\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_input_number, {\n              modelValue: settings.value.maxTokens,\n              \"onUpdate:modelValue\": _cache[15] || (_cache[15] = $event => settings.value.maxTokens = $event),\n              min: 1000,\n              max: 8000,\n              step: 1000,\n              style: {\n                \"width\": \"100%\"\n              }\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_el_form_item, {\n            label: \"启用 RAG\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_switch, {\n              modelValue: settings.value.useRag,\n              \"onUpdate:modelValue\": _cache[16] || (_cache[16] = $event => settings.value.useRag = $event)\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          }), _createVNode(_component_el_form_item, {\n            label: \"自动引用\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_switch, {\n              modelValue: settings.value.autoReference,\n              \"onUpdate:modelValue\": _cache[17] || (_cache[17] = $event => settings.value.autoReference = $event)\n            }, null, 8, [\"modelValue\"])]),\n            _: 1\n          })]),\n          _: 1\n        })]),\n        _: 1\n      }, 8, [\"modelValue\"]), _createVNode(_component_el_dialog, {\n        modelValue: showRenameDialog.value,\n        \"onUpdate:modelValue\": _cache[22] || (_cache[22] = $event => showRenameDialog.value = $event),\n        title: \"重命名对话\",\n        width: \"400px\"\n      }, {\n        footer: _withCtx(() => [_createVNode(_component_el_button, {\n          onClick: _cache[21] || (_cache[21] = $event => showRenameDialog.value = false)\n        }, {\n          default: _withCtx(() => [...(_cache[40] || (_cache[40] = [_createTextVNode(\"取消\", -1)]))]),\n          _: 1\n        }), _createVNode(_component_el_button, {\n          type: \"primary\",\n          onClick: confirmRename\n        }, {\n          default: _withCtx(() => [...(_cache[41] || (_cache[41] = [_createTextVNode(\"确定\", -1)]))]),\n          _: 1\n        })]),\n        default: _withCtx(() => [_createVNode(_component_el_input, {\n          modelValue: renameValue.value,\n          \"onUpdate:modelValue\": _cache[20] || (_cache[20] = $event => renameValue.value = $event),\n          placeholder: \"输入新名称\"\n        }, null, 8, [\"modelValue\"])]),\n        _: 1\n      }, 8, [\"modelValue\"])]);\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","nextTick","watch","useStore","ElMessage","ElMessageBox","Plus","Fold","Expand","ChatLineRound","MoreFilled","Setting","Document","Delete","ChatDotRound","Cpu","Paperclip","Search","Globe","Promotion","Loading","Edit","api","marked","DOMPurify","hljs","setOptions","highlight","code","lang","getLanguage","language","value","highlightAuto","breaks","gfm","store","sidebarCollapsed","currentChatId","chatHistory","messages","inputMessage","isTyping","currentModel","messagesContainer","useRag","useWebSearch","selectedPapers","showPaperSelector","paperSearch","papers","tempSelectedPapers","paperTable","showSettings","settings","model","temperature","maxTokens","autoReference","showRenameDialog","renameValue","renameChatId","userAvatar","getters","currentUser","avatar","userInitial","name","full_name","username","charAt","toUpperCase","currentChatTitle","chat","find","c","chat_id","preview","canSend","trim","length","inputRows","lines","split","Math","min","max","filteredPapers","query","toLowerCase","filter","p","title","includes","abstract","quickCards","key","label","icon","prompt","exampleQuestions","formatTime","timestamp","date","Date","toLocaleTimeString","hour","minute","renderMessage","content","html","sanitize","scrollToBottom","scrollTop","scrollHeight","loadChatHistory","saved","localStorage","getItem","JSON","parse","e","console","error","saveChatHistory","setItem","stringify","createNewChat","newChatId","now","unshift","created_at","toISOString","message_count","switchChat","chatId","response","getChatHistory","success","data","renameChat","confirmRename","warning","deleteChat","confirm","confirmButtonText","cancelButtonText","type","clearCurrentChat","clearChat","handleEnter","shiftKey","preventDefault","sendMessage","handleInput","sendQuickMessage","message","push","role","references","fetch","method","headers","body","map","id","reader","getReader","decoder","TextDecoder","fullContent","done","read","chunk","decode","line","startsWith","slice","loadPapers","getPapersList","limit","items","handlePaperSelectionChange","selection","confirmPaperSelection","viewPaper","paperId","window","open","saveSettings","loadSettings","handleUpload","info","_createElementBlock","_hoisted_1","_createElementVNode","class","_normalizeClass","_hoisted_2","onClick","_createVNode","_component_el_icon","_unref","_cache","$event","_createBlock","_hoisted_3","_Fragment","_renderList","active","_hoisted_5","_toDisplayString","_withModifiers","_component_el_dropdown","trigger","teleported","dropdown","_withCtx","_component_el_dropdown_menu","_component_el_dropdown_item","divided","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_component_el_tag","size","_hoisted_11","_component_el_select","_component_el_option","_component_el_tooltip","_component_el_button","circle","_hoisted_12","_hoisted_13","color","_hoisted_14","card","_resolveDynamicComponent","_hoisted_16","_hoisted_17","q","effect","index","_hoisted_18","_component_el_avatar","src","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","innerHTML","_hoisted_25","_hoisted_26","paper_id","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_component_el_input","rows","placeholder","resize","onKeydown","_withKeys","onInput","disabled","_hoisted_35","_hoisted_36","_component_el_dialog","width","footer","_hoisted_38","_hoisted_37","clearable","prefix","_component_el_table","style","onSelectionChange","_component_el_table_column","prop","_component_el_form","_component_el_form_item","_component_el_slider","step","_component_el_input_number","_component_el_switch"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/views/KimiChat.vue"],"sourcesContent":["<template>\n  <div class=\"kimi-chat-container\">\n    <!-- 左侧边栏 -->\n    <aside class=\"sidebar\" :class=\"{ 'collapsed': sidebarCollapsed }\">\n      <!-- 新建对话按钮 -->\n      <div class=\"sidebar-header\">\n        <button class=\"new-chat-btn\" @click=\"createNewChat\">\n          <el-icon><Plus /></el-icon>\n          <span>新建对话</span>\n        </button>\n        <button class=\"collapse-btn\" @click=\"sidebarCollapsed = !sidebarCollapsed\">\n          <el-icon><Fold v-if=\"!sidebarCollapsed\" /><Expand v-else /></el-icon>\n        </button>\n      </div>\n\n      <!-- 对话历史列表 -->\n      <div class=\"chat-history\">\n        <div\n          v-for=\"chat in chatHistory\"\n          :key=\"chat.chat_id\"\n          class=\"chat-item\"\n          :class=\"{ active: currentChatId === chat.chat_id }\"\n          @click=\"switchChat(chat.chat_id)\"\n        >\n          <el-icon class=\"chat-icon\"><ChatLineRound /></el-icon>\n          <span class=\"chat-title\">{{ chat.preview || '新对话' }}</span>\n          <div class=\"chat-actions\" @click.stop>\n            <el-dropdown trigger=\"click\" :teleported=\"false\">\n              <el-icon class=\"more-icon\"><MoreFilled /></el-icon>\n              <template #dropdown>\n                <el-dropdown-menu>\n                  <el-dropdown-item @click=\"renameChat(chat.chat_id)\">\n                    <el-icon><Edit /></el-icon> 重命名\n                  </el-dropdown-item>\n                  <el-dropdown-item divided @click=\"deleteChat(chat.chat_id)\" class=\"danger\">\n                    <el-icon><Delete /></el-icon> 删除\n                  </el-dropdown-item>\n                </el-dropdown-menu>\n              </template>\n            </el-dropdown>\n          </div>\n        </div>\n      </div>\n\n      <!-- 底部设置 -->\n      <div class=\"sidebar-footer\">\n        <button class=\"footer-btn\" @click=\"showSettings = true\">\n          <el-icon><Setting /></el-icon>\n          <span>设置</span>\n        </button>\n      </div>\n    </aside>\n\n    <!-- 主聊天区域 -->\n    <main class=\"chat-main\">\n      <!-- 顶部导航 -->\n      <header class=\"chat-header\">\n        <div class=\"header-left\">\n          <h2 class=\"chat-title\">{{ currentChatTitle }}</h2>\n          <el-tag v-if=\"selectedPapers.length > 0\" type=\"success\" size=\"small\">\n            已关联 {{ selectedPapers.length }} 篇论文\n          </el-tag>\n        </div>\n        <div class=\"header-right\">\n          <el-select v-model=\"currentModel\" size=\"small\" class=\"model-select\">\n            <el-option label=\"GLM-4-Plus\" value=\"glm-4-plus\" />\n            <el-option label=\"GLM-4-Flash\" value=\"glm-4-flash\" />\n          </el-select>\n          <el-tooltip content=\"关联论文\">\n            <el-button circle size=\"small\" @click=\"showPaperSelector = true\">\n              <el-icon><Document /></el-icon>\n            </el-button>\n          </el-tooltip>\n          <el-tooltip content=\"清空对话\">\n            <el-button circle size=\"small\" @click=\"clearCurrentChat\">\n              <el-icon><Delete /></el-icon>\n            </el-button>\n          </el-tooltip>\n        </div>\n      </header>\n\n      <!-- 消息列表区域 -->\n      <div ref=\"messagesContainer\" class=\"messages-area\">\n        <!-- 欢迎页面 -->\n        <div v-if=\"messages.length === 0\" class=\"welcome-section\">\n          <div class=\"welcome-logo\">\n            <el-icon :size=\"80\" color=\"#10b981\"><ChatDotRound /></el-icon>\n          </div>\n          <h1 class=\"welcome-title\">AI 科研助手</h1>\n          <p class=\"welcome-subtitle\">\n            基于您的论文库，提供深度文献分析、研究建议、代码生成等服务\n          </p>\n\n          <!-- 快捷功能卡片 -->\n          <div class=\"quick-cards\">\n            <div\n              v-for=\"card in quickCards\"\n              :key=\"card.key\"\n              class=\"quick-card\"\n              @click=\"sendQuickMessage(card.prompt)\"\n            >\n              <el-icon :size=\"24\"><component :is=\"card.icon\" /></el-icon>\n              <span>{{ card.label }}</span>\n            </div>\n          </div>\n\n          <!-- 示例问题 -->\n          <div class=\"example-questions\">\n            <div class=\"section-title\">你可以这样问我：</div>\n            <div class=\"question-tags\">\n              <el-tag\n                v-for=\"q in exampleQuestions\"\n                :key=\"q\"\n                class=\"question-tag\"\n                effect=\"plain\"\n                @click=\"sendMessage(q)\"\n              >\n                {{ q }}\n              </el-tag>\n            </div>\n          </div>\n        </div>\n\n        <!-- 消息列表 -->\n        <template v-else>\n          <div\n            v-for=\"(message, index) in messages\"\n            :key=\"index\"\n            class=\"message-wrapper\"\n            :class=\"{ 'user-message': message.role === 'user', 'ai-message': message.role === 'assistant' }\"\n          >\n            <div class=\"message-avatar\">\n              <el-avatar\n                v-if=\"message.role === 'user'\"\n                :size=\"36\"\n                :src=\"userAvatar\"\n              >\n                {{ userInitial }}\n              </el-avatar>\n              <div v-else class=\"ai-avatar\">\n                <el-icon :size=\"20\"><Cpu /></el-icon>\n              </div>\n            </div>\n\n            <div class=\"message-content\">\n              <!-- 消息头部 -->\n              <div class=\"message-header\">\n                <span class=\"message-role\">{{ message.role === 'user' ? '我' : 'AI 助手' }}</span>\n                <span class=\"message-time\">{{ formatTime(message.timestamp) }}</span>\n              </div>\n\n              <!-- 消息体 -->\n              <div class=\"message-body\" v-html=\"renderMessage(message.content)\"></div>\n\n              <!-- 引用论文 -->\n              <div v-if=\"message.references && message.references.length > 0\" class=\"message-references\">\n                <div class=\"ref-title\">引用文献：</div>\n                <div class=\"ref-list\">\n                  <el-tag\n                    v-for=\"ref in message.references\"\n                    :key=\"ref.paper_id\"\n                    size=\"small\"\n                    type=\"info\"\n                    class=\"ref-tag\"\n                    @click=\"viewPaper(ref.paper_id)\"\n                  >\n                    {{ ref.title }}\n                  </el-tag>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- AI 正在输入 -->\n          <div v-if=\"isTyping\" class=\"message-wrapper ai-message typing\">\n            <div class=\"message-avatar\">\n              <div class=\"ai-avatar\">\n                <el-icon :size=\"20\"><Cpu /></el-icon>\n              </div>\n            </div>\n            <div class=\"message-content\">\n              <div class=\"typing-indicator\">\n                <span></span>\n                <span></span>\n                <span></span>\n              </div>\n            </div>\n          </div>\n        </template>\n      </div>\n\n      <!-- 输入区域 -->\n      <footer class=\"input-area\">\n        <div class=\"input-toolbar\">\n          <el-tooltip content=\"上传文件\">\n            <button class=\"tool-btn\" @click=\"handleUpload\">\n              <el-icon><Paperclip /></el-icon>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"关联论文\">\n            <button class=\"tool-btn\" @click=\"showPaperSelector = true\">\n              <el-icon><Document /></el-icon>\n              <span v-if=\"selectedPapers.length > 0\" class=\"badge\">{{ selectedPapers.length }}</span>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"使用 RAG\">\n            <button\n              class=\"tool-btn\"\n              :class=\"{ active: useRag }\"\n              @click=\"useRag = !useRag\"\n            >\n              <el-icon><Search /></el-icon>\n              <span>RAG</span>\n            </button>\n          </el-tooltip>\n          <el-tooltip content=\"网络搜索\">\n            <button\n              class=\"tool-btn\"\n              :class=\"{ active: useWebSearch }\"\n              @click=\"useWebSearch = !useWebSearch\"\n            >\n              <el-icon><Globe /></el-icon>\n              <span>联网</span>\n            </button>\n          </el-tooltip>\n        </div>\n\n        <div class=\"input-box\">\n          <el-input\n            v-model=\"inputMessage\"\n            type=\"textarea\"\n            :rows=\"inputRows\"\n            placeholder=\"输入您的问题，AI 将基于您的论文库进行回答...\"\n            resize=\"none\"\n            @keydown.enter.prevent=\"handleEnter\"\n            @input=\"handleInput\"\n          />\n          <button\n            class=\"send-btn\"\n            :disabled=\"!canSend\"\n            @click=\"sendMessage()\"\n          >\n            <el-icon v-if=\"!isTyping\"><Promotion /></el-icon>\n            <el-icon v-else class=\"loading\"><Loading /></el-icon>\n          </button>\n        </div>\n\n        <div class=\"input-hint\">\n          <span>Enter 发送，Shift + Enter 换行</span>\n          <span v-if=\"inputMessage.length > 0\">{{ inputMessage.length }} 字符</span>\n        </div>\n      </footer>\n    </main>\n\n    <!-- 论文选择对话框 -->\n    <el-dialog v-model=\"showPaperSelector\" title=\"选择关联论文\" width=\"700px\">\n      <div class=\"paper-selector\">\n        <el-input\n          v-model=\"paperSearch\"\n          placeholder=\"搜索论文...\"\n          clearable\n          class=\"paper-search\"\n        >\n          <template #prefix>\n            <el-icon><Search /></el-icon>\n          </template>\n        </el-input>\n\n        <el-table\n          :data=\"filteredPapers\"\n          style=\"width: 100%\"\n          max-height=\"400\"\n          @selection-change=\"handlePaperSelectionChange\"\n          ref=\"paperTable\"\n        >\n          <el-table-column type=\"selection\" width=\"55\" />\n          <el-table-column prop=\"title\" label=\"论文标题\" show-overflow-tooltip min-width=\"250\" />\n          <el-table-column prop=\"year\" label=\"年份\" width=\"80\" />\n          <el-table-column prop=\"venue\" label=\"期刊/会议\" show-overflow-tooltip />\n        </el-table>\n      </div>\n\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <span>已选择 {{ tempSelectedPapers.length }} 篇论文</span>\n          <div>\n            <el-button @click=\"showPaperSelector = false\">取消</el-button>\n            <el-button type=\"primary\" @click=\"confirmPaperSelection\">确定</el-button>\n          </div>\n        </div>\n      </template>\n    </el-dialog>\n\n    <!-- 设置对话框 -->\n    <el-dialog v-model=\"showSettings\" title=\"聊天设置\" width=\"500px\">\n      <el-form label-width=\"100px\">\n        <el-form-item label=\"默认模型\">\n          <el-select v-model=\"settings.model\" style=\"width: 100%\">\n            <el-option label=\"GLM-4-Plus\" value=\"glm-4-plus\" />\n            <el-option label=\"GLM-4-Flash\" value=\"glm-4-flash\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"温度\">\n          <el-slider v-model=\"settings.temperature\" :min=\"0\" :max=\"1\" :step=\"0.1\" show-stops />\n          <div class=\"slider-hint\">较低的值使输出更确定，较高的值使输出更随机</div>\n        </el-form-item>\n        <el-form-item label=\"最大长度\">\n          <el-input-number v-model=\"settings.maxTokens\" :min=\"1000\" :max=\"8000\" :step=\"1000\" style=\"width: 100%\" />\n        </el-form-item>\n        <el-form-item label=\"启用 RAG\">\n          <el-switch v-model=\"settings.useRag\" />\n        </el-form-item>\n        <el-form-item label=\"自动引用\">\n          <el-switch v-model=\"settings.autoReference\" />\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"showSettings = false\">关闭</el-button>\n        <el-button type=\"primary\" @click=\"saveSettings\">保存设置</el-button>\n      </template>\n    </el-dialog>\n\n    <!-- 重命名对话框 -->\n    <el-dialog v-model=\"showRenameDialog\" title=\"重命名对话\" width=\"400px\">\n      <el-input v-model=\"renameValue\" placeholder=\"输入新名称\" />\n      <template #footer>\n        <el-button @click=\"showRenameDialog = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmRename\">确定</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, nextTick, watch } from 'vue'\nimport { useStore } from 'vuex'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport {\n  Plus, Fold, Expand, ChatLineRound, MoreFilled, Setting,\n  Document, Delete, ChatDotRound, Cpu, Paperclip, Search,\n  Globe, Promotion, Loading, Edit\n} from '@element-plus/icons-vue'\nimport api from '@/api'\nimport { marked } from 'marked'\nimport DOMPurify from 'dompurify'\nimport hljs from 'highlight.js'\n\n// 配置 marked\nmarked.setOptions({\n  highlight: function(code, lang) {\n    if (lang && hljs.getLanguage(lang)) {\n      return hljs.highlight(code, { language: lang }).value\n    }\n    return hljs.highlightAuto(code).value\n  },\n  breaks: true,\n  gfm: true\n})\n\nconst store = useStore()\n\n// ==================== 状态 ====================\nconst sidebarCollapsed = ref(false)\nconst currentChatId = ref(null)\nconst chatHistory = ref([])\nconst messages = ref([])\nconst inputMessage = ref('')\nconst isTyping = ref(false)\nconst currentModel = ref('glm-4-plus')\nconst messagesContainer = ref(null)\nconst useRag = ref(true)\nconst useWebSearch = ref(false)\nconst selectedPapers = ref([])\n\n// 论文选择\nconst showPaperSelector = ref(false)\nconst paperSearch = ref('')\nconst papers = ref([])\nconst tempSelectedPapers = ref([])\nconst paperTable = ref(null)\n\n// 设置\nconst showSettings = ref(false)\nconst settings = ref({\n  model: 'glm-4-plus',\n  temperature: 0.7,\n  maxTokens: 4000,\n  useRag: true,\n  autoReference: true\n})\n\n// 重命名\nconst showRenameDialog = ref(false)\nconst renameValue = ref('')\nconst renameChatId = ref(null)\n\n// ==================== 计算属性 ====================\nconst userAvatar = computed(() => store.getters.currentUser?.avatar || '')\nconst userInitial = computed(() => {\n  const name = store.getters.currentUser?.full_name || store.getters.currentUser?.username || 'U'\n  return name.charAt(0).toUpperCase()\n})\n\nconst currentChatTitle = computed(() => {\n  const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n  return chat?.preview || '新对话'\n})\n\nconst canSend = computed(() => {\n  return inputMessage.value.trim().length > 0 && !isTyping.value\n})\n\nconst inputRows = computed(() => {\n  const lines = inputMessage.value.split('\\n').length\n  return Math.min(Math.max(lines, 1), 5)\n})\n\nconst filteredPapers = computed(() => {\n  if (!paperSearch.value) return papers.value\n  const query = paperSearch.value.toLowerCase()\n  return papers.value.filter(p =>\n    (p.title || '').toLowerCase().includes(query) ||\n    (p.abstract || '').toLowerCase().includes(query)\n  )\n})\n\n// ==================== 快捷功能卡片 ====================\nconst quickCards = [\n  { key: 'summary', label: '文献综述', icon: 'Document', prompt: '请基于我的论文库生成一份文献综述' },\n  { key: 'gaps', label: '研究空白', icon: 'Search', prompt: '请分析当前研究领域的主要空白' },\n  { key: 'code', label: '代码生成', icon: 'Cpu', prompt: '请帮我生成实现XX算法的代码' },\n  { key: 'trends', label: '趋势分析', icon: 'TrendCharts', prompt: '请分析该领域的研究趋势' },\n]\n\nconst exampleQuestions = [\n  '帮我总结这几篇论文的核心贡献',\n  '这些论文中使用了哪些主要方法？',\n  '这个领域的研究现状如何？',\n  '有哪些潜在的研究方向值得探索？',\n  '帮我比较论文A和论文B的方法差异',\n  '请解释论文中的XX算法原理'\n]\n\n// ==================== 方法 ====================\nconst formatTime = (timestamp) => {\n  if (!timestamp) return ''\n  const date = new Date(timestamp)\n  return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })\n}\n\nconst renderMessage = (content) => {\n  if (!content) return ''\n  const html = marked(content)\n  return DOMPurify.sanitize(html)\n}\n\nconst scrollToBottom = () => {\n  nextTick(() => {\n    if (messagesContainer.value) {\n      messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight\n    }\n  })\n}\n\n// ==================== 聊天操作 ====================\nconst loadChatHistory = async () => {\n  try {\n    // 这里可以调用后端 API 获取会话列表\n    // 目前使用本地存储\n    const saved = localStorage.getItem('kimi_chat_history')\n    if (saved) {\n      chatHistory.value = JSON.parse(saved)\n    }\n  } catch (e) {\n    console.error('加载聊天历史失败:', e)\n  }\n}\n\nconst saveChatHistory = () => {\n  try {\n    localStorage.setItem('kimi_chat_history', JSON.stringify(chatHistory.value))\n  } catch (e) {\n    console.error('保存聊天历史失败:', e)\n  }\n}\n\nconst createNewChat = () => {\n  const newChatId = `chat_${Date.now()}`\n  currentChatId.value = newChatId\n  messages.value = []\n  selectedPapers.value = []\n\n  // 添加到历史\n  chatHistory.value.unshift({\n    chat_id: newChatId,\n    preview: '新对话',\n    created_at: new Date().toISOString(),\n    message_count: 0\n  })\n\n  saveChatHistory()\n}\n\nconst switchChat = async (chatId) => {\n  if (currentChatId.value === chatId) return\n\n  currentChatId.value = chatId\n\n  // 加载该会话的消息历史\n  try {\n    const response = await api.getChatHistory(chatId)\n    if (response.success) {\n      messages.value = response.data || []\n    }\n  } catch (e) {\n    console.error('加载消息历史失败:', e)\n    messages.value = []\n  }\n\n  scrollToBottom()\n}\n\nconst renameChat = (chatId) => {\n  renameChatId.value = chatId\n  renameValue.value = ''\n  showRenameDialog.value = true\n}\n\nconst confirmRename = () => {\n  if (!renameValue.value.trim()) {\n    ElMessage.warning('请输入新名称')\n    return\n  }\n\n  const chat = chatHistory.value.find(c => c.chat_id === renameChatId.value)\n  if (chat) {\n    chat.preview = renameValue.value\n    saveChatHistory()\n    ElMessage.success('重命名成功')\n  }\n\n  showRenameDialog.value = false\n}\n\nconst deleteChat = async (chatId) => {\n  try {\n    await ElMessageBox.confirm('确定要删除这个对话吗？', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    })\n\n    // 调用后端 API 删除\n    await api.deleteChat({ chatId })\n\n    // 从列表中移除\n    chatHistory.value = chatHistory.value.filter(c => c.chat_id !== chatId)\n\n    // 如果删除的是当前会话，切换到第一个或新建\n    if (currentChatId.value === chatId) {\n      if (chatHistory.value.length > 0) {\n        switchChat(chatHistory.value[0].chat_id)\n      } else {\n        createNewChat()\n      }\n    }\n\n    saveChatHistory()\n    ElMessage.success('删除成功')\n  } catch (e) {\n    if (e !== 'cancel') {\n      console.error('删除失败:', e)\n    }\n  }\n}\n\nconst clearCurrentChat = async () => {\n  if (messages.value.length === 0) return\n\n  try {\n    await ElMessageBox.confirm('确定要清空当前对话吗？', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    })\n\n    await api.clearChat({ chatId: currentChatId.value })\n    messages.value = []\n\n    // 更新预览\n    const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n    if (chat) {\n      chat.preview = '新对话'\n      chat.message_count = 0\n      saveChatHistory()\n    }\n\n    ElMessage.success('已清空')\n  } catch (e) {\n    if (e !== 'cancel') {\n      console.error('清空失败:', e)\n    }\n  }\n}\n\n// ==================== 消息发送 ====================\nconst handleEnter = (e) => {\n  if (e.shiftKey) {\n    // Shift+Enter 换行\n    return\n  }\n  e.preventDefault()\n  sendMessage()\n}\n\nconst handleInput = () => {\n  // 可以在这里实现输入提示等功能\n}\n\nconst sendQuickMessage = (prompt) => {\n  inputMessage.value = prompt\n  sendMessage()\n}\n\nconst sendMessage = async (content = null) => {\n  const message = content || inputMessage.value.trim()\n  if (!message || isTyping.value) return\n\n  // 清空输入框\n  if (!content) {\n    inputMessage.value = ''\n  }\n\n  // 添加用户消息\n  messages.value.push({\n    role: 'user',\n    content: message,\n    timestamp: new Date().toISOString(),\n    references: []\n  })\n\n  scrollToBottom()\n  isTyping.value = true\n\n  try {\n    // 调用流式 API\n    const response = await fetch('/api/chat/stream', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      },\n      body: JSON.stringify({\n        message,\n        chatId: currentChatId.value,\n        papers: selectedPapers.value.map(p => p.id),\n        model: currentModel.value,\n        temperature: settings.value.temperature,\n        useRag: useRag.value\n      })\n    })\n\n    const reader = response.body.getReader()\n    const decoder = new TextDecoder()\n    let fullContent = ''\n\n    // 添加 AI 消息占位\n    messages.value.push({\n      role: 'assistant',\n      content: '',\n      timestamp: new Date().toISOString(),\n      references: []\n    })\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const { done, value } = await reader.read()\n      if (done) break\n\n      const chunk = decoder.decode(value)\n      const lines = chunk.split('\\n\\n')\n\n      for (const line of lines) {\n        if (line.startsWith('data: ')) {\n          try {\n            const data = JSON.parse(line.slice(6))\n\n            if (data.done) {\n              isTyping.value = false\n            } else if (data.content) {\n              fullContent += data.content\n              messages.value[messages.value.length - 1].content = fullContent\n              scrollToBottom()\n            }\n          } catch (e) {\n            console.error('解析 SSE 数据失败:', e)\n          }\n        }\n      }\n    }\n\n    // 更新会话预览\n    const chat = chatHistory.value.find(c => c.chat_id === currentChatId.value)\n    if (chat) {\n      chat.preview = message.slice(0, 30) + (message.length > 30 ? '...' : '')\n      chat.message_count = messages.value.length\n      saveChatHistory()\n    }\n\n  } catch (error) {\n    console.error('发送消息失败:', error)\n    ElMessage.error('发送失败，请重试')\n    isTyping.value = false\n  }\n}\n\n// ==================== 论文选择 ====================\nconst loadPapers = async () => {\n  try {\n    const response = await api.getPapersList({ limit: 100 })\n    if (response.success) {\n      papers.value = response.data.items || []\n    }\n  } catch (error) {\n    console.error('加载论文失败:', error)\n  }\n}\n\nconst handlePaperSelectionChange = (selection) => {\n  tempSelectedPapers.value = selection\n}\n\nconst confirmPaperSelection = () => {\n  selectedPapers.value = [...tempSelectedPapers.value]\n  showPaperSelector.value = false\n  ElMessage.success(`已关联 ${selectedPapers.value.length} 篇论文`)\n}\n\nconst viewPaper = (paperId) => {\n  window.open(`#/papers/${paperId}`, '_blank')\n}\n\n// ==================== 设置 ====================\nconst saveSettings = () => {\n  localStorage.setItem('kimi_chat_settings', JSON.stringify(settings.value))\n  showSettings.value = false\n  ElMessage.success('设置已保存')\n}\n\nconst loadSettings = () => {\n  try {\n    const saved = localStorage.getItem('kimi_chat_settings')\n    if (saved) {\n      settings.value = { ...settings.value, ...JSON.parse(saved) }\n    }\n  } catch (e) {\n    console.error('加载设置失败:', e)\n  }\n}\n\n// ==================== 其他操作 ====================\nconst handleUpload = () => {\n  ElMessage.info('文件上传功能开发中')\n}\n\n// ==================== 生命周期 ====================\nonMounted(() => {\n  loadChatHistory()\n  loadPapers()\n  loadSettings()\n\n  // 如果没有会话，创建一个新的\n  if (chatHistory.value.length === 0) {\n    createNewChat()\n  } else {\n    // 切换到第一个会话\n    switchChat(chatHistory.value[0].chat_id)\n  }\n})\n</script>\n\n<style scoped>\n.kimi-chat-container {\n  display: flex;\n  height: calc(100vh - 64px);\n  background: #f9fafb;\n}\n\n/* ==================== 侧边栏 ==================== */\n.sidebar {\n  width: 260px;\n  background: #ffffff;\n  border-right: 1px solid #e5e7eb;\n  display: flex;\n  flex-direction: column;\n  transition: width 0.3s ease;\n}\n\n.sidebar.collapsed {\n  width: 60px;\n}\n\n.sidebar-header {\n  padding: 16px;\n  display: flex;\n  gap: 8px;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.new-chat-btn {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  padding: 10px 16px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  color: white;\n  border: none;\n  border-radius: 10px;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.new-chat-btn:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n}\n\n.collapse-btn {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #f3f4f6;\n  border: none;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.collapse-btn:hover {\n  background: #e5e7eb;\n}\n\n.sidebar.collapsed .new-chat-btn span {\n  display: none;\n}\n\n/* 对话历史 */\n.chat-history {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px;\n}\n\n.chat-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  border-radius: 8px;\n  cursor: pointer;\n  margin-bottom: 4px;\n  transition: all 0.2s;\n  position: relative;\n}\n\n.chat-item:hover {\n  background: #f3f4f6;\n}\n\n.chat-item.active {\n  background: #d1fae5;\n}\n\n.chat-item.active .chat-title {\n  color: #059669;\n  font-weight: 500;\n}\n\n.chat-icon {\n  font-size: 16px;\n  color: #6b7280;\n  flex-shrink: 0;\n}\n\n.chat-item.active .chat-icon {\n  color: #059669;\n}\n\n.chat-title {\n  flex: 1;\n  font-size: 14px;\n  color: #374151;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.chat-actions {\n  opacity: 0;\n  transition: opacity 0.2s;\n}\n\n.chat-item:hover .chat-actions {\n  opacity: 1;\n}\n\n.more-icon {\n  padding: 4px;\n  border-radius: 4px;\n  color: #6b7280;\n  cursor: pointer;\n}\n\n.more-icon:hover {\n  background: #e5e7eb;\n  color: #374151;\n}\n\n.sidebar.collapsed .chat-title,\n.sidebar.collapsed .chat-actions {\n  display: none;\n}\n\n/* 侧边栏底部 */\n.sidebar-footer {\n  padding: 12px 16px;\n  border-top: 1px solid #e5e7eb;\n}\n\n.footer-btn {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  background: transparent;\n  border: none;\n  border-radius: 8px;\n  color: #6b7280;\n  font-size: 14px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.footer-btn:hover {\n  background: #f3f4f6;\n  color: #374151;\n}\n\n.sidebar.collapsed .footer-btn span {\n  display: none;\n}\n\n/* ==================== 主聊天区域 ==================== */\n.chat-main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n/* 顶部导航 */\n.chat-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 24px;\n  background: #ffffff;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.header-left {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.chat-title {\n  font-size: 16px;\n  font-weight: 600;\n  color: #111827;\n  margin: 0;\n}\n\n.header-right {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.model-select {\n  width: 140px;\n}\n\n/* 消息区域 */\n.messages-area {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px;\n}\n\n/* 欢迎页面 */\n.welcome-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 100%;\n  text-align: center;\n  padding: 40px 20px;\n}\n\n.welcome-logo {\n  margin-bottom: 24px;\n  animation: float 3s ease-in-out infinite;\n}\n\n@keyframes float {\n  0%, 100% { transform: translateY(0); }\n  50% { transform: translateY(-10px); }\n}\n\n.welcome-title {\n  font-size: 32px;\n  font-weight: 700;\n  color: #111827;\n  margin-bottom: 12px;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  background-clip: text;\n}\n\n.welcome-subtitle {\n  font-size: 16px;\n  color: #6b7280;\n  max-width: 500px;\n  margin-bottom: 40px;\n}\n\n/* 快捷卡片 */\n.quick-cards {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  gap: 16px;\n  max-width: 600px;\n  margin-bottom: 48px;\n}\n\n.quick-card {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 10px;\n  padding: 20px 16px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.quick-card:hover {\n  border-color: #10b981;\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);\n  transform: translateY(-2px);\n}\n\n.quick-card span {\n  font-size: 14px;\n  color: #374151;\n  font-weight: 500;\n}\n\n.quick-card:hover span {\n  color: #059669;\n}\n\n/* 示例问题 */\n.example-questions {\n  max-width: 600px;\n}\n\n.section-title {\n  font-size: 14px;\n  color: #9ca3af;\n  margin-bottom: 16px;\n}\n\n.question-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  justify-content: center;\n}\n\n.question-tag {\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.question-tag:hover {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n/* 消息样式 */\n.message-wrapper {\n  display: flex;\n  gap: 12px;\n  margin-bottom: 24px;\n  max-width: 90%;\n}\n\n.message-wrapper.user-message {\n  margin-left: auto;\n  flex-direction: row-reverse;\n}\n\n.message-wrapper.ai-message {\n  margin-right: auto;\n}\n\n.message-avatar {\n  flex-shrink: 0;\n}\n\n.ai-avatar {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  border-radius: 50%;\n  color: white;\n}\n\n.message-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.message-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 6px;\n}\n\n.user-message .message-header {\n  justify-content: flex-end;\n}\n\n.message-role {\n  font-size: 13px;\n  font-weight: 600;\n  color: #374151;\n}\n\n.message-time {\n  font-size: 12px;\n  color: #9ca3af;\n}\n\n.message-body {\n  padding: 14px 18px;\n  border-radius: 12px;\n  font-size: 15px;\n  line-height: 1.7;\n  color: #374151;\n}\n\n.user-message .message-body {\n  background: #10b981;\n  color: white;\n  border-bottom-right-radius: 4px;\n}\n\n.ai-message .message-body {\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-bottom-left-radius: 4px;\n}\n\n.ai-message .message-body :deep(p) {\n  margin: 0 0 12px 0;\n}\n\n.ai-message .message-body :deep(p:last-child) {\n  margin-bottom: 0;\n}\n\n.ai-message .message-body :deep(pre) {\n  background: #1f2937;\n  border-radius: 8px;\n  padding: 16px;\n  overflow-x: auto;\n  margin: 12px 0;\n}\n\n.ai-message .message-body :deep(code) {\n  font-family: 'Menlo', 'Monaco', 'Courier New', monospace;\n  font-size: 13px;\n}\n\n.ai-message .message-body :deep(:not(pre) > code) {\n  background: #f3f4f6;\n  padding: 2px 6px;\n  border-radius: 4px;\n  color: #ec4899;\n}\n\n.ai-message .message-body :deep(ul), .ai-message .message-body :deep(ol) {\n  padding-left: 20px;\n  margin: 12px 0;\n}\n\n.ai-message .message-body :deep(li) {\n  margin: 6px 0;\n}\n\n.ai-message .message-body :deep(h1), .ai-message .message-body :deep(h2), .ai-message .message-body :deep(h3) {\n  margin: 20px 0 12px 0;\n  color: #111827;\n}\n\n.ai-message .message-body :deep(blockquote) {\n  border-left: 4px solid #10b981;\n  margin: 12px 0;\n  padding: 8px 16px;\n  background: #f0fdf4;\n  border-radius: 0 8px 8px 0;\n}\n\n/* 引用文献 */\n.message-references {\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px dashed #e5e7eb;\n}\n\n.ref-title {\n  font-size: 12px;\n  color: #9ca3af;\n  margin-bottom: 8px;\n}\n\n.ref-list {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.ref-tag {\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.ref-tag:hover {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n/* 正在输入动画 */\n.typing-indicator {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 16px 18px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  border-bottom-left-radius: 4px;\n}\n\n.typing-indicator span {\n  width: 8px;\n  height: 8px;\n  background: #10b981;\n  border-radius: 50%;\n  animation: typing 1.4s infinite ease-in-out both;\n}\n\n.typing-indicator span:nth-child(1) {\n  animation-delay: -0.32s;\n}\n\n.typing-indicator span:nth-child(2) {\n  animation-delay: -0.16s;\n}\n\n@keyframes typing {\n  0%, 80%, 100% {\n    transform: scale(0);\n    opacity: 0.5;\n  }\n  40% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n/* ==================== 输入区域 ==================== */\n.input-area {\n  background: #ffffff;\n  border-top: 1px solid #e5e7eb;\n  padding: 16px 24px;\n}\n\n.input-toolbar {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 10px;\n}\n\n.tool-btn {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  color: #6b7280;\n  font-size: 13px;\n  cursor: pointer;\n  transition: all 0.2s;\n  position: relative;\n}\n\n.tool-btn:hover {\n  background: #f3f4f6;\n  color: #374151;\n}\n\n.tool-btn.active {\n  background: #d1fae5;\n  border-color: #10b981;\n  color: #059669;\n}\n\n.tool-btn .badge {\n  position: absolute;\n  top: -6px;\n  right: -6px;\n  width: 18px;\n  height: 18px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: #ef4444;\n  color: white;\n  font-size: 11px;\n  border-radius: 50%;\n}\n\n.input-box {\n  display: flex;\n  gap: 12px;\n  align-items: flex-end;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 12px;\n  padding: 12px 16px;\n  transition: all 0.2s;\n}\n\n.input-box:focus-within {\n  background: #ffffff;\n  border-color: #10b981;\n  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);\n}\n\n.input-box :deep(.el-textarea__inner) {\n  background: transparent;\n  border: none;\n  padding: 0;\n  font-size: 15px;\n  resize: none;\n  box-shadow: none;\n}\n\n.input-box :deep(.el-textarea__inner:focus) {\n  box-shadow: none;\n}\n\n.send-btn {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n  border: none;\n  border-radius: 10px;\n  color: white;\n  cursor: pointer;\n  transition: all 0.2s;\n  flex-shrink: 0;\n}\n\n.send-btn:hover:not(:disabled) {\n  transform: scale(1.05);\n  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);\n}\n\n.send-btn:disabled {\n  background: #d1d5db;\n  cursor: not-allowed;\n}\n\n.send-btn .loading {\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n.input-hint {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 8px;\n  font-size: 12px;\n  color: #9ca3af;\n}\n\n/* ==================== 对话框样式 ==================== */\n.dialog-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.paper-selector {\n  max-height: 500px;\n}\n\n.paper-search {\n  margin-bottom: 16px;\n}\n\n.slider-hint {\n  font-size: 12px;\n  color: #9ca3af;\n  margin-top: 4px;\n}\n\n/* 下拉菜单危险项 */\n:deep(.el-dropdown-menu__item.danger) {\n  color: #ef4444;\n}\n\n:deep(.el-dropdown-menu__item.danger:hover) {\n  background: #fef2f2;\n  color: #dc2626;\n}\n\n/* 响应式 */\n@media (max-width: 768px) {\n  .sidebar {\n    position: absolute;\n    z-index: 100;\n    height: 100%;\n  }\n\n  .sidebar.collapsed {\n    transform: translateX(-100%);\n  }\n\n  .quick-cards {\n    grid-template-columns: repeat(2, 1fr);\n  }\n\n  .message-wrapper {\n    max-width: 100%;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}