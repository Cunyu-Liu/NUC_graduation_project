{"ast":null,"code":"import { ref, provide, inject, onMounted, unref, onBeforeUnmount } from 'vue';\nimport Collection from './collection2.mjs';\nimport CollectionItem from './collection-item.mjs';\nconst COLLECTION_ITEM_SIGN = `data-el-collection-item`;\nconst createCollectionWithScope = name => {\n  const COLLECTION_NAME = `El${name}Collection`;\n  const COLLECTION_ITEM_NAME = `${COLLECTION_NAME}Item`;\n  const COLLECTION_INJECTION_KEY = Symbol(COLLECTION_NAME);\n  const COLLECTION_ITEM_INJECTION_KEY = Symbol(COLLECTION_ITEM_NAME);\n  const ElCollection = Object.assign({}, Collection, {\n    name: COLLECTION_NAME,\n    setup() {\n      const collectionRef = ref();\n      const itemMap = /* @__PURE__ */new Map();\n      const getItems = () => {\n        const collectionEl = unref(collectionRef);\n        if (!collectionEl) return [];\n        const orderedNodes = Array.from(collectionEl.querySelectorAll(`[${COLLECTION_ITEM_SIGN}]`));\n        const items = [...itemMap.values()];\n        return items.sort((a, b) => orderedNodes.indexOf(a.ref) - orderedNodes.indexOf(b.ref));\n      };\n      provide(COLLECTION_INJECTION_KEY, {\n        itemMap,\n        getItems,\n        collectionRef\n      });\n    }\n  });\n  const ElCollectionItem = Object.assign({}, CollectionItem, {\n    name: COLLECTION_ITEM_NAME,\n    setup(_, {\n      attrs\n    }) {\n      const collectionItemRef = ref();\n      const collectionInjection = inject(COLLECTION_INJECTION_KEY, void 0);\n      provide(COLLECTION_ITEM_INJECTION_KEY, {\n        collectionItemRef\n      });\n      onMounted(() => {\n        const collectionItemEl = unref(collectionItemRef);\n        if (collectionItemEl) {\n          collectionInjection.itemMap.set(collectionItemEl, {\n            ref: collectionItemEl,\n            ...attrs\n          });\n        }\n      });\n      onBeforeUnmount(() => {\n        const collectionItemEl = unref(collectionItemRef);\n        collectionInjection.itemMap.delete(collectionItemEl);\n      });\n    }\n  });\n  return {\n    COLLECTION_INJECTION_KEY,\n    COLLECTION_ITEM_INJECTION_KEY,\n    ElCollection,\n    ElCollectionItem\n  };\n};\nexport { COLLECTION_ITEM_SIGN, createCollectionWithScope };","map":{"version":3,"names":["COLLECTION_ITEM_SIGN","createCollectionWithScope","name","COLLECTION_NAME","COLLECTION_ITEM_NAME","COLLECTION_INJECTION_KEY","Symbol","COLLECTION_ITEM_INJECTION_KEY","ElCollection","Object","assign","Collection","setup","collectionRef","ref","itemMap","Map","getItems","collectionEl","unref","orderedNodes","Array","from","querySelectorAll","items","values","sort","a","b","indexOf","provide","ElCollectionItem","CollectionItem","_","attrs","collectionItemRef","collectionInjection","inject","onMounted","collectionItemEl","set","onBeforeUnmount","delete"],"sources":["../../../../../../packages/components/collection/src/collection.ts"],"sourcesContent":["import { inject, onBeforeUnmount, onMounted, provide, ref, unref } from 'vue'\nimport Collection from './collection.vue'\nimport CollectionItem from './collection-item.vue'\n\nimport type { InjectionKey, SetupContext } from 'vue'\nimport type {\n  ElCollectionInjectionContext,\n  ElCollectionItemInjectionContext,\n} from './tokens'\n\nexport const COLLECTION_ITEM_SIGN = `data-el-collection-item`\n\n// Make sure the first letter of name is capitalized\nexport const createCollectionWithScope = (name: string) => {\n  const COLLECTION_NAME = `El${name}Collection`\n  const COLLECTION_ITEM_NAME = `${COLLECTION_NAME}Item`\n  const COLLECTION_INJECTION_KEY: InjectionKey<ElCollectionInjectionContext> =\n    Symbol(COLLECTION_NAME)\n  const COLLECTION_ITEM_INJECTION_KEY: InjectionKey<ElCollectionItemInjectionContext> =\n    Symbol(COLLECTION_ITEM_NAME)\n\n  const ElCollection = Object.assign({}, Collection, {\n    name: COLLECTION_NAME,\n    setup() {\n      const collectionRef = ref<HTMLElement>()\n      const itemMap: ElCollectionInjectionContext['itemMap'] = new Map()\n      const getItems = (() => {\n        const collectionEl = unref(collectionRef)\n\n        if (!collectionEl) return []\n        const orderedNodes = Array.from(\n          collectionEl.querySelectorAll(`[${COLLECTION_ITEM_SIGN}]`)\n        )\n\n        const items = [...itemMap.values()]\n\n        return items.sort(\n          (a, b) => orderedNodes.indexOf(a.ref!) - orderedNodes.indexOf(b.ref!)\n        )\n      }) as ElCollectionInjectionContext['getItems']\n\n      provide(COLLECTION_INJECTION_KEY, {\n        itemMap,\n        getItems,\n        collectionRef,\n      })\n    },\n  })\n\n  const ElCollectionItem = Object.assign({}, CollectionItem, {\n    name: COLLECTION_ITEM_NAME,\n    setup(_: unknown, { attrs }: SetupContext) {\n      const collectionItemRef = ref<HTMLElement>()\n      const collectionInjection = inject(COLLECTION_INJECTION_KEY, undefined)!\n\n      provide(COLLECTION_ITEM_INJECTION_KEY, {\n        collectionItemRef,\n      })\n\n      onMounted(() => {\n        const collectionItemEl = unref(collectionItemRef)\n        if (collectionItemEl) {\n          collectionInjection.itemMap.set(collectionItemEl, {\n            ref: collectionItemEl,\n            ...attrs,\n          })\n        }\n      })\n\n      onBeforeUnmount(() => {\n        const collectionItemEl = unref(collectionItemRef)!\n        collectionInjection.itemMap.delete(collectionItemEl)\n      })\n    },\n  })\n\n  return {\n    COLLECTION_INJECTION_KEY,\n    COLLECTION_ITEM_INJECTION_KEY,\n    ElCollection,\n    ElCollectionItem,\n  }\n}\n"],"mappings":";;;AAUO,MAAMA,oBAAuB;AAGvB,MAAAC,yBAAA,GAA6BC,IAAiB;EACzD,MAAMC,eAAA,GAAkB,KAAKD,IAAA;EAC7B,MAAME,oBAAA,GAAuB,GAAGD,eAAA;EAC1B,MAAAE,wBAAA,GACJC,MAAA,CAAOH,eAAe;EAClB,MAAAI,6BAAA,GACJD,MAAA,CAAOF,oBAAoB;EAE7B,MAAMI,YAAe,GAAAC,MAAA,CAAOC,MAAO,KAAIC,UAAY;IACjDT,IAAM,EAAAC,eAAA;IACNS,KAAQA,CAAA;MACN,MAAMC,aAAA,GAAgBC,GAAiB;MACjC,MAAAC,OAAA,sBAAuDC,GAAI;MACjE,MAAMC,QAAA,GAAYA,CAAA,KAAM;QAChB,MAAAC,YAAA,GAAeC,KAAA,CAAMN,aAAa;QAExC,IAAI,CAACK,YAAA,EAAc,OAAO,EAAC;QAC3B,MAAME,YAAA,GAAeC,KAAM,CAAAC,IAAA,CACzBJ,YAAA,CAAaK,gBAAiB,KAAIvB,oBAAuB,KAC3D;QAEA,MAAMwB,KAAQ,IAAC,GAAGT,OAAA,CAAQU,MAAA,EAAQ;QAElC,OAAOD,KAAM,CAAAE,IAAA,CACX,CAACC,CAAG,EAAAC,CAAA,KAAMR,YAAa,CAAAS,OAAA,CAAQF,CAAE,CAAAb,GAAI,CAAI,GAAAM,YAAA,CAAaS,OAAQ,CAAAD,CAAA,CAAEd,GAAI,EACtE;MAAA,CACF;MAEAgB,OAAA,CAAQzB,wBAA0B;QAChCU,OAAA;QACAE,QAAA;QACAJ;MAAA,CACD;IAAA;EACH,CACD;EAED,MAAMkB,gBAAmB,GAAAtB,MAAA,CAAOC,MAAO,KAAIsB,cAAgB;IACzD9B,IAAM,EAAAE,oBAAA;IACNQ,KAAMA,CAAAqB,CAAA,EAAY;MAAEC;IAAA,CAAuB;MACzC,MAAMC,iBAAA,GAAoBrB,GAAiB;MACrC,MAAAsB,mBAAA,GAAsBC,MAAO,CAAAhC,wBAAA,EAA0B,KAAS;MAEtEyB,OAAA,CAAQvB,6BAA+B;QACrC4B;MAAA,CACD;MAEDG,SAAA,CAAU,MAAM;QACR,MAAAC,gBAAA,GAAmBpB,KAAA,CAAMgB,iBAAiB;QAChD,IAAII,gBAAkB;UACAH,mBAAA,CAAArB,OAAA,CAAQyB,GAAA,CAAID,gBAAkB;YAChDzB,GAAK,EAAAyB,gBAAA;YACL,GAAGL;UAAA,CACJ;QAAA;MACH,CACD;MAEDO,eAAA,CAAgB,MAAM;QACd,MAAAF,gBAAA,GAAmBpB,KAAA,CAAMgB,iBAAiB;QAC5BC,mBAAA,CAAArB,OAAA,CAAQ2B,MAAA,CAAOH,gBAAgB;MAAA,CACpD;IAAA;EACH,CACD;EAEM;IACLlC,wBAAA;IACAE,6BAAA;IACAC,YAAA;IACAuB;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}