{"ast":null,"code":"import { computed, ref } from 'vue';\nimport { useStore } from 'vuex';\nimport { ElMessage } from 'element-plus';\nexport default {\n  name: 'UploadDialog',\n  setup(_, {\n    emit\n  }) {\n    const store = useStore();\n    const fileList = ref([]);\n    const visible = computed({\n      get: () => store.state.showUploadDialog,\n      set: val => store.commit('SHOW_UPLOAD_DIALOG', val)\n    });\n    const beforeUpload = file => {\n      const isPDF = file.type === 'application/pdf';\n      const isLt50M = file.size / 1024 / 1024 < 50;\n      if (!isPDF) {\n        ElMessage.error('只能上传PDF文件!');\n        return false;\n      }\n      if (!isLt50M) {\n        ElMessage.error('文件大小不能超过50MB!');\n        return false;\n      }\n      return true;\n    };\n    const handleSuccess = (response, file) => {\n      if (response.success) {\n        ElMessage.success({\n          message: `${file.name} 上传成功`,\n          duration: 3000,\n          showClose: true\n        });\n        emit('uploaded', response.data);\n        fileList.value = [];\n      } else {\n        // 显示友好的错误提示\n        const errorMsg = response.error || '上传失败';\n\n        // 根据错误类型显示不同的提示\n        if (errorMsg.includes('PDF')) {\n          ElMessage.error({\n            message: `PDF解析失败：${file.name}`,\n            description: '请确保文件是有效的PDF格式且未损坏',\n            duration: 5000,\n            showClose: true\n          });\n        } else if (errorMsg.includes('数据库')) {\n          ElMessage.error({\n            message: '数据库保存失败',\n            description: '请检查数据库连接是否正常',\n            duration: 5000,\n            showClose: true\n          });\n        } else {\n          ElMessage.error({\n            message: errorMsg,\n            duration: 4000,\n            showClose: true\n          });\n        }\n      }\n    };\n    const handleError = error => {\n      console.error('上传错误:', error);\n      let errorMsg = '上传失败';\n      if (error.message) {\n        if (error.message.includes('403') || error.message.includes('CORS')) {\n          errorMsg = '权限错误：请检查后端CORS配置';\n        } else if (error.message.includes('Network Error')) {\n          errorMsg = '网络错误：请检查后端服务是否启动（端口5001）';\n        } else if (error.message.includes('timeout')) {\n          errorMsg = '上传超时：文件可能过大，请尝试更小的文件';\n        } else if (error.message.includes('413')) {\n          errorMsg = '文件过大：单个文件不能超过50MB';\n        } else {\n          errorMsg = `上传失败: ${error.message}`;\n        }\n      }\n      ElMessage.error({\n        message: errorMsg,\n        duration: 5000,\n        showClose: true\n      });\n    };\n    return {\n      visible,\n      fileList,\n      beforeUpload,\n      handleSuccess,\n      handleError\n    };\n  }\n};","map":{"version":3,"names":["computed","ref","useStore","ElMessage","name","setup","_","emit","store","fileList","visible","get","state","showUploadDialog","set","val","commit","beforeUpload","file","isPDF","type","isLt50M","size","error","handleSuccess","response","success","message","duration","showClose","data","value","errorMsg","includes","description","handleError","console"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/components/UploadDialog.vue"],"sourcesContent":["<template>\n  <el-dialog\n    v-model=\"visible\"\n    title=\"上传PDF论文\"\n    width=\"500px\"\n    :close-on-click-modal=\"false\"\n  >\n    <el-upload\n      class=\"upload-demo\"\n      drag\n    action=\"/api/upload\"\n    :on-success=\"handleSuccess\"\n    :on-error=\"handleError\"\n    :before-upload=\"beforeUpload\"\n    :file-list=\"fileList\"\n    accept=\".pdf\"\n    :limit=\"5\"\n    multiple\n    >\n      <i class=\"el-icon-upload\"></i>\n      <div class=\"el-upload__text\">\n        将PDF文件拖到此处，或<em>点击上传</em>\n      </div>\n      <template #tip>\n        <div class=\"el-upload__tip\">\n          只支持PDF格式，单个文件不超过50MB\n        </div>\n      </template>\n    </el-upload>\n\n    <template #footer>\n      <el-button @click=\"visible = false\">关闭</el-button>\n    </template>\n  </el-dialog>\n</template>\n\n<script>\nimport { computed, ref } from 'vue'\nimport { useStore } from 'vuex'\nimport { ElMessage } from 'element-plus'\n\nexport default {\n  name: 'UploadDialog',\n  setup(_, { emit }) {\n    const store = useStore()\n    const fileList = ref([])\n\n    const visible = computed({\n      get: () => store.state.showUploadDialog,\n      set: (val) => store.commit('SHOW_UPLOAD_DIALOG', val)\n    })\n\n    const beforeUpload = (file) => {\n      const isPDF = file.type === 'application/pdf'\n      const isLt50M = file.size / 1024 / 1024 < 50\n\n      if (!isPDF) {\n        ElMessage.error('只能上传PDF文件!')\n        return false\n      }\n      if (!isLt50M) {\n        ElMessage.error('文件大小不能超过50MB!')\n        return false\n      }\n      return true\n    }\n\n    const handleSuccess = (response, file) => {\n      if (response.success) {\n        ElMessage.success({\n          message: `${file.name} 上传成功`,\n          duration: 3000,\n          showClose: true\n        })\n        emit('uploaded', response.data)\n        fileList.value = []\n      } else {\n        // 显示友好的错误提示\n        const errorMsg = response.error || '上传失败'\n\n        // 根据错误类型显示不同的提示\n        if (errorMsg.includes('PDF')) {\n          ElMessage.error({\n            message: `PDF解析失败：${file.name}`,\n            description: '请确保文件是有效的PDF格式且未损坏',\n            duration: 5000,\n            showClose: true\n          })\n        } else if (errorMsg.includes('数据库')) {\n          ElMessage.error({\n            message: '数据库保存失败',\n            description: '请检查数据库连接是否正常',\n            duration: 5000,\n            showClose: true\n          })\n        } else {\n          ElMessage.error({\n            message: errorMsg,\n            duration: 4000,\n            showClose: true\n          })\n        }\n      }\n    }\n\n    const handleError = (error) => {\n      console.error('上传错误:', error)\n\n      let errorMsg = '上传失败'\n\n      if (error.message) {\n        if (error.message.includes('403') || error.message.includes('CORS')) {\n          errorMsg = '权限错误：请检查后端CORS配置'\n        } else if (error.message.includes('Network Error')) {\n          errorMsg = '网络错误：请检查后端服务是否启动（端口5001）'\n        } else if (error.message.includes('timeout')) {\n          errorMsg = '上传超时：文件可能过大，请尝试更小的文件'\n        } else if (error.message.includes('413')) {\n          errorMsg = '文件过大：单个文件不能超过50MB'\n        } else {\n          errorMsg = `上传失败: ${error.message}`\n        }\n      }\n\n      ElMessage.error({\n        message: errorMsg,\n        duration: 5000,\n        showClose: true\n      })\n    }\n\n    return {\n      visible,\n      fileList,\n      beforeUpload,\n      handleSuccess,\n      handleError\n    }\n  }\n}\n</script>\n\n<style scoped>\n.upload-demo {\n  text-align: center;\n}\n\n.el-icon-upload {\n  font-size: 67px;\n  color: #409eff;\n  margin: 20px 0;\n}\n\n.el-upload__text {\n  font-size: 14px;\n  color: #606266;\n}\n\n.el-upload__text em {\n  color: #409eff;\n  font-style: normal;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}