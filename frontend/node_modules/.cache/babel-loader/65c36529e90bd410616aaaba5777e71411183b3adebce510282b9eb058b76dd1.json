{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRoute } from 'vue-router';\nimport api, { connectSocket } from '@/api';\nimport { ElMessage, ElMessageBox } from 'element-plus';\n\n// 改进的Markdown渲染器 - 更好的格式支持\nconst renderMarkdown = text => {\n  if (!text) return '';\n\n  // HTML转义，防止XSS\n  const escapeHtml = unsafe => {\n    return unsafe.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n  };\n  let html = escapeHtml(text);\n\n  // 代码块 (```language\\ncode\\n```)\n  html = html.replace(/```(\\w+)?\\n([\\s\\S]*?)```/g, (match, lang, code) => {\n    return `<div class=\"code-block\"><pre class=\"language-${lang || 'text'}\"><code>${code.trim()}</code></pre></div>`;\n  });\n\n  // 行内代码 (`code`)\n  html = html.replace(/`([^`]+)`/g, '<code class=\"inline-code\">$1</code>');\n\n  // 标题 (# ## ### #### ##### ######)\n  html = html.replace(/^######\\s+(.+)$/gm, '<h6 class=\"md-h6\">$1</h6>');\n  html = html.replace(/^#####\\s+(.+)$/gm, '<h5 class=\"md-h5\">$1</h5>');\n  html = html.replace(/^####\\s+(.+)$/gm, '<h4 class=\"md-h4\">$1</h4>');\n  html = html.replace(/^###\\s+(.+)$/gm, '<h3 class=\"md-h3\">$1</h3>');\n  html = html.replace(/^##\\s+(.+)$/gm, '<h2 class=\"md-h2\">$1</h2>');\n  html = html.replace(/^#\\s+(.+)$/gm, '<h1 class=\"md-h1\">$1</h1>');\n\n  // 粗体和斜体\n  html = html.replace(/\\*\\*\\*(.+?)\\*\\*\\*/g, '<strong><em>$1</em></strong>');\n  html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong class=\"md-bold\">$1</strong>');\n  html = html.replace(/\\*(.+?)\\*/g, '<em class=\"md-italic\">$1</em>');\n\n  // 删除线\n  html = html.replace(/~~(.+?)~~/g, '<del>$1</del>');\n\n  // 引用块\n  html = html.replace(/^&gt;\\s+(.+)$/gm, '<blockquote class=\"md-quote\">$1</blockquote>');\n  html = html.replace(/(<blockquote[^>]*>[\\s\\S]*?<\\/blockquote>)/g, '<div class=\"md-blockquote\">$1</div>');\n\n  // 分隔线\n  html = html.replace(/^---+$/gm, '<hr class=\"md-hr\" />');\n\n  // 无序列表 - 先处理列表项\n  html = html.replace(/^([*-])\\s+(.+)$/gm, '<li class=\"md-li\">$2</li>');\n  // 然后将连续的li包装成ul\n  html = html.replace(/(<li[^>]*>[\\s\\S]*?<\\/li>)(\\s*<li[^>]*>[\\s\\S]*?<\\/li>)*/g, match => {\n    return `<ul class=\"md-ul\">${match}</ul>`;\n  });\n\n  // 有序列表\n  html = html.replace(/^\\d+\\.\\s+(.+)$/gm, '<li class=\"md-ol-li\">$1</li>');\n  html = html.replace(/(<li class=\"md-ol-li\">[\\s\\S]*?<\\/li>)(\\s*<li class=\"md-ol-li\">[\\s\\S]*?<\\/li>)*/g, match => {\n    return `<ol class=\"md-ol\">${match.replace(/md-ol-li/g, 'md-li')}</ol>`;\n  });\n\n  // 链接 [text](url)\n  html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\" class=\"md-link\">$1</a>');\n\n  // 图片 ![alt](url)\n  html = html.replace(/!\\[([^\\]]*)\\]\\(([^)]+)\\)/g, '<img src=\"$2\" alt=\"$1\" class=\"md-img\" />');\n\n  // 将文本段落包装\n  const paragraphs = html.split(/\\n\\n+/);\n  html = paragraphs.map(p => {\n    p = p.trim();\n    if (!p) return '';\n    // 如果已经是以标签开头，不再包装\n    if (p.startsWith('<') && !p.startsWith('<br')) {\n      return p;\n    }\n    return `<p class=\"md-paragraph\">${p}</p>`;\n  }).join('\\n');\n\n  // 单换行转为br（在段落内部）\n  html = html.replace(/([^>])\\n/g, '$1<br>');\n  return html;\n};\nexport default {\n  name: 'Analyze',\n  setup() {\n    const store = useStore();\n    const route = useRoute();\n    const files = computed(() => store.state.files);\n    const currentPaper = ref(null);\n    const selectedTasks = ref(['summary', 'keypoints', 'gaps']);\n    const analyzing = ref(false);\n    const result = ref(null);\n    const activeTab = ref('summary');\n    const isHistoricalData = ref(false);\n    const analysisTime = ref('');\n    const loading = ref(false);\n\n    // Markdown渲染计算属性\n    const renderedSummary = computed(() => {\n      if (!result.value?.summary) return '';\n      return renderMarkdown(result.value.summary);\n    });\n    const categoryNames = {\n      innovations: '核心创新点',\n      methods: '主要方法',\n      experiments: '实验设计',\n      conclusions: '主要结论',\n      contributions: '学术贡献',\n      limitations: '局限性',\n      background: '研究背景',\n      assumptions: '关键假设',\n      implications: '应用与影响',\n      future_work: '未来工作'\n    };\n    const getGapTypeLabel = type => {\n      const labels = {\n        'methodological': '方法论',\n        'theoretical': '理论',\n        'data': '数据',\n        'application': '应用',\n        'evaluation': '评估'\n      };\n      return labels[type] || type;\n    };\n    const getGapTypeColor = type => {\n      const colors = {\n        'methodological': 'primary',\n        'theoretical': 'success',\n        'data': 'warning',\n        'application': 'info',\n        'evaluation': 'danger'\n      };\n      return colors[type] || '';\n    };\n    const keypointsDisplay = computed(() => {\n      if (!result.value?.keypoints) return {};\n      const filtered = {};\n      for (const [key, value] of Object.entries(result.value.keypoints)) {\n        if (value && value.length > 0) {\n          filtered[key] = value;\n        }\n      }\n      return filtered;\n    });\n\n    // 格式化年份显示\n    const formatYear = year => {\n      if (!year || year === 'unknown' || year === 0) return '未知';\n      // 确保年份是数字\n      const yearNum = parseInt(year);\n      if (isNaN(yearNum)) return '未知';\n      return yearNum;\n    };\n\n    // 刷新文件列表\n    const refreshFiles = async () => {\n      loading.value = true;\n      try {\n        await store.dispatch('fetchFiles');\n        ElMessage.success('论文列表已刷新');\n      } catch (error) {\n        console.error('刷新失败:', error);\n        ElMessage.error('刷新失败');\n      } finally {\n        loading.value = false;\n      }\n    };\n    const selectPaper = async paper => {\n      console.log('[DEBUG] selectPaper 被调用:', paper);\n\n      // 确保paper对象有id字段\n      if (!paper || !paper.id) {\n        ElMessage.error('论文数据无效');\n        return;\n      }\n\n      // 创建深拷贝避免引用问题\n      currentPaper.value = {\n        ...paper\n      };\n      result.value = null;\n      isHistoricalData.value = false;\n      analysisTime.value = '';\n      console.log('[DEBUG] currentPaper.value 已设置:', currentPaper.value);\n\n      // 确保数据完整性，如果缺少关键信息则从API重新获取\n      if (!paper.year || !paper.venue || !paper.authors) {\n        try {\n          const response = await api.getPaper(paper.id);\n          if (response.success && response.data) {\n            // 合并API返回的数据\n            currentPaper.value = {\n              ...currentPaper.value,\n              ...response.data\n            };\n            console.log('[DEBUG] 从API更新了论文信息:', currentPaper.value);\n          }\n        } catch (error) {\n          console.error('[ERROR] 获取论文详情失败:', error);\n        }\n      }\n\n      // 自动加载历史分析结果\n      try {\n        console.log('[DEBUG] 加载历史分析结果, paper_id:', paper.id);\n        const response = await api.getPaperAnalysis(paper.id);\n        console.log('[DEBUG] 历史分析响应:', response);\n        if (response.success && response.data) {\n          const analysisData = response.data;\n\n          // 格式化结果以便显示\n          result.value = {\n            summary: analysisData.summary_text,\n            keypoints: analysisData.keypoints || {},\n            gaps: analysisData.gaps || []\n          };\n\n          // 标记为历史数据\n          isHistoricalData.value = true;\n\n          // 显示分析时间\n          if (analysisData.created_at) {\n            const createdDate = new Date(analysisData.created_at);\n            analysisTime.value = createdDate.toLocaleString('zh-CN', {\n              year: 'numeric',\n              month: '2-digit',\n              day: '2-digit',\n              hour: '2-digit',\n              minute: '2-digit'\n            });\n          }\n          ElMessage.info('已加载历史分析结果');\n        }\n      } catch (error) {\n        console.error('[ERROR] 加载历史分析失败:', error);\n        // 不显示错误提示，因为可能只是没有历史记录\n      }\n      console.log('[DEBUG] selectPaper 完成, currentPaper.value.id =', currentPaper.value?.id);\n    };\n    const startAnalysis = async () => {\n      // 验证已选择论文 - 使用更健壮的方式获取论文ID\n      console.log('[DEBUG] startAnalysis 被调用');\n      console.log('[DEBUG] currentPaper.value:', currentPaper.value);\n\n      // 尝试从currentPaper获取ID（支持多种格式）\n      let paperId = null;\n      if (currentPaper.value) {\n        paperId = currentPaper.value.id || currentPaper.value.paper_id;\n      }\n      console.log('[DEBUG] 提取的paperId:', paperId);\n      if (!paperId) {\n        console.error('[ERROR] 没有选择论文或论文ID为空');\n        ElMessage.error('请先选择要分析的论文');\n        return;\n      }\n\n      // 确保currentPaper有正确的id字段\n      if (!currentPaper.value.id && paperId) {\n        currentPaper.value.id = paperId;\n      }\n      if (selectedTasks.value.length === 0) {\n        ElMessage.warning('请至少选择一项分析任务');\n        return;\n      }\n\n      // 开始新分析时，清除历史数据标志\n      isHistoricalData.value = false;\n      analysisTime.value = '';\n\n      // 连接WebSocket\n      connectSocket();\n      store.commit('SHOW_PROGRESS_DIALOG', true);\n      store.commit('SET_PROGRESS', {\n        progress: 0,\n        message: '开始分析...',\n        step: ''\n      });\n      analyzing.value = true;\n      try {\n        console.log('[DEBUG] 开始分析, paper_id:', currentPaper.value.id);\n        console.log('[DEBUG] 分析任务:', selectedTasks.value);\n        const response = await api.analyzePaperV4(paperId, selectedTasks.value, true // auto_generate_code\n        );\n        console.log('[DEBUG] 分析响应:', response);\n        if (response.success) {\n          // 提取分析结果\n          const analysisData = response.data;\n\n          // 格式化结果以便显示\n          result.value = {\n            summary: analysisData.summary_text,\n            keypoints: analysisData.keypoints || {},\n            gaps: analysisData.gaps || []\n          };\n\n          // 更新论文状态为已分析\n          store.commit('UPDATE_FILE_STATUS', {\n            paperId: paperId,\n            analyzed: true,\n            analysisData: {\n              summary: result.value.summary,\n              keypoints: result.value.keypoints\n            }\n          });\n          store.commit('SET_PROGRESS', {\n            progress: 100,\n            message: '分析完成!'\n          });\n          ElMessage.success('分析完成!');\n        } else {\n          ElMessage.error(response.error || '分析失败');\n        }\n      } catch (error) {\n        console.error('[ERROR] 分析失败:', error);\n\n        // 提供更友好的错误提示\n        let errorMsg = '分析失败';\n        const errorDetail = error.response?.data?.error || error.message;\n        if (errorDetail) {\n          if (errorDetail.includes('PDF') || errorDetail.includes('文件')) {\n            errorMsg = 'PDF文件读取失败，请检查文件是否存在';\n          } else if (errorDetail.includes('LLM') || errorDetail.includes('AI')) {\n            errorMsg = 'AI分析服务异常，请稍后重试';\n          } else if (errorDetail.includes('timeout') || errorDetail.includes('超时')) {\n            errorMsg = '分析超时，请稍后重试或减少分析任务';\n          } else if (errorDetail.includes('网络') || errorDetail.includes('network')) {\n            errorMsg = '网络连接异常，请检查网络连接';\n          } else {\n            errorMsg = `分析失败: ${errorDetail}`;\n          }\n        }\n        ElMessage.error({\n          message: errorMsg,\n          duration: 5000,\n          showClose: true\n        });\n      } finally {\n        analyzing.value = false;\n        store.commit('SHOW_PROGRESS_DIALOG', false);\n      }\n    };\n    const reanalyze = async () => {\n      // 确认是否要重新分析\n      try {\n        await ElMessageBox.confirm('重新分析将覆盖当前的分析结果，是否继续？', '确认操作', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n\n        // 清除历史数据标志\n        isHistoricalData.value = false;\n        analysisTime.value = '';\n\n        // 清空当前结果\n        result.value = null;\n\n        // 开始新的分析\n        await startAnalysis();\n      } catch {\n        // 用户取消操作\n        ElMessage.info('已取消重新分析');\n      }\n    };\n    const downloadResult = () => {\n      const filename = (currentPaper.value.title || 'paper').replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_');\n      if (activeTab.value === 'summary' && result.value?.summary) {\n        const blob = new Blob([result.value.summary], {\n          type: 'text/plain;charset=utf-8'\n        });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `${filename}_summary.txt`;\n        a.click();\n        URL.revokeObjectURL(url);\n      } else if (activeTab.value === 'keypoints' && result.value?.keypoints) {\n        const content = Object.entries(result.value.keypoints).map(([key, items]) => `${categoryNames[key] || key}:\\n${items.map(i => `  - ${i}`).join('\\n')}`).join('\\n\\n');\n        const blob = new Blob([content], {\n          type: 'text/plain;charset=utf-8'\n        });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `${filename}_keypoints.txt`;\n        a.click();\n        URL.revokeObjectURL(url);\n      }\n    };\n\n    // 研究空白编辑功能\n    const startEditGap = (gap, index) => {\n      // 保存原始数据\n      gap.originalData = {\n        ...gap\n      };\n      // 将字符串importance转换为数值用于el-rate\n      const importanceValue = gap.importance === 'high' ? 3 : gap.importance === 'medium' ? 2 : 1;\n      const difficultyValue = gap.difficulty === 'high' ? 3 : gap.difficulty === 'medium' ? 2 : 1;\n      // 创建编辑副本\n      gap.editData = {\n        gap_type: gap.gap_type || '',\n        description: gap.description || '',\n        importance: importanceValue,\n        difficulty: difficultyValue,\n        potential_approach: gap.potential_approach || '',\n        expected_impact: gap.expected_impact || ''\n      };\n      gap.editing = true;\n    };\n    const saveGap = async (gap, index) => {\n      try {\n        // 转换数值为字符串\n        const importanceStr = gap.editData.importance >= 3 ? 'high' : gap.editData.importance >= 2 ? 'medium' : 'low';\n        const difficultyStr = gap.editData.difficulty >= 3 ? 'high' : gap.editData.difficulty >= 2 ? 'medium' : 'low';\n\n        // 调用API保存到数据库\n        const response = await api.updateGap(gap.id, {\n          gap_type: gap.editData.gap_type,\n          description: gap.editData.description,\n          importance: importanceStr,\n          difficulty: difficultyStr,\n          potential_approach: gap.editData.potential_approach,\n          expected_impact: gap.editData.expected_impact\n        });\n        if (response.success) {\n          // 更新本地数据\n          Object.assign(gap, gap.editData);\n          gap.editing = false;\n          ElMessage.success('保存成功');\n        } else {\n          ElMessage.error(response.error || '保存失败');\n        }\n      } catch (error) {\n        console.error('保存失败:', error);\n        ElMessage.error('保存失败: ' + (error.message || '未知错误'));\n      }\n    };\n    const cancelEditGap = (gap, index) => {\n      // 恢复原始数据\n      Object.assign(gap, gap.originalData);\n      gap.editing = false;\n      delete gap.originalData;\n      delete gap.editData;\n    };\n    const generateCode = async (gap, index) => {\n      try {\n        gap.generating = true;\n        ElMessage.info('正在生成代码，请稍候...');\n\n        // 调用代码生成API\n        const response = await api.generateCode(gap.id, 'method_improvement');\n        if (response.success) {\n          gap.generated_code_id = response.data.id;\n          ElMessage.success('代码生成成功！');\n        } else {\n          ElMessage.error(response.error || '代码生成失败');\n        }\n      } catch (error) {\n        console.error('代码生成失败:', error);\n        ElMessage.error('代码生成失败: ' + (error.message || '未知错误'));\n      } finally {\n        gap.generating = false;\n      }\n    };\n    const viewCode = async gap => {\n      try {\n        if (!gap.code_id) {\n          ElMessage.warning('暂无生成的代码');\n          return;\n        }\n\n        // 获取代码详情\n        const response = await api.getCode(gap.code_id);\n        if (response.success && response.data) {\n          const code = response.data.code || '// 暂无代码内容';\n          const language = response.data.language || 'python';\n\n          // 打开代码查看对话框\n          ElMessageBox.alert(`<div style=\"max-height: 500px; overflow: auto;\">\n              <pre style=\"background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; font-size: 13px; line-height: 1.6; margin: 0;\"><code>${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>\n            </div>`, `查看代码 (${language})`, {\n            confirmButtonText: '关闭',\n            dangerouslyUseHTMLString: true,\n            customClass: 'code-view-dialog'\n          });\n        } else {\n          ElMessage.error('获取代码失败');\n        }\n      } catch (error) {\n        console.error('获取代码失败:', error);\n        ElMessage.error('获取代码失败: ' + (error.message || '未知错误'));\n      }\n    };\n    onMounted(async () => {\n      // 先等待文件列表加载完成\n      await store.dispatch('fetchFiles');\n\n      // 等待一下确保store已更新\n      await new Promise(resolve => setTimeout(resolve, 100));\n\n      // 检查URL参数中的paperId\n      const paperIdFromQuery = route.query.paperId;\n      if (paperIdFromQuery) {\n        console.log('[DEBUG] 从URL获取paperId:', paperIdFromQuery);\n        console.log('[DEBUG] 当前文件列表:', store.state.files.length);\n\n        // 从store中查找对应的论文\n        const paper = store.state.files.find(f => f.id === parseInt(paperIdFromQuery));\n        if (paper) {\n          console.log('[DEBUG] 找到论文，自动选中:', paper.title);\n          await selectPaper(paper);\n        } else {\n          console.error('[ERROR] 未找到论文ID:', paperIdFromQuery);\n          ElMessage.error(`未找到ID为 ${paperIdFromQuery} 的论文`);\n        }\n      }\n    });\n    return {\n      files,\n      currentPaper,\n      selectedTasks,\n      analyzing,\n      result,\n      activeTab,\n      isHistoricalData,\n      analysisTime,\n      categoryNames,\n      keypointsDisplay,\n      renderedSummary,\n      loading,\n      formatYear,\n      refreshFiles,\n      getGapTypeLabel,\n      getGapTypeColor,\n      selectPaper,\n      startAnalysis,\n      reanalyze,\n      downloadResult,\n      startEditGap,\n      saveGap,\n      cancelEditGap,\n      generateCode,\n      viewCode\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useStore","useRoute","api","connectSocket","ElMessage","ElMessageBox","renderMarkdown","text","escapeHtml","unsafe","replace","html","match","lang","code","trim","paragraphs","split","map","p","startsWith","join","name","setup","store","route","files","state","currentPaper","selectedTasks","analyzing","result","activeTab","isHistoricalData","analysisTime","loading","renderedSummary","value","summary","categoryNames","innovations","methods","experiments","conclusions","contributions","limitations","background","assumptions","implications","future_work","getGapTypeLabel","type","labels","getGapTypeColor","colors","keypointsDisplay","keypoints","filtered","key","Object","entries","length","formatYear","year","yearNum","parseInt","isNaN","refreshFiles","dispatch","success","error","console","selectPaper","paper","log","id","venue","authors","response","getPaper","data","getPaperAnalysis","analysisData","summary_text","gaps","created_at","createdDate","Date","toLocaleString","month","day","hour","minute","info","startAnalysis","paperId","paper_id","warning","commit","progress","message","step","analyzePaperV4","analyzed","errorMsg","errorDetail","includes","duration","showClose","reanalyze","confirm","confirmButtonText","cancelButtonText","downloadResult","filename","title","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","click","revokeObjectURL","content","items","i","startEditGap","gap","index","originalData","importanceValue","importance","difficultyValue","difficulty","editData","gap_type","description","potential_approach","expected_impact","editing","saveGap","importanceStr","difficultyStr","updateGap","assign","cancelEditGap","generateCode","generating","generated_code_id","viewCode","code_id","getCode","language","alert","dangerouslyUseHTMLString","customClass","Promise","resolve","setTimeout","paperIdFromQuery","query","find","f"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/views/Analyze.vue"],"sourcesContent":["<template>\n  <div class=\"analyze\">\n    <h2>单篇论文分析</h2>\n\n    <el-card class=\"select-card\" v-if=\"!currentPaper\">\n      <div class=\"select-header\">\n        <h3>选择要分析的论文</h3>\n        <el-button @click=\"refreshFiles\" icon=\"Refresh\" size=\"small\">刷新列表</el-button>\n      </div>\n      <el-table :data=\"files\" style=\"width: 100%; margin-top: 20px\" v-loading=\"loading\">\n        <el-table-column label=\"论文标题\" min-width=\"300\">\n          <template #default=\"scope\">\n            <div class=\"paper-title-cell\">\n              <span class=\"paper-title-text\">{{ scope.row.title || '未命名论文' }}</span>\n              <el-tag v-if=\"scope.row.analyzed\" size=\"small\" type=\"success\">已分析</el-tag>\n            </div>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"年份\" width=\"100\">\n          <template #default=\"scope\">\n            {{ formatYear(scope.row.year) }}\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"venue\" label=\"期刊/会议\" width=\"200\">\n          <template #default=\"scope\">\n            {{ scope.row.venue || '未知' }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"150\">\n          <template #default=\"scope\">\n            <el-button type=\"primary\" size=\"small\" @click=\"selectPaper(scope.row)\">\n              分析此论文\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <el-empty v-if=\"files.length === 0 && !loading\" description=\"暂无论文，请先上传\" />\n    </el-card>\n\n    <div v-else>\n      <el-card class=\"paper-card\">\n        <div class=\"paper-info\">\n          <el-button @click=\"currentPaper = null\" icon=\"ArrowLeft\" circle size=\"large\" class=\"back-button\" />\n          <i class=\"el-icon-document paper-icon\"></i>\n          <div class=\"paper-details\">\n            <h3>{{ currentPaper.title || '未命名论文' }}</h3>\n            <p>年份: {{ currentPaper.year || '未知' }} | 发表于: {{ currentPaper.venue || '未知' }}</p>\n          </div>\n        </div>\n      </el-card>\n\n      <el-card class=\"options-card\">\n        <h3>分析选项</h3>\n        <el-checkbox-group v-model=\"selectedTasks\">\n          <el-checkbox label=\"summary\">生成摘要</el-checkbox>\n          <el-checkbox label=\"keypoints\">提取要点</el-checkbox>\n          <el-checkbox label=\"gaps\">研究空白挖掘</el-checkbox>\n        </el-checkbox-group>\n\n        <div style=\"margin-top: 20px; display: flex; gap: 10px;\">\n          <el-button type=\"primary\" size=\"large\" @click=\"startAnalysis\" :loading=\"analyzing\">\n            <i class=\"el-icon-video-play\"></i> 开始分析\n          </el-button>\n          <el-button\n            v-if=\"result\"\n            type=\"warning\"\n            size=\"large\"\n            @click=\"reanalyze\"\n            :loading=\"analyzing\"\n          >\n            <i class=\"el-icon-refresh\"></i> 重新分析\n          </el-button>\n        </div>\n      </el-card>\n\n      <el-card class=\"result-card\" v-if=\"result\">\n        <div class=\"result-header\">\n          <h3>分析结果</h3>\n          <div class=\"result-meta\">\n            <el-tag v-if=\"isHistoricalData\" type=\"info\" size=\"small\">\n              <i class=\"el-icon-time\"></i> 历史数据\n            </el-tag>\n            <el-tag v-if=\"analysisTime\" type=\"success\" size=\"small\" style=\"margin-left: 8px\">\n              分析时间: {{ analysisTime }}\n            </el-tag>\n          </div>\n        </div>\n\n        <el-tabs v-model=\"activeTab\">\n          <el-tab-pane label=\"摘要\" name=\"summary\" v-if=\"result.summary\">\n            <div class=\"markdown-content summary-content\" v-html=\"renderedSummary\"></div>\n          </el-tab-pane>\n\n          <el-tab-pane label=\"要点\" name=\"keypoints\" v-if=\"result.keypoints\">\n            <div class=\"keypoints-content\">\n              <div v-for=\"(items, category) in keypointsDisplay\" :key=\"category\" class=\"keypoint-category\">\n                <h4>{{ categoryNames[category] || category }}</h4>\n                <ul>\n                  <li v-for=\"(item, index) in items\" :key=\"index\">{{ item }}</li>\n                </ul>\n              </div>\n            </div>\n          </el-tab-pane>\n\n          <el-tab-pane label=\"研究空白\" name=\"gaps\" v-if=\"result.gaps && result.gaps.length > 0\">\n            <div class=\"gaps-content\">\n              <div v-for=\"(gap, index) in result.gaps\" :key=\"index\" class=\"gap-item\">\n                <div class=\"gap-header\">\n                  <h4>研究空白 #{{ index + 1 }}</h4>\n                  <el-button\n                    v-if=\"!gap.editing\"\n                    type=\"primary\"\n                    size=\"small\"\n                    @click=\"startEditGap(gap, index)\"\n                    icon=\"Edit\"\n                  >\n                    编辑\n                  </el-button>\n                  <template v-else>\n                    <el-button type=\"success\" size=\"small\" @click=\"saveGap(gap, index)\" icon=\"Check\">\n                      保存\n                    </el-button>\n                    <el-button size=\"small\" @click=\"cancelEditGap(gap, index)\" icon=\"Close\">\n                      取消\n                    </el-button>\n                  </template>\n                </div>\n\n                <el-descriptions :column=\"1\" border v-if=\"!gap.editing\">\n                  <el-descriptions-item label=\"类型\">\n                    <el-tag :type=\"getGapTypeColor(gap.gap_type)\">{{ getGapTypeLabel(gap.gap_type) }}</el-tag>\n                  </el-descriptions-item>\n                  <el-descriptions-item label=\"描述\">{{ gap.description }}</el-descriptions-item>\n                  <el-descriptions-item label=\"重要性\">\n                    <el-tag :type=\"gap.importance === 'high' ? 'danger' : gap.importance === 'medium' ? 'warning' : 'info'\">\n                      {{ gap.importance === 'high' ? '高' : gap.importance === 'medium' ? '中' : '低' }}\n                    </el-tag>\n                  </el-descriptions-item>\n                  <el-descriptions-item label=\"难度\">\n                    <el-tag :type=\"gap.difficulty === 'high' ? 'danger' : gap.difficulty === 'medium' ? 'warning' : 'info'\">\n                      {{ gap.difficulty === 'high' ? '高' : gap.difficulty === 'medium' ? '中' : '低' }}\n                    </el-tag>\n                  </el-descriptions-item>\n                  <el-descriptions-item label=\"潜在解决方法\" v-if=\"gap.potential_approach\">\n                    <div class=\"gap-detail-text\">{{ gap.potential_approach }}</div>\n                  </el-descriptions-item>\n                  <el-descriptions-item label=\"预期影响\" v-if=\"gap.expected_impact\">\n                    <div class=\"gap-detail-text\">{{ gap.expected_impact }}</div>\n                  </el-descriptions-item>\n                  <el-descriptions-item label=\"代码状态\">\n                    <el-tag v-if=\"gap.generated_code_id\" type=\"success\">已生成</el-tag>\n                    <el-tag v-else type=\"info\">未生成</el-tag>\n                    <el-button\n                      v-if=\"!gap.generated_code_id\"\n                      type=\"primary\"\n                      size=\"small\"\n                      style=\"margin-left: 10px;\"\n                      @click=\"generateCode(gap, index)\"\n                      :loading=\"gap.generating\"\n                    >\n                      生成代码\n                    </el-button>\n                    <el-button\n                      v-else\n                      type=\"success\"\n                      size=\"small\"\n                      style=\"margin-left: 10px;\"\n                      @click=\"viewCode(gap)\"\n                    >\n                      查看代码\n                    </el-button>\n                  </el-descriptions-item>\n                </el-descriptions>\n\n                <el-form v-else label-width=\"120px\" class=\"gap-edit-form\">\n                  <el-form-item label=\"类型\">\n                    <el-select v-model=\"gap.editData.gap_type\" style=\"width: 100%;\">\n                      <el-option label=\"方法论\" value=\"methodological\" />\n                      <el-option label=\"理论\" value=\"theoretical\" />\n                      <el-option label=\"数据\" value=\"data\" />\n                      <el-option label=\"应用\" value=\"application\" />\n                      <el-option label=\"评估\" value=\"evaluation\" />\n                    </el-select>\n                  </el-form-item>\n                  <el-form-item label=\"描述\">\n                    <el-input type=\"textarea\" :rows=\"3\" v-model=\"gap.editData.description\" />\n                  </el-form-item>\n                  <el-form-item label=\"重要性\">\n                    <el-rate\n                      v-model=\"gap.editData.importance\"\n                      :max=\"3\"\n                      :colors=\"['#99A9BF', '#F7BA2A', '#FF9900']\"\n                      show-score\n                      :score-template=\"{1: '低', 2: '中', 3: '高'}[gap.editData.importance]\"\n                    />\n                  </el-form-item>\n                  <el-form-item label=\"难度\">\n                    <el-rate\n                      v-model=\"gap.editData.difficulty\"\n                      :max=\"3\"\n                      :colors=\"['#67C23A', '#E6A23C', '#F56C6C']\"\n                      show-score\n                      :score-template=\"{1: '低', 2: '中', 3: '高'}[gap.editData.difficulty]\"\n                    />\n                  </el-form-item>\n                  <el-form-item label=\"潜在解决方法\">\n                    <el-input type=\"textarea\" :rows=\"3\" v-model=\"gap.editData.potential_approach\" placeholder=\"请详细描述可能的解决方案...\" />\n                  </el-form-item>\n                  <el-form-item label=\"预期影响\">\n                    <el-input type=\"textarea\" :rows=\"3\" v-model=\"gap.editData.expected_impact\" placeholder=\"请描述实施该方案的预期学术和实际影响...\" />\n                  </el-form-item>\n                </el-form>\n              </div>\n            </div>\n          </el-tab-pane>\n        </el-tabs>\n\n        <div class=\"result-actions\">\n          <el-button @click=\"downloadResult\">\n            <i class=\"el-icon-download\"></i> 下载结果\n          </el-button>\n        </div>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRoute } from 'vue-router'\nimport api, { connectSocket } from '@/api'\nimport { ElMessage, ElMessageBox } from 'element-plus'\n\n// 改进的Markdown渲染器 - 更好的格式支持\nconst renderMarkdown = (text) => {\n  if (!text) return ''\n\n  // HTML转义，防止XSS\n  const escapeHtml = (unsafe) => {\n    return unsafe\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\")\n      .replace(/\"/g, \"&quot;\")\n      .replace(/'/g, \"&#039;\")\n  }\n\n  let html = escapeHtml(text)\n\n  // 代码块 (```language\\ncode\\n```)\n  html = html.replace(/```(\\w+)?\\n([\\s\\S]*?)```/g, (match, lang, code) => {\n    return `<div class=\"code-block\"><pre class=\"language-${lang || 'text'}\"><code>${code.trim()}</code></pre></div>`\n  })\n\n  // 行内代码 (`code`)\n  html = html.replace(/`([^`]+)`/g, '<code class=\"inline-code\">$1</code>')\n\n  // 标题 (# ## ### #### ##### ######)\n  html = html.replace(/^######\\s+(.+)$/gm, '<h6 class=\"md-h6\">$1</h6>')\n  html = html.replace(/^#####\\s+(.+)$/gm, '<h5 class=\"md-h5\">$1</h5>')\n  html = html.replace(/^####\\s+(.+)$/gm, '<h4 class=\"md-h4\">$1</h4>')\n  html = html.replace(/^###\\s+(.+)$/gm, '<h3 class=\"md-h3\">$1</h3>')\n  html = html.replace(/^##\\s+(.+)$/gm, '<h2 class=\"md-h2\">$1</h2>')\n  html = html.replace(/^#\\s+(.+)$/gm, '<h1 class=\"md-h1\">$1</h1>')\n\n  // 粗体和斜体\n  html = html.replace(/\\*\\*\\*(.+?)\\*\\*\\*/g, '<strong><em>$1</em></strong>')\n  html = html.replace(/\\*\\*(.+?)\\*\\*/g, '<strong class=\"md-bold\">$1</strong>')\n  html = html.replace(/\\*(.+?)\\*/g, '<em class=\"md-italic\">$1</em>')\n\n  // 删除线\n  html = html.replace(/~~(.+?)~~/g, '<del>$1</del>')\n\n  // 引用块\n  html = html.replace(/^&gt;\\s+(.+)$/gm, '<blockquote class=\"md-quote\">$1</blockquote>')\n  html = html.replace(/(<blockquote[^>]*>[\\s\\S]*?<\\/blockquote>)/g, '<div class=\"md-blockquote\">$1</div>')\n\n  // 分隔线\n  html = html.replace(/^---+$/gm, '<hr class=\"md-hr\" />')\n\n  // 无序列表 - 先处理列表项\n  html = html.replace(/^([*-])\\s+(.+)$/gm, '<li class=\"md-li\">$2</li>')\n  // 然后将连续的li包装成ul\n  html = html.replace(/(<li[^>]*>[\\s\\S]*?<\\/li>)(\\s*<li[^>]*>[\\s\\S]*?<\\/li>)*/g, (match) => {\n    return `<ul class=\"md-ul\">${match}</ul>`\n  })\n\n  // 有序列表\n  html = html.replace(/^\\d+\\.\\s+(.+)$/gm, '<li class=\"md-ol-li\">$1</li>')\n  html = html.replace(/(<li class=\"md-ol-li\">[\\s\\S]*?<\\/li>)(\\s*<li class=\"md-ol-li\">[\\s\\S]*?<\\/li>)*/g, (match) => {\n    return `<ol class=\"md-ol\">${match.replace(/md-ol-li/g, 'md-li')}</ol>`\n  })\n\n  // 链接 [text](url)\n  html = html.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\" class=\"md-link\">$1</a>')\n\n  // 图片 ![alt](url)\n  html = html.replace(/!\\[([^\\]]*)\\]\\(([^)]+)\\)/g, '<img src=\"$2\" alt=\"$1\" class=\"md-img\" />')\n\n  // 将文本段落包装\n  const paragraphs = html.split(/\\n\\n+/)\n  html = paragraphs.map(p => {\n    p = p.trim()\n    if (!p) return ''\n    // 如果已经是以标签开头，不再包装\n    if (p.startsWith('<') && !p.startsWith('<br')) {\n      return p\n    }\n    return `<p class=\"md-paragraph\">${p}</p>`\n  }).join('\\n')\n\n  // 单换行转为br（在段落内部）\n  html = html.replace(/([^>])\\n/g, '$1<br>')\n\n  return html\n}\n\nexport default {\n  name: 'Analyze',\n  setup() {\n    const store = useStore()\n    const route = useRoute()\n\n    const files = computed(() => store.state.files)\n    const currentPaper = ref(null)\n    const selectedTasks = ref(['summary', 'keypoints', 'gaps'])\n    const analyzing = ref(false)\n    const result = ref(null)\n    const activeTab = ref('summary')\n    const isHistoricalData = ref(false)\n    const analysisTime = ref('')\n    const loading = ref(false)\n\n    // Markdown渲染计算属性\n    const renderedSummary = computed(() => {\n      if (!result.value?.summary) return ''\n      return renderMarkdown(result.value.summary)\n    })\n\n    const categoryNames = {\n      innovations: '核心创新点',\n      methods: '主要方法',\n      experiments: '实验设计',\n      conclusions: '主要结论',\n      contributions: '学术贡献',\n      limitations: '局限性',\n      background: '研究背景',\n      assumptions: '关键假设',\n      implications: '应用与影响',\n      future_work: '未来工作'\n    }\n\n    const getGapTypeLabel = (type) => {\n      const labels = {\n        'methodological': '方法论',\n        'theoretical': '理论',\n        'data': '数据',\n        'application': '应用',\n        'evaluation': '评估'\n      }\n      return labels[type] || type\n    }\n\n    const getGapTypeColor = (type) => {\n      const colors = {\n        'methodological': 'primary',\n        'theoretical': 'success',\n        'data': 'warning',\n        'application': 'info',\n        'evaluation': 'danger'\n      }\n      return colors[type] || ''\n    }\n\n    const keypointsDisplay = computed(() => {\n      if (!result.value?.keypoints) return {}\n      const filtered = {}\n      for (const [key, value] of Object.entries(result.value.keypoints)) {\n        if (value && value.length > 0) {\n          filtered[key] = value\n        }\n      }\n      return filtered\n    })\n\n    // 格式化年份显示\n    const formatYear = (year) => {\n      if (!year || year === 'unknown' || year === 0) return '未知'\n      // 确保年份是数字\n      const yearNum = parseInt(year)\n      if (isNaN(yearNum)) return '未知'\n      return yearNum\n    }\n\n    // 刷新文件列表\n    const refreshFiles = async () => {\n      loading.value = true\n      try {\n        await store.dispatch('fetchFiles')\n        ElMessage.success('论文列表已刷新')\n      } catch (error) {\n        console.error('刷新失败:', error)\n        ElMessage.error('刷新失败')\n      } finally {\n        loading.value = false\n      }\n    }\n\n    const selectPaper = async (paper) => {\n      console.log('[DEBUG] selectPaper 被调用:', paper)\n\n      // 确保paper对象有id字段\n      if (!paper || !paper.id) {\n        ElMessage.error('论文数据无效')\n        return\n      }\n\n      // 创建深拷贝避免引用问题\n      currentPaper.value = { ...paper }\n      result.value = null\n      isHistoricalData.value = false\n      analysisTime.value = ''\n\n      console.log('[DEBUG] currentPaper.value 已设置:', currentPaper.value)\n\n      // 确保数据完整性，如果缺少关键信息则从API重新获取\n      if (!paper.year || !paper.venue || !paper.authors) {\n        try {\n          const response = await api.getPaper(paper.id)\n          if (response.success && response.data) {\n            // 合并API返回的数据\n            currentPaper.value = { ...currentPaper.value, ...response.data }\n            console.log('[DEBUG] 从API更新了论文信息:', currentPaper.value)\n          }\n        } catch (error) {\n          console.error('[ERROR] 获取论文详情失败:', error)\n        }\n      }\n\n      // 自动加载历史分析结果\n      try {\n        console.log('[DEBUG] 加载历史分析结果, paper_id:', paper.id)\n        const response = await api.getPaperAnalysis(paper.id)\n\n        console.log('[DEBUG] 历史分析响应:', response)\n\n        if (response.success && response.data) {\n          const analysisData = response.data\n\n          // 格式化结果以便显示\n          result.value = {\n            summary: analysisData.summary_text,\n            keypoints: analysisData.keypoints || {},\n            gaps: analysisData.gaps || []\n          }\n\n          // 标记为历史数据\n          isHistoricalData.value = true\n\n          // 显示分析时间\n          if (analysisData.created_at) {\n            const createdDate = new Date(analysisData.created_at)\n            analysisTime.value = createdDate.toLocaleString('zh-CN', {\n              year: 'numeric',\n              month: '2-digit',\n              day: '2-digit',\n              hour: '2-digit',\n              minute: '2-digit'\n            })\n          }\n\n          ElMessage.info('已加载历史分析结果')\n        }\n      } catch (error) {\n        console.error('[ERROR] 加载历史分析失败:', error)\n        // 不显示错误提示，因为可能只是没有历史记录\n      }\n\n      console.log('[DEBUG] selectPaper 完成, currentPaper.value.id =', currentPaper.value?.id)\n    }\n\n    const startAnalysis = async () => {\n      // 验证已选择论文 - 使用更健壮的方式获取论文ID\n      console.log('[DEBUG] startAnalysis 被调用')\n      console.log('[DEBUG] currentPaper.value:', currentPaper.value)\n\n      // 尝试从currentPaper获取ID（支持多种格式）\n      let paperId = null\n      if (currentPaper.value) {\n        paperId = currentPaper.value.id || currentPaper.value.paper_id\n      }\n\n      console.log('[DEBUG] 提取的paperId:', paperId)\n\n      if (!paperId) {\n        console.error('[ERROR] 没有选择论文或论文ID为空')\n        ElMessage.error('请先选择要分析的论文')\n        return\n      }\n\n      // 确保currentPaper有正确的id字段\n      if (!currentPaper.value.id && paperId) {\n        currentPaper.value.id = paperId\n      }\n\n      if (selectedTasks.value.length === 0) {\n        ElMessage.warning('请至少选择一项分析任务')\n        return\n      }\n\n      // 开始新分析时，清除历史数据标志\n      isHistoricalData.value = false\n      analysisTime.value = ''\n\n      // 连接WebSocket\n      connectSocket()\n      store.commit('SHOW_PROGRESS_DIALOG', true)\n      store.commit('SET_PROGRESS', { progress: 0, message: '开始分析...', step: '' })\n\n      analyzing.value = true\n\n      try {\n        console.log('[DEBUG] 开始分析, paper_id:', currentPaper.value.id)\n        console.log('[DEBUG] 分析任务:', selectedTasks.value)\n\n        const response = await api.analyzePaperV4(\n          paperId,\n          selectedTasks.value,\n          true  // auto_generate_code\n        )\n\n        console.log('[DEBUG] 分析响应:', response)\n\n        if (response.success) {\n          // 提取分析结果\n          const analysisData = response.data\n\n          // 格式化结果以便显示\n          result.value = {\n            summary: analysisData.summary_text,\n            keypoints: analysisData.keypoints || {},\n            gaps: analysisData.gaps || []\n          }\n\n          // 更新论文状态为已分析\n          store.commit('UPDATE_FILE_STATUS', {\n            paperId: paperId,\n            analyzed: true,\n            analysisData: {\n              summary: result.value.summary,\n              keypoints: result.value.keypoints\n            }\n          })\n\n          store.commit('SET_PROGRESS', { progress: 100, message: '分析完成!' })\n          ElMessage.success('分析完成!')\n        } else {\n          ElMessage.error(response.error || '分析失败')\n        }\n      } catch (error) {\n        console.error('[ERROR] 分析失败:', error)\n\n        // 提供更友好的错误提示\n        let errorMsg = '分析失败'\n        const errorDetail = error.response?.data?.error || error.message\n\n        if (errorDetail) {\n          if (errorDetail.includes('PDF') || errorDetail.includes('文件')) {\n            errorMsg = 'PDF文件读取失败，请检查文件是否存在'\n          } else if (errorDetail.includes('LLM') || errorDetail.includes('AI')) {\n            errorMsg = 'AI分析服务异常，请稍后重试'\n          } else if (errorDetail.includes('timeout') || errorDetail.includes('超时')) {\n            errorMsg = '分析超时，请稍后重试或减少分析任务'\n          } else if (errorDetail.includes('网络') || errorDetail.includes('network')) {\n            errorMsg = '网络连接异常，请检查网络连接'\n          } else {\n            errorMsg = `分析失败: ${errorDetail}`\n          }\n        }\n\n        ElMessage.error({\n          message: errorMsg,\n          duration: 5000,\n          showClose: true\n        })\n      } finally {\n        analyzing.value = false\n        store.commit('SHOW_PROGRESS_DIALOG', false)\n      }\n    }\n\n    const reanalyze = async () => {\n      // 确认是否要重新分析\n      try {\n        await ElMessageBox.confirm(\n          '重新分析将覆盖当前的分析结果，是否继续？',\n          '确认操作',\n          {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }\n        )\n\n        // 清除历史数据标志\n        isHistoricalData.value = false\n        analysisTime.value = ''\n\n        // 清空当前结果\n        result.value = null\n\n        // 开始新的分析\n        await startAnalysis()\n      } catch {\n        // 用户取消操作\n        ElMessage.info('已取消重新分析')\n      }\n    }\n\n    const downloadResult = () => {\n      const filename = (currentPaper.value.title || 'paper').replace(/[^a-zA-Z0-9\\u4e00-\\u9fa5]/g, '_')\n      if (activeTab.value === 'summary' && result.value?.summary) {\n        const blob = new Blob([result.value.summary], { type: 'text/plain;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${filename}_summary.txt`\n        a.click()\n        URL.revokeObjectURL(url)\n      } else if (activeTab.value === 'keypoints' && result.value?.keypoints) {\n        const content = Object.entries(result.value.keypoints)\n          .map(([key, items]) => `${categoryNames[key] || key}:\\n${items.map(i => `  - ${i}`).join('\\n')}`)\n          .join('\\n\\n')\n        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${filename}_keypoints.txt`\n        a.click()\n        URL.revokeObjectURL(url)\n      }\n    }\n\n    // 研究空白编辑功能\n    const startEditGap = (gap, index) => {\n      // 保存原始数据\n      gap.originalData = { ...gap }\n      // 将字符串importance转换为数值用于el-rate\n      const importanceValue = gap.importance === 'high' ? 3 : gap.importance === 'medium' ? 2 : 1\n      const difficultyValue = gap.difficulty === 'high' ? 3 : gap.difficulty === 'medium' ? 2 : 1\n      // 创建编辑副本\n      gap.editData = {\n        gap_type: gap.gap_type || '',\n        description: gap.description || '',\n        importance: importanceValue,\n        difficulty: difficultyValue,\n        potential_approach: gap.potential_approach || '',\n        expected_impact: gap.expected_impact || ''\n      }\n      gap.editing = true\n    }\n\n    const saveGap = async (gap, index) => {\n      try {\n        // 转换数值为字符串\n        const importanceStr = gap.editData.importance >= 3 ? 'high' : gap.editData.importance >= 2 ? 'medium' : 'low'\n        const difficultyStr = gap.editData.difficulty >= 3 ? 'high' : gap.editData.difficulty >= 2 ? 'medium' : 'low'\n\n        // 调用API保存到数据库\n        const response = await api.updateGap(gap.id, {\n          gap_type: gap.editData.gap_type,\n          description: gap.editData.description,\n          importance: importanceStr,\n          difficulty: difficultyStr,\n          potential_approach: gap.editData.potential_approach,\n          expected_impact: gap.editData.expected_impact\n        })\n\n        if (response.success) {\n          // 更新本地数据\n          Object.assign(gap, gap.editData)\n          gap.editing = false\n          ElMessage.success('保存成功')\n        } else {\n          ElMessage.error(response.error || '保存失败')\n        }\n      } catch (error) {\n        console.error('保存失败:', error)\n        ElMessage.error('保存失败: ' + (error.message || '未知错误'))\n      }\n    }\n\n    const cancelEditGap = (gap, index) => {\n      // 恢复原始数据\n      Object.assign(gap, gap.originalData)\n      gap.editing = false\n      delete gap.originalData\n      delete gap.editData\n    }\n\n    const generateCode = async (gap, index) => {\n      try {\n        gap.generating = true\n        ElMessage.info('正在生成代码，请稍候...')\n\n        // 调用代码生成API\n        const response = await api.generateCode(gap.id, 'method_improvement')\n\n        if (response.success) {\n          gap.generated_code_id = response.data.id\n          ElMessage.success('代码生成成功！')\n        } else {\n          ElMessage.error(response.error || '代码生成失败')\n        }\n      } catch (error) {\n        console.error('代码生成失败:', error)\n        ElMessage.error('代码生成失败: ' + (error.message || '未知错误'))\n      } finally {\n        gap.generating = false\n      }\n    }\n\n    const viewCode = async (gap) => {\n      try {\n        if (!gap.code_id) {\n          ElMessage.warning('暂无生成的代码')\n          return\n        }\n\n        // 获取代码详情\n        const response = await api.getCode(gap.code_id)\n        if (response.success && response.data) {\n          const code = response.data.code || '// 暂无代码内容'\n          const language = response.data.language || 'python'\n\n          // 打开代码查看对话框\n          ElMessageBox.alert(\n            `<div style=\"max-height: 500px; overflow: auto;\">\n              <pre style=\"background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; font-size: 13px; line-height: 1.6; margin: 0;\"><code>${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>\n            </div>`,\n            `查看代码 (${language})`,\n            {\n              confirmButtonText: '关闭',\n              dangerouslyUseHTMLString: true,\n              customClass: 'code-view-dialog'\n            }\n          )\n        } else {\n          ElMessage.error('获取代码失败')\n        }\n      } catch (error) {\n        console.error('获取代码失败:', error)\n        ElMessage.error('获取代码失败: ' + (error.message || '未知错误'))\n      }\n    }\n\n    onMounted(async () => {\n      // 先等待文件列表加载完成\n      await store.dispatch('fetchFiles')\n\n      // 等待一下确保store已更新\n      await new Promise(resolve => setTimeout(resolve, 100))\n\n      // 检查URL参数中的paperId\n      const paperIdFromQuery = route.query.paperId\n      if (paperIdFromQuery) {\n        console.log('[DEBUG] 从URL获取paperId:', paperIdFromQuery)\n        console.log('[DEBUG] 当前文件列表:', store.state.files.length)\n\n        // 从store中查找对应的论文\n        const paper = store.state.files.find(f => f.id === parseInt(paperIdFromQuery))\n        if (paper) {\n          console.log('[DEBUG] 找到论文，自动选中:', paper.title)\n          await selectPaper(paper)\n        } else {\n          console.error('[ERROR] 未找到论文ID:', paperIdFromQuery)\n          ElMessage.error(`未找到ID为 ${paperIdFromQuery} 的论文`)\n        }\n      }\n    })\n\n    return {\n      files,\n      currentPaper,\n      selectedTasks,\n      analyzing,\n      result,\n      activeTab,\n      isHistoricalData,\n      analysisTime,\n      categoryNames,\n      keypointsDisplay,\n      renderedSummary,\n      loading,\n      formatYear,\n      refreshFiles,\n      getGapTypeLabel,\n      getGapTypeColor,\n      selectPaper,\n      startAnalysis,\n      reanalyze,\n      downloadResult,\n      startEditGap,\n      saveGap,\n      cancelEditGap,\n      generateCode,\n      viewCode\n    }\n  }\n}\n</script>\n\n<style scoped>\n.analyze {\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\nh2 {\n  margin-bottom: 20px;\n  color: #303133;\n}\n\n.select-card,\n.paper-card,\n.options-card,\n.result-card {\n  margin-bottom: 20px;\n}\n\n.paper-info {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n}\n\n.back-button {\n  flex-shrink: 0;\n}\n\n.paper-icon {\n  font-size: 48px;\n  color: #409eff;\n}\n\n.paper-details {\n  flex: 1;\n}\n\n.paper-details h3 {\n  margin: 0 0 8px 0;\n  color: #303133;\n}\n\n.paper-details p {\n  margin: 0;\n  color: #606266;\n  font-size: 14px;\n}\n\n.markdown-content {\n  line-height: 1.8;\n  color: #303133;\n  padding: 15px;\n  background: #f5f7fa;\n  border-radius: 4px;\n}\n\n.markdown-content h1,\n.markdown-content h2,\n.markdown-content h3 {\n  margin-top: 20px;\n  margin-bottom: 10px;\n  color: #2c3e50;\n}\n\n.markdown-content h1:first-child {\n  margin-top: 0;\n}\n\n.markdown-content p {\n  margin-bottom: 15px;\n}\n\n.markdown-content ul,\n.markdown-content ol {\n  margin-bottom: 15px;\n  padding-left: 30px;\n}\n\n.markdown-content li {\n  margin-bottom: 5px;\n}\n\n.markdown-content code {\n  background: #e8e8e8;\n  padding: 2px 6px;\n  border-radius: 3px;\n  font-family: 'Courier New', monospace;\n}\n\n.markdown-content pre {\n  background: #2d2d2d;\n  color: #ccc;\n  padding: 15px;\n  border-radius: 5px;\n  overflow-x: auto;\n  margin-bottom: 15px;\n}\n\n.markdown-content pre code {\n  background: transparent;\n  padding: 0;\n  color: #ccc;\n}\n\n.summary-content {\n  white-space: pre-wrap;\n  line-height: 1.9;\n  font-size: 15px;\n}\n\n.summary-content h1,\n.summary-content h2,\n.summary-content h3,\n.summary-content h4,\n.summary-content h5,\n.summary-content h6 {\n  margin-top: 24px;\n  margin-bottom: 16px;\n  font-weight: 600;\n  line-height: 1.4;\n  color: #2c3e50;\n}\n\n.summary-content h1 { font-size: 28px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }\n.summary-content h2 { font-size: 24px; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px; }\n.summary-content h3 { font-size: 20px; }\n.summary-content h4 { font-size: 18px; }\n.summary-content h5 { font-size: 16px; }\n.summary-content h6 { font-size: 14px; }\n\n.summary-content p {\n  margin-bottom: 16px;\n  text-align: justify;\n  text-indent: 2em;\n}\n\n.summary-content ul,\n.summary-content ol {\n  margin-bottom: 20px;\n  padding-left: 30px;\n}\n\n.summary-content li {\n  margin-bottom: 10px;\n  line-height: 1.8;\n}\n\n.summary-content ul li {\n  list-style-type: disc;\n}\n\n.summary-content ol li {\n  list-style-type: decimal;\n}\n\n.summary-content code {\n  background: #f5f5f5;\n  border: 1px solid #e0e0e0;\n  padding: 3px 8px;\n  border-radius: 4px;\n  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;\n  font-size: 14px;\n  color: #e74c3c;\n}\n\n.summary-content pre {\n  background: #2d2d2d;\n  color: #f8f8f2;\n  padding: 20px;\n  border-radius: 8px;\n  overflow-x: auto;\n  margin-bottom: 20px;\n  border: 1px solid #404040;\n}\n\n.summary-content pre code {\n  background: transparent;\n  border: none;\n  padding: 0;\n  color: #f8f8f2;\n  font-size: 13px;\n  line-height: 1.6;\n}\n\n.summary-content blockquote {\n  margin: 20px 0;\n  padding: 12px 20px;\n  border-left: 4px solid #409eff;\n  background: #ecf5ff;\n  color: #606266;\n  font-style: italic;\n}\n\n.summary-content table {\n  width: 100%;\n  border-collapse: collapse;\n  margin-bottom: 20px;\n}\n\n.summary-content table th,\n.summary-content table td {\n  border: 1px solid #d0d7de;\n  padding: 10px 12px;\n  text-align: left;\n}\n\n.summary-content table th {\n  background: #f6f8fa;\n  font-weight: 600;\n}\n\n.summary-content strong {\n  font-weight: 600;\n  color: #2c3e50;\n}\n\n.summary-content em {\n  font-style: italic;\n  color: #555;\n}\n\n.summary-content a {\n  color: #409eff;\n  text-decoration: none;\n  border-bottom: 1px solid #409eff;\n}\n\n.summary-content a:hover {\n  color: #66b1ff;\n  border-bottom-color: #66b1ff;\n}\n\n.keypoints-content {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n  gap: 20px;\n}\n\n.keypoint-category {\n  padding: 15px;\n  background: #f5f7fa;\n  border-radius: 4px;\n}\n\n.keypoint-category h4 {\n  color: #409eff;\n  margin-bottom: 10px;\n}\n\n.keypoint-category ul {\n  list-style: none;\n  padding: 0;\n}\n\n.keypoint-category li {\n  padding: 8px 0;\n  padding-left: 20px;\n  position: relative;\n}\n\n.keypoint-category li:before {\n  content: '•';\n  position: absolute;\n  left: 0;\n  color: #409eff;\n  font-weight: bold;\n}\n\n.gaps-content {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.gap-item {\n  padding: 20px;\n  background: #f5f7fa;\n  border-radius: 4px;\n  border-left: 4px solid #409eff;\n}\n\n.gap-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.gap-header h4 {\n  color: #409eff;\n  margin: 0;\n}\n\n.gap-item p {\n  margin: 8px 0;\n  line-height: 1.6;\n}\n\n.gap-edit-form {\n  background: white;\n  padding: 20px;\n  border-radius: 4px;\n  margin-top: 15px;\n}\n\n.gap-detail-text {\n  white-space: pre-wrap;\n  line-height: 1.8;\n  color: #606266;\n  background: #f5f7fa;\n  padding: 12px;\n  border-radius: 4px;\n}\n\n.code-view-dialog {\n  max-width: 800px;\n}\n\n.result-actions {\n  margin-top: 20px;\n  text-align: right;\n}\n\n.result-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.result-header h3 {\n  margin: 0;\n  color: #303133;\n}\n\n.result-meta {\n  display: flex;\n  align-items: center;\n}\n\n/* 选择论文表格样式 */\n.select-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.select-header h3 {\n  margin: 0;\n}\n\n.paper-title-cell {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.paper-title-text {\n  flex: 1;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* 返回按钮样式增强 */\n.back-button {\n  margin-right: 10px;\n  transition: all 0.3s;\n}\n\n.back-button:hover {\n  transform: scale(1.1);\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}