{"ast":null,"code":"import { ref, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport api, { connectSocket } from '@/api';\nimport { ElMessage } from 'element-plus';\nexport default {\n  name: 'Analyze',\n  setup() {\n    const store = useStore();\n    const files = computed(() => store.state.files);\n    const currentFile = ref(null);\n    const selectedTasks = ref(['summary', 'keypoints', 'topic']);\n    const analyzing = ref(false);\n    const result = ref(null);\n    const activeTab = ref('summary');\n    const categoryNames = {\n      innovations: '核心创新点',\n      methods: '主要方法',\n      experiments: '实验设计',\n      conclusions: '主要结论',\n      contributions: '学术贡献',\n      limitations: '局限性'\n    };\n    const keypointsDisplay = computed(() => {\n      if (!result.value?.keypoints) return {};\n      const filtered = {};\n      for (const [key, value] of Object.entries(result.value.keypoints)) {\n        if (value && value.length > 0) {\n          filtered[key] = value;\n        }\n      }\n      return filtered;\n    });\n    const formatSize = (row, column, size) => {\n      return (size / 1024 / 1024).toFixed(2) + ' MB';\n    };\n    const selectFile = file => {\n      currentFile.value = file;\n      result.value = null;\n    };\n    const startAnalysis = async () => {\n      if (selectedTasks.value.length === 0) {\n        ElMessage.warning('请至少选择一项分析任务');\n        return;\n      }\n\n      // 连接WebSocket\n      connectSocket();\n      store.commit('SHOW_PROGRESS_DIALOG', true);\n      store.commit('SET_PROGRESS', {\n        progress: 0,\n        message: '开始分析...',\n        step: ''\n      });\n      analyzing.value = true;\n      try {\n        const response = await api.analyzePaper(`/uploads/${currentFile.value.filename}`, selectedTasks.value);\n        if (response.success) {\n          result.value = response.data;\n          store.commit('SET_PROGRESS', {\n            progress: 100,\n            message: '分析完成!'\n          });\n          ElMessage.success('分析完成!');\n        } else {\n          ElMessage.error(response.error || '分析失败');\n        }\n      } catch (error) {\n        ElMessage.error('分析失败: ' + error.message);\n      } finally {\n        analyzing.value = false;\n      }\n    };\n    const downloadResult = () => {\n      const filename = currentFile.value.filename.replace('.pdf', '');\n      if (activeTab.value === 'summary') {\n        api.downloadResult('summary', `${filename}_summary.txt`);\n      } else if (activeTab.value === 'keypoints') {\n        api.downloadResult('keypoints', `${filename}_keypoints.txt`);\n      }\n    };\n    onMounted(() => {\n      store.dispatch('fetchFiles');\n    });\n    return {\n      files,\n      currentFile,\n      selectedTasks,\n      analyzing,\n      result,\n      activeTab,\n      categoryNames,\n      keypointsDisplay,\n      formatSize,\n      selectFile,\n      startAnalysis,\n      downloadResult\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useStore","api","connectSocket","ElMessage","name","setup","store","files","state","currentFile","selectedTasks","analyzing","result","activeTab","categoryNames","innovations","methods","experiments","conclusions","contributions","limitations","keypointsDisplay","value","keypoints","filtered","key","Object","entries","length","formatSize","row","column","size","toFixed","selectFile","file","startAnalysis","warning","commit","progress","message","step","response","analyzePaper","filename","success","data","error","downloadResult","replace","dispatch"],"sources":["/Users/liucunyu/Documents/all_code/nuc_Graduation_project/frontend/src/views/Analyze.vue"],"sourcesContent":["<template>\n  <div class=\"analyze\">\n    <h2>单篇论文分析</h2>\n\n    <el-card class=\"select-card\" v-if=\"!currentFile\">\n      <h3>选择要分析的论文</h3>\n      <el-table :data=\"files\" style=\"width: 100%; margin-top: 20px\">\n        <el-table-column prop=\"filename\" label=\"文件名\" />\n        <el-table-column prop=\"size\" label=\"大小\" :formatter=\"formatSize\" />\n        <el-table-column label=\"操作\" width=\"200\">\n          <template #default=\"scope\">\n            <el-button type=\"primary\" size=\"small\" @click=\"selectFile(scope.row)\">\n              分析此文件\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n\n    <div v-else>\n      <el-card class=\"file-card\">\n        <div class=\"file-info\">\n          <i class=\"el-icon-document file-icon\"></i>\n          <div>\n            <h3>{{ currentFile.filename }}</h3>\n            <p>文件大小: {{ formatSize(null, null, currentFile.size) }}</p>\n          </div>\n          <el-button @click=\"currentFile = null\">选择其他文件</el-button>\n        </div>\n      </el-card>\n\n      <el-card class=\"options-card\">\n        <h3>分析选项</h3>\n        <el-checkbox-group v-model=\"selectedTasks\">\n          <el-checkbox label=\"summary\">生成摘要</el-checkbox>\n          <el-checkbox label=\"keypoints\">提取要点</el-checkbox>\n          <el-checkbox label=\"topic\">主题分析</el-checkbox>\n        </el-checkbox-group>\n\n        <div style=\"margin-top: 20px\">\n          <el-button type=\"primary\" size=\"large\" @click=\"startAnalysis\" :loading=\"analyzing\">\n            <i class=\"el-icon-video-play\"></i> 开始分析\n          </el-button>\n        </div>\n      </el-card>\n\n      <el-card class=\"result-card\" v-if=\"result\">\n        <h3>分析结果</h3>\n\n        <el-tabs v-model=\"activeTab\">\n          <el-tab-pane label=\"摘要\" name=\"summary\" v-if=\"result.summary\">\n            <div class=\"summary-content\">{{ result.summary }}</div>\n          </el-tab-pane>\n\n          <el-tab-pane label=\"要点\" name=\"keypoints\" v-if=\"result.keypoints\">\n            <div class=\"keypoints-content\">\n              <div v-for=\"(items, category) in keypointsDisplay\" :key=\"category\" class=\"keypoint-category\">\n                <h4>{{ categoryNames[category] }}</h4>\n                <ul>\n                  <li v-for=\"(item, index) in items\" :key=\"index\">{{ item }}</li>\n                </ul>\n              </div>\n            </div>\n          </el-tab-pane>\n\n          <el-tab-pane label=\"主题分析\" name=\"topic\" v-if=\"result.topicAnalysis\">\n            <div class=\"topic-content\">{{ result.topicAnalysis.analysis }}</div>\n          </el-tab-pane>\n        </el-tabs>\n\n        <div class=\"result-actions\">\n          <el-button @click=\"downloadResult\">\n            <i class=\"el-icon-download\"></i> 下载结果\n          </el-button>\n        </div>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted } from 'vue'\nimport { useStore } from 'vuex'\nimport api, { connectSocket } from '@/api'\nimport { ElMessage } from 'element-plus'\n\nexport default {\n  name: 'Analyze',\n  setup() {\n    const store = useStore()\n\n    const files = computed(() => store.state.files)\n    const currentFile = ref(null)\n    const selectedTasks = ref(['summary', 'keypoints', 'topic'])\n    const analyzing = ref(false)\n    const result = ref(null)\n    const activeTab = ref('summary')\n\n    const categoryNames = {\n      innovations: '核心创新点',\n      methods: '主要方法',\n      experiments: '实验设计',\n      conclusions: '主要结论',\n      contributions: '学术贡献',\n      limitations: '局限性'\n    }\n\n    const keypointsDisplay = computed(() => {\n      if (!result.value?.keypoints) return {}\n      const filtered = {}\n      for (const [key, value] of Object.entries(result.value.keypoints)) {\n        if (value && value.length > 0) {\n          filtered[key] = value\n        }\n      }\n      return filtered\n    })\n\n    const formatSize = (row, column, size) => {\n      return (size / 1024 / 1024).toFixed(2) + ' MB'\n    }\n\n    const selectFile = (file) => {\n      currentFile.value = file\n      result.value = null\n    }\n\n    const startAnalysis = async () => {\n      if (selectedTasks.value.length === 0) {\n        ElMessage.warning('请至少选择一项分析任务')\n        return\n      }\n\n      // 连接WebSocket\n      connectSocket()\n      store.commit('SHOW_PROGRESS_DIALOG', true)\n      store.commit('SET_PROGRESS', { progress: 0, message: '开始分析...', step: '' })\n\n      analyzing.value = true\n\n      try {\n        const response = await api.analyzePaper(\n          `/uploads/${currentFile.value.filename}`,\n          selectedTasks.value\n        )\n\n        if (response.success) {\n          result.value = response.data\n          store.commit('SET_PROGRESS', { progress: 100, message: '分析完成!' })\n          ElMessage.success('分析完成!')\n        } else {\n          ElMessage.error(response.error || '分析失败')\n        }\n      } catch (error) {\n        ElMessage.error('分析失败: ' + error.message)\n      } finally {\n        analyzing.value = false\n      }\n    }\n\n    const downloadResult = () => {\n      const filename = currentFile.value.filename.replace('.pdf', '')\n      if (activeTab.value === 'summary') {\n        api.downloadResult('summary', `${filename}_summary.txt`)\n      } else if (activeTab.value === 'keypoints') {\n        api.downloadResult('keypoints', `${filename}_keypoints.txt`)\n      }\n    }\n\n    onMounted(() => {\n      store.dispatch('fetchFiles')\n    })\n\n    return {\n      files,\n      currentFile,\n      selectedTasks,\n      analyzing,\n      result,\n      activeTab,\n      categoryNames,\n      keypointsDisplay,\n      formatSize,\n      selectFile,\n      startAnalysis,\n      downloadResult\n    }\n  }\n}\n</script>\n\n<style scoped>\n.analyze {\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\nh2 {\n  margin-bottom: 20px;\n  color: #303133;\n}\n\n.select-card,\n.file-card,\n.options-card,\n.result-card {\n  margin-bottom: 20px;\n}\n\n.file-info {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n}\n\n.file-icon {\n  font-size: 48px;\n  color: #409eff;\n}\n\n.summary-content,\n.topic-content {\n  line-height: 1.8;\n  color: #303133;\n  padding: 15px;\n  background: #f5f7fa;\n  border-radius: 4px;\n}\n\n.keypoints-content {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n  gap: 20px;\n}\n\n.keypoint-category {\n  padding: 15px;\n  background: #f5f7fa;\n  border-radius: 4px;\n}\n\n.keypoint-category h4 {\n  color: #409eff;\n  margin-bottom: 10px;\n}\n\n.keypoint-category ul {\n  list-style: none;\n  padding: 0;\n}\n\n.keypoint-category li {\n  padding: 8px 0;\n  padding-left: 20px;\n  position: relative;\n}\n\n.keypoint-category li:before {\n  content: '•';\n  position: absolute;\n  left: 0;\n  color: #409eff;\n  font-weight: bold;\n}\n\n.result-actions {\n  margin-top: 20px;\n  text-align: right;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}