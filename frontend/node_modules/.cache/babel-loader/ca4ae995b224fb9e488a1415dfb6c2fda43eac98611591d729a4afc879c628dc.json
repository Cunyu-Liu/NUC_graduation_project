{"ast":null,"code":"import { defineComponent, inject, computed, onMounted, watch, onBeforeUnmount, openBlock, createBlock, unref, mergeProps, withCtx, renderSlot, createCommentVNode } from 'vue';\nimport { isNil } from 'lodash-unified';\nimport { unrefElement } from '@vueuse/core';\nimport { POPPER_INJECTION_KEY } from './constants.mjs';\nimport { popperTriggerProps } from './trigger.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useForwardRef } from '../../../hooks/use-forward-ref/index.mjs';\nimport { OnlyChild } from '../../slot/src/only-child.mjs';\nimport { isElement } from '../../../utils/types.mjs';\nimport { isFocusable } from '../../../utils/dom/aria.mjs';\nconst _sfc_main = defineComponent({\n  ...{\n    name: \"ElPopperTrigger\",\n    inheritAttrs: false\n  },\n  __name: \"trigger\",\n  props: popperTriggerProps,\n  setup(__props, {\n    expose: __expose\n  }) {\n    const props = __props;\n    const {\n      role,\n      triggerRef\n    } = inject(POPPER_INJECTION_KEY, void 0);\n    useForwardRef(triggerRef);\n    const ariaControls = computed(() => {\n      return ariaHaspopup.value ? props.id : void 0;\n    });\n    const ariaDescribedby = computed(() => {\n      if (role && role.value === \"tooltip\") {\n        return props.open && props.id ? props.id : void 0;\n      }\n      return void 0;\n    });\n    const ariaHaspopup = computed(() => {\n      if (role && role.value !== \"tooltip\") {\n        return role.value;\n      }\n      return void 0;\n    });\n    const ariaExpanded = computed(() => {\n      return ariaHaspopup.value ? `${props.open}` : void 0;\n    });\n    let virtualTriggerAriaStopWatch = void 0;\n    const TRIGGER_ELE_EVENTS = [\"onMouseenter\", \"onMouseleave\", \"onClick\", \"onKeydown\", \"onFocus\", \"onBlur\", \"onContextmenu\"];\n    onMounted(() => {\n      watch(() => props.virtualRef, virtualEl => {\n        if (virtualEl) {\n          triggerRef.value = unrefElement(virtualEl);\n        }\n      }, {\n        immediate: true\n      });\n      watch(triggerRef, (el, prevEl) => {\n        virtualTriggerAriaStopWatch == null ? void 0 : virtualTriggerAriaStopWatch();\n        virtualTriggerAriaStopWatch = void 0;\n        if (isElement(prevEl)) {\n          TRIGGER_ELE_EVENTS.forEach(eventName => {\n            const handler = props[eventName];\n            if (handler) {\n              prevEl.removeEventListener(eventName.slice(2).toLowerCase(), handler, [\"onFocus\", \"onBlur\"].includes(eventName));\n            }\n          });\n        }\n        if (isElement(el)) {\n          TRIGGER_ELE_EVENTS.forEach(eventName => {\n            const handler = props[eventName];\n            if (handler) {\n              el.addEventListener(eventName.slice(2).toLowerCase(), handler, [\"onFocus\", \"onBlur\"].includes(eventName));\n            }\n          });\n          if (isFocusable(el)) {\n            virtualTriggerAriaStopWatch = watch([ariaControls, ariaDescribedby, ariaHaspopup, ariaExpanded], watches => {\n              [\"aria-controls\", \"aria-describedby\", \"aria-haspopup\", \"aria-expanded\"].forEach((key, idx) => {\n                isNil(watches[idx]) ? el.removeAttribute(key) : el.setAttribute(key, watches[idx]);\n              });\n            }, {\n              immediate: true\n            });\n          }\n        }\n        if (isElement(prevEl) && isFocusable(prevEl)) {\n          [\"aria-controls\", \"aria-describedby\", \"aria-haspopup\", \"aria-expanded\"].forEach(key => prevEl.removeAttribute(key));\n        }\n      }, {\n        immediate: true\n      });\n    });\n    onBeforeUnmount(() => {\n      virtualTriggerAriaStopWatch == null ? void 0 : virtualTriggerAriaStopWatch();\n      virtualTriggerAriaStopWatch = void 0;\n      if (triggerRef.value && isElement(triggerRef.value)) {\n        const el = triggerRef.value;\n        TRIGGER_ELE_EVENTS.forEach(eventName => {\n          const handler = props[eventName];\n          if (handler) {\n            el.removeEventListener(eventName.slice(2).toLowerCase(), handler, [\"onFocus\", \"onBlur\"].includes(eventName));\n          }\n        });\n        triggerRef.value = void 0;\n      }\n    });\n    __expose({\n      triggerRef\n    });\n    return (_ctx, _cache) => {\n      return !_ctx.virtualTriggering ? (openBlock(), createBlock(unref(OnlyChild), mergeProps({\n        key: 0\n      }, _ctx.$attrs, {\n        \"aria-controls\": ariaControls.value,\n        \"aria-describedby\": ariaDescribedby.value,\n        \"aria-expanded\": ariaExpanded.value,\n        \"aria-haspopup\": ariaHaspopup.value\n      }), {\n        default: withCtx(() => [renderSlot(_ctx.$slots, \"default\")]),\n        _: 3\n      }, 16, [\"aria-controls\", \"aria-describedby\", \"aria-expanded\", \"aria-haspopup\"])) : createCommentVNode(\"v-if\", true);\n    };\n  }\n});\nvar ElPopperTrigger = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/popper/src/trigger.vue\"]]);\nexport { ElPopperTrigger as default };","map":{"version":3,"names":["props","__props","role","triggerRef","inject","POPPER_INJECTION_KEY","useForwardRef","ariaControls","computed","ariaHaspopup","value","id","ariaDescribedby","open","ariaExpanded","virtualTriggerAriaStopWatch","TRIGGER_ELE_EVENTS","onMounted","watch","virtualRef","virtualEl","unrefElement","immediate","el","prevEl","isElement","forEach","eventName","handler","removeEventListener","slice","toLowerCase","includes","addEventListener","isFocusable","watches","key","idx","isNil","removeAttribute","setAttribute","onBeforeUnmount","__expose","_ctx","virtualTriggering","openBlock","createBlock","unref","OnlyChild","mergeProps","$attrs","default","withCtx","renderSlot","$slots","_"],"sources":["../../../../../../packages/components/popper/src/trigger.vue"],"sourcesContent":["<template>\n  <el-only-child\n    v-if=\"!virtualTriggering\"\n    v-bind=\"$attrs\"\n    :aria-controls=\"ariaControls\"\n    :aria-describedby=\"ariaDescribedby\"\n    :aria-expanded=\"ariaExpanded\"\n    :aria-haspopup=\"ariaHaspopup\"\n  >\n    <slot />\n  </el-only-child>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, inject, onBeforeUnmount, onMounted, watch } from 'vue'\nimport { isNil } from 'lodash-unified'\nimport { unrefElement } from '@vueuse/core'\nimport { ElOnlyChild } from '@element-plus/components/slot'\nimport { useForwardRef } from '@element-plus/hooks'\nimport { isElement, isFocusable } from '@element-plus/utils'\nimport { POPPER_INJECTION_KEY } from './constants'\nimport { popperTriggerProps } from './trigger'\n\nimport type { WatchStopHandle } from 'vue'\n\ndefineOptions({\n  name: 'ElPopperTrigger',\n  inheritAttrs: false,\n})\n\nconst props = defineProps(popperTriggerProps)\n\nconst { role, triggerRef } = inject(POPPER_INJECTION_KEY, undefined)!\n\nuseForwardRef(triggerRef)\n\nconst ariaControls = computed<string | undefined>(() => {\n  return ariaHaspopup.value ? props.id : undefined\n})\n\nconst ariaDescribedby = computed<string | undefined>(() => {\n  if (role && role.value === 'tooltip') {\n    return props.open && props.id ? props.id : undefined\n  }\n  return undefined\n})\n\nconst ariaHaspopup = computed<string | undefined>(() => {\n  if (role && role.value !== 'tooltip') {\n    return role.value\n  }\n  return undefined\n})\n\nconst ariaExpanded = computed<string | undefined>(() => {\n  return ariaHaspopup.value ? `${props.open}` : undefined\n})\n\nlet virtualTriggerAriaStopWatch: WatchStopHandle | undefined = undefined\n\nconst TRIGGER_ELE_EVENTS = [\n  'onMouseenter',\n  'onMouseleave',\n  'onClick',\n  'onKeydown',\n  'onFocus',\n  'onBlur',\n  'onContextmenu',\n] as const\n\nonMounted(() => {\n  watch(\n    () => props.virtualRef,\n    (virtualEl) => {\n      if (virtualEl) {\n        triggerRef.value = unrefElement(virtualEl as HTMLElement)\n      }\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  watch(\n    triggerRef,\n    (el, prevEl) => {\n      virtualTriggerAriaStopWatch?.()\n      virtualTriggerAriaStopWatch = undefined\n\n      if (isElement(prevEl)) {\n        TRIGGER_ELE_EVENTS.forEach((eventName) => {\n          const handler = props[eventName]\n          if (handler) {\n            // @ts-ignore\n            ;(prevEl as HTMLElement).removeEventListener(\n              eventName.slice(2).toLowerCase(),\n              handler,\n              ['onFocus', 'onBlur'].includes(eventName)\n            )\n          }\n        })\n      }\n      if (isElement(el)) {\n        TRIGGER_ELE_EVENTS.forEach((eventName) => {\n          const handler = props[eventName]\n          if (handler) {\n            // It's not worth doing type gymnastics here\n            // @ts-ignore\n            ;(el as HTMLElement).addEventListener(\n              eventName.slice(2).toLowerCase(),\n              handler,\n              ['onFocus', 'onBlur'].includes(eventName)\n            )\n          }\n        })\n        if (isFocusable(el as HTMLElement)) {\n          virtualTriggerAriaStopWatch = watch(\n            [ariaControls, ariaDescribedby, ariaHaspopup, ariaExpanded],\n            (watches) => {\n              ;[\n                'aria-controls',\n                'aria-describedby',\n                'aria-haspopup',\n                'aria-expanded',\n              ].forEach((key, idx) => {\n                isNil(watches[idx])\n                  ? el.removeAttribute(key)\n                  : el.setAttribute(key, watches[idx]!)\n              })\n            },\n            { immediate: true }\n          )\n        }\n      }\n      if (isElement(prevEl) && isFocusable(prevEl as HTMLElement)) {\n        ;[\n          'aria-controls',\n          'aria-describedby',\n          'aria-haspopup',\n          'aria-expanded',\n        ].forEach((key) => prevEl.removeAttribute(key))\n      }\n    },\n    {\n      immediate: true,\n    }\n  )\n})\n\nonBeforeUnmount(() => {\n  virtualTriggerAriaStopWatch?.()\n  virtualTriggerAriaStopWatch = undefined\n  if (triggerRef.value && isElement(triggerRef.value)) {\n    const el = triggerRef.value as HTMLElement\n    TRIGGER_ELE_EVENTS.forEach((eventName) => {\n      const handler = props[eventName]\n      if (handler) {\n        // @ts-ignore\n        el.removeEventListener(\n          eventName.slice(2).toLowerCase(),\n          handler,\n          ['onFocus', 'onBlur'].includes(eventName)\n        )\n      }\n    })\n    triggerRef.value = undefined\n  }\n})\n\ndefineExpose({\n  /**\n   * @description trigger element\n   */\n  triggerRef,\n})\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}