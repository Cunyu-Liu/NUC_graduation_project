{"ast":null,"code":"import { getCurrentInstance, shallowRef, ref, watch, unref, onMounted } from 'vue';\nimport { useEventListener } from '@vueuse/core';\nimport { isElement } from '../../utils/types.mjs';\nimport { isFocusable } from '../../utils/dom/aria.mjs';\nimport { isFunction } from '@vue/shared';\nfunction useFocusController(target, {\n  disabled,\n  beforeFocus,\n  afterFocus,\n  beforeBlur,\n  afterBlur\n} = {}) {\n  const instance = getCurrentInstance();\n  const {\n    emit\n  } = instance;\n  const wrapperRef = shallowRef();\n  const isFocused = ref(false);\n  const handleFocus = event => {\n    const cancelFocus = isFunction(beforeFocus) ? beforeFocus(event) : false;\n    if (unref(disabled) || isFocused.value || cancelFocus) return;\n    isFocused.value = true;\n    emit(\"focus\", event);\n    afterFocus == null ? void 0 : afterFocus();\n  };\n  const handleBlur = event => {\n    var _a;\n    const cancelBlur = isFunction(beforeBlur) ? beforeBlur(event) : false;\n    if (unref(disabled) || event.relatedTarget && ((_a = wrapperRef.value) == null ? void 0 : _a.contains(event.relatedTarget)) || cancelBlur) return;\n    isFocused.value = false;\n    emit(\"blur\", event);\n    afterBlur == null ? void 0 : afterBlur();\n  };\n  const handleClick = event => {\n    var _a, _b;\n    if (unref(disabled) || isFocusable(event.target) || ((_a = wrapperRef.value) == null ? void 0 : _a.contains(document.activeElement)) && wrapperRef.value !== document.activeElement) return;\n    (_b = target.value) == null ? void 0 : _b.focus();\n  };\n  watch([wrapperRef, () => unref(disabled)], ([el, disabled2]) => {\n    if (!el) return;\n    if (disabled2) {\n      el.removeAttribute(\"tabindex\");\n    } else {\n      el.setAttribute(\"tabindex\", \"-1\");\n    }\n  });\n  useEventListener(wrapperRef, \"focus\", handleFocus, true);\n  useEventListener(wrapperRef, \"blur\", handleBlur, true);\n  useEventListener(wrapperRef, \"click\", handleClick, true);\n  if (process.env.NODE_ENV === \"test\") {\n    onMounted(() => {\n      const targetEl = isElement(target.value) ? target.value : document.querySelector(\"input,textarea\");\n      if (targetEl) {\n        useEventListener(targetEl, \"focus\", handleFocus, true);\n        useEventListener(targetEl, \"blur\", handleBlur, true);\n      }\n    });\n  }\n  return {\n    isFocused,\n    wrapperRef,\n    handleFocus,\n    handleBlur\n  };\n}\nexport { useFocusController };","map":{"version":3,"names":["useFocusController","target","disabled","beforeFocus","afterFocus","beforeBlur","afterBlur","instance","getCurrentInstance","emit","wrapperRef","shallowRef","isFocused","ref","handleFocus","event","cancelFocus","isFunction","unref","value","handleBlur","_a","cancelBlur","relatedTarget","contains","handleClick","_b","isFocusable","document","activeElement","focus","watch","el","disabled2","removeAttribute","setAttribute","useEventListener","process","env","NODE_ENV","onMounted","targetEl","isElement","querySelector"],"sources":["../../../../../packages/hooks/use-focus-controller/index.ts"],"sourcesContent":["import {\n  getCurrentInstance,\n  onMounted,\n  ref,\n  shallowRef,\n  unref,\n  watch,\n} from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { isElement, isFocusable, isFunction } from '@element-plus/utils'\n\nimport type { ShallowRef } from 'vue'\nimport type { MaybeRef } from '@vueuse/core'\n\ninterface UseFocusControllerOptions {\n  disabled?: MaybeRef<boolean>\n  /**\n   * return true to cancel focus\n   * @param event FocusEvent\n   */\n  beforeFocus?: (event: FocusEvent) => boolean | undefined\n  afterFocus?: () => void\n  /**\n   * return true to cancel blur\n   * @param event FocusEvent\n   */\n  beforeBlur?: (event: FocusEvent) => boolean | undefined\n  afterBlur?: () => void\n}\n\nexport function useFocusController<T extends { focus: () => void }>(\n  target: ShallowRef<T | undefined>,\n  {\n    disabled,\n    beforeFocus,\n    afterFocus,\n    beforeBlur,\n    afterBlur,\n  }: UseFocusControllerOptions = {}\n) {\n  const instance = getCurrentInstance()!\n  const { emit } = instance\n  const wrapperRef = shallowRef<HTMLElement>()\n  const isFocused = ref(false)\n\n  const handleFocus = (event: FocusEvent) => {\n    const cancelFocus = isFunction(beforeFocus) ? beforeFocus(event) : false\n    if (unref(disabled) || isFocused.value || cancelFocus) return\n\n    isFocused.value = true\n    emit('focus', event)\n    afterFocus?.()\n  }\n\n  const handleBlur = (event: FocusEvent) => {\n    const cancelBlur = isFunction(beforeBlur) ? beforeBlur(event) : false\n    if (\n      unref(disabled) ||\n      (event.relatedTarget &&\n        wrapperRef.value?.contains(event.relatedTarget as Node)) ||\n      cancelBlur\n    )\n      return\n\n    isFocused.value = false\n    emit('blur', event)\n    afterBlur?.()\n  }\n\n  const handleClick = (event: Event) => {\n    if (\n      unref(disabled) ||\n      isFocusable(event.target as HTMLElement) ||\n      (wrapperRef.value?.contains(document.activeElement) &&\n        wrapperRef.value !== document.activeElement)\n    )\n      return\n\n    target.value?.focus()\n  }\n\n  watch([wrapperRef, () => unref(disabled)], ([el, disabled]) => {\n    if (!el) return\n    if (disabled) {\n      el.removeAttribute('tabindex')\n    } else {\n      el.setAttribute('tabindex', '-1')\n    }\n  })\n\n  useEventListener(wrapperRef, 'focus', handleFocus, true)\n  useEventListener(wrapperRef, 'blur', handleBlur, true)\n  useEventListener(wrapperRef, 'click', handleClick, true)\n\n  // only for test\n  if (process.env.NODE_ENV === 'test') {\n    onMounted(() => {\n      const targetEl = isElement(target.value)\n        ? target.value\n        : document.querySelector('input,textarea')\n\n      if (targetEl) {\n        useEventListener(targetEl, 'focus', handleFocus, true)\n        useEventListener(targetEl, 'blur', handleBlur, true)\n      }\n    })\n  }\n\n  return {\n    isFocused,\n    /** Avoid using wrapperRef and handleFocus/handleBlur together */\n    wrapperRef,\n    handleFocus,\n    handleBlur,\n  }\n}\n"],"mappings":";;;;;AA8BO,SAASA,mBACdC,MACA;EACEC,QAAA;EACAC,WAAA;EACAC,UAAA;EACAC,UAAA;EACAC;AACF,IAA+B,EAC/B;EACA,MAAMC,QAAA,GAAWC,kBAAmB;EAC9B;IAAEC;EAAA,CAAS,GAAAF,QAAA;EACjB,MAAMG,UAAA,GAAaC,UAAwB;EACrC,MAAAC,SAAA,GAAYC,GAAA,CAAI,KAAK;EAErB,MAAAC,WAAA,GAAeC,KAAsB;IACzC,MAAMC,WAAA,GAAcC,UAAW,CAAAd,WAAW,CAAI,GAAAA,WAAA,CAAYY,KAAK,CAAI;IACnE,IAAIG,KAAM,CAAAhB,QAAQ,CAAK,IAAAU,SAAA,CAAUO,KAAS,IAAAH,WAAA,EAAa;IAEvDJ,SAAA,CAAUO,KAAQ;IAClBV,IAAA,CAAK,SAASM,KAAK;IACnBX,UAAA,oBAAAA,UAAA;EAAA,CACF;EAEM,MAAAgB,UAAA,GAAcL,KAAsB;IAtD5C,IAAAM,EAAA;IAuDI,MAAMC,UAAA,GAAaL,UAAW,CAAAZ,UAAU,CAAI,GAAAA,UAAA,CAAWU,KAAK,CAAI;IAE9D,IAAAG,KAAA,CAAMhB,QAAQ,KACba,KAAM,CAAAQ,aAAA,MACLF,EAAA,GAAAX,UAAA,CAAWS,KAAX,qBAAAE,EAAA,CAAkBG,QAAS,CAAAT,KAAA,CAAMQ,aACnC,MAAAD,UAAA,EAEA;IAEFV,SAAA,CAAUO,KAAQ;IAClBV,IAAA,CAAK,QAAQM,KAAK;IAClBT,SAAA,oBAAAA,SAAA;EAAA,CACF;EAEM,MAAAmB,WAAA,GAAeV,KAAiB;IArExC,IAAAM,EAAA,EAAAK,EAAA;IAsEI,IACER,KAAM,CAAAhB,QAAQ,CACd,IAAAyB,WAAA,CAAYZ,KAAA,CAAMd,MAAqB,OACtCoB,EAAW,GAAAX,UAAA,CAAAS,KAAA,KAAX,gBAAAE,EAAA,CAAkBG,QAAS,CAAAI,QAAA,CAASC,aACnC,MAAAnB,UAAA,CAAWS,KAAA,KAAUS,QAAS,CAAAC,aAAA,EAEhC;IAEF,CAAAH,EAAA,GAAAzB,MAAA,CAAOkB,KAAA,KAAP,IAAc,YAAAO,EAAA,CAAAI,KAAA;EAAA,CAChB;EAEMC,KAAA,EAACrB,UAAY,QAAMQ,KAAM,CAAAhB,QAAQ,CAAC,GAAG,CAAC,CAAC8B,EAAI,EAAAC,SAAQ,CAAM;IAC7D,IAAI,CAACD,EAAA,EAAI;IACT,IAAIC,SAAU;MACZD,EAAA,CAAGE,eAAA,CAAgB,UAAU;IAAA,CACxB;MACFF,EAAA,CAAAG,YAAA,CAAa,YAAY,IAAI;IAAA;EAClC,CACD;EAEgBC,gBAAA,CAAA1B,UAAA,EAAY,OAAS,EAAAI,WAAA,EAAa,IAAI;EACtCsB,gBAAA,CAAA1B,UAAA,EAAY,MAAQ,EAAAU,UAAA,EAAY,IAAI;EACpCgB,gBAAA,CAAA1B,UAAA,EAAY,OAAS,EAAAe,WAAA,EAAa,IAAI;EAGnD,IAAAY,OAAA,CAAQC,GAAI,CAAAC,QAAA,KAAa,MAAQ;IACnCC,SAAA,CAAU,MAAM;MACR,MAAAC,QAAA,GAAWC,SAAA,CAAUzC,MAAO,CAAAkB,KAAK,IACnClB,MAAO,CAAAkB,KAAA,GACPS,QAAS,CAAAe,aAAA,CAAc,gBAAgB;MAE3C,IAAIF,QAAU;QACKL,gBAAA,CAAAK,QAAA,EAAU,OAAS,EAAA3B,WAAA,EAAa,IAAI;QACpCsB,gBAAA,CAAAK,QAAA,EAAU,MAAQ,EAAArB,UAAA,EAAY,IAAI;MAAA;IACrD,CACD;EAAA;EAGI;IACLR,SAAA;IAEAF,UAAA;IACAI,WAAA;IACAM;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}