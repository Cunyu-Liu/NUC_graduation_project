{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport { isEmpty, isUndefined } from '../../../utils/types.mjs';\nimport { isFunction, isArray } from '@vue/shared';\nlet uid = 0;\nconst calculatePathNodes = node => {\n  const nodes = [node];\n  let {\n    parent\n  } = node;\n  while (parent) {\n    nodes.unshift(parent);\n    parent = parent.parent;\n  }\n  return nodes;\n};\nclass Node {\n  constructor(data, config, parent, root = false) {\n    this.data = data;\n    this.config = config;\n    this.parent = parent;\n    this.root = root;\n    this.uid = uid++;\n    this.checked = false;\n    this.indeterminate = false;\n    this.loading = false;\n    const {\n      value: valueKey,\n      label: labelKey,\n      children: childrenKey\n    } = config;\n    const childrenData = data[childrenKey];\n    const pathNodes = calculatePathNodes(this);\n    this.level = root ? 0 : parent ? parent.level + 1 : 1;\n    this.value = data[valueKey];\n    this.label = data[labelKey];\n    this.pathNodes = pathNodes;\n    this.pathValues = pathNodes.map(node => node.value);\n    this.pathLabels = pathNodes.map(node => node.label);\n    this.childrenData = childrenData;\n    this.children = (childrenData || []).map(child => new Node(child, config, this));\n    this.loaded = !config.lazy || this.isLeaf || !isEmpty(childrenData);\n    this.text = \"\";\n  }\n  get isDisabled() {\n    const {\n      data,\n      parent,\n      config\n    } = this;\n    const {\n      disabled,\n      checkStrictly\n    } = config;\n    const isDisabled = isFunction(disabled) ? disabled(data, this) : !!data[disabled];\n    return isDisabled || !checkStrictly && !!(parent == null ? void 0 : parent.isDisabled);\n  }\n  get isLeaf() {\n    const {\n      data,\n      config,\n      childrenData,\n      loaded\n    } = this;\n    const {\n      lazy,\n      leaf\n    } = config;\n    const isLeaf = isFunction(leaf) ? leaf(data, this) : data[leaf];\n    return isUndefined(isLeaf) ? lazy && !loaded ? false : !(isArray(childrenData) && childrenData.length) : !!isLeaf;\n  }\n  get valueByOption() {\n    return this.config.emitPath ? this.pathValues : this.value;\n  }\n  appendChild(childData) {\n    const {\n      childrenData,\n      children\n    } = this;\n    const node = new Node(childData, this.config, this);\n    if (isArray(childrenData)) {\n      childrenData.push(childData);\n    } else {\n      this.childrenData = [childData];\n    }\n    children.push(node);\n    return node;\n  }\n  calcText(allLevels, separator) {\n    const text = allLevels ? this.pathLabels.join(separator) : this.label;\n    this.text = text;\n    return text;\n  }\n  broadcast(checked) {\n    this.children.forEach(child => {\n      var _a;\n      if (child) {\n        child.broadcast(checked);\n        (_a = child.onParentCheck) == null ? void 0 : _a.call(child, checked);\n      }\n    });\n  }\n  emit() {\n    var _a;\n    const {\n      parent\n    } = this;\n    if (parent) {\n      (_a = parent.onChildCheck) == null ? void 0 : _a.call(parent);\n      parent.emit();\n    }\n  }\n  onParentCheck(checked) {\n    if (!this.isDisabled) {\n      this.setCheckState(checked);\n    }\n  }\n  onChildCheck() {\n    const {\n      children\n    } = this;\n    const validChildren = children.filter(child => !child.isDisabled);\n    const checked = validChildren.length ? validChildren.every(child => child.checked) : false;\n    this.setCheckState(checked);\n  }\n  setCheckState(checked) {\n    const totalNum = this.children.length;\n    const checkedNum = this.children.reduce((c, p) => {\n      const num = p.checked ? 1 : p.indeterminate ? 0.5 : 0;\n      return c + num;\n    }, 0);\n    this.checked = this.loaded && this.children.filter(child => !child.isDisabled).every(child => child.loaded && child.checked) && checked;\n    this.indeterminate = this.loaded && checkedNum !== totalNum && checkedNum > 0;\n  }\n  doCheck(checked) {\n    if (this.checked === checked) return;\n    const {\n      checkStrictly,\n      multiple\n    } = this.config;\n    if (checkStrictly || !multiple) {\n      this.checked = checked;\n    } else {\n      this.broadcast(checked);\n      this.setCheckState(checked);\n      this.emit();\n    }\n  }\n}\nexport { Node as default };","map":{"version":3,"names":["uid","calculatePathNodes","node","nodes","parent","unshift","Node","constructor","data","config","root","checked","indeterminate","loading","value","valueKey","label","labelKey","children","childrenKey","childrenData","pathNodes","level","pathValues","map","pathLabels","child","loaded","lazy","isLeaf","isEmpty","text","isDisabled","disabled","checkStrictly","isFunction","leaf","isUndefined","isArray","length","valueByOption","emitPath","appendChild","childData","push","calcText","allLevels","separator","join","broadcast","forEach","_a","onParentCheck","call","emit","onChildCheck","setCheckState","validChildren","filter","every","totalNum","checkedNum","reduce","c","p","num","doCheck","multiple"],"sources":["../../../../../../packages/components/cascader-panel/src/node.ts"],"sourcesContent":["import { isArray, isEmpty, isFunction, isUndefined } from '@element-plus/utils'\n\nimport type {\n  CascaderConfig,\n  CascaderNodePathValue,\n  CascaderNodeValue,\n  CascaderOption,\n} from './types'\n\ntype ChildrenData = CascaderOption[] | undefined\n\nlet uid = 0\n\nconst calculatePathNodes = (node: Node) => {\n  const nodes = [node]\n  let { parent } = node\n\n  while (parent) {\n    nodes.unshift(parent)\n    parent = parent.parent\n  }\n\n  return nodes\n}\n\nclass Node {\n  readonly uid: number = uid++\n  readonly level: number\n  readonly value: CascaderNodeValue\n  readonly label: string\n  readonly pathNodes: Node[]\n  readonly pathValues: CascaderNodePathValue\n  readonly pathLabels: string[]\n\n  childrenData: ChildrenData\n  children: Node[]\n  text: string\n  loaded: boolean\n  /**\n   * Is it checked\n   *\n   * @default false\n   */\n  checked = false\n  /**\n   * Used to indicate the intermediate state of unchecked and fully checked child nodes\n   *\n   * @default false\n   */\n  indeterminate = false\n  /**\n   * Loading Status\n   *\n   * @default false\n   */\n  loading = false\n\n  constructor(\n    readonly data: CascaderOption,\n    readonly config: CascaderConfig,\n    readonly parent?: Node,\n    readonly root = false\n  ) {\n    const { value: valueKey, label: labelKey, children: childrenKey } = config\n\n    const childrenData = data[childrenKey] as ChildrenData\n    const pathNodes = calculatePathNodes(this)\n\n    this.level = root ? 0 : parent ? parent.level + 1 : 1\n    this.value = data[valueKey] as CascaderNodeValue\n    this.label = data[labelKey] as string\n    this.pathNodes = pathNodes\n    this.pathValues = pathNodes.map((node) => node.value)\n    this.pathLabels = pathNodes.map((node) => node.label)\n    this.childrenData = childrenData\n    this.children = (childrenData || []).map(\n      (child) => new Node(child, config, this)\n    )\n    this.loaded = !config.lazy || this.isLeaf || !isEmpty(childrenData)\n    this.text = ''\n  }\n\n  get isDisabled(): boolean {\n    const { data, parent, config } = this\n    const { disabled, checkStrictly } = config\n    const isDisabled = isFunction(disabled)\n      ? disabled(data, this)\n      : !!data[disabled]\n    return isDisabled || (!checkStrictly && !!parent?.isDisabled)\n  }\n\n  get isLeaf(): boolean {\n    const { data, config, childrenData, loaded } = this\n    const { lazy, leaf } = config\n    const isLeaf = isFunction(leaf) ? leaf(data, this) : data[leaf]\n\n    return isUndefined(isLeaf)\n      ? lazy && !loaded\n        ? false\n        : !(isArray(childrenData) && childrenData.length)\n      : !!isLeaf\n  }\n\n  get valueByOption() {\n    return this.config.emitPath ? this.pathValues : this.value\n  }\n\n  appendChild(childData: CascaderOption) {\n    const { childrenData, children } = this\n    const node = new Node(childData, this.config, this)\n\n    if (isArray(childrenData)) {\n      childrenData.push(childData)\n    } else {\n      this.childrenData = [childData]\n    }\n\n    children.push(node)\n\n    return node\n  }\n\n  calcText(allLevels: boolean, separator: string) {\n    const text = allLevels ? this.pathLabels.join(separator) : this.label\n    this.text = text\n    return text\n  }\n\n  broadcast(checked: boolean) {\n    this.children.forEach((child) => {\n      if (child) {\n        // bottom up\n        child.broadcast(checked)\n        child.onParentCheck?.(checked)\n      }\n    })\n  }\n\n  emit() {\n    const { parent } = this\n    if (parent) {\n      parent.onChildCheck?.()\n      parent.emit()\n    }\n  }\n\n  onParentCheck(checked: boolean) {\n    if (!this.isDisabled) {\n      this.setCheckState(checked)\n    }\n  }\n\n  onChildCheck() {\n    const { children } = this\n    const validChildren = children.filter((child) => !child.isDisabled)\n    const checked = validChildren.length\n      ? validChildren.every((child) => child.checked)\n      : false\n\n    this.setCheckState(checked)\n  }\n\n  setCheckState(checked: boolean) {\n    const totalNum = this.children.length\n    const checkedNum = this.children.reduce((c, p) => {\n      const num = p.checked ? 1 : p.indeterminate ? 0.5 : 0\n      return c + num\n    }, 0)\n\n    this.checked =\n      this.loaded &&\n      this.children\n        .filter((child) => !child.isDisabled)\n        .every((child) => child.loaded && child.checked) &&\n      checked\n    this.indeterminate =\n      this.loaded && checkedNum !== totalNum && checkedNum > 0\n  }\n\n  doCheck(checked: boolean) {\n    if (this.checked === checked) return\n\n    const { checkStrictly, multiple } = this.config\n\n    if (checkStrictly || !multiple) {\n      this.checked = checked\n    } else {\n      // bottom up to unify the calculation of the indeterminate state\n      this.broadcast(checked)\n      this.setCheckState(checked)\n      this.emit()\n    }\n  }\n}\n\nexport default Node\n"],"mappings":";;;;;;;;;AAWA,IAAIA,GAAM;AAEV,MAAMC,kBAAA,GAAsBC,IAAe;EACnC,MAAAC,KAAA,GAAQ,CAACD,IAAI;EACf;IAAEE;EAAA,CAAW,GAAAF,IAAA;EAEjB,OAAOE,MAAQ;IACbD,KAAA,CAAME,OAAA,CAAQD,MAAM;IACpBA,MAAA,GAASA,MAAO,CAAAA,MAAA;EAAA;EAGX,OAAAD,KAAA;AACT;AAEA,MAAMG,IAAK;EAgCTC,WACWA,CAAAC,IAAA,EACAC,MACA,EAAAL,MAAA,EACAM,IAAA,GAAO,KAChB;IAJS,KAAAF,IAAA,GAAAA,IAAA;IACA,KAAAC,MAAA,GAAAA,MAAA;IACA,KAAAL,MAAA,GAAAA,MAAA;IACA,KAAAM,IAAA,GAAAA,IAAA;IAnCX,KAASV,GAAc,GAAAA,GAAA;IAiBb,KAAAW,OAAA;IAMM,KAAAC,aAAA;IAMN,KAAAC,OAAA;IAQR,MAAM;MAAEC,KAAO,EAAAC,QAAA;MAAUC,KAAA,EAAOC,QAAU;MAAAC,QAAA,EAAUC;IAAA,CAAgB,GAAAV,MAAA;IAEpE,MAAMW,YAAA,GAAeZ,IAAK,CAAAW,WAAA;IACpB,MAAAE,SAAA,GAAYpB,kBAAA,CAAmB,IAAI;IAEzC,KAAKqB,KAAA,GAAQZ,IAAO,OAAIN,MAAS,GAAAA,MAAA,CAAOkB,KAAA,GAAQ,CAAI;IACpD,KAAKR,KAAA,GAAQN,IAAK,CAAAO,QAAA;IAClB,KAAKC,KAAA,GAAQR,IAAK,CAAAS,QAAA;IAClB,KAAKI,SAAY,GAAAA,SAAA;IACjB,KAAKE,UAAA,GAAaF,SAAU,CAAAG,GAAA,CAAKtB,IAAA,IAASA,IAAA,CAAKY,KAAK;IACpD,KAAKW,UAAA,GAAaJ,SAAU,CAAAG,GAAA,CAAKtB,IAAA,IAASA,IAAA,CAAKc,KAAK;IACpD,KAAKI,YAAe,GAAAA,YAAA;IACf,KAAAF,QAAA,IAAYE,YAAgB,MAAI,EAAAI,GAAA,CAClCE,KAAU,QAAIpB,IAAK,CAAAoB,KAAA,EAAOjB,MAAA,EAAQ,IAAI,EACzC;IACK,KAAAkB,MAAA,GAAS,CAAClB,MAAO,CAAAmB,IAAA,IAAQ,KAAKC,MAAU,KAACC,OAAA,CAAQV,YAAY;IAClE,KAAKW,IAAO;EAAA;EAGd,IAAIC,UAAsBA,CAAA;IACxB,MAAM;MAAExB,IAAA;MAAMJ,MAAQ;MAAAK;IAAA,CAAW;IAC3B;MAAEwB,QAAU;MAAAC;IAAA,CAAkB,GAAAzB,MAAA;IAC9B,MAAAuB,UAAA,GAAaG,UAAW,CAAAF,QAAQ,CAClC,GAAAA,QAAA,CAASzB,IAAA,EAAM,IAAI,IACnB,CAAC,CAACA,IAAK,CAAAyB,QAAA;IACX,OAAOD,UAAe,KAACE,aAAiB,KAAC,EAAC9B,MAAQ,oBAAAA,MAAA,CAAA4B,UAAA;EAAA;EAGpD,IAAIH,MAAkBA,CAAA;IACpB,MAAM;MAAErB,IAAA;MAAMC,MAAQ;MAAAW,YAAA;MAAcO;IAAA,CAAW;IACzC;MAAEC,IAAM;MAAAQ;IAAA,CAAS,GAAA3B,MAAA;IACjB,MAAAoB,MAAA,GAASM,UAAA,CAAWC,IAAI,IAAIA,IAAA,CAAK5B,IAAM,MAAI,IAAIA,IAAK,CAAA4B,IAAA;IAE1D,OAAOC,WAAY,CAAAR,MAAM,CACrB,GAAAD,IAAA,IAAQ,CAACD,MACP,WACA,EAAEW,OAAA,CAAQlB,YAAY,KAAKA,YAAa,CAAAmB,MAAA,IAC1C,CAAC,CAACV,MAAA;EAAA;EAGR,IAAIW,aAAgBA,CAAA;IAClB,OAAO,IAAK,CAAA/B,MAAA,CAAOgC,QAAW,QAAKlB,UAAA,GAAa,IAAK,CAAAT,KAAA;EAAA;EAGvD4B,YAAYC,SAA2B;IAC/B;MAAEvB,YAAc;MAAAF;IAAA,CAAa;IACnC,MAAMhB,IAAA,GAAO,IAAII,IAAA,CAAKqC,SAAW,OAAKlC,MAAA,EAAQ,IAAI;IAE9C,IAAA6B,OAAA,CAAQlB,YAAY,CAAG;MACzBA,YAAA,CAAawB,IAAA,CAAKD,SAAS;IAAA,CACtB;MACA,KAAAvB,YAAA,GAAe,CAACuB,SAAS;IAAA;IAGhCzB,QAAA,CAAS0B,IAAA,CAAK1C,IAAI;IAEX,OAAAA,IAAA;EAAA;EAGT2C,SAASC,SAAA,EAAoBC,SAAmB;IAC9C,MAAMhB,IAAA,GAAOe,SAAY,QAAKrB,UAAA,CAAWuB,IAAK,CAAAD,SAAS,IAAI,IAAK,CAAA/B,KAAA;IAChE,KAAKe,IAAO,GAAAA,IAAA;IACL,OAAAA,IAAA;EAAA;EAGTkB,UAAUtC,OAAkB;IACrB,KAAAO,QAAA,CAASgC,OAAQ,CAACxB,KAAU;MAjIrC,IAAAyB,EAAA;MAkIM,IAAIzB,KAAO;QAETA,KAAA,CAAMuB,SAAA,CAAUtC,OAAO;QACvB,CAAAwC,EAAA,GAAAzB,KAAA,CAAM0B,aAAA,KAAN,IAAsB,YAAAD,EAAA,CAAAE,IAAA,CAAA3B,KAAA,EAAAf,OAAA;MAAA;IACxB,CACD;EAAA;EAGH2C,IAAOA,CAAA;IA1IT,IAAAH,EAAA;IA2IU;MAAE/C;IAAA,CAAW;IACnB,IAAIA,MAAQ;MACV,CAAA+C,EAAA,GAAA/C,MAAA,CAAOmD,YAAP,qBAAAJ,EAAA,CAAAE,IAAA,CAAAjD,MAAA;MACAA,MAAA,CAAOkD,IAAK;IAAA;EACd;EAGFF,cAAczC,OAAkB;IAC1B,KAAC,KAAKqB,UAAY;MACpB,KAAKwB,aAAA,CAAc7C,OAAO;IAAA;EAC5B;EAGF4C,YAAeA,CAAA;IACP;MAAErC;IAAA,CAAa;IACrB,MAAMuC,aAAA,GAAgBvC,QAAS,CAAAwC,MAAA,CAAQhC,KAAU,KAACA,KAAA,CAAMM,UAAU;IAC5D,MAAArB,OAAA,GAAU8C,aAAA,CAAclB,MAC1B,GAAAkB,aAAA,CAAcE,KAAA,CAAOjC,KAAA,IAAUA,KAAM,CAAAf,OAAO,CAC5C;IAEJ,KAAK6C,aAAA,CAAc7C,OAAO;EAAA;EAG5B6C,cAAc7C,OAAkB;IACxB,MAAAiD,QAAA,GAAW,KAAK1C,QAAS,CAAAqB,MAAA;IAC/B,MAAMsB,UAAA,GAAa,IAAK,CAAA3C,QAAA,CAAS4C,MAAO,EAACC,CAAA,EAAGC,CAAM;MAChD,MAAMC,GAAA,GAAMD,CAAE,CAAArD,OAAA,GAAU,CAAI,GAAAqD,CAAA,CAAEpD,aAAA,GAAgB,GAAM;MACpD,OAAOmD,CAAI,GAAAE,GAAA;IAAA,GACV,CAAC;IAEJ,KAAKtD,OAAA,GACH,IAAK,CAAAgB,MAAA,IACL,KAAKT,QACF,CAAAwC,MAAA,CAAQhC,KAAU,KAACA,KAAA,CAAMM,UAAU,EACnC2B,KAAA,CAAOjC,KAAA,IAAUA,KAAA,CAAMC,MAAU,IAAAD,KAAA,CAAMf,OAAO,CACjD,IAAAA,OAAA;IACF,KAAKC,aACH,QAAKe,MAAU,IAAAkC,UAAA,KAAeD,QAAA,IAAYC,UAAa;EAAA;EAG3DK,QAAQvD,OAAkB;IACxB,IAAI,KAAKA,OAAY,KAAAA,OAAA,EAAS;IAE9B,MAAM;MAAEuB,aAAA;MAAeiC;IAAS,IAAI,IAAK,CAAA1D,MAAA;IAErC,IAAAyB,aAAA,IAAiB,CAACiC,QAAU;MAC9B,KAAKxD,OAAU,GAAAA,OAAA;IAAA,CACV;MAEL,KAAKsC,SAAA,CAAUtC,OAAO;MACtB,KAAK6C,aAAA,CAAc7C,OAAO;MAC1B,KAAK2C,IAAK;IAAA;EACZ;AAEJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}