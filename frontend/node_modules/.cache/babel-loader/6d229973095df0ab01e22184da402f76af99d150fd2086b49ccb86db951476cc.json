{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref, onMounted } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport { Share, Refresh, Download, InfoFilled } from '@element-plus/icons-vue';\nimport KnowledgeGraph from '@/components/KnowledgeGraph.vue';\nimport api from '@/api';\nexport default {\n  name: 'KnowledgeGraphView',\n  components: {\n    KnowledgeGraph,\n    Share,\n    Refresh,\n    Download,\n    InfoFilled\n  },\n  setup() {\n    const graphComponent = ref(null);\n    const building = ref(false);\n    const showStats = ref(false);\n    const stats = ref(null);\n\n    // 页面加载时自动构建图谱\n    onMounted(async () => {\n      await loadStats();\n      // 自动构建图谱（如果还没有数据）\n      await buildGraph();\n    });\n    const loadStats = async () => {\n      try {\n        const response = await api.getStatistics();\n        if (response.success) {\n          stats.value = {\n            total_nodes: response.data.total_papers,\n            total_edges: response.data.total_relations,\n            avg_degree: response.data.total_relations * 2 / Math.max(response.data.total_papers, 1)\n          };\n        }\n      } catch (error) {\n        console.error('获取统计信息失败:', error);\n      }\n    };\n    const buildGraph = async () => {\n      try {\n        building.value = true;\n        ElMessage.info('正在构建知识图谱，请稍候...');\n        const response = await api.buildKnowledgeGraph([]);\n        if (response.success) {\n          ElMessage.success(response.message || '知识图谱构建成功');\n          if (graphComponent.value) {\n            await graphComponent.value.refreshGraph();\n          }\n          // 刷新统计信息\n          await loadStats();\n        } else {\n          ElMessage.warning(response.message || '图谱构建未完成');\n        }\n      } catch (error) {\n        console.error('构建知识图谱失败:', error);\n        // 不显示错误，因为可能是图谱已经存在\n        // 直接刷新图谱显示\n        if (graphComponent.value) {\n          await graphComponent.value.refreshGraph();\n        }\n      } finally {\n        building.value = false;\n      }\n    };\n    const exportGraph = () => {\n      // 导出当前图谱为图片\n      const svg = document.querySelector('.knowledge-graph-container svg');\n      if (!svg) {\n        ElMessage.warning('没有可导出的图谱');\n        return;\n      }\n      const svgData = new XMLSerializer().serializeToString(svg);\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      const img = new Image();\n      canvas.width = 1920;\n      canvas.height = 1080;\n      img.onload = () => {\n        ctx.fillStyle = '#f8f9fa';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n        canvas.toBlob(blob => {\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `knowledge_graph_${Date.now()}.png`;\n          a.click();\n          URL.revokeObjectURL(url);\n          ElMessage.success('图谱导出成功');\n        });\n      };\n      img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));\n    };\n    return {\n      graphComponent,\n      building,\n      showStats,\n      stats,\n      buildGraph,\n      exportGraph\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","ElMessage","Share","Refresh","Download","InfoFilled","KnowledgeGraph","api","name","components","setup","graphComponent","building","showStats","stats","loadStats","buildGraph","response","getStatistics","success","value","total_nodes","data","total_papers","total_edges","total_relations","avg_degree","Math","max","error","console","info","buildKnowledgeGraph","message","refreshGraph","warning","exportGraph","svg","document","querySelector","svgData","XMLSerializer","serializeToString","canvas","createElement","ctx","getContext","img","Image","width","height","onload","fillStyle","fillRect","drawImage","toBlob","blob","url","URL","createObjectURL","a","href","download","Date","now","click","revokeObjectURL","src","btoa","unescape","encodeURIComponent"],"sources":["/Users/liucunyu/Documents/all_code/NUC_graduation_project/frontend/src/views/KnowledgeGraph.vue"],"sourcesContent":["<template>\n  <div class=\"knowledge-graph-page\">\n    <el-card class=\"page-header\">\n      <div class=\"header-content\">\n        <div class=\"header-left\">\n          <h2>\n            <el-icon><Share /></el-icon>\n            知识图谱\n          </h2>\n          <p>可视化展示论文之间的引用和关联关系</p>\n        </div>\n        <div class=\"header-right\">\n          <el-button type=\"primary\" @click=\"buildGraph\" :loading=\"building\">\n            <el-icon><Refresh /></el-icon>\n            构建图谱\n          </el-button>\n          <el-button @click=\"showStats = true\">\n            <el-icon><InfoFilled /></el-icon>\n            统计信息\n          </el-button>\n          <el-button @click=\"exportGraph\">\n            <el-icon><Download /></el-icon>\n            导出\n          </el-button>\n        </div>\n      </div>\n    </el-card>\n\n    <!-- 统计信息对话框 -->\n    <el-dialog v-model=\"showStats\" title=\"知识图谱统计\" width=\"500px\">\n      <el-descriptions :column=\"1\" border v-if=\"stats\">\n        <el-descriptions-item label=\"节点数（论文）\">{{ stats.total_nodes || 0 }}</el-descriptions-item>\n        <el-descriptions-item label=\"边数（关系）\">{{ stats.total_edges || 0 }}</el-descriptions-item>\n        <el-descriptions-item label=\"平均度数\">{{ (stats.avg_degree || 0).toFixed(2) }}</el-descriptions-item>\n      </el-descriptions>\n      <el-empty v-else description=\"暂无统计信息\" />\n    </el-dialog>\n\n    <KnowledgeGraph ref=\"graphComponent\" />\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport { Share, Refresh, Download, InfoFilled } from '@element-plus/icons-vue'\nimport KnowledgeGraph from '@/components/KnowledgeGraph.vue'\nimport api from '@/api'\n\nexport default {\n  name: 'KnowledgeGraphView',\n  components: {\n    KnowledgeGraph,\n    Share,\n    Refresh,\n    Download,\n    InfoFilled\n  },\n  setup() {\n    const graphComponent = ref(null)\n    const building = ref(false)\n    const showStats = ref(false)\n    const stats = ref(null)\n\n    // 页面加载时自动构建图谱\n    onMounted(async () => {\n      await loadStats()\n      // 自动构建图谱（如果还没有数据）\n      await buildGraph()\n    })\n\n    const loadStats = async () => {\n      try {\n        const response = await api.getStatistics()\n        if (response.success) {\n          stats.value = {\n            total_nodes: response.data.total_papers,\n            total_edges: response.data.total_relations,\n            avg_degree: response.data.total_relations * 2 / Math.max(response.data.total_papers, 1)\n          }\n        }\n      } catch (error) {\n        console.error('获取统计信息失败:', error)\n      }\n    }\n\n    const buildGraph = async () => {\n      try {\n        building.value = true\n        ElMessage.info('正在构建知识图谱，请稍候...')\n\n        const response = await api.buildKnowledgeGraph([])\n\n        if (response.success) {\n          ElMessage.success(response.message || '知识图谱构建成功')\n          if (graphComponent.value) {\n            await graphComponent.value.refreshGraph()\n          }\n          // 刷新统计信息\n          await loadStats()\n        } else {\n          ElMessage.warning(response.message || '图谱构建未完成')\n        }\n      } catch (error) {\n        console.error('构建知识图谱失败:', error)\n        // 不显示错误，因为可能是图谱已经存在\n        // 直接刷新图谱显示\n        if (graphComponent.value) {\n          await graphComponent.value.refreshGraph()\n        }\n      } finally {\n        building.value = false\n      }\n    }\n\n    const exportGraph = () => {\n      // 导出当前图谱为图片\n      const svg = document.querySelector('.knowledge-graph-container svg')\n      if (!svg) {\n        ElMessage.warning('没有可导出的图谱')\n        return\n      }\n\n      const svgData = new XMLSerializer().serializeToString(svg)\n      const canvas = document.createElement('canvas')\n      const ctx = canvas.getContext('2d')\n      const img = new Image()\n\n      canvas.width = 1920\n      canvas.height = 1080\n\n      img.onload = () => {\n        ctx.fillStyle = '#f8f9fa'\n        ctx.fillRect(0, 0, canvas.width, canvas.height)\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height)\n\n        canvas.toBlob((blob) => {\n          const url = URL.createObjectURL(blob)\n          const a = document.createElement('a')\n          a.href = url\n          a.download = `knowledge_graph_${Date.now()}.png`\n          a.click()\n          URL.revokeObjectURL(url)\n          ElMessage.success('图谱导出成功')\n        })\n      }\n\n      img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)))\n    }\n\n    return {\n      graphComponent,\n      building,\n      showStats,\n      stats,\n      buildGraph,\n      exportGraph\n    }\n  }\n}\n</script>\n\n<style scoped>\n.knowledge-graph-page {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.page-header {\n  margin-bottom: 20px;\n}\n\n.header-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.header-left h2 {\n  margin: 0 0 8px 0;\n  font-size: 24px;\n  color: #303133;\n  display: flex;\n  align-items: center;\n}\n\n.header-left h2 i {\n  margin-right: 10px;\n  color: #409eff;\n}\n\n.header-left p {\n  margin: 0;\n  font-size: 14px;\n  color: #909399;\n}\n\n.header-right {\n  display: flex;\n  gap: 10px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}