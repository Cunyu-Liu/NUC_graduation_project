{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { ref, computed } from 'vue';\nimport { isEqual } from 'lodash-unified';\nimport { useLocale } from '../../../../hooks/use-locale/index.mjs';\nimport { parseDate, dayOrDaysToDate, valueEquals, formatter } from '../utils.mjs';\nimport { isArray } from '@vue/shared';\nimport { UPDATE_MODEL_EVENT } from '../../../../constants/event.mjs';\nconst useCommonPicker = (props, emit) => {\n  const {\n    lang\n  } = useLocale();\n  const pickerVisible = ref(false);\n  const pickerActualVisible = ref(false);\n  const userInput = ref(null);\n  const valueIsEmpty = computed(() => {\n    const {\n      modelValue\n    } = props;\n    return !modelValue || isArray(modelValue) && !modelValue.filter(Boolean).length;\n  });\n  const emitInput = input => {\n    if (!valueEquals(props.modelValue, input)) {\n      let formatted;\n      if (isArray(input)) {\n        formatted = input.map(item => formatter(item, props.valueFormat, lang.value));\n      } else if (input) {\n        formatted = formatter(input, props.valueFormat, lang.value);\n      }\n      const emitVal = input ? formatted : input;\n      emit(UPDATE_MODEL_EVENT, emitVal, lang.value);\n    }\n  };\n  const parsedValue = computed(() => {\n    var _a;\n    let dayOrDays;\n    if (valueIsEmpty.value) {\n      if (pickerOptions.value.getDefaultValue) {\n        dayOrDays = pickerOptions.value.getDefaultValue();\n      }\n    } else {\n      if (isArray(props.modelValue)) {\n        dayOrDays = props.modelValue.map(d => parseDate(d, props.valueFormat, lang.value));\n      } else {\n        dayOrDays = parseDate((_a = props.modelValue) != null ? _a : \"\", props.valueFormat, lang.value);\n      }\n    }\n    if (pickerOptions.value.getRangeAvailableTime) {\n      const availableResult = pickerOptions.value.getRangeAvailableTime(dayOrDays);\n      if (!isEqual(availableResult, dayOrDays)) {\n        dayOrDays = availableResult;\n        if (!valueIsEmpty.value) {\n          emitInput(dayOrDaysToDate(dayOrDays));\n        }\n      }\n    }\n    if (isArray(dayOrDays) && dayOrDays.some(day => !day)) {\n      dayOrDays = [];\n    }\n    return dayOrDays;\n  });\n  const pickerOptions = ref({});\n  const onSetPickerOption = e => {\n    pickerOptions.value[e[0]] = e[1];\n    pickerOptions.value.panelReady = true;\n  };\n  const onCalendarChange = e => {\n    emit(\"calendar-change\", e);\n  };\n  const onPanelChange = (value, mode, view) => {\n    emit(\"panel-change\", value, mode, view);\n  };\n  const onPick = (date = \"\", visible = false) => {\n    pickerVisible.value = visible;\n    let result;\n    if (isArray(date)) {\n      result = date.map(_ => _.toDate());\n    } else {\n      result = date ? date.toDate() : date;\n    }\n    userInput.value = null;\n    emitInput(result);\n  };\n  return {\n    parsedValue,\n    pickerActualVisible,\n    pickerOptions,\n    pickerVisible,\n    userInput,\n    valueIsEmpty,\n    emitInput,\n    onCalendarChange,\n    onPanelChange,\n    onPick,\n    onSetPickerOption\n  };\n};\nexport { useCommonPicker };","map":{"version":3,"names":["useCommonPicker","props","emit","lang","useLocale","pickerVisible","ref","pickerActualVisible","userInput","valueIsEmpty","computed","modelValue","isArray","filter","Boolean","length","emitInput","input","valueEquals","formatted","map","item","formatter","valueFormat","value","emitVal","UPDATE_MODEL_EVENT","parsedValue","_a","dayOrDays","pickerOptions","getDefaultValue","d","parseDate","getRangeAvailableTime","availableResult","isEqual","dayOrDaysToDate","some","day","onSetPickerOption","e","panelReady","onCalendarChange","onPanelChange","mode","view","onPick","date","visible","result","_","toDate"],"sources":["../../../../../../../packages/components/time-picker/src/composables/use-common-picker.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport { isEqual } from 'lodash-unified'\nimport { useLocale } from '@element-plus/hooks/use-locale'\nimport { isArray } from '@element-plus/utils'\nimport { UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { dayOrDaysToDate, formatter, parseDate, valueEquals } from '../utils'\n\nimport type { Dayjs } from 'dayjs'\nimport type {\n  DateModelType,\n  DayOrDays,\n  ModelValueType,\n  PickerOptions,\n  SingleOrRange,\n  UserInput,\n} from '../common/props'\n\ninterface CommonPickerProps {\n  modelValue: ModelValueType | null\n  valueFormat?: string\n}\ntype CommonPickerEmits = (\n  event: 'update:modelValue' | 'calendar-change' | 'panel-change',\n  ...args: any[]\n) => void\n\nexport const useCommonPicker = <\n  P extends CommonPickerProps,\n  E extends CommonPickerEmits,\n>(\n  props: P,\n  emit: E\n) => {\n  const { lang } = useLocale()\n  const pickerVisible = ref(false)\n  const pickerActualVisible = ref(false)\n  const userInput = ref<UserInput>(null)\n\n  const valueIsEmpty = computed(() => {\n    const { modelValue } = props\n    return (\n      !modelValue || (isArray(modelValue) && !modelValue.filter(Boolean).length)\n    )\n  })\n\n  const emitInput = (input: SingleOrRange<DateModelType> | null) => {\n    if (!valueEquals(props.modelValue, input)) {\n      let formatted\n      if (isArray(input)) {\n        formatted = input.map((item) =>\n          formatter(item, props.valueFormat, lang.value)\n        )\n      } else if (input) {\n        formatted = formatter(input, props.valueFormat, lang.value)\n      }\n      const emitVal = input ? formatted : input\n      emit(UPDATE_MODEL_EVENT, emitVal, lang.value)\n    }\n  }\n\n  const parsedValue = computed(() => {\n    let dayOrDays: DayOrDays\n    if (valueIsEmpty.value) {\n      if (pickerOptions.value.getDefaultValue) {\n        dayOrDays = pickerOptions.value.getDefaultValue()\n      }\n    } else {\n      if (isArray(props.modelValue)) {\n        dayOrDays = props.modelValue.map((d) =>\n          parseDate(d, props.valueFormat, lang.value)\n        ) as [Dayjs, Dayjs]\n      } else {\n        dayOrDays = parseDate(\n          props.modelValue ?? '',\n          props.valueFormat,\n          lang.value\n        )!\n      }\n    }\n\n    if (pickerOptions.value.getRangeAvailableTime) {\n      const availableResult = pickerOptions.value.getRangeAvailableTime(\n        dayOrDays!\n      )\n      if (!isEqual(availableResult, dayOrDays!)) {\n        dayOrDays = availableResult\n\n        // The result is corrected only when model-value exists\n        if (!valueIsEmpty.value) {\n          emitInput(dayOrDaysToDate(dayOrDays))\n        }\n      }\n    }\n    if (isArray(dayOrDays!) && dayOrDays.some((day) => !day)) {\n      dayOrDays = [] as unknown as DayOrDays\n    }\n    return dayOrDays!\n  })\n\n  const pickerOptions = ref<Partial<PickerOptions>>({})\n\n  const onSetPickerOption = <T extends keyof PickerOptions>(\n    e: [T, PickerOptions[T]]\n  ) => {\n    pickerOptions.value[e[0]] = e[1]\n    pickerOptions.value.panelReady = true\n  }\n\n  const onCalendarChange = (e: [Date, null | Date]) => {\n    emit('calendar-change', e)\n  }\n\n  const onPanelChange = (\n    value: [Dayjs, Dayjs],\n    mode: 'month' | 'year',\n    view: unknown\n  ) => {\n    emit('panel-change', value, mode, view)\n  }\n\n  const onPick = (date: any = '', visible = false) => {\n    pickerVisible.value = visible\n    let result\n    if (isArray(date)) {\n      result = date.map((_) => _.toDate())\n    } else {\n      // clear btn emit null\n      result = date ? date.toDate() : date\n    }\n    userInput.value = null\n    emitInput(result)\n  }\n\n  return {\n    parsedValue,\n    pickerActualVisible,\n    pickerOptions,\n    pickerVisible,\n    userInput,\n    valueIsEmpty,\n    emitInput,\n    onCalendarChange,\n    onPanelChange,\n    onPick,\n    onSetPickerOption,\n  }\n}\n\nexport type CommonPickerContext = ReturnType<typeof useCommonPicker>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}