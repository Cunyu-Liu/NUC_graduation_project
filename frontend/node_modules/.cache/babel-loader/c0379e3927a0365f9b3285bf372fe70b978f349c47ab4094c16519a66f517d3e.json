{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { inject, computed } from 'vue';\nimport { TABLE_INJECTION_KEY } from '../tokens.mjs';\nconst getAllColumns = columns => {\n  const result = [];\n  columns.forEach(column => {\n    if (column.children) {\n      result.push(column);\n      result.push.apply(result, getAllColumns(column.children));\n    } else {\n      result.push(column);\n    }\n  });\n  return result;\n};\nconst convertToRows = originColumns => {\n  let maxLevel = 1;\n  const traverse = (column, parent) => {\n    if (parent) {\n      column.level = parent.level + 1;\n      if (maxLevel < column.level) {\n        maxLevel = column.level;\n      }\n    }\n    if (column.children) {\n      let colSpan = 0;\n      column.children.forEach(subColumn => {\n        traverse(subColumn, column);\n        colSpan += subColumn.colSpan;\n      });\n      column.colSpan = colSpan;\n    } else {\n      column.colSpan = 1;\n    }\n  };\n  originColumns.forEach(column => {\n    column.level = 1;\n    traverse(column, void 0);\n  });\n  const rows = [];\n  for (let i = 0; i < maxLevel; i++) {\n    rows.push([]);\n  }\n  const allColumns = getAllColumns(originColumns);\n  allColumns.forEach(column => {\n    if (!column.children) {\n      column.rowSpan = maxLevel - column.level + 1;\n    } else {\n      column.rowSpan = 1;\n      column.children.forEach(col => col.isSubColumn = true);\n    }\n    rows[column.level - 1].push(column);\n  });\n  return rows;\n};\nfunction useUtils(props) {\n  const parent = inject(TABLE_INJECTION_KEY);\n  const columnRows = computed(() => {\n    return convertToRows(props.store.states.originColumns.value);\n  });\n  const isGroup = computed(() => {\n    const result = columnRows.value.length > 1;\n    if (result && parent) {\n      parent.state.isGroup.value = true;\n    }\n    return result;\n  });\n  const toggleAllSelection = event => {\n    event.stopPropagation();\n    parent == null ? void 0 : parent.store.commit(\"toggleAllSelection\");\n  };\n  return {\n    isGroup,\n    toggleAllSelection,\n    columnRows\n  };\n}\nexport { convertToRows, useUtils as default };","map":{"version":3,"names":["getAllColumns","columns","result","forEach","column","children","push","apply","convertToRows","originColumns","maxLevel","traverse","parent","level","colSpan","subColumn","rows","i","allColumns","rowSpan","col","isSubColumn","useUtils","props","inject","TABLE_INJECTION_KEY","columnRows","computed","store","states","value","isGroup","length","state","toggleAllSelection","event","stopPropagation","commit"],"sources":["../../../../../../../packages/components/table/src/table-header/utils-helper.ts"],"sourcesContent":["import { computed, inject } from 'vue'\nimport { TABLE_INJECTION_KEY } from '../tokens'\n\nimport type { DefaultRow } from '../table/defaults'\nimport type { TableColumnCtx } from '../table-column/defaults'\nimport type { TableHeaderProps } from '.'\n\nconst getAllColumns = <T extends DefaultRow>(\n  columns: TableColumnCtx<T>[]\n): TableColumnCtx<T>[] => {\n  const result: TableColumnCtx<T>[] = []\n  columns.forEach((column) => {\n    if (column.children) {\n      result.push(column)\n      // eslint-disable-next-line prefer-spread\n      result.push.apply(result, getAllColumns(column.children))\n    } else {\n      result.push(column)\n    }\n  })\n  return result\n}\n\nexport const convertToRows = <T extends DefaultRow>(\n  originColumns: TableColumnCtx<T>[]\n): TableColumnCtx<T>[][] => {\n  let maxLevel = 1\n  const traverse = (column: TableColumnCtx<T>, parent?: TableColumnCtx<T>) => {\n    if (parent) {\n      column.level = parent.level + 1\n      if (maxLevel < column.level) {\n        maxLevel = column.level\n      }\n    }\n    if (column.children) {\n      let colSpan = 0\n      column.children.forEach((subColumn) => {\n        traverse(subColumn, column)\n        colSpan += subColumn.colSpan\n      })\n      column.colSpan = colSpan\n    } else {\n      column.colSpan = 1\n    }\n  }\n\n  originColumns.forEach((column) => {\n    column.level = 1\n    traverse(column, undefined)\n  })\n\n  const rows: TableColumnCtx<T>[][] = []\n  for (let i = 0; i < maxLevel; i++) {\n    rows.push([])\n  }\n\n  const allColumns: TableColumnCtx<T>[] = getAllColumns(originColumns)\n\n  allColumns.forEach((column) => {\n    if (!column.children) {\n      column.rowSpan = maxLevel - column.level + 1\n    } else {\n      column.rowSpan = 1\n      column.children.forEach((col) => (col.isSubColumn = true))\n    }\n    rows[column.level - 1].push(column)\n  })\n\n  return rows\n}\n\nfunction useUtils<T extends DefaultRow>(props: TableHeaderProps<T>) {\n  const parent = inject(TABLE_INJECTION_KEY)\n  const columnRows = computed(() => {\n    return convertToRows(props.store.states.originColumns.value)\n  })\n  const isGroup = computed(() => {\n    const result = columnRows.value.length > 1\n    if (result && parent) {\n      parent.state.isGroup.value = true\n    }\n    return result\n  })\n  const toggleAllSelection = (event: Event) => {\n    event.stopPropagation()\n    parent?.store.commit('toggleAllSelection')\n  }\n  return {\n    isGroup,\n    toggleAllSelection,\n    columnRows,\n  }\n}\n\nexport default useUtils\n"],"mappings":";;;;;AAOA,MAAMA,aAAA,GACJC,OACwB;EACxB,MAAMC,MAAA,GAA8B,EAAC;EAC7BD,OAAA,CAAAE,OAAA,CAASC,MAAW;IAC1B,IAAIA,MAAA,CAAOC,QAAU;MACnBH,MAAA,CAAOI,IAAA,CAAKF,MAAM;MAElBF,MAAA,CAAOI,IAAA,CAAKC,KAAM,CAAAL,MAAA,EAAQF,aAAc,CAAAI,MAAA,CAAOC,QAAQ,CAAC;IAAA,CACnD;MACLH,MAAA,CAAOI,IAAA,CAAKF,MAAM;IAAA;EACpB,CACD;EACM,OAAAF,MAAA;AACT;AAEa,MAAAM,aAAA,GACXC,aAC0B;EAC1B,IAAIC,QAAW;EACT,MAAAC,QAAA,GAAWA,CAACP,MAAA,EAA2BQ,MAA+B;IAC1E,IAAIA,MAAQ;MACHR,MAAA,CAAAS,KAAA,GAAQD,MAAA,CAAOC,KAAQ;MAC1B,IAAAH,QAAA,GAAWN,MAAA,CAAOS,KAAO;QAC3BH,QAAA,GAAWN,MAAO,CAAAS,KAAA;MAAA;IACpB;IAEF,IAAIT,MAAA,CAAOC,QAAU;MACnB,IAAIS,OAAU;MACPV,MAAA,CAAAC,QAAA,CAASF,OAAQ,CAACY,SAAc;QACrCJ,QAAA,CAASI,SAAA,EAAWX,MAAM;QAC1BU,OAAA,IAAWC,SAAU,CAAAD,OAAA;MAAA,CACtB;MACDV,MAAA,CAAOU,OAAU,GAAAA,OAAA;IAAA,CACZ;MACLV,MAAA,CAAOU,OAAU;IAAA;EACnB,CACF;EAEcL,aAAA,CAAAN,OAAA,CAASC,MAAW;IAChCA,MAAA,CAAOS,KAAQ;IACfF,QAAA,CAASP,MAAA,EAAQ,KAAS;EAAA,CAC3B;EAED,MAAMY,IAAA,GAA8B,EAAC;EACrC,SAASC,CAAI,MAAGA,CAAI,GAAAP,QAAA,EAAUO,CAAK;IAC5BD,IAAA,CAAAV,IAAA,CAAK,EAAE;EAAA;EAGR,MAAAY,UAAA,GAAkClB,aAAA,CAAcS,aAAa;EAExDS,UAAA,CAAAf,OAAA,CAASC,MAAW;IACzB,KAACA,MAAA,CAAOC,QAAU;MACbD,MAAA,CAAAe,OAAA,GAAUT,QAAW,GAAAN,MAAA,CAAOS,KAAQ;IAAA,CACtC;MACLT,MAAA,CAAOe,OAAU;MACjBf,MAAA,CAAOC,QAAA,CAASF,OAAQ,CAACiB,GAAS,IAAAA,GAAA,CAAIC,WAAA,GAAc,IAAK;IAAA;IAE3DL,IAAA,CAAKZ,MAAO,CAAAS,KAAA,GAAQ,CAAG,EAAAP,IAAA,CAAKF,MAAM;EAAA,CACnC;EAEM,OAAAY,IAAA;AACT;AAEA,SAASM,SAA+BC,KAA4B;EAC5D,MAAAX,MAAA,GAASY,MAAA,CAAOC,mBAAmB;EACnC,MAAAC,UAAA,GAAaC,QAAA,CAAS,MAAM;IAChC,OAAOnB,aAAc,CAAAe,KAAA,CAAMK,KAAM,CAAAC,MAAA,CAAOpB,aAAA,CAAcqB,KAAK;EAAA,CAC5D;EACK,MAAAC,OAAA,GAAUJ,QAAA,CAAS,MAAM;IACvB,MAAAzB,MAAA,GAASwB,UAAW,CAAAI,KAAA,CAAME,MAAS;IACzC,IAAI9B,MAAA,IAAUU,MAAQ;MACbA,MAAA,CAAAqB,KAAA,CAAMF,OAAA,CAAQD,KAAQ;IAAA;IAExB,OAAA5B,MAAA;EAAA,CACR;EACK,MAAAgC,kBAAA,GAAsBC,KAAiB;IAC3CA,KAAA,CAAMC,eAAgB;IACtBxB,MAAA,oBAAAA,MAAA,CAAQgB,KAAA,CAAMS,MAAO;EAAA,CACvB;EACO;IACLN,OAAA;IACAG,kBAAA;IACAR;EAAA,CACF;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}