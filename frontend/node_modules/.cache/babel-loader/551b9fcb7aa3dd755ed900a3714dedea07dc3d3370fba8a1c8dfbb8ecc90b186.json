{"ast":null,"code":"function useCursor(input) {\n  let selectionInfo;\n  function recordCursor() {\n    if (input.value == void 0) return;\n    const {\n      selectionStart,\n      selectionEnd,\n      value\n    } = input.value;\n    if (selectionStart == null || selectionEnd == null) return;\n    const beforeTxt = value.slice(0, Math.max(0, selectionStart));\n    const afterTxt = value.slice(Math.max(0, selectionEnd));\n    selectionInfo = {\n      selectionStart,\n      selectionEnd,\n      value,\n      beforeTxt,\n      afterTxt\n    };\n  }\n  function setCursor() {\n    if (input.value == void 0 || selectionInfo == void 0) return;\n    const {\n      value\n    } = input.value;\n    const {\n      beforeTxt,\n      afterTxt,\n      selectionStart\n    } = selectionInfo;\n    if (beforeTxt == void 0 || afterTxt == void 0 || selectionStart == void 0) return;\n    let startPos = value.length;\n    if (value.endsWith(afterTxt)) {\n      startPos = value.length - afterTxt.length;\n    } else if (value.startsWith(beforeTxt)) {\n      startPos = beforeTxt.length;\n    } else {\n      const beforeLastChar = beforeTxt[selectionStart - 1];\n      const newIndex = value.indexOf(beforeLastChar, selectionStart - 1);\n      if (newIndex !== -1) {\n        startPos = newIndex + 1;\n      }\n    }\n    input.value.setSelectionRange(startPos, startPos);\n  }\n  return [recordCursor, setCursor];\n}\nexport { useCursor };","map":{"version":3,"names":["useCursor","input","selectionInfo","recordCursor","value","selectionStart","selectionEnd","beforeTxt","slice","Math","max","afterTxt","setCursor","startPos","length","endsWith","startsWith","beforeLastChar","newIndex","indexOf","setSelectionRange"],"sources":["../../../../../packages/hooks/use-cursor/index.ts"],"sourcesContent":["import type { ShallowRef } from 'vue'\n\ninterface SelectionInfo {\n  selectionStart?: number\n  selectionEnd?: number\n  value?: string\n  beforeTxt?: string\n  afterTxt?: string\n}\n\n// Keep input cursor in the correct position when we use formatter.\nexport function useCursor(\n  input: ShallowRef<HTMLInputElement | undefined>\n): [() => void, () => void] {\n  let selectionInfo: SelectionInfo\n  function recordCursor() {\n    if (input.value == undefined) return\n\n    const { selectionStart, selectionEnd, value } = input.value\n\n    if (selectionStart == null || selectionEnd == null) return\n\n    const beforeTxt = value.slice(0, Math.max(0, selectionStart))\n    const afterTxt = value.slice(Math.max(0, selectionEnd))\n\n    selectionInfo = {\n      selectionStart,\n      selectionEnd,\n      value,\n      beforeTxt,\n      afterTxt,\n    }\n  }\n  function setCursor() {\n    if (input.value == undefined || selectionInfo == undefined) return\n\n    const { value } = input.value\n    const { beforeTxt, afterTxt, selectionStart } = selectionInfo\n\n    if (\n      beforeTxt == undefined ||\n      afterTxt == undefined ||\n      selectionStart == undefined\n    )\n      return\n\n    let startPos = value.length\n\n    if (value.endsWith(afterTxt)) {\n      startPos = value.length - afterTxt.length\n    } else if (value.startsWith(beforeTxt)) {\n      startPos = beforeTxt.length\n    } else {\n      const beforeLastChar = beforeTxt[selectionStart - 1]\n      const newIndex = value.indexOf(beforeLastChar, selectionStart - 1)\n      if (newIndex !== -1) {\n        startPos = newIndex + 1\n      }\n    }\n\n    input.value.setSelectionRange(startPos, startPos)\n  }\n\n  return [recordCursor, setCursor]\n}\n"],"mappings":"AAWO,SAASA,UACdC,KAC0B;EACtB,IAAAC,aAAA;EACJ,SAASC,YAAeA,CAAA;IACtB,IAAIF,KAAA,CAAMG,KAAS,YAAW;IAE9B,MAAM;MAAEC,cAAA;MAAgBC,YAAc;MAAAF;IAAA,IAAUH,KAAM,CAAAG,KAAA;IAElD,IAAAC,cAAA,IAAkB,QAAQC,YAAgB,UAAM;IAE9C,MAAAC,SAAA,GAAYH,KAAA,CAAMI,KAAM,IAAGC,IAAA,CAAKC,GAAI,IAAGL,cAAc,CAAC;IAC5D,MAAMM,QAAA,GAAWP,KAAM,CAAAI,KAAA,CAAMC,IAAA,CAAKC,GAAI,IAAGJ,YAAY,CAAC;IAEtCJ,aAAA;MACdG,cAAA;MACAC,YAAA;MACAF,KAAA;MACAG,SAAA;MACAI;IAAA,CACF;EAAA;EAEF,SAASC,SAAYA,CAAA;IACf,IAAAX,KAAA,CAAMG,KAAS,cAAaF,aAAiB,YAAW;IAEtD;MAAEE;IAAM,IAAIH,KAAM,CAAAG,KAAA;IACxB,MAAM;MAAEG,SAAA;MAAWI,QAAU;MAAAN;IAAA,CAAmB,GAAAH,aAAA;IAEhD,IACEK,SAAa,cACbI,QAAY,cACZN,cAAkB,YAElB;IAEF,IAAIQ,QAAA,GAAWT,KAAM,CAAAU,MAAA;IAEjB,IAAAV,KAAA,CAAMW,QAAS,CAAAJ,QAAQ,CAAG;MACjBE,QAAA,GAAAT,KAAA,CAAMU,MAAA,GAASH,QAAS,CAAAG,MAAA;IAAA,CAC1B,UAAAV,KAAA,CAAMY,UAAW,CAAAT,SAAS,CAAG;MACtCM,QAAA,GAAWN,SAAU,CAAAO,MAAA;IAAA,CAChB;MACC,MAAAG,cAAA,GAAiBV,SAAA,CAAUF,cAAiB;MAClD,MAAMa,QAAW,GAAAd,KAAA,CAAMe,OAAQ,CAAAF,cAAA,EAAgBZ,cAAA,GAAiB,CAAC;MACjE,IAAIa,QAAA,KAAa,CAAI;QACnBL,QAAA,GAAWK,QAAW;MAAA;IACxB;IAGIjB,KAAA,CAAAG,KAAA,CAAMgB,iBAAkB,CAAAP,QAAA,EAAUA,QAAQ;EAAA;EAG3C,QAACV,YAAA,EAAcS,SAAS;AACjC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}