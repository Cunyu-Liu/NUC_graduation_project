{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport { inject, computed, getCurrentInstance, toRaw, watch } from 'vue';\nimport { castArray, get, isEqual } from 'lodash-unified';\nimport { selectKey, selectGroupKey } from './token.mjs';\nimport { COMPONENT_NAME } from './option.mjs';\nimport { escapeStringRegexp } from '../../../utils/strings.mjs';\nimport { throwError } from '../../../utils/error.mjs';\nimport { isObject } from '@vue/shared';\nfunction useOption(props, states) {\n  const select = inject(selectKey);\n  if (!select) {\n    throwError(COMPONENT_NAME, \"usage: <el-select><el-option /></el-select/>\");\n  }\n  const selectGroup = inject(selectGroupKey, {\n    disabled: false\n  });\n  const itemSelected = computed(() => {\n    return contains(castArray(select.props.modelValue), props.value);\n  });\n  const limitReached = computed(() => {\n    var _a;\n    if (select.props.multiple) {\n      const modelValue = castArray((_a = select.props.modelValue) != null ? _a : []);\n      return !itemSelected.value && modelValue.length >= select.props.multipleLimit && select.props.multipleLimit > 0;\n    } else {\n      return false;\n    }\n  });\n  const currentLabel = computed(() => {\n    var _a;\n    return (_a = props.label) != null ? _a : isObject(props.value) ? \"\" : props.value;\n  });\n  const currentValue = computed(() => {\n    return props.value || props.label || \"\";\n  });\n  const isDisabled = computed(() => {\n    return props.disabled || states.groupDisabled || limitReached.value;\n  });\n  const instance = getCurrentInstance();\n  const contains = (arr = [], target) => {\n    if (!isObject(props.value)) {\n      return arr && arr.includes(target);\n    } else {\n      const valueKey = select.props.valueKey;\n      return arr && arr.some(item => {\n        return toRaw(get(item, valueKey)) === get(target, valueKey);\n      });\n    }\n  };\n  const hoverItem = () => {\n    if (!isDisabled.value) {\n      select.states.hoveringIndex = select.optionsArray.indexOf(instance.proxy);\n    }\n  };\n  const updateOption = query => {\n    const regexp = new RegExp(escapeStringRegexp(query), \"i\");\n    states.visible = regexp.test(String(currentLabel.value)) || props.created;\n  };\n  watch(() => currentLabel.value, () => {\n    if (!props.created && !select.props.remote) select.setSelected();\n  });\n  watch(() => props.value, (val, oldVal) => {\n    const {\n      remote,\n      valueKey\n    } = select.props;\n    const shouldUpdate = remote ? val !== oldVal : !isEqual(val, oldVal);\n    if (shouldUpdate) {\n      select.onOptionDestroy(oldVal, instance.proxy);\n      select.onOptionCreate(instance.proxy);\n    }\n    if (!props.created && !remote) {\n      if (valueKey && isObject(val) && isObject(oldVal) && val[valueKey] === oldVal[valueKey]) {\n        return;\n      }\n      select.setSelected();\n    }\n  });\n  watch(() => selectGroup.disabled, () => {\n    states.groupDisabled = selectGroup.disabled;\n  }, {\n    immediate: true\n  });\n  return {\n    select,\n    currentLabel,\n    currentValue,\n    itemSelected,\n    isDisabled,\n    hoverItem,\n    updateOption\n  };\n}\nexport { useOption };","map":{"version":3,"names":["useOption","props","states","select","inject","selectKey","throwError","COMPONENT_NAME","selectGroup","selectGroupKey","disabled","itemSelected","computed","contains","castArray","modelValue","value","limitReached","_a","multiple","length","multipleLimit","currentLabel","label","isObject","currentValue","isDisabled","groupDisabled","instance","getCurrentInstance","arr","target","includes","valueKey","some","item","toRaw","get","hoverItem","hoveringIndex","optionsArray","indexOf","proxy","updateOption","query","regexp","RegExp","escapeStringRegexp","visible","test","String","created","watch","remote","setSelected","val","oldVal","shouldUpdate","isEqual","onOptionDestroy","onOptionCreate","immediate"],"sources":["../../../../../../packages/components/select/src/useOption.ts"],"sourcesContent":["import { computed, getCurrentInstance, inject, toRaw, watch } from 'vue'\nimport { get, isEqual } from 'lodash-unified'\nimport {\n  ensureArray,\n  escapeStringRegexp,\n  isObject,\n  throwError,\n} from '@element-plus/utils'\nimport { selectGroupKey, selectKey } from './token'\nimport { COMPONENT_NAME } from './option'\n\nimport type { OptionInternalInstance, OptionProps, OptionStates } from './type'\n\nexport function useOption(props: OptionProps, states: OptionStates) {\n  // inject\n  const select = inject(selectKey)\n  if (!select) {\n    throwError(COMPONENT_NAME, 'usage: <el-select><el-option /></el-select/>')\n  }\n  const selectGroup = inject(selectGroupKey, { disabled: false })\n\n  // computed\n  const itemSelected = computed(() => {\n    return contains(ensureArray(select.props.modelValue), props.value)\n  })\n\n  const limitReached = computed(() => {\n    if (select.props.multiple) {\n      const modelValue = ensureArray(select.props.modelValue ?? [])\n      return (\n        !itemSelected.value &&\n        modelValue.length >= select.props.multipleLimit &&\n        select.props.multipleLimit > 0\n      )\n    } else {\n      return false\n    }\n  })\n\n  const currentLabel = computed(() => {\n    return props.label ?? (isObject(props.value) ? '' : props.value)\n  })\n\n  const currentValue = computed(() => {\n    return props.value || props.label || ''\n  })\n\n  const isDisabled = computed(() => {\n    return props.disabled || states.groupDisabled || limitReached.value\n  })\n\n  const instance = getCurrentInstance()! as OptionInternalInstance\n  const contains = <T>(arr: T[] = [], target: T) => {\n    if (!isObject(props.value)) {\n      return arr && arr.includes(target)\n    } else {\n      const valueKey = select.props.valueKey\n      return (\n        arr &&\n        arr.some((item) => {\n          return toRaw(get(item, valueKey)) === get(target, valueKey)\n        })\n      )\n    }\n  }\n\n  const hoverItem = () => {\n    if (!isDisabled.value) {\n      select.states.hoveringIndex = select.optionsArray.indexOf(instance.proxy)\n    }\n  }\n\n  const updateOption = (query: string) => {\n    const regexp = new RegExp(escapeStringRegexp(query), 'i')\n    states.visible = regexp.test(String(currentLabel.value)) || props.created\n  }\n\n  watch(\n    () => currentLabel.value,\n    () => {\n      if (!props.created && !select.props.remote) select.setSelected()\n    }\n  )\n\n  watch(\n    () => props.value,\n    (val, oldVal) => {\n      const { remote, valueKey } = select.props\n      const shouldUpdate = remote ? val !== oldVal : !isEqual(val, oldVal)\n      if (shouldUpdate) {\n        select.onOptionDestroy(oldVal, instance.proxy)\n        select.onOptionCreate(instance.proxy)\n      }\n\n      if (!props.created && !remote) {\n        if (\n          valueKey &&\n          isObject(val) &&\n          isObject(oldVal) &&\n          val[valueKey] === oldVal[valueKey]\n        ) {\n          return\n        }\n        select.setSelected()\n      }\n    }\n  )\n\n  watch(\n    () => selectGroup.disabled,\n    () => {\n      states.groupDisabled = selectGroup.disabled\n    },\n    { immediate: true }\n  )\n\n  return {\n    select,\n    currentLabel,\n    currentValue,\n    itemSelected,\n    isDisabled,\n    hoverItem,\n    updateOption,\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}